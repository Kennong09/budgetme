import{s as n}from"./index-BbApZ7g3.js";class g{static async validateGoalReference(s,r){try{const{data:e,error:o}=await n.from("goals").select("id").eq("id",s).eq("user_id",r).single();return o?(console.error("Goal validation error:",o),!1):!!e}catch(e){return console.error("Goal validation exception:",e),!1}}static async createTransaction(s){try{if(s.goal_id&&!await this.validateGoalReference(s.goal_id,s.user_id))return{success:!1,error:"Invalid goal reference: Goal does not exist or does not belong to the user"};const{data:r,error:e}=await n.from("transactions").insert(s).select().single();return e?(console.error("Transaction creation error:",e),{success:!1,error:e.message}):{success:!0,data:r}}catch(r){return console.error("Transaction creation exception:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}static async updateTransaction(s,r,e){try{if(r.goal_id&&!await this.validateGoalReference(r.goal_id,e))return{success:!1,error:"Invalid goal reference: Goal does not exist or does not belong to the user"};const{data:o,error:t}=await n.from("transactions").update(r).eq("id",s).eq("user_id",e).select().single();return t?(console.error("Transaction update error:",t),{success:!1,error:t.message}):{success:!0,data:o}}catch(o){return console.error("Transaction update exception:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}static async cleanupInvalidGoalReferences(s){try{const{data:r,error:e}=await n.from("transactions").select("id, goal_id").eq("user_id",s).not("goal_id","is",null);if(e)return console.error("Error finding transactions for cleanup:",e),{success:!1,cleanedCount:0,error:e.message};if(!r||r.length===0)return{success:!0,cleanedCount:0};const o=Array.from(new Set(r.map(a=>a.goal_id))),{data:t,error:c}=await n.from("goals").select("id").eq("user_id",s).in("id",o);if(c)return console.error("Error checking valid goals:",c),{success:!1,cleanedCount:0,error:c.message};const d=new Set(t?.map(a=>a.id)||[]),i=r.filter(a=>!d.has(a.goal_id));if(i.length===0)return{success:!0,cleanedCount:0};const{error:l}=await n.from("transactions").update({goal_id:null}).in("id",i.map(a=>a.id));return l?(console.error("Error cleaning up transactions:",l),{success:!1,cleanedCount:0,error:l.message}):{success:!0,cleanedCount:i.length}}catch(r){return console.error("Cleanup exception:",r),{success:!1,cleanedCount:0,error:r instanceof Error?r.message:"Unknown error"}}}}export{g as T};
