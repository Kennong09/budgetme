var ze=Object.defineProperty;var Be=(u,t,s)=>t in u?ze(u,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[t]=s;var we=(u,t,s)=>Be(u,typeof t!="symbol"?t+"":t,s);import{j as e}from"./ui-vendor-Cn1Vfl4w.js";import{r as D,R as be}from"./react-vendor-D4A9EtXC.js";import{j as Te,s as L,u as ve,f as de,k as ke,y as $}from"./index-BbApZ7g3.js";import{a as ye}from"./utils-vendor-DvLzUnYR.js";import{R as Pe,C as Ce,e as Ee,X as Fe,Y as De,f as Re,A as pe,L as ce,g as He}from"./chart-vendor-B0c7K_uV.js";/* empty css                       */const Me=Te.PREDICTION_API_URL;function fe(u){switch(u){case"3months":case"months_3":return"months_3";case"6months":case"months_6":return"months_6";case"1year":case"year_1":return"year_1";default:return console.warn("‚ö†Ô∏è Unknown timeframe format:",u,"- defaulting to months_3"),"months_3"}}function qe(u){switch(u){case"months_3":case"3months":return"3months";case"months_6":case"6months":return"6months";case"year_1":case"1year":return"1year";default:return console.warn("‚ö†Ô∏è Unknown timeframe format:",u,"- defaulting to 3months"),"3months"}}function Ye(u){switch(fe(u)){case"months_3":return 90;case"months_6":return 180;case"year_1":return 365;default:return 90}}function Ae(u){switch(fe(u)){case"months_3":return 3;case"months_6":return 6;case"year_1":return 12;default:return 3}}class je{static async generateProphetPredictions(t,s="months_3",a=!1){let i=null;const n=fe(s);console.log("üîÑ Timeframe normalization:",{input:s,normalized:n});try{if(a)console.log("üîÑ Force regenerate enabled - bypassing cache and generating fresh prediction");else{console.log("Checking for cached prediction for user:",t,"timeframe:",n);const h=await this.getCachedPredictionFromDB(t,n);if(h.found&&h.data)return console.log("‚úì Found valid cached prediction, returning cached data"),h.data}console.log("Generating new prediction");const r=await this.checkUsageLimitsFromDB(t,"prophet");if(!r.can_request)throw new Error(`Usage limit exceeded. ${r.remaining} requests remaining until ${r.reset_date}`);const c=await this.fetchUserTransactionData(t);if(c.length<3)throw new Error("At least 3 transactions are required for predictions");i=await this.logPredictionRequestToDB(t,"/api/v1/predictions/generate",n,{transaction_count:c.length,api_call:"prophet"});const o={user_id:t,transaction_data:c.slice(0,20),timeframe:n,seasonality_mode:"additive",include_categories:!0,include_insights:!0};let l;try{console.log("Calling FastAPI prediction service..."),l=(await ye.post(`${Me}/api/v1/predictions/generate`,o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${await this.getAuthToken()}`},timeout:45e3})).data,i&&!i.startsWith("fallback-")&&await this.updateRequestStatusInDB(i,"completed",l,null,Date.now()-parseInt(i.split("-")[0]||"0"))}catch(h){console.warn("FastAPI call failed, using fallback:",h.message),i&&!i.startsWith("fallback-")&&await this.updateRequestStatusInDB(i,"failed",null,{error:h.message,fallback_used:!0}),l=this.generateFallbackPredictions(t,n,c)}console.log("üíæ About to save prediction to database...");const m=i&&!i.startsWith("fallback-")?i:null,x=await this.storeProphetPredictionToDB(t,m,n,l.predictions,l.category_forecasts||{},l.model_accuracy,l.confidence_score,l.user_profile);return console.log("üíæ Prediction saved with ID:",x),l.insights&&x&&(console.log("Storing AI insights to database..."),await this.storeAIInsightsToDB(t,x,l.insights,"openrouter","openai/gpt-oss-120b:free"),console.log("AI insights stored successfully")),await this.incrementUsageInDB(t,"prophet"),console.log(`Prediction generated and stored with ID: ${x}`),l}catch(r){throw console.error("Prediction generation error:",r),i&&await this.updateRequestStatusInDB(i,"failed",null,{error:r.message}),new Error(`Failed to generate predictions: ${r.message}`)}}static generateFallbackPredictions(t,s,a){const i=Ye(s),n=Ae(s);console.warn("‚ö†Ô∏è FALLBACK PREDICTIONS USED - API unavailable or failed",{userId:t,timeframe:s,transactionCount:a.length,timestamp:new Date().toISOString(),reason:"API call failed or unavailable"}),console.log("üìä Fallback prediction generator:",{timeframe:s,days:i,months:n});const r=a.filter(S=>S.type==="income"),c=a.filter(S=>S.type==="expense"),o=r.reduce((S,F)=>S+F.amount,0),l=c.reduce((S,F)=>S+F.amount,0),m=a.map(S=>new Date(S.date)),x=new Set(m.map(S=>`${S.getFullYear()}-${S.getMonth()}`)),h=Math.max(1,x.size);let d=o/h;const p=l/h;o===0&&l>0&&(d=p*1.2,console.warn("‚ö†Ô∏è No income transactions found. Estimating income as 120% of expenses:",{userId:t,timeframe:s,monthlyExpense:p,estimatedIncome:d,timestamp:new Date().toISOString()}));const b=d;d>b*3&&console.error("‚ùå VALIDATION ERROR: Unrealistic prediction detected - Income exceeds 3x historical average:",{userId:t,timeframe:s,predictedIncome:d,historicalAverage:b,ratio:d/b,timestamp:new Date().toISOString(),validationRule:"income_exceeds_3x_historical"}),p>d*2&&console.error("‚ùå VALIDATION ERROR: Unrealistic expense prediction - Expenses exceed 2x income:",{userId:t,timeframe:s,predictedExpenses:p,predictedIncome:d,ratio:p/d,timestamp:new Date().toISOString(),validationRule:"expenses_exceed_2x_income"}),console.log("üìä Generating stable predictions from transaction data:",{totalIncome:o,totalExpenses:l,transactionMonths:h,monthlyIncome:d,monthlyExpense:p,incomeTransactions:r.length,expenseTransactions:c.length});const A=[],H=.025,ie=H/12;for(let S=1;S<=n;S++){const F=new Date;F.setMonth(F.getMonth()+S),F.setDate(1);const q=1+ie*S,N=d*q,Z=(N-d)/d*100;Math.abs(Z)>50&&console.error("‚ùå VALIDATION ERROR: Unrealistic growth rate detected in prediction:",{userId:t,timeframe:s,monthIndex:S,futureDate:F.toISOString().substring(0,7),baseIncome:d.toFixed(2),predictedIncome:N.toFixed(2),growthRate:`${Z.toFixed(2)}%`,threshold:"50%",timestamp:new Date().toISOString(),validationRule:"growth_rate_exceeds_50_percent"}),Math.abs(Z)>20&&Math.abs(Z)<=50&&console.warn("‚ö†Ô∏è VALIDATION WARNING: High growth rate detected in prediction:",{userId:t,timeframe:s,monthIndex:S,futureDate:F.toISOString().substring(0,7),baseIncome:d.toFixed(2),predictedIncome:N.toFixed(2),growthRate:`${Z.toFixed(2)}%`,threshold:"20-50%",timestamp:new Date().toISOString(),validationRule:"growth_rate_exceeds_20_percent"}),A.push({date:F,predicted:Math.max(0,N),upper:N*1.1,lower:N*.9,trend:N,seasonal:0,confidence:.8})}console.log("üìä Generated monthly income predictions:",{months:n,baseMonthlyIncome:d,predictions:A.map(S=>({month:S.date.toISOString().substring(0,7),predicted:S.predicted.toFixed(2),growthFromBase:((S.predicted-d)/d*100).toFixed(2)+"%"}))});const re={},W=new Map;c.forEach(S=>{const F=S.category||"Other";W.has(F)||W.set(F,{total:0,count:0});const q=W.get(F);q.total+=S.amount,q.count+=1}),W.forEach((S,F)=>{const q=S.total/h,N=q*(1+H),Z=N-q;let ae="stable";const g=Z/q*100;g>3?ae="increasing":g<-3&&(ae="decreasing"),re[F]={category:F,historicalAverage:q,predicted:N,confidence:.85,trend:ae}});const E=Object.values(re).reduce((S,F)=>S+F.predicted,0);console.log("üìä Generated stable category forecasts (MONTHLY values):",{userId:t,timeframe:s,categories:Array.from(W.keys()),transactionMonths:h,totalMonthlyExpenseForecast:E,categoryDetails:Object.entries(re).map(([S,F])=>({category:S,monthlyHistorical:F.historicalAverage,monthlyPredicted:F.predicted,growthRate:((F.predicted-F.historicalAverage)/F.historicalAverage*100).toFixed(2)+"%"})),timestamp:new Date().toISOString()}),E>d*1.5&&console.error("‚ùå VALIDATION ERROR: Total category expenses exceed 150% of income:",{userId:t,timeframe:s,totalExpenses:E.toFixed(2),monthlyIncome:d.toFixed(2),ratio:(E/d).toFixed(2),timestamp:new Date().toISOString(),validationRule:"category_expenses_exceed_150_percent_income"}),Object.entries(re).forEach(([S,F])=>{const q=(F.predicted-F.historicalAverage)/F.historicalAverage*100;Math.abs(q)>30&&console.warn("‚ö†Ô∏è VALIDATION WARNING: High category growth rate detected:",{userId:t,timeframe:s,category:S,historicalAverage:F.historicalAverage.toFixed(2),predicted:F.predicted.toFixed(2),growthRate:`${q.toFixed(2)}%`,threshold:"30%",timestamp:new Date().toISOString(),validationRule:"category_growth_exceeds_30_percent"})});const M=Object.values(re).reduce((S,F)=>S+F.predicted,0),X=d>0?(d-M)/d:0;return{user_id:t,timeframe:s,predictions:A,model_accuracy:{mape:5,rmse:50,mae:30,data_points:a.length},confidence_score:.85,user_profile:{avgMonthlyIncome:d,avgMonthlyExpenses:p,savingsRate:X,budgetCategories:Array.from(W.keys()),financialGoals:[],spendingPatterns:[],transactionCount:a.length},category_forecasts:re,insights:[{title:"Stable Financial Forecast",description:"Predictions based on your actual transaction patterns with realistic 2-3% annual growth assumptions. Income and expenses are calculated from your real transaction history.",category:"trend",confidence:.85}],usage_count:1,max_usage:10,reset_date:new Date(Date.now()+30*24*60*60*1e3).toISOString(),generated_at:new Date().toISOString(),expires_at:new Date(Date.now()+24*60*60*1e3).toISOString()}}static async checkUsageLimit(t){try{const s=await this.checkUsageLimitsFromDB(t,"prophet");return{user_id:t,current_usage:s.current_usage,max_usage:s.limit,reset_date:s.reset_date,exceeded:!s.can_request,remaining:s.remaining,tier:s.tier,rate_limited:s.rate_limited,rate_limit_remaining:s.rate_limit_remaining,suspended:s.suspended}}catch(s){return console.error("Error checking usage limit:",s),{user_id:t,current_usage:0,max_usage:5,reset_date:new Date(Date.now()+30*24*60*60*1e3).toISOString(),exceeded:!1,remaining:5}}}static async checkUsageLimitsFromDB(t,s="prophet"){try{const{data:a,error:i}=await L.rpc("can_make_prediction_request",{p_user_id:t,p_service_type:s});return i?(console.error("Error checking usage limits:",i),{can_request:!0,current_usage:0,limit:10,remaining:10,tier:"free",rate_limited:!1,reset_date:new Date().toISOString()}):a}catch(a){return console.error("Database error checking usage limits:",a),{can_request:!0,current_usage:0,limit:5,remaining:5,tier:"free",rate_limited:!1,reset_date:new Date().toISOString()}}}static async incrementUsageInDB(t,s="prophet"){try{const{data:a,error:i}=await L.rpc("increment_prediction_usage",{p_user_id:t,p_service_type:s});return i?(console.error("Error incrementing usage:",i),!1):(console.log(`Successfully incremented ${s} usage for user:`,t),a===!0)}catch(a){return console.error("Database error incrementing usage:",a),!1}}static async logPredictionRequestToDB(t,s,a,i,n){try{const{data:r,error:c}=await L.rpc("log_prediction_request",{p_user_id:t,p_api_endpoint:s,p_timeframe:a,p_input_data:i,p_external_request_id:n});return c?(console.error("Error logging prediction request:",c),`fallback-${Date.now()}`):r}catch(r){return console.error("Database error logging request:",r),`fallback-${Date.now()}`}}static async updateRequestStatusInDB(t,s,a,i,n){try{const{data:r,error:c}=await L.rpc("update_request_status",{p_request_id:t,p_status:s,p_response_data:a,p_error_details:i,p_api_response_time_ms:n});return c?(console.error("Error updating request status:",c),!1):r===!0}catch(r){return console.error("Database error updating request status:",r),!1}}static async storeAIInsightsToDB(t,s,a,i="openrouter",n="openai/gpt-oss-120b:free"){try{if(!Array.isArray(a)||a.length===0)return console.log("No AI Financial Analysis insights to store (using fallback/Prophet insights)"),null;console.log("Storing AI Financial Analysis insights from OpenRouter...");const r=a;let c=null,o=null,l=null;a.forEach(h=>{h.risk_assessment&&(c=h.risk_assessment),h.recommendations&&(o=h.recommendations),h.opportunity_areas&&(l=h.opportunity_areas)});const{data:m,error:x}=await L.from("ai_insights").insert({user_id:t,prediction_id:s,ai_service:i,model_used:n,insights:r,risk_assessment:c,recommendations:o,opportunity_areas:l,confidence_level:.8,generated_at:new Date().toISOString(),expires_at:new Date(Date.now()+30*60*1e3).toISOString()}).select("id").single();return x?(console.error("Error storing AI insights to database:",x),null):(console.log("AI Financial Analysis insights stored to database successfully:",m?.id),m?.id||null)}catch(r){return console.error("Exception storing AI insights:",r),null}}static async storeProphetPredictionToDB(t,s,a,i,n,r,c,o){try{console.log("üìù Attempting to store prediction to database...",{userId:t,requestId:s||"null (fallback)",timeframe:a,confidenceScore:c,predictionsCount:i?.length||0});const{data:l,error:m}=await L.rpc("store_prophet_prediction",{p_user_id:t,p_request_id:s,p_timeframe:a,p_predictions:i,p_category_forecasts:n,p_model_accuracy:r,p_confidence_score:c,p_user_profile:o});if(m)throw console.error("‚ùå ERROR storing Prophet prediction:",m),console.error("Error details:",JSON.stringify(m,null,2)),new Error(`Failed to store prediction: ${m.message}`);return console.log("‚úÖ Prediction stored successfully! ID:",l),l}catch(l){throw console.error("‚ùå Database error storing prediction:",l),console.error("Stack trace:",l.stack),l}}static async getCachedPredictionFromDB(t,s){const a=fe(s);console.log("üîÑ Database query timeframe:",{input:s,normalized:a});try{const{data:i,error:n}=await L.rpc("get_cached_prophet_prediction",{p_user_id:t,p_timeframe:a});if(n)return console.error("Error getting cached prediction:",n),{found:!1};if(i&&i.found){const r={user_id:t,timeframe:s,generated_at:i.generated_at,expires_at:new Date(Date.now()+864e5).toISOString(),predictions:Array.isArray(i.predictions)?i.predictions.map(c=>({date:new Date(c.date),predicted:c.predicted,upper:c.upper,lower:c.lower,trend:c.trend,seasonal:c.seasonal||0,confidence:c.confidence})):[],category_forecasts:i.category_forecasts||{},model_accuracy:i.model_accuracy||{mae:0,mape:0,rmse:0,data_points:0},confidence_score:i.confidence_score||.75,user_profile:i.user_profile||{avgMonthlyIncome:0,avgMonthlyExpenses:0,savingsRate:0,budgetCategories:[],financialGoals:[],spendingPatterns:[],transactionCount:0},insights:[],usage_count:0,max_usage:10,reset_date:new Date().toISOString()};return console.log("Retrieved cached prediction:",{id:i.id,generated_at:i.generated_at,predictions_count:r.predictions.length}),{found:!0,data:r}}return{found:!1}}catch(i){return console.error("Database error getting cached prediction:",i),{found:!1}}}static async fetchUserTransactionData(t){try{const s=new Date,a=new Date;a.setMonth(a.getMonth()-12);const{data:i,error:n}=await L.from("transactions").select("*").eq("user_id",t).gte("date",a.toISOString()).lte("date",s.toISOString()).order("date",{ascending:!0});if(n)throw new Error(`Failed to fetch transactions: ${n.message}`);if(!i||i.length===0)return console.log("No transaction data found for user:",t),[];console.log(`Found ${i.length} transactions for user ${t}:`,i.map(l=>({date:l.date,amount:l.amount,type:l.type,category:l.category,description:l.description})));const r=i.map(l=>{const m=l.type||(Number(l.amount)>=0?"income":"expense"),x=Math.abs(Number(l.amount));return{date:new Date(l.date).toISOString(),amount:x,type:m,category:l.category||"Other",description:l.description||""}});console.log(`Formatted ${r.length} transactions for Prophet API:`,r.map(l=>({date:l.date.substring(0,10),amount:l.amount,type:l.type,category:l.category})));const c=r.filter(l=>l.type==="expense").length,o=r.filter(l=>l.type==="income").length;return console.log(`Transaction breakdown: ${c} expenses, ${o} income`),r}catch(s){throw console.error("Error fetching transaction data:",s),s}}static async getAuthToken(){try{const{data:{session:t},error:s}=await L.auth.getSession();if(s)throw new Error(`Authentication error: ${s.message}`);if(!t?.access_token)throw new Error("No valid session found. Please log in.");return t.access_token}catch(t){throw console.error("Error getting auth token:",t),t}}static async cachePredictionResults(t,s){try{const a=`prediction_cache_${t}_${s.timeframe}`,i={data:s,timestamp:Date.now(),expires:new Date(s.expires_at).getTime()};localStorage.setItem(a,JSON.stringify(i))}catch(a){console.error("Error caching prediction results:",a)}}static getCachedPredictions(t,s){try{const a=`prediction_cache_${t}_${s}`,i=localStorage.getItem(a);if(!i)return null;const n=JSON.parse(i);return Date.now()>n.expires?(localStorage.removeItem(a),null):n.data}catch(a){return console.error("Error getting cached predictions:",a),null}}static async validatePredictionData(t,s){try{const a=await this.getAuthToken(),i={user_id:t,transaction_data:s,timeframe:"months_3",seasonality_mode:"additive",include_categories:!1,include_insights:!1};return(await ye.post(`${Me}/api/v1/predictions/validate`,i,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}})).data}catch(a){return console.error("Error validating prediction data:",a),{valid:!1,errors:[a.message],warnings:[]}}}static async fetchUserFinancialData(t,s=24){try{const a=new Date,i=new Date;i.setMonth(i.getMonth()-s);const n=await this.fetchUserTransactionData(t);if(n.length===0)return console.log("No transactions found for user, returning empty financial data:",t),[];const r=new Map;return n.forEach(o=>{const l=new Date(o.date),m=`${l.getFullYear()}-${l.getMonth()}`;r.has(m)||r.set(m,{income:0,expenses:0,date:new Date(l.getFullYear(),l.getMonth(),1)});const x=r.get(m);o.type==="income"?x.income+=o.amount:o.type==="expense"&&(x.expenses+=o.amount)}),Array.from(r.values()).map(o=>({date:o.date,income:o.income,expenses:o.expenses,balance:o.income-o.expenses})).sort((o,l)=>o.date.getTime()-l.date.getTime())}catch(a){throw console.error("Error fetching user financial data:",a),new Error("Failed to fetch financial data")}}static async generateCategoryForecasts(t){try{const s=await this.generateProphetPredictions(t,"months_3");return Object.entries(s.category_forecasts).map(([i,n])=>({category:i,historicalAverage:n.historical_average||n.historicalAverage,predicted:n.predicted_average||n.predicted,confidence:n.confidence,trend:n.trend,forecast_data:n.forecast_data})).sort((i,n)=>n.predicted-i.predicted)}catch(s){return console.error("Error generating category forecasts:",s),this.generateFallbackCategoryForecasts(t)}}static async generateFallbackCategoryForecasts(t){try{const s=await this.fetchUserTransactionData(t),a=new Map;return s.filter(n=>n.type==="expense").forEach(n=>{const r=n.category||"Other";a.has(r)||a.set(r,{total:0,count:0});const c=a.get(r);c.total+=n.amount,c.count+=1}),Array.from(a.entries()).map(([n,r])=>{const c=r.total/3,o=Math.random()*.1-.05,l=c*(1+o);let m="stable";return o>.02?m="increasing":o<-.02&&(m="decreasing"),{category:n,historicalAverage:c,predicted:l,confidence:Math.max(.6,1-(r.count<5?.3:0)),trend:m}}).sort((n,r)=>r.predicted-n.predicted)}catch(s){return console.error("Error generating fallback category forecasts:",s),[]}}static async buildUserFinancialProfile(t){try{try{return(await this.generateProphetPredictions(t,"months_3")).user_profile}catch(h){console.warn("Prophet profile generation failed, using fallback:",h)}const s=await this.fetchUserFinancialData(t,6),a=await this.fetchUserTransactionData(t),i=[],n=[],r=s.length>0?s.reduce((h,d)=>h+d.income,0)/s.length:0,c=s.length>0?s.reduce((h,d)=>h+d.expenses,0)/s.length:0,o=r>0?(r-c)/r:0,l=i.map(h=>h.category?.categoryName||"Unknown"),m=Array.from(new Set(a.map(h=>h.category).filter(Boolean))),x=m.map(h=>{const d=a.filter(A=>A.category===h&&A.type==="expense"),p=d.reduce((A,H)=>A+H.amount,0),b=d.length>0?p/d.length:0;return{category:h,averageAmount:b,frequency:d.length,seasonality:1}});return{avgMonthlyIncome:r,avgMonthlyExpenses:c,savingsRate:o,budgetCategories:[...l,...m],financialGoals:n,spendingPatterns:x,transactionCount:a.length}}catch(s){return console.error("Error building user financial profile:",s),{avgMonthlyIncome:0,avgMonthlyExpenses:0,savingsRate:0,budgetCategories:[],financialGoals:[],spendingPatterns:[],transactionCount:0}}}static detectSeasonalPatterns(t){if(t.length<12)return[];const s=[],a=new Map;t.forEach(n=>{const r=n.date.getMonth();a.has(r)||a.set(r,0),a.set(r,a.get(r)+n.expenses)});const i=t.reduce((n,r)=>n+r.expenses,0)/t.length;return a.forEach((n,r)=>{const c=t.filter(m=>m.date.getMonth()===r).length,l=(n/c-i)/i;Math.abs(l)>.15&&s.push({name:`Month ${r+1} Pattern`,period:12,amplitude:Math.abs(l),phase:r})}),s}static async buildPredictionContext(t){try{const[s,a,i]=await Promise.all([this.fetchUserFinancialData(t),this.buildUserFinancialProfile(t),this.generateCategoryForecasts(t)]),n=this.detectSeasonalPatterns(s);return{historicalData:s,userProfile:a,categoryBreakdown:i,seasonalPatterns:n}}catch(s){throw console.error("Error building prediction context:",s),new Error("Failed to build prediction context")}}static subscribeToRealtimeUpdates(t,s){const a=[],i=L.channel("prediction-transactions").on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${t}`},s).subscribe(),n=L.channel("prediction-budgets").on("postgres_changes",{event:"*",schema:"public",table:"budgets",filter:`user_id=eq.${t}`},s).subscribe(),r=L.channel("prediction-goals").on("postgres_changes",{event:"*",schema:"public",table:"goals",filter:`user_id=eq.${t}`},s).subscribe();return a.push(i,n,r),()=>{a.forEach(c=>{c&&L.removeChannel(c)})}}}const Se=({userId:u,serviceType:t="prophet",compact:s=!1})=>{const[a,i]=D.useState({current_usage:0,limit:10,remaining:10,reset_date:new Date().toISOString(),loading:!0});D.useEffect(()=>{n();const h=setInterval(n,3e4);return()=>clearInterval(h)},[u,t]);const n=async()=>{try{const h=await je.checkUsageLimitsFromDB(u,t);console.log("üìä Usage API Response:",h);const d=h.limit||10;let p=h.remaining!==void 0?h.remaining:d;p>d&&(console.warn("‚ö†Ô∏è Remaining exceeds limit, capping to limit:",{remaining:p,limit:d}),p=d);let b=h.current_usage||0;const A=Math.max(0,d-p);b!==A&&(console.warn("‚ö†Ô∏è Usage data inconsistency detected, recalculating:",{reported_current_usage:b,calculated_current_usage:A,limit:d,remaining:p}),b=A),b+p!==d&&(console.warn("‚ö†Ô∏è Usage math doesn't add up, forcing consistency:",{currentUsage:b,remaining:p,limit:d,sum:b+p}),b=Math.max(0,d-p)),i({current_usage:Math.max(0,b),limit:d,remaining:Math.max(0,p),reset_date:h.reset_date,tier:h.tier,rate_limited:h.rate_limited,suspended:h.suspended,loading:!1}),console.log("‚úÖ Final usage data:",{current_usage:Math.max(0,b),limit:d,remaining:Math.max(0,p)})}catch(h){console.error("Failed to load usage data:",h),i(d=>({...d,loading:!1,error:h.message}))}},r=()=>a.current_usage/a.limit*100,c=()=>{const h=r();return h>=90?"bg-danger":h>=70?"bg-warning":"bg-success"},o=()=>a.suspended||a.rate_limited||a.remaining===0?"badge-danger":a.remaining<=2?"badge-warning":"badge-success",l=()=>a.suspended?"Suspended":a.rate_limited?"Rate Limited":a.remaining===0?"Limit Reached":a.remaining<=2?"Low Usage":"Active",m=()=>{try{const h=new Date(a.reset_date),d=new Date,p=h.getTime()-d.getTime(),b=Math.floor(p/(1e3*60*60)),A=Math.floor(b/24);return A>0?`${A} day${A>1?"s":""}`:b>0?`${b} hour${b>1?"s":""}`:"Less than 1 hour"}catch{return"Unknown"}};if(a.loading)return e.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),"Loading usage data..."]});if(a.error)return e.jsxs("div",{className:"alert alert-warning small mb-0 py-2",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),"Unable to load usage data"]});if(s)return e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("span",{className:`badge ${o()} px-2 py-1`,children:[a.remaining," / ",a.limit," Remaining"]})});const x=()=>e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:`fas fa-chart-line text-${a.remaining===0?"rose":"indigo"}-500 text-[10px]`}),t==="prophet"?"Prediction":"Insights"," Usage"]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-semibold ${a.remaining===0?"bg-rose-100 text-rose-600":a.remaining<=2?"bg-amber-100 text-amber-600":"bg-emerald-100 text-emerald-600"}`,children:l()})]}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-[10px] text-gray-500",children:[a.current_usage," of ",a.limit," used"]}),e.jsxs("span",{className:"text-[10px] font-semibold text-gray-700",children:[a.remaining," left"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${c()}`,style:{width:`${r()}%`}})}),e.jsxs("div",{className:"flex items-center text-[9px] text-gray-500",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Resets in ",m(),a.tier&&e.jsxs("span",{className:"ml-2",children:["‚Ä¢ Tier: ",a.tier]})]}),a.remaining===0&&e.jsx("div",{className:"mt-2 bg-rose-50 border border-rose-100 rounded-lg p-2",children:e.jsxs("p",{className:"text-[9px] text-rose-700",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),"Limit reached. Resets in ",m(),"."]})})]})]})});return e.jsxs(e.Fragment,{children:[e.jsx(x,{}),e.jsx("div",{className:"card shadow-sm border-left-primary mb-4 d-none d-md-block",children:e.jsxs("div",{className:"card-body py-3",children:[e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{className:`fas fa-chart-line mr-2 ${a.remaining===0?"text-danger":"text-primary"}`}),e.jsxs("h6",{className:"m-0 font-weight-bold",children:[t==="prophet"?"AI Prediction":"AI Insights"," Usage"]}),e.jsx("span",{className:`badge ${o()} ml-2 px-2`,children:l()})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{className:"small text-muted",children:[a.current_usage," of ",a.limit," requests used"]}),e.jsxs("span",{className:"small font-weight-bold",children:[a.remaining," remaining"]})]}),e.jsx("div",{className:"progress",style:{height:"10px"},children:e.jsx("div",{className:`progress-bar ${c()}`,role:"progressbar",style:{width:`${r()}%`},"aria-valuenow":a.current_usage,"aria-valuemin":0,"aria-valuemax":a.limit})})]}),e.jsxs("div",{className:"d-flex align-items-center small text-muted",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Resets in ",e.jsx("strong",{className:"ml-1",children:m()}),a.tier&&e.jsxs("span",{className:"ml-3",children:[e.jsx("i",{className:"fas fa-layer-group mr-1"}),"Tier: ",e.jsx("strong",{children:a.tier})]})]})]}),e.jsx("div",{className:"col-md-4 text-right",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"display-4 font-weight-bold",style:{color:a.remaining===0?"#e74a3b":a.remaining<=2?"#f6c23e":"#1cc88a"},children:a.remaining}),e.jsx("div",{className:"small text-muted",children:"Requests Left"})]})})]}),a.suspended&&e.jsxs("div",{className:"alert alert-danger mb-0 mt-3",children:[e.jsx("i",{className:"fas fa-ban mr-2"}),e.jsx("strong",{children:"Account Suspended:"})," Your account has been suspended. Please contact support."]}),a.rate_limited&&!a.suspended&&e.jsxs("div",{className:"alert alert-warning mb-0 mt-3",children:[e.jsx("i",{className:"fas fa-hourglass-half mr-2"}),e.jsx("strong",{children:"Rate Limited:"})," You've made too many requests. Please wait before trying again."]}),a.remaining===0&&!a.suspended&&!a.rate_limited&&e.jsxs("div",{className:"alert alert-danger mb-0 mt-3",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),e.jsx("strong",{children:"Usage Limit Reached:"})," You've reached your ",t==="prophet"?"prediction":"insights"," limit. Your quota will reset in ",m(),"."]}),a.remaining>0&&a.remaining<=2&&!a.suspended&&!a.rate_limited&&e.jsxs("div",{className:"alert alert-warning mb-0 mt-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),e.jsx("strong",{children:"Low Usage Warning:"})," You have only ",a.remaining," ",t==="prophet"?"prediction":"insights"," request",a.remaining>1?"s":""," remaining."]})]})})]})},We=({showModelDetails:u,onToggleModelDetails:t,onExportCSV:s,onExportPredictions:a,onViewHistory:i,onExportInsights:n,onGeneratePredictions:r,generating:c=!1,hasProphetData:o=!1})=>{const{user:l}=ve();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-base font-bold text-gray-800",children:"AI Predictions"}),o&&e.jsxs("span",{className:"bg-emerald-100 text-emerald-600 px-1.5 py-0.5 rounded-full text-[9px] font-semibold",children:[e.jsx("i",{className:"fas fa-check-circle mr-0.5"}),"Cached"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsx("button",{onClick:r,disabled:c,className:`w-9 h-9 rounded-full ${o?"bg-emerald-500 hover:bg-emerald-600":"bg-blue-500 hover:bg-blue-600"} text-white flex items-center justify-center shadow-md transition-all active:scale-95 disabled:opacity-50`,"aria-label":o?"Regenerate predictions":"Generate predictions",children:c?e.jsx("i",{className:"fas fa-spinner fa-spin text-xs"}):e.jsx("i",{className:`fas fa-${o?"sync-alt":"magic"} text-xs`})}),i&&e.jsx("button",{onClick:i,className:"w-9 h-9 rounded-full bg-sky-500 hover:bg-sky-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95","aria-label":"View history",children:e.jsx("i",{className:"fas fa-history text-xs"})}),(a||s)&&e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"w-9 h-9 rounded-full bg-indigo-500 hover:bg-indigo-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95",type:"button",id:"mobileExportDropdown","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false","aria-label":"Export",children:e.jsx("i",{className:"fas fa-download text-xs"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-right shadow","aria-labelledby":"mobileExportDropdown",children:[e.jsxs("button",{className:"dropdown-item text-sm",onClick:()=>a?a("json"):s?.(),children:[e.jsx("i",{className:"fas fa-chart-line fa-sm fa-fw mr-2 text-primary"}),"Predictions"]}),n&&e.jsxs("button",{className:"dropdown-item text-sm",onClick:()=>n("json"),children:[e.jsx("i",{className:"fas fa-lightbulb fa-sm fa-fw mr-2 text-warning"}),"AI Insights"]})]})]})]})]})}),e.jsxs("div",{className:"d-none d-md-flex align-items-center justify-content-between mb-4",children:[e.jsxs("h1",{className:"h3 mb-0 text-gray-800 animate__animated animate__fadeIn",children:["AI Financial Predictions",o&&e.jsxs("span",{className:"badge badge-success ml-3",style:{fontSize:"0.6rem",verticalAlign:"middle"},children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Cached"]})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[l?.id&&e.jsx("div",{className:"mr-3",children:e.jsx(Se,{userId:l.id,serviceType:"prophet",compact:!0})}),r&&e.jsx("button",{onClick:r,disabled:c,className:"d-none d-sm-inline-block btn shadow-sm mr-2 animate__animated animate__fadeIn",style:{backgroundColor:o?"#10b981":"#3b82f6",color:"white",borderColor:o?"#10b981":"#3b82f6",minWidth:"190px",height:"38px",padding:"8px 16px",fontSize:"14px",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseEnter:m=>m.currentTarget.style.backgroundColor=o?"#059669":"#2563eb",onMouseLeave:m=>m.currentTarget.style.backgroundColor=o?"#10b981":"#3b82f6",title:o?"Generate new predictions (will use rate limit)":"Generate predictions from your transaction data",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-2",role:"status"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas fa-${o?"sync-alt":"magic"} mr-2`}),o?"Regenerate":"Generate"," Predictions"]})}),i&&e.jsxs("button",{onClick:i,className:"d-none d-sm-inline-block btn shadow-sm mr-2 animate__animated animate__fadeIn",style:{backgroundColor:"#0ea5e9",color:"white",borderColor:"#0ea5e9",minWidth:"150px",height:"38px",padding:"8px 16px",fontSize:"14px",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseEnter:m=>m.currentTarget.style.backgroundColor="#0284c7",onMouseLeave:m=>m.currentTarget.style.backgroundColor="#0ea5e9",children:[e.jsx("i",{className:"fas fa-history mr-2"}),"View History"]}),e.jsxs("button",{onClick:t,className:"d-none d-sm-inline-block btn shadow-sm mr-2 animate__animated animate__fadeIn",style:{backgroundColor:"#6366f1",color:"white",borderColor:"#6366f1",minWidth:"170px",height:"38px",padding:"8px 16px",fontSize:"14px",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseEnter:m=>m.currentTarget.style.backgroundColor="#4f46e5",onMouseLeave:m=>m.currentTarget.style.backgroundColor="#6366f1",children:[e.jsx("i",{className:"fas fa-brain mr-2"}),"AI Model Details"]}),(a||s)&&e.jsxs("button",{onClick:()=>{a?a("json"):s&&s()},className:"d-none d-sm-inline-block btn shadow-sm mr-2 animate__animated animate__fadeIn",style:{backgroundColor:"#16a34a",color:"white",borderColor:"#16a34a",minWidth:"180px",height:"38px",padding:"8px 16px",fontSize:"14px",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseEnter:m=>m.currentTarget.style.backgroundColor="#15803d",onMouseLeave:m=>m.currentTarget.style.backgroundColor="#16a34a",children:[e.jsx("i",{className:"fas fa-download mr-2"}),"Export Predictions"]}),n&&e.jsxs("button",{onClick:()=>n("json"),className:"d-none d-sm-inline-block btn shadow-sm animate__animated animate__fadeIn",style:{backgroundColor:"#06b6d4",color:"white",borderColor:"#06b6d4",minWidth:"180px",height:"38px",padding:"8px 16px",fontSize:"14px",display:"inline-flex",alignItems:"center",justifyContent:"center"},onMouseEnter:m=>m.currentTarget.style.backgroundColor="#0891b2",onMouseLeave:m=>m.currentTarget.style.backgroundColor="#06b6d4",children:[e.jsx("i",{className:"fas fa-file-code mr-2"}),"Export AI Insights"]})]})]})]})},Ke=({showModelDetails:u,modelDetails:t,modelAccuracy:s,activeTip:a,tooltipPosition:i,onToggleTip:n,onClose:r})=>u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-cyan-200 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 bg-gradient-to-r from-cyan-50 to-blue-50 border-b border-cyan-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-cyan-700 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-brain text-cyan-500 text-[10px]"}),"Prophet Model Details"]}),e.jsx("button",{onClick:r,className:"w-6 h-6 rounded-full bg-white/80 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-times text-gray-400 text-[10px]"})})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsx("div",{className:"bg-cyan-50 rounded-xl p-2.5",children:e.jsxs("p",{className:"text-[9px] text-cyan-700 leading-relaxed",children:[e.jsx("strong",{children:"About Prophet:"})," Open-source time series forecasting by Facebook, designed for business metrics with strong seasonal effects."]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-semibold text-gray-600 uppercase mb-2",children:"Parameters"}),e.jsx("div",{className:"space-y-1.5",children:t.slice(0,4).map((c,o)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg px-2.5 py-1.5",children:[e.jsx("span",{className:"text-[9px] text-gray-600",children:c.name}),e.jsx("span",{className:"text-[9px] font-semibold text-gray-800",children:c.value})]},o))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-semibold text-gray-600 uppercase mb-2",children:"Accuracy"}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:s.slice(0,4).map((c,o)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2",children:[e.jsx("p",{className:"text-[8px] text-gray-500 truncate",children:c.metric}),e.jsx("p",{className:"text-xs font-bold text-gray-800",children:c.metric.includes("MAPE")||c.metric.includes("Coverage")?`${c.value}%`:c.value})]},o))})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-100 rounded-xl p-2.5",children:e.jsxs("p",{className:"text-[8px] text-amber-700",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),"Financial predictions are estimates. Consult a financial advisor for major decisions."]})})]})]})}),e.jsx("div",{className:"row mb-4 animate__animated animate__fadeIn d-none d-md-block",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow border-left-info",style:{borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",style:{background:"linear-gradient(135deg, rgba(54, 185, 204, 0.05) 0%, rgba(54, 185, 204, 0.1) 100%)"},children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-info d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-brain mr-2"}),"Prophet Model Details",e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:c=>n("prophetModel",c),"aria-label":"Prophet model information"})})]}),e.jsx("div",{className:"dropdown no-arrow",children:e.jsx("button",{className:"btn btn-link btn-sm",type:"button",onClick:r,children:e.jsx("i",{className:"fas fa-times text-info"})})})]}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"alert alert-info",style:{background:"rgba(54, 185, 204, 0.05)",border:"1px solid rgba(54, 185, 204, 0.2)"},children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx("i",{className:"fas fa-lightbulb fa-2x text-info"})}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"About Prophet:"})," Prophet is an open-source time series forecasting procedure developed by Facebook. It's designed for forecasting business metrics with high accuracy and works best with time series that have strong seasonal effects and several seasons of historical data."]})]})}),e.jsx("div",{className:"table-responsive mt-4",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{style:{background:"rgba(54, 185, 204, 0.1)"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-info",children:"Parameter"}),e.jsx("th",{className:"text-info",children:"Value"}),e.jsx("th",{className:"text-info",children:"Description"})]})}),e.jsx("tbody",{children:t.map((c,o)=>e.jsxs("tr",{className:o%2===0?"bg-light":"",children:[e.jsx("td",{children:e.jsx("strong",{children:c.name})}),e.jsx("td",{children:c.value}),e.jsx("td",{children:c.description})]},o))})]})})]})}),e.jsxs("div",{className:"col-lg-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3 text-info",children:[e.jsx("i",{className:"fas fa-chart-line mr-2"}),"Model Accuracy Metrics"]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{style:{background:"rgba(54, 185, 204, 0.1)"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-info",children:"Metric"}),e.jsx("th",{className:"text-info",children:"Value"}),e.jsx("th",{className:"text-info",children:"Description"})]})}),e.jsx("tbody",{children:s.map((c,o)=>e.jsxs("tr",{className:o%2===0?"bg-light":"",children:[e.jsx("td",{children:e.jsx("strong",{children:c.metric})}),e.jsx("td",{children:c.metric.includes("MAPE")||c.metric.includes("Coverage")?`${c.value}%`:c.value}),e.jsx("td",{children:c.description})]},o))})]})})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("a",{href:"https://facebook.github.io/prophet/",target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-info",children:[e.jsx("i",{className:"fas fa-external-link-alt mr-2"}),"Learn More About Prophet"]})})]})]}),e.jsx("div",{className:"row mt-3",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card bg-light border-left-warning",children:e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-warning"})}),e.jsxs("p",{className:"mb-0 small",children:[e.jsx("strong",{children:"Note:"})," Financial predictions are estimates based on historical data and may not accurately reflect future outcomes. Always consider external factors and consult a financial advisor for major financial decisions."]})]})})})})})]})]})})})]}):null,Ve=({showAccuracyReport:u,modelAccuracy:t,activeTip:s,tooltipPosition:a,onToggleAccuracyReport:i,onToggleTip:n})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-info-circle text-indigo-500 text-[10px]"}),"About Predictions"]}),e.jsx("button",{onClick:i,className:"w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("i",{className:`fas fa-${u?"minus":"plus"} text-gray-500 text-[8px]`})})]}),e.jsxs("div",{className:"p-3",children:[e.jsx("p",{className:"text-[10px] text-gray-600 leading-relaxed mb-3",children:"Our AI analyzes your financial behavior to predict future trends using Facebook's Prophet model, seasonal patterns, and economic indicators."}),u&&e.jsxs("div",{className:"space-y-2 animate__animated animate__fadeIn",children:[e.jsx("p",{className:"text-[9px] font-semibold text-gray-600 uppercase",children:"Accuracy Report"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("i",{className:"fas fa-bullseye text-blue-500 text-[10px]"}),e.jsx("span",{className:"text-[8px] text-blue-600 font-medium",children:"MAPE"})]}),e.jsxs("p",{className:"text-sm font-bold text-gray-800",children:[t[0]?.value,"%"]}),e.jsx("p",{className:"text-[8px] text-gray-500",children:"Prediction accuracy"})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx("i",{className:"fas fa-check-circle text-emerald-500 text-[10px]"}),e.jsx("span",{className:"text-[8px] text-emerald-600 font-medium",children:"Confidence"})]}),e.jsxs("p",{className:"text-sm font-bold text-gray-800",children:[t[4]?.value,"%"]}),e.jsx("p",{className:"text-[8px] text-gray-500",children:"Within predicted range"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-2 mt-2",children:e.jsxs("p",{className:"text-[8px] text-blue-700",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Shorter timeframes tend to have higher accuracy."]})})]})]})]})}),e.jsxs("div",{className:"card shadow mb-4 animate__animated animate__fadeIn d-none d-md-block",children:[e.jsxs("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-primary d-flex align-items-center",children:["About Predictions",e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:r=>n("aboutPredictions",r),"aria-label":"About predictions information"})})]}),e.jsx("div",{className:"dropdown no-arrow",children:e.jsx("button",{className:"btn btn-link btn-sm",type:"button",onClick:i,"aria-label":"Toggle accuracy report",children:e.jsx("i",{className:`fas fa-${u?"minus":"plus"}-circle text-gray-400`})})})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{children:"Our AI algorithm analyzes your past financial behavior to predict future trends. These predictions use Facebook's Prophet model and are based on your transaction history, seasonal patterns, and economic indicators."}),u&&e.jsxs("div",{className:"mt-3 animate__animated animate__fadeIn",children:[e.jsx("h6",{className:"font-weight-bold text-gray-700",children:"Prediction Accuracy Report"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card bg-light mb-3",children:e.jsxs("div",{className:"card-body py-3 px-4",children:[e.jsxs("p",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-bullseye text-primary mr-2"}),e.jsx("strong",{children:"Mean Absolute Percentage Error (MAPE):"})," ",t[0]?.value,"%"]}),e.jsxs("small",{className:"text-muted",children:["Our predictions are typically within ",t[0]?.value,"% of actual values."]})]})})}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card bg-light mb-3",children:e.jsxs("div",{className:"card-body py-3 px-4",children:[e.jsxs("p",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-check-circle text-success mr-2"}),e.jsx("strong",{children:"Prediction Confidence:"})," ",t[4]?.value,"%"]}),e.jsxs("small",{className:"text-muted",children:[t[4]?.value,"% of actual outcomes fall within our predicted ranges."]})]})})})]}),e.jsxs("div",{className:"alert alert-info mt-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),e.jsx("strong",{children:"Note:"})," Financial predictions become less accurate as they extend further into the future. Shorter timeframes tend to have higher accuracy."]})]})]})]})]}),Je=({insights:u,activeTip:t,tooltipPosition:s,onToggleTip:a})=>{const{incomeGrowth:i,expenseGrowth:n,savingsGrowth:r,confidenceScore:c=95}=u,o=c<70;return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"row mb-3",children:e.jsxs("div",{className:"col-12",children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3 mb-3 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-amber-500 text-sm"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-semibold text-amber-800",children:["Low Confidence (",c.toFixed(0),"%)"]}),e.jsx("p",{className:"text-[10px] text-amber-600 mt-0.5",children:"Add more transactions for improved forecasts."})]})]})})}),e.jsxs("div",{className:"alert alert-warning d-none d-md-flex align-items-center animate__animated animate__fadeIn",role:"alert",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-3",style:{fontSize:"1.5rem"}}),e.jsxs("div",{children:[e.jsxs("strong",{children:["Low Prediction Confidence (",c.toFixed(0),"%)"]}),e.jsx("p",{className:"mb-0 mt-1 small",children:"These predictions have lower accuracy due to limited transaction data or irregular patterns. Consider adding more transaction history for improved forecasts."})]})]})]})}),e.jsxs("div",{className:"block md:hidden mb-4",children:[e.jsxs("div",{className:`bg-gradient-to-br ${r>=5?"from-emerald-500 via-teal-500 to-cyan-500":r>=0?"from-blue-500 via-indigo-500 to-purple-500":"from-rose-500 via-red-500 to-orange-500"} rounded-2xl p-4 mb-3 shadow-lg`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-white/80 text-xs font-medium",children:"Savings Forecast"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:`fas fa-${r>=0?"piggy-bank":"exclamation-triangle"} text-white text-sm`})})]}),e.jsxs("div",{className:"text-white text-2xl font-bold mb-1",children:[r>=0?"+":"",r.toFixed(1),"%"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:`text-xs font-medium ${r>=5?"text-green-200":r>=0?"text-blue-200":"text-red-200"}`,children:[e.jsx("i",{className:`fas fa-${r>=0?"arrow-up":"arrow-down"} text-[10px] mr-1`}),r>=5?"Strong Growth":r>=0?"Stable":"Declining"]}),o&&e.jsxs("span",{className:"bg-white/20 text-white/90 px-1.5 py-0.5 rounded text-[9px] ml-2",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-0.5"}),"Low Confidence"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-chart-line text-blue-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Income Growth"}),e.jsxs("p",{className:`text-sm font-bold ${i>=0?"text-emerald-600":"text-rose-600"}`,children:[i>=0?"+":"",i.toFixed(1),"%"]}),o&&e.jsxs("span",{className:"text-[8px] text-amber-500",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-0.5"}),c.toFixed(0),"%"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-rose-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-chart-area text-rose-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Expense Growth"}),e.jsxs("p",{className:`text-sm font-bold ${n<=0?"text-emerald-600":"text-rose-600"}`,children:[n>=0?"+":"",n.toFixed(1),"%"]}),o&&e.jsxs("span",{className:"text-[8px] text-amber-500",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-0.5"}),c.toFixed(0),"%"]})]})]})]}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-xl-4 col-md-6 mb-4",children:e.jsx("div",{className:"card border-left-primary shadow h-100 py-2 animate__animated animate__fadeIn",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1 d-flex align-items-center",children:["Projected Income Growth",o&&e.jsx("span",{className:"ml-2 badge badge-warning",title:"Low confidence - prediction may be less accurate",style:{fontSize:"0.65rem",cursor:"help"},children:e.jsx("i",{className:"fas fa-exclamation-circle"})}),e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:l=>a("projectedIncome",l),"aria-label":"Projected income information"})})]}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[i.toFixed(1),"%"]}),o&&e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-chart-line mr-1"}),"Confidence: ",c.toFixed(0),"%"]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-chart-line fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-xl-4 col-md-6 mb-4",children:e.jsx("div",{className:"card border-left-danger shadow h-100 py-2 animate__animated animate__fadeIn",style:{animationDelay:"0.1s"},children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-danger text-uppercase mb-1 d-flex align-items-center",children:["Projected Expense Growth",o&&e.jsx("span",{className:"ml-2 badge badge-warning",title:"Low confidence - prediction may be less accurate",style:{fontSize:"0.65rem",cursor:"help"},children:e.jsx("i",{className:"fas fa-exclamation-circle"})}),e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:l=>a("projectedExpense",l),"aria-label":"Projected expense information"})})]}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[n.toFixed(1),"%"]}),o&&e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-chart-line mr-1"}),"Confidence: ",c.toFixed(0),"%"]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-chart-area fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-xl-4 col-md-6 mb-4",children:e.jsx("div",{className:"card border-left-success shadow h-100 py-2 animate__animated animate__fadeIn",style:{animationDelay:"0.2s"},children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-success text-uppercase mb-1 d-flex align-items-center",children:["Projected Savings Growth",o&&e.jsx("span",{className:"ml-2 badge badge-warning",title:"Low confidence - prediction may be less accurate",style:{fontSize:"0.65rem",cursor:"help"},children:e.jsx("i",{className:"fas fa-exclamation-circle"})}),e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:l=>a("projectedSavings",l),"aria-label":"Projected savings information"})})]}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[r.toFixed(1),"%"]}),o&&e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-chart-line mr-1"}),"Confidence: ",c.toFixed(0),"%"]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-piggy-bank fa-2x text-gray-300"})})]})})})})]})]})},Xe=({timeframe:u,dataType:t,data:s,modelAccuracy:a,activeTip:i,tooltipPosition:n,onTimeframeChange:r,onDataTypeChange:c,onToggleTip:o})=>{const l=D.useRef(null);D.useEffect(()=>()=>{if(l.current)try{l.current=null}catch{}},[u,t]);const m=s[u],h=m&&m.length>0&&m.some(d=>d.income>0||d.expenses>0||d.savings!==0||d.incomePrediction&&d.incomePrediction>0||d.expensesPrediction&&d.expensesPrediction>0||d.savingsPrediction&&d.savingsPrediction!==0);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-chart-line text-indigo-500 text-[10px]"}),"Financial Forecast"]}),e.jsxs("span",{className:"text-[9px] text-gray-500",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),a[4]?.value,"% Confidence"]})]}),e.jsx("div",{className:"flex bg-slate-50 border-b border-gray-100",children:["3months","6months","1year"].map(d=>e.jsxs("button",{onClick:()=>r(d),className:`flex-1 py-2.5 text-[10px] font-semibold transition-all relative ${u===d?"text-indigo-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[d==="3months"?"3 Mo":d==="6months"?"6 Mo":"1 Yr",u===d&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]},d))}),e.jsx("div",{className:"px-3 py-2 flex gap-1.5 overflow-x-auto",children:["all","income","expenses","savings"].map(d=>e.jsx("button",{onClick:()=>c(d),className:`px-2.5 py-1 rounded-full text-[9px] font-medium whitespace-nowrap transition-all ${t===d?"bg-indigo-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:d.charAt(0).toUpperCase()+d.slice(1)},d))}),e.jsx("div",{className:"p-3",children:h?e.jsx("div",{style:{height:"250px"},children:e.jsx(Pe,{width:"100%",height:"100%",children:e.jsxs(Ce,{ref:d=>{d&&(l.current=d)},data:m,margin:{top:5,right:10,left:0,bottom:40},children:[e.jsx(Ee,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(Fe,{dataKey:"month",angle:-45,textAnchor:"end",height:50,interval:0,tick:{fontSize:9}}),e.jsx(De,{tickFormatter:d=>`‚Ç±${(d/1e3).toFixed(0)}k`,tick:{fontSize:9},width:45}),e.jsx(Re,{formatter:d=>de(d),labelFormatter:d=>`${d}`,contentStyle:{borderRadius:"8px",fontSize:"10px"}}),(t==="all"||t==="income")&&e.jsx(pe,{type:"monotone",dataKey:"incomeUpper",stroke:"transparent",fill:"#6366f1",fillOpacity:.1}),(t==="all"||t==="expenses")&&e.jsx(pe,{type:"monotone",dataKey:"expensesUpper",stroke:"transparent",fill:"#e74a3b",fillOpacity:.1}),(t==="all"||t==="income")&&e.jsx(ce,{type:"monotone",dataKey:"income",name:"Income",stroke:"#6366f1",strokeWidth:2,dot:{r:3}}),(t==="all"||t==="expenses")&&e.jsx(ce,{type:"monotone",dataKey:"expenses",name:"Expenses",stroke:"#e74a3b",strokeWidth:2,dot:{r:3}}),(t==="all"||t==="savings")&&e.jsx(ce,{type:"monotone",dataKey:"savings",name:"Savings",stroke:"#1cc88a",strokeWidth:2,dot:{r:3}}),(t==="all"||t==="income")&&e.jsx(ce,{type:"monotone",dataKey:"incomePrediction",name:"Income Forecast",stroke:"#6366f1",strokeDasharray:"5 5",strokeWidth:1.5,dot:!1}),(t==="all"||t==="expenses")&&e.jsx(ce,{type:"monotone",dataKey:"expensesPrediction",name:"Expense Forecast",stroke:"#e74a3b",strokeDasharray:"5 5",strokeWidth:1.5,dot:!1})]})})}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-chart-line text-gray-400 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"No Data Available"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:"Add transactions to see forecasts"})]})}),h&&e.jsx("div",{className:"px-3 pb-3",children:e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center text-[9px]",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-indigo-500 rounded"}),e.jsx("span",{className:"text-gray-600",children:"Income"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-rose-500 rounded"}),e.jsx("span",{className:"text-gray-600",children:"Expenses"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 bg-emerald-500 rounded"}),e.jsx("span",{className:"text-gray-600",children:"Savings"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-0.5 border-t-2 border-dashed border-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Forecast"})]})]})})]})}),e.jsx("div",{className:"row d-none d-md-block",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow mb-4 animate__animated animate__fadeIn",style:{animationDelay:"0.3s"},children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:e.jsxs("h6",{className:"m-0 font-weight-bold text-primary d-flex align-items-center",children:["Financial Forecast",e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:d=>o("financialForecast",d),"aria-label":"Financial forecast information"})})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{type:"button",className:`btn ${u==="3months"?"btn-primary":"btn-outline-primary"}`,onClick:()=>r("3months"),children:"3 Months"}),e.jsx("button",{type:"button",className:`btn ${u==="6months"?"btn-primary":"btn-outline-primary"}`,onClick:()=>r("6months"),children:"6 Months"}),e.jsx("button",{type:"button",className:`btn ${u==="1year"?"btn-primary":"btn-outline-primary"}`,onClick:()=>r("1year"),children:"1 Year"})]}),e.jsxs("div",{className:"btn-group ml-3",role:"group",children:[e.jsx("button",{type:"button",className:`btn ${t==="all"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>c("all"),children:"All"}),e.jsx("button",{type:"button",className:`btn ${t==="income"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>c("income"),children:"Income"}),e.jsx("button",{type:"button",className:`btn ${t==="expenses"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>c("expenses"),children:"Expenses"}),e.jsx("button",{type:"button",className:`btn ${t==="savings"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>c("savings"),children:"Savings"})]})]}),h?e.jsx("div",{style:{height:"400px"},children:e.jsx(Pe,{width:"100%",height:"100%",children:e.jsxs(Ce,{ref:d=>{d&&(l.current=d)},data:m,margin:{top:5,right:30,left:20,bottom:60},children:[e.jsx(Ee,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"month",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(De,{tickFormatter:d=>de(d)}),e.jsx(Re,{formatter:d=>de(d),labelFormatter:d=>`Period: ${d}`,contentStyle:{borderRadius:"5px"}}),e.jsx(He,{}),(t==="all"||t==="income")&&e.jsx(pe,{type:"monotone",dataKey:"incomeUpper",stroke:"transparent",fill:"#6366f1",fillOpacity:.1}),(t==="all"||t==="income")&&e.jsx(pe,{type:"monotone",dataKey:"incomeLower",stroke:"transparent",fill:"#6366f1",fillOpacity:.1}),(t==="all"||t==="expenses")&&e.jsx(pe,{type:"monotone",dataKey:"expensesUpper",stroke:"transparent",fill:"#e74a3b",fillOpacity:.1}),(t==="all"||t==="expenses")&&e.jsx(pe,{type:"monotone",dataKey:"expensesLower",stroke:"transparent",fill:"#e74a3b",fillOpacity:.1}),(t==="all"||t==="income")&&e.jsx(ce,{type:"monotone",dataKey:"income",name:"Income",stroke:"#6366f1",activeDot:{r:8},strokeWidth:2,dot:{stroke:"#6366f1",strokeWidth:2,r:4}}),(t==="all"||t==="expenses")&&e.jsx(ce,{type:"monotone",dataKey:"expenses",name:"Expenses",stroke:"#e74a3b",activeDot:{r:8},strokeWidth:2,dot:{stroke:"#e74a3b",strokeWidth:2,r:4}}),(t==="all"||t==="savings")&&e.jsx(ce,{type:"monotone",dataKey:"savings",name:"Savings",stroke:"#1cc88a",activeDot:{r:8},strokeWidth:2,dot:{stroke:"#1cc88a",strokeWidth:2,r:4}}),(t==="all"||t==="income")&&e.jsx(ce,{type:"monotone",dataKey:"incomePrediction",name:"Income Forecast",stroke:"#6366f1",strokeDasharray:"5 5",strokeWidth:1.5,dot:!1,activeDot:!1}),(t==="all"||t==="expenses")&&e.jsx(ce,{type:"monotone",dataKey:"expensesPrediction",name:"Expense Forecast",stroke:"#e74a3b",strokeDasharray:"5 5",strokeWidth:1.5,dot:!1,activeDot:!1})]})})}):e.jsx("div",{style:{height:"400px"},className:"d-flex align-items-center justify-content-center",children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"fas fa-chart-line fa-4x text-gray-300"})}),e.jsx("h5",{className:"text-gray-600 mb-3",children:"No Financial Data Available"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Add transactions to your account to see financial forecasts and predictions."}),e.jsxs("div",{className:"alert alert-info mx-auto",style:{maxWidth:"500px"},children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),e.jsx("strong",{children:"Getting Started:"})," Add at least 3-6 months of transaction history to generate accurate AI-powered financial forecasts."]})]})}),h&&e.jsxs("div",{className:"mt-3 d-flex justify-content-between",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("i",{className:"fas fa-lightbulb text-warning mr-1"}),e.jsx("strong",{children:"Tip:"})," Hover over the chart to see detailed values. Shaded areas represent prediction confidence intervals."]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("i",{className:"fas fa-info-circle text-info mr-1"}),e.jsx("strong",{children:"Prophet Model"})," | Confidence: ",a[4]?.value,"%"]})]})]})]})})})]})},Qe=({transactionTypePredictions:u,activeTip:t,tooltipPosition:s,onToggleTip:a,timeframe:i="3months"})=>{Ae(i);const n=i==="3months"?"3 Month":i==="6months"?"6 Month":"1 Year",r=u.length>0&&u[0].isEmptyState,c=x=>{switch(x){case"Income":return"fas fa-plus-circle text-success";case"Expense":return"fas fa-minus-circle text-danger";case"Savings":return"fas fa-piggy-bank text-info";case"Total":return"fas fa-calculator text-primary";default:return"fas fa-circle"}},o=x=>{switch(x){case"Income":return{bg:"emerald",icon:"emerald"};case"Expense":return{bg:"rose",icon:"rose"};case"Savings":return{bg:"cyan",icon:"cyan"};case"Total":return{bg:"indigo",icon:"indigo"};default:return{bg:"gray",icon:"gray"}}},l=(x,h)=>x==="Total"?h>0?"badge-success":"badge-danger":x==="Income"?h>0?"badge-success":"badge-warning":x==="Expense"?h<0?"badge-success":h<10?"badge-warning":"badge-danger":x==="Savings"?h>0?"badge-success":"badge-warning":"badge-info",m=(x,h)=>x==="Total"?h>0?"Growing":"Declining":x==="Income"?h>0?"Increasing":h<-5?"Decreasing":"Stable":x==="Expense"?h<0?"Decreasing":h<10?"Stable":"Increasing":x==="Savings"?h>0?"Growing":h<-5?"Declining":"Stable":"Stable";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-exchange-alt text-indigo-500 text-[10px]"}),"Transaction Forecast"]}),e.jsx("span",{className:"bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded text-[9px] font-medium",children:n})]}),e.jsx("div",{className:"p-3",children:r?e.jsxs("div",{className:"py-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-chart-line text-gray-400 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"No Transaction Data"}),e.jsx("p",{className:"text-[10px] text-gray-500 mb-3",children:"Add transactions to see forecasts"}),e.jsxs("a",{href:"/transactions/add",className:"inline-flex items-center gap-1 px-3 py-1.5 bg-indigo-500 text-white text-[10px] font-medium rounded-full",children:[e.jsx("i",{className:"fas fa-plus text-[8px]"}),"Add Transaction"]})]}):e.jsx("div",{className:"space-y-2",children:u.map((x,h)=>{const d=o(x.type),p=x.change>=0,b=x.type==="Income"||x.type==="Savings"||x.type==="Total"?p:!p;return e.jsxs("div",{className:`rounded-xl p-3 ${x.type==="Total"?"bg-indigo-50 border border-indigo-100":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-7 h-7 rounded-lg bg-${d.bg}-100 flex items-center justify-center`,children:e.jsx("i",{className:`fas fa-${x.type==="Income"?"arrow-up":x.type==="Expense"?"arrow-down":x.type==="Savings"?"piggy-bank":"calculator"} text-${d.icon}-500 text-xs`})}),e.jsx("span",{className:`text-xs font-semibold ${x.type==="Total"?"text-indigo-700":"text-gray-800"}`,children:x.type})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[x.lowConfidence&&e.jsx("span",{className:"bg-amber-100 text-amber-600 px-1 py-0.5 rounded text-[8px]",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[8px] font-semibold ${b?"bg-emerald-100 text-emerald-600":"bg-rose-100 text-rose-600"}`,children:[p?"+":"",x.changePercent.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-[9px]",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 uppercase",children:"Current"}),e.jsx("p",{className:"font-semibold text-gray-700",children:de(x.current)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 uppercase",children:"Predicted"}),e.jsx("p",{className:"font-semibold text-gray-700",children:de(x.predicted)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 uppercase",children:"Change"}),e.jsxs("p",{className:`font-semibold ${b?"text-emerald-600":"text-rose-600"}`,children:[p?"+":"",de(x.change)]})]})]})]},h)})})}),!r&&e.jsx("div",{className:"px-3 py-2 border-t border-gray-100 bg-gray-50",children:e.jsxs("p",{className:"text-[9px] text-gray-500 text-center",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Current month vs predicted next month"]})})]})}),e.jsx("div",{className:"row d-none d-md-block",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow mb-4 animate__animated animate__fadeIn",style:{animationDelay:"0.35s"},children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:e.jsxs("h6",{className:"m-0 font-weight-bold text-primary d-flex align-items-center",children:["Transaction Type Forecast",e.jsxs("span",{className:"badge badge-info ml-2 px-2 py-1",style:{fontSize:"0.75rem",fontWeight:"normal"},children:[e.jsx("i",{className:"fas fa-calendar-alt mr-1"}),n," Forecast"]}),e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:x=>a("transactionTypeForecast",x),"aria-label":"Transaction type forecast information"})})]})}),e.jsx("div",{className:"card-body",children:r?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"mb-4",children:e.jsx("i",{className:"fas fa-chart-line fa-3x text-gray-300"})}),e.jsx("h5",{className:"text-gray-600 mb-3",children:"No Transaction Data"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"We need transaction data to generate transaction type forecasts. Add some transactions to see predictions for income, expenses, and savings."}),e.jsxs("div",{className:"alert alert-info text-left mb-4",children:[e.jsxs("h6",{className:"alert-heading",children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),"Get Started:"]}),e.jsxs("ul",{className:"mb-0 small",children:[e.jsx("li",{children:"Add at least 7 transactions for reliable predictions"}),e.jsx("li",{children:"Include both income and expense transactions"}),e.jsx("li",{children:"Use consistent date ranges for better accuracy"}),e.jsx("li",{children:"Track different transaction types to see comprehensive forecasts"})]})]}),e.jsxs("div",{className:"d-flex justify-content-center",children:[e.jsxs("a",{href:"/transactions/add",className:"btn btn-primary btn-sm mr-2",children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Transaction"]}),e.jsxs("a",{href:"/transactions",className:"btn btn-outline-primary btn-sm",children:[e.jsx("i",{className:"fas fa-list mr-1"}),"View Transactions"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-light",children:[e.jsx("th",{children:"Transaction Type"}),e.jsx("th",{children:"Current Month"}),e.jsx("th",{children:"Predicted Next Month"}),e.jsx("th",{children:"Change"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:u.map((x,h)=>e.jsxs("tr",{className:x.type==="Total"?"table-primary font-weight-bold":"",children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:`${c(x.type)} mr-2`}),e.jsx("strong",{children:x.type})]})}),e.jsx("td",{children:de(x.current)}),e.jsx("td",{children:de(x.predicted)}),e.jsxs("td",{className:x.change<0?"text-success":"text-danger",children:[e.jsx("i",{className:`fas fa-${x.change<0?"arrow-down":"arrow-up"} mr-1`}),x.change<0?"-":"+",de(Math.abs(x.change)),e.jsxs("span",{className:"text-muted small ml-1",children:["(",Math.abs(x.changePercent).toFixed(1),"%)"]})]}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`badge ${l(x.type,x.changePercent)} badge-pill`,children:m(x.type,x.changePercent)}),x.lowConfidence&&e.jsxs("div",{className:"badge badge-warning badge-pill ml-2",title:"Prediction capped due to unrealistic growth rate (>50%). Conservative estimate applied.",style:{cursor:"help"},children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),"Low Confidence"]})]})})]},h))})]})}),e.jsxs("div",{className:"row mt-3",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),e.jsx("strong",{children:"Current Month"})," shows your actual spending from the Income vs Expenses Trend chart. Predictions are AI-powered forecasts."]}),u.some(x=>x.lowConfidence)&&e.jsxs("div",{className:"small text-warning mt-2",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),e.jsx("strong",{children:"Low Confidence:"})," Some predictions were capped at ¬±5% due to unrealistic growth rates exceeding 50%. Conservative estimates applied for accuracy."]})]}),e.jsx("div",{className:"col-md-4 text-right",children:e.jsxs("div",{className:"small text-muted",children:[e.jsx("i",{className:"fas fa-chart-line mr-1"}),"Showing Monthly Income, Expenses, Savings & Net Total"]})})]})]})})]})})})]})},_e=Te.PROPHET_API_URL;class Ie{static async generateInsights(t,s=!1){const a=Date.now();let i=null;try{const n=t.userContext?.userId||t.userContext?.user_id||t.userContext?.id;if(console.log("üîç Extracted user ID for AI insights:",n),console.log("üîç User context keys:",Object.keys(t.userContext||{})),n){console.log("‚úÖ User ID found, proceeding with database storage");const h=await this.checkAIInsightsUsage(t.userContext);if(!h.can_request)throw new Error(`RATE_LIMIT: AI insights limit exceeded. ${h.remaining} requests remaining.`)}else console.warn("‚ö†Ô∏è WARNING: No user ID found in request.userContext, insights will NOT be saved to database"),console.log("UserContext received:",t.userContext);let r=null,c=null;if(n&&!s){if(r=this.generateCacheKey(t),c=await this.getCachedInsightFromDB(r),c)return console.log("Returning cached AI insight"),c}else s?(console.log("üîÑ Force regenerate enabled - bypassing cache and generating fresh AI insights"),r=this.generateCacheKey(t)):r=this.generateCacheKey(t);let o=null,l="fallback",m="local";console.log("Using OpenRouter API via chatbot service for AI insights generation");try{o=await this.generateChatbotInsights(t),l="openrouter",m="openai/gpt-oss-20b:free",console.log("‚úÖ Successfully generated AI insights via OpenRouter API")}catch(h){console.warn("‚ö†Ô∏è OpenRouter API via chatbot service failed, trying direct API:",h.message);try{o=await this.generateProphetAIInsights(t),l="prophet-openrouter",m="openrouter-gpt-4o-mini",console.log("‚úÖ Successfully generated AI insights via Prophet API")}catch(d){console.warn("‚ö†Ô∏è Prophet API also failed, using enhanced fallback:",d.message),o=this.generateEnhancedFallbackInsights(t),l="fallback",m="local-enhanced"}}o||(console.warn("All AI methods failed, generating fallback insights"),o=this.generateFallbackInsights(t),l="fallback",m="local-fallback");const x=Date.now()-a;return n&&r?(console.log("üíæ Attempting to store AI insights to database..."),console.log("üíæ Storage params:",{userId:n,aiService:l,modelUsed:m,generationTime:x,cacheKey:r}),i=await this.storeAIInsightsToDB(n,null,o,l,m,x,r),await this.incrementAIInsightsUsage(t.userContext),console.log(`‚úÖ SUCCESS: AI insights stored in database with ID: ${i}`)):(console.error("‚ùå FAILED: Cannot store AI insights - missing userId or cacheKey"),console.log("Debug info:",{userId:n,cacheKey:r,hasInsights:!!o})),o}catch(n){if(console.error("Error generating AI insights:",n),n.message&&n.message.startsWith("RATE_LIMIT:"))throw n;return this.generateFallbackInsights(t)}}static async checkAIInsightsUsage(t){try{const s=t.userId||t.user_id;if(!s)return console.warn("No user ID found in context, allowing usage with default limits"),{can_request:!0,current_usage:0,limit:5,remaining:5};const{data:a,error:i}=await L.rpc("can_make_prediction_request",{p_user_id:s,p_service_type:"ai_insights"});return i?(console.error("Error checking AI insights usage:",i),{can_request:!0,current_usage:0,limit:5,remaining:5}):(console.log("AI insights usage check:",{userId:s,can_request:a.can_request,current_usage:a.current_usage,limit:a.limit}),a)}catch(s){return console.error("Database error checking AI insights usage:",s),{can_request:!0,current_usage:0,limit:5,remaining:5}}}static async incrementAIInsightsUsage(t){try{const s=t.userId||t.user_id;if(!s)return console.warn("No user ID found, skipping usage increment"),!0;const{data:a,error:i}=await L.rpc("increment_prediction_usage",{p_user_id:s,p_service_type:"ai_insights"});return i?(console.error("Error incrementing AI insights usage:",i),!1):(console.log("Successfully incremented AI insights usage for user:",s),a===!0)}catch(s){return console.error("Database error incrementing AI insights usage:",s),!1}}static async storeAIInsightsToDB(t,s,a,i,n,r,c){try{if(console.log("üìù storeAIInsightsToDB called with:",{userId:t,predictionId:s,aiService:i,modelUsed:n,generationTimeMs:r,cacheKey:c,hasInsights:!!a}),!t&&a&&typeof a=="object"){const m=a;t=m.userId||m.user_id||"",console.log("üìù Extracted userId from insights object:",t)}if(!t)return console.error("‚ùå Cannot store AI insights: userId is null or undefined"),`fallback-${Date.now()}`;console.log("üìù Calling store_ai_insights RPC function...");const{data:o,error:l}=await L.rpc("store_ai_insights",{p_user_id:t,p_prediction_id:s,p_insights:a,p_ai_service:i,p_model_used:n,p_generation_time_ms:r,p_cache_key:c});return l?(console.error("‚ùå Error storing AI insights to database:",l),console.error("Error details:",{message:l.message,code:l.code,details:l.details,hint:l.hint}),`fallback-${Date.now()}`):(console.log(`‚úÖ AI insights stored successfully in database with ID: ${o}`),o)}catch(o){return console.error("Database error storing AI insights:",o),`fallback-${Date.now()}`}}static async getCachedInsightFromDB(t){try{const{data:s,error:a}=await L.from("ai_insights").select("*").eq("cache_key",t).gt("expires_at",new Date().toISOString()).order("generated_at",{ascending:!1}).limit(1).single();return a||!s?null:(await L.from("ai_insights").update({access_count:(s.access_count||0)+1,last_accessed_at:new Date().toISOString()}).eq("id",s.id),console.log("Retrieved cached AI insights:",{id:s.id,cache_key:t,generated_at:s.generated_at}),s.insights)}catch(s){return console.error("Database error getting cached insights:",s),null}}static async generateChatbotInsights(t){try{console.log("üöÄ Starting AI insights generation via OpenRouter API...");const s=this.buildFinancialAnalysisPrompt(t);console.log("üìù Built comprehensive financial analysis prompt");const a=await ke.sendMessage(s);if(console.log("üåç OpenRouter API response received:",{success:a.success}),!a.success)throw console.error("‚ùå OpenRouter API failed:",a.error),new Error(a.error||"OpenRouter API service failed");if(!a.message||a.message.trim().length===0)throw console.error("‚ùå Empty response from OpenRouter API"),new Error("Empty response from OpenRouter API");console.log("‚úÖ Successfully received AI insights from OpenRouter API, parsing response...");const i=this.parseInsightResponse(a.message);return console.log("‚úÖ AI insights parsed successfully:",{summary:i.summary.substring(0,100)+"...",recommendationsCount:i.recommendations.length,riskLevel:i.riskAssessment.level,confidence:i.confidenceLevel}),i}catch(s){throw console.error("‚ùå Chatbot insights generation failed:",s),s}}static async generateInteractiveAIInsights(t){try{const{data:{session:s}}=await L.auth.getSession();if(!s?.access_token)throw new Error("User not authenticated");const a={predictions:t.predictionData.map(b=>({date:b.date.toISOString(),predicted:b.predicted,upper:b.upper,lower:b.lower,trend:b.trend,seasonal:b.seasonal||0,confidence:b.confidence})),category_forecasts:t.categoryForecasts.reduce((b,A)=>(b[A.category]={historical_average:A.historicalAverage,predicted_average:A.predicted,confidence:A.confidence,trend:A.trend,data_points:10},b),{}),user_profile:{avg_monthly_income:t.userContext.avgMonthlyIncome,avg_monthly_expenses:t.userContext.avgMonthlyExpenses,savings_rate:t.userContext.savingsRate,spending_categories:t.userContext.budgetCategories,transaction_count:t.userContext.financialGoals.length+20},timeframe:t.timeframe,custom_prompt:t.customPrompt},i=await ye.post(`${_e}/api/v1/predictions/ai-insights`,a,{headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},timeout:3e4});if(i.data?.rate_limited){const b=i.data?.error?.details?.retry_after,A=b?`Rate limit exceeded. Try again in ${b} seconds.`:"Rate limit exceeded. Please try again later.";throw new Error(`RATE_LIMIT: ${A}`)}if(i.status!==200||!i.data?.success)throw new Error(i.data?.error||"Invalid response from AI insights service");const n=i.data.insights,r=n.filter(b=>b.recommendation).map(b=>b.recommendation),c=n.filter(b=>b.category==="risk").map(b=>b.description),o=n.filter(b=>b.category==="opportunity").map(b=>b.description),l=n.filter(b=>b.category==="risk").map(b=>b.recommendation).filter(b=>b),m=n.filter(b=>b.category==="risk"),x=m.length>0?m.reduce((b,A)=>b+A.confidence,0)/m.length:.5,h=x>.8?"high":x>.5?"medium":"low",d=n.length>0&&n[0].description||"AI analysis completed based on your financial data.",p=n.length>0?n.reduce((b,A)=>b+A.confidence,0)/n.length:.75;return{summary:d,recommendations:r.length>0?r:["Review your spending patterns for optimization opportunities","Consider setting up automated savings to improve your financial position","Monitor your category budgets to ensure you stay on track"],riskAssessment:{level:h,factors:c.length>0?c:["Market volatility","Spending variability"],mitigationSuggestions:l.length>0?l:["Build an emergency fund covering 3-6 months of expenses","Diversify your income sources when possible"]},opportunityAreas:o.length>0?o:["Budget optimization","Savings rate improvement","Investment planning"],confidenceLevel:p,timestamp:new Date(i.data.metadata?.generated_at||new Date().toISOString())}}catch(s){return console.error("Interactive AI insights error:",s),null}}static async generateProphetAIInsights(t){try{const{data:{session:s}}=await L.auth.getSession();if(!s?.access_token)throw new Error("User not authenticated");const a={predictions:t.predictionData,category_forecasts:t.categoryForecasts,user_profile:t.userContext,timeframe:t.timeframe,custom_prompt:t.customPrompt},i=await ye.post(`${_e}/api/v1/predictions/ai-insights`,a,{headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},timeout:3e4});if(i.data?.rate_limited){const r=i.data?.error?.details?.retry_after,c=r?`Rate limit exceeded. Try again in ${r} seconds.`:"Rate limit exceeded. Please try again later.";throw new Error(`RATE_LIMIT: ${c}`)}if(i.status!==200||!i.data?.insights)throw new Error("Invalid response from Prophet AI service");const n=i.data.insights;return{summary:n.summary,recommendations:n.recommendations,riskAssessment:{level:n.risk_assessment.level,factors:n.risk_assessment.factors,mitigationSuggestions:n.risk_assessment.mitigation_suggestions},opportunityAreas:n.opportunity_areas,confidenceLevel:n.confidence_level,timestamp:new Date(i.data.generated_at||new Date().toISOString())}}catch(s){return console.error("Prophet AI insights error:",s),null}}static buildFinancialAnalysisPrompt(t){const{predictionData:s,categoryForecasts:a,userContext:i,timeframe:n,customPrompt:r}=t,c=this.getTimeframeName(n),o=i.avgMonthlyIncome||0,l=i.avgMonthlyExpenses||0,m=i.savingsRate||0,x=o-l,h=o>0?(l/o*100).toFixed(1):"0",d=l>0&&x>0?(x/l*12).toFixed(1):"0";return`You are an expert financial advisor analyzing a user's financial data from BudgetMe, a personal finance app. Provide specific, actionable insights based on their actual financial situation.

üìä FINANCIAL PROFILE ANALYSIS:
‚Ä¢ Monthly Income: ‚Ç±${o.toLocaleString()}
‚Ä¢ Monthly Expenses: ‚Ç±${l.toLocaleString()}
‚Ä¢ Net Cash Flow: ‚Ç±${x.toLocaleString()}
‚Ä¢ Current Savings Rate: ${m.toFixed(1)}%
‚Ä¢ Expense-to-Income Ratio: ${h}%
‚Ä¢ Emergency Fund Potential: ${d} months of expenses
‚Ä¢ Budget Categories: ${i.budgetCategories.join(", ")}
‚Ä¢ Active Financial Goals: ${i.financialGoals.length}

üìà CATEGORY SPENDING ANALYSIS (${c}):
${this.formatDetailedCategoryAnalysis(a)}

üîÆ MONTHLY PREDICTIONS:
${this.formatPredictionData(s)}

üí° KEY INSIGHTS FROM CATEGORY DATA:
${this.generateCategoryInsights(a)}

${r?`
üéØ SPECIFIC FOCUS: ${r}
`:""}


Please provide a comprehensive financial analysis in the following format:

**FINANCIAL SUMMARY** (2-3 sentences):
Analyze the user's overall financial health, current trends, and trajectory. Be specific about their cash flow situation and what it means for their financial goals.

**TOP 3 PRIORITIES** (EXACTLY 3 RECOMMENDATIONS - NO MORE, NO LESS):
‚Ä¢ Priority 1: [Most important action based on their specific situation]
‚Ä¢ Priority 2: [Second most impactful recommendation]
‚Ä¢ Priority 3: [Additional optimization opportunity]

**RISK ASSESSMENT: [HIGH/MEDIUM/LOW]**
‚Ä¢ Risk factors: [List 2-3 specific risks based on their data]
‚Ä¢ Mitigation strategies: [Specific steps to address these risks]

**OPPORTUNITY AREAS**:
‚Ä¢ [2-3 specific opportunities for financial improvement]

**CONFIDENCE LEVEL**: [X]% - [Brief explanation of confidence factors]

IMPORTANT: Base your advice entirely on the provided financial data. Use Philippine peso amounts and local context. Be encouraging but realistic. Focus on actionable steps they can implement in BudgetMe. Avoid generic advice - make it personal to their situation.`}static formatPredictionData(t){if(t.length===0)return"No prediction data available";const s=a=>`‚Ç±${a.toFixed(2)}`;return t.map((a,i)=>`${new Date(a.date).toLocaleDateString("en-US",{month:"long",year:"numeric"})}: Predicted ${s(a.predicted)} (Range: ${s(a.lower)} - ${s(a.upper)}, Confidence: ${(a.confidence*100).toFixed(0)}%)`).join(`
`)}static formatDetailedCategoryAnalysis(t){return t.length===0?"No category forecasts available":t.map(a=>{const i=a.predicted-a.historicalAverage,n=(i/a.historicalAverage*100).toFixed(1),r=a.trend==="increasing"?"‚Üë":a.trend==="decreasing"?"‚Üì":"‚Üí",c=Math.abs(parseFloat(n))>20?"SIGNIFICANT":Math.abs(parseFloat(n))>10?"MODERATE":"MINOR";return`‚Ä¢ ${a.category}:
   Current Month: ‚Ç±${a.historicalAverage.toLocaleString()}
   Next Month Prediction: ‚Ç±${a.predicted.toLocaleString()}
   Change: ${n}% ${r} (‚Ç±${Math.abs(i).toLocaleString()})
   Impact Level: ${c}`}).join(`

`)}static generateCategoryInsights(t){if(t.length===0)return"No category data for analysis";const s=[],a=t.filter(l=>l.predicted>l.historicalAverage);if(a.length>0){const l=a.reduce((x,h)=>(h.predicted-h.historicalAverage)/h.historicalAverage>(x.predicted-x.historicalAverage)/x.historicalAverage?h:x),m=((l.predicted-l.historicalAverage)/l.historicalAverage*100).toFixed(1);s.push(`‚Ä¢ HIGHEST RISK: ${l.category} spending is predicted to increase by ${m}% (‚Ç±${(l.predicted-l.historicalAverage).toLocaleString()} more)`)}const i=t.filter(l=>l.predicted<l.historicalAverage);if(i.length>0){const l=i.reduce((x,h)=>(h.historicalAverage-h.predicted)/h.historicalAverage>(x.historicalAverage-x.predicted)/x.historicalAverage?h:x),m=((l.historicalAverage-l.predicted)/l.historicalAverage*100).toFixed(1);s.push(`‚Ä¢ BIGGEST OPPORTUNITY: ${l.category} spending is predicted to decrease by ${m}% (‚Ç±${(l.historicalAverage-l.predicted).toLocaleString()} saved)`)}const n=t.reduce((l,m)=>l+m.historicalAverage,0),c=t.reduce((l,m)=>l+m.predicted,0)-n,o=(c/n*100).toFixed(1);return c>0?s.push(`‚Ä¢ OVERALL TREND: Total spending is predicted to increase by ‚Ç±${c.toLocaleString()} (${o}%) next month`):c<0?s.push(`‚Ä¢ OVERALL TREND: Total spending is predicted to decrease by ‚Ç±${Math.abs(c).toLocaleString()} (${Math.abs(parseFloat(o))}%) next month`):s.push("‚Ä¢ OVERALL TREND: Total spending is predicted to remain stable next month"),s.join(`
`)}static formatCategoryForecasts(t){return t.length===0?"No category forecasts available":t.map(s=>{const i=((s.predicted-s.historicalAverage)/s.historicalAverage*100).toFixed(1),n=s.trend==="increasing"?"‚Üë":s.trend==="decreasing"?"‚Üì":"‚Üí";return`${s.category}: ‚Ç±${s.predicted.toFixed(2)} predicted vs ‚Ç±${s.historicalAverage.toFixed(2)} average (${i}% ${n})`}).join(`
`)}static parseInsightResponse(t){try{const s=this.extractSections(t),a=this.parseRiskAssessment(s.riskAssessment||""),i=this.parseRecommendations(s.recommendations||""),n=this.parseOpportunityAreas(s.opportunityAreas||""),r=this.parseConfidenceLevel(s.confidence||"");return{summary:s.summary||"Financial analysis completed.",recommendations:i,riskAssessment:a,opportunityAreas:n,confidenceLevel:r,timestamp:new Date}}catch(s){return console.error("Error parsing insight response:",s),{summary:t.substring(0,200)+"...",recommendations:["Review your spending patterns","Consider increasing savings","Monitor budget categories"],riskAssessment:{level:"medium",factors:["Insufficient data for detailed analysis"],mitigationSuggestions:["Gather more financial data","Establish emergency fund"]},opportunityAreas:["Budget optimization","Expense reduction"],confidenceLevel:.7,timestamp:new Date}}}static extractSections(t){const s={},a={summary:/(?:FINANCIAL TREND SUMMARY|1\.|SUMMARY)[:\s]*([\s\S]*?)(?=(?:TOP 3|2\.|RISK|$))/i,recommendations:/(?:TOP 3|RECOMMENDATIONS|2\.)[:\s]*([\s\S]*?)(?=(?:RISK|3\.|OPPORTUNITY|$))/i,riskAssessment:/(?:RISK|3\.)[:\s]*([\s\S]*?)(?=(?:OPPORTUNITY|4\.|CONFIDENCE|$))/i,opportunityAreas:/(?:OPPORTUNITY|4\.)[:\s]*([\s\S]*?)(?=(?:CONFIDENCE|5\.|$))/i,confidence:/(?:CONFIDENCE|5\.)[:\s]*([\s\S]*?)$/i};for(const[i,n]of Object.entries(a)){const r=t.match(n);r&&(s[i]=r[1].trim())}return Object.keys(s).length===0&&(s.summary=t.substring(0,300)),s}static parseRecommendations(t){const s=[],a=t.match(/(?:[\s\u2022\u2023\u25E6\u25AA\u25AB\u25A0\u25A1-]|\d+\.|Priority\s*\d+)[:\s]*([^\n\r]+)/gi);if(a)s.push(...a.map(n=>n.replace(/^[\s\u2022\u2023\u25E6\u25AA\u25AB\u25A0\u25A1-]*\s*/,"").replace(/^\d+[\.:)]\s*/,"").replace(/^Priority\s*\d+[\s\-\u2013\u2014:]*\s*/i,"Priority "+(s.length+1)+" ‚Äì ").replace(/\n/g," ").replace(/\r/g," ").replace(/\s+/g," ").trim()));else{const n=t.split(/[.!?]+/).filter(r=>r.trim().length>10);s.push(...n.map((r,c)=>`Priority ${c+1} ‚Äì ${r.trim()}`))}const i=s.filter(n=>n.length>0);for(;i.length<3;){const n=["Review and optimize your highest spending categories to identify potential savings","Set up automated savings to consistently build your emergency fund each month","Track your monthly expenses more closely to stay within your budget targets"],r=i.length;r<n.length?i.push(n[r]):i.push("Monitor your financial progress regularly and adjust your budget as needed")}return i}static parseRiskAssessment(t){const s=t.match(/\b(low|medium|high)\b/i),a=s?s[1].toLowerCase():"medium",i=this.extractListItems(t,["risk","factor","concern"]),n=this.extractListItems(t,["mitigation","suggestion","recommendation"]);return{level:a,factors:i.length>0?i:["Market volatility","Spending increase"],mitigationSuggestions:n.length>0?n:["Build emergency fund","Monitor expenses closely"]}}static parseOpportunityAreas(t){const s=this.extractListItems(t,["opportunity","improve","optimize"]);return s.length>0?s:["Budget optimization","Expense reduction","Income growth"]}static parseConfidenceLevel(t){const s=t.match(/(\d+)%/);if(s)return parseInt(s[1])/100;const a=t.match(/0\.(\d+)/);return a?parseFloat(`0.${a[1]}`):.75}static extractListItems(t,s){const a=[],i=t.match(/(?:[-‚Ä¢*]|\d+\.)\s*([^\n\r]+)/g);return i&&a.push(...i.map(n=>n.replace(/^(?:[-‚Ä¢*]|\d+\.)\s*/,"").trim())),a}static generateCacheKey(t){const s=JSON.stringify({timeframe:t.timeframe,avgIncome:Math.round(t.userContext.avgMonthlyIncome),avgExpenses:Math.round(t.userContext.avgMonthlyExpenses),categoriesCount:t.categoryForecasts.length,predictionsCount:t.predictionData.length});return btoa(s).slice(0,16)}static getTimeframeName(t){switch(t){case"months_3":return"Next 3 Months";case"months_6":return"Next 6 Months";case"year_1":return"Next 12 Months";default:return"Upcoming Period"}}static generateEnhancedFallbackInsights(t){console.log("üîÑ Generating enhanced fallback insights...");const{userContext:s,categoryForecasts:a,predictionData:i}=t,n=s.avgMonthlyIncome||0,r=s.avgMonthlyExpenses||0,c=s.savingsRate||0,o=n-r,l=this.calculateFinancialHealthScore(n,r,c);let m=`Your monthly income of ‚Ç±${n.toLocaleString()} `;if(o>0?m+=`exceeds your expenses of ‚Ç±${r.toLocaleString()}, leaving you with a positive cash flow of ‚Ç±${o.toLocaleString()}. `:o<0?m+=`is currently below your expenses of ‚Ç±${r.toLocaleString()}, creating a deficit of ‚Ç±${Math.abs(o).toLocaleString()}. `:m+=`exactly matches your expenses of ‚Ç±${r.toLocaleString()}, leaving no room for savings. `,i&&i.length>0){const p=i.reduce((A,H)=>A+H.predicted,0)/i.length,b=p>r?"increasing":"decreasing";m+=`Future projections suggest your expenses may be ${b}, with an average predicted amount of ‚Ç±${p.toLocaleString()}.`}const x=this.generateSmartRecommendations(n,r,c,a),h=this.assessFinancialRisk(n,r,c,l),d=this.identifyOpportunityAreas(n,r,c,a);return console.log("‚úÖ Enhanced fallback insights generated with health score:",l),{summary:m,recommendations:x,riskAssessment:h,opportunityAreas:d,confidenceLevel:.85,timestamp:new Date}}static calculateFinancialHealthScore(t,s,a){if(t===0)return 0;let i=0;const n=t-s;n>0&&(i+=Math.min(40,n/t*100)),a>=20?i+=40:a>=10?i+=30:a>=5?i+=20:a>0&&(i+=10);const r=n>0?n/s*12:0;return r>=6?i+=20:r>=3?i+=15:r>=1?i+=10:r>0&&(i+=5),Math.min(100,Math.round(i))}static generateSmartRecommendations(t,s,a,i){const n=[],r=t-s;if(t===0?n.push("**Priority 1 ‚Äì Add your income sources** ‚Äì Record all income streams in BudgetMe to get accurate financial insights and better track your financial progress."):r<0?n.push("**Priority 1 ‚Äì Address spending deficit immediately** ‚Äì Your expenses exceed income. Review your highest spending categories and identify areas to cut back."):a<5?n.push("**Priority 1 ‚Äì Build emergency savings** ‚Äì Start with saving at least 5% of your income to create a financial safety net for unexpected expenses."):n.push("**Priority 1 ‚Äì Optimize your highest spending category** ‚Äì Focus on your largest expense category to find the biggest potential savings."),a<15&&n.length===1)n.push("**Priority 2 ‚Äì Increase your savings rate** ‚Äì Aim for at least 15-20% of income. Use BudgetMe's automated tracking to monitor your progress.");else if(i&&i.length>0&&n.length===1){const o=i.reduce((l,m)=>m.predicted>l.predicted?m:l);n.push(`**Priority 2 ‚Äì Monitor ${o.category} spending** ‚Äì This is your highest predicted expense category. Track it closely and look for optimization opportunities.`)}else n.push("**Priority 2 ‚Äì Set monthly spending limits** ‚Äì Create realistic budgets for each expense category and track your progress weekly.");n.length===2&&(r>0&&a>=10?n.push("**Priority 3 ‚Äì Explore investment opportunities** ‚Äì With positive cash flow and good savings habits, consider growing your wealth through investments."):i&&i.length>1?n.push("**Priority 3 ‚Äì Rebalance your spending categories** ‚Äì Review all expense categories to ensure optimal allocation of your income."):n.push("**Priority 3 ‚Äì Use BudgetMe's tracking features** ‚Äì Set up automated transaction categorization and monthly budget reviews to stay on track."));const c=["**Priority 1 ‚Äì Track all your transactions** ‚Äì Complete transaction tracking is essential for accurate financial insights and better budgeting decisions.","**Priority 2 ‚Äì Set realistic monthly budgets** ‚Äì Create achievable spending limits for each category and review them regularly to stay on track.","**Priority 3 ‚Äì Build your emergency fund** ‚Äì Aim to save 3-6 months of expenses for unexpected situations and financial security."];for(;n.length<3;){const o=n.length;n.push(c[o])}return n}static assessFinancialRisk(t,s,a,i){let n="medium";const r=[],c=[];return i>=70?n="low":i>=40?n="medium":n="high",t===0&&(r.push("No recorded income sources"),c.push("Add all income sources to BudgetMe for complete financial tracking")),s>t&&(r.push("Expenses exceed income"),c.push("Create a debt reduction plan and identify expense cuts")),a<5&&(r.push("Very low savings rate"),c.push("Build an emergency fund starting with small, consistent amounts")),r.length===0&&r.push("Normal market volatility","Potential unexpected expenses"),c.length===0&&c.push("Continue monitoring expenses regularly","Consider increasing emergency fund when possible"),{level:n,factors:r,mitigationSuggestions:c}}static identifyOpportunityAreas(t,s,a,i){const n=[];return a<20&&n.push("**Savings rate improvement** ‚Äì Increase from "+a.toFixed(1)+"% to at least 20%"),s>0&&t>s&&n.push("**Budget optimization** ‚Äì Fine-tune spending categories to maximize savings potential"),i&&i.length>1?n.push("**Category rebalancing** ‚Äì Redistribute spending across categories for better financial health"):n.push("**Expense tracking enhancement** ‚Äì Add more detailed transaction categories for better insights"),n}static generateFallbackInsights(t){const{userContext:s,categoryForecasts:a}=t,i=s.savingsRate>20,n=s.savingsRate<5;let r=`Based on your financial data, you have an average monthly income of ‚Ç±${s.avgMonthlyIncome.toFixed(2)} and expenses of ‚Ç±${s.avgMonthlyExpenses.toFixed(2)}.`;i?r+=" You have excellent savings habits with a strong financial foundation.":n?r+=" There are opportunities to improve your savings rate and build financial security.":r+=" Your savings rate is moderate with room for optimization.";const c=[n?"Focus on increasing your savings rate to at least 10-15%":"Maintain your current savings momentum",a.length>0?`Monitor spending in ${a[0].category} which shows the highest predicted costs`:"Track your spending patterns more closely","Review and adjust your budget monthly to stay on track"];return{summary:r,recommendations:c,riskAssessment:{level:n?"high":i?"low":"medium",factors:n?["Low savings rate","Limited emergency fund"]:["Market volatility"],mitigationSuggestions:["Build emergency fund","Diversify income sources"]},opportunityAreas:["Budget optimization","Expense reduction","Savings growth"],confidenceLevel:.8,timestamp:new Date}}static async generateProphetInsights(t,s,a,i="months_3"){const n={predictionData:t,categoryForecasts:s,userContext:a,timeframe:i};return this.generateInsights(n)}static async generateCustomInsights(t,s){const a={...t,customPrompt:s};return this.generateInsights(a)}static async checkProphetAPIHealth(){try{return(await ye.get(`${_e}/health`,{timeout:5e3})).status===200}catch(t){return console.warn("Prophet API health check failed:",t),!1}}static async getServiceStatus(){const[t,s]=await Promise.allSettled([this.checkProphetAPIHealth(),this.testChatbotService()]);return{prophetAPI:t.status==="fulfilled"?t.value:!1,chatbotService:s.status==="fulfilled"?s.value:!1,cacheStats:this.getCacheStats()}}static async testChatbotService(){try{return(await ke.sendMessage("test")).success!==!1}catch{return!1}}static clearCache(){this.cache={}}static getCacheStats(){const t=Object.values(this.cache),s=t.length>0?Math.min(...t.map(a=>a.timestamp)):null;return{size:t.length,oldestEntry:s?new Date(s):null}}}we(Ie,"cache",{}),we(Ie,"CACHE_TTL",30*60*1e3);const Oe=D.forwardRef(({insights:u,timeframe:t,modelAccuracy:s,activeTip:a,tooltipPosition:i,onToggleTip:n,predictionData:r,transactionTypePredictions:c,userProfile:o},l)=>{const{user:m}=ve(),{incomeGrowth:x,expenseGrowth:h,savingsGrowth:d}=u,[p,b]=D.useState(null),[A,H]=D.useState(!1),[ie,re]=D.useState(null),[W,E]=D.useState(!1),[M,X]=D.useState(!1),[S,F]=D.useState(null),q=D.useRef(null);D.useEffect(()=>{m?.id&&N()},[m?.id]);const N=async()=>{if(m?.id)try{console.log("Loading most recent AI insights from database for user:",m.id);const{data:g,error:k}=await L.from("ai_insights").select("*").eq("user_id",m.id).gt("expires_at",new Date().toISOString()).order("generated_at",{ascending:!1}).limit(1);if(!k&&g&&g.length>0&&g[0].insights){const C=g[0].insights;console.log("‚úì Found cached AI insights in database:",{id:g[0].id,generated_at:g[0].generated_at,ai_service:g[0].ai_service,insightsType:typeof C,hasRecommendationsCol:!!g[0].recommendations,hasRiskAssessmentCol:!!g[0].risk_assessment,hasOpportunityAreasCol:!!g[0].opportunity_areas,insightsKeys:C?Object.keys(C):[]});let j;if(C&&typeof C=="object"&&("summary"in C||"recommendations"in C))j={summary:C.summary||"",timestamp:C.timestamp?new Date(C.timestamp):new Date,recommendations:g[0].recommendations||C.recommendations||[],riskAssessment:g[0].risk_assessment||C.riskAssessment||{level:"medium",factors:[],mitigationSuggestions:[]},opportunityAreas:g[0].opportunity_areas||C.opportunityAreas||[],confidenceLevel:C.confidenceLevel||.75};else if(Array.isArray(C))j={summary:"Fallback insights loaded from database",timestamp:new Date,recommendations:[],riskAssessment:{level:"medium",factors:[],mitigationSuggestions:[]},opportunityAreas:[],confidenceLevel:.7};else{console.error("Unknown insights structure:",C);return}console.log("‚úÖ Reconstructed AI insights:",{summary:j.summary?.substring(0,100)+"...",recommendations:j.recommendations?.length||0,riskLevel:j.riskAssessment?.level||"unknown",opportunityAreas:j.opportunityAreas?.length||0,confidence:j.confidenceLevel}),b(j),$.success("Loaded your most recent AI insights"),await L.from("ai_insights").update({access_count:(g[0].access_count||0)+1,last_accessed_at:new Date().toISOString()}).eq("id",g[0].id)}else console.log("No cached AI insights found for user")}catch(g){console.error("Error loading cached AI insights:",g)}},Z=()=>{switch(t){case"3months":return"3 months";case"6months":return"6 months";case"1year":return"year";default:return"period"}},ae=async()=>{if(!m?.id){$.error("Please log in to generate AI insights");return}H(!0);try{console.log("üîç DEBUG: Checking prediction data:",r),console.log("üîç DEBUG: Checking user profile:",o);const g=o?{...o,userId:m.id,user_id:m.id}:{userId:m.id,user_id:m.id,avgMonthlyIncome:0,avgMonthlyExpenses:0,savingsRate:0,budgetCategories:[],financialGoals:[],spendingPatterns:[]};console.log("üë§ ACTUAL user context (with user_id):",g);const k=r&&r.length>0?r:[];console.log("üîÆ ACTUAL prediction data:",k);const C={predictionData:k,categoryForecasts:[],userContext:g,timeframe:t==="3months"?"months_3":t==="6months"?"months_6":"year_1",customPrompt:"Provide specific financial advice and recommendations for a user with the following profile. Focus on actionable insights about transaction type analysis (Income, Expenses, Savings), cash flow optimization, savings strategies, and investment opportunities. Use the OpenRouter API with openai/gpt-oss-120b:free model to generate personalized advice."},j=await Ie.generateInsights(C,!0);console.log("üîç AI Insights Response Debug:",{response:j,recommendations:j?.recommendations,summary:j?.summary,riskAssessment:j?.riskAssessment,opportunityAreas:j?.opportunityAreas}),b(j),X(!1),F(null),console.log("‚úÖ AI insights generated and should be saved to database with user_id:",m.id),setTimeout(async()=>{try{await N(),console.log("‚úÖ Reloaded latest AI insights from database")}catch(_){console.error("Error reloading AI insights:",_)}},1500),setTimeout(()=>{q.current&&q.current.scrollIntoView({behavior:"smooth",block:"start"})},500),$.success("AI insights generated and updated successfully!")}catch(g){if(console.error("Error generating AI insights:",g),g.message&&g.message.includes("Rate limit exceeded")){X(!0),F(g.message),$.error(g.message);return}X(!1),F(null),$.error(g.message||"Failed to generate AI insights")}finally{H(!1)}};return D.useImperativeHandle(l,()=>({generateInsights:ae})),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-robot text-indigo-500 text-[10px]"}),"AI Insights"]}),e.jsx("button",{onClick:ae,disabled:A,className:`px-2.5 py-1 rounded-full text-[9px] font-medium transition-all ${A?"bg-gray-100 text-gray-400":"bg-indigo-500 text-white active:scale-95"}`,children:A?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-1"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-magic mr-1"}),"Generate"]})})]}),e.jsxs("div",{className:"p-3",children:[M&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-2.5 mb-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-amber-500 text-xs mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-semibold text-amber-800",children:"Rate Limited"}),e.jsx("p",{className:"text-[9px] text-amber-600",children:S||"Please try again later."})]})]})}),p?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-emerald-50 border border-emerald-100 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"fas fa-lightbulb text-emerald-500 text-xs"}),e.jsx("span",{className:"text-[10px] font-semibold text-emerald-700",children:"Financial Analysis"})]}),e.jsxs("p",{className:"text-[10px] text-gray-700 leading-relaxed line-clamp-4",children:[p.summary?.substring(0,200),"..."]}),e.jsx("button",{onClick:()=>E(!W),className:"text-[9px] text-indigo-500 font-medium mt-2",children:W?"Show Less":"Show More"})]}),p.recommendations&&p.recommendations.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-semibold text-gray-600 uppercase mb-2",children:"Top Recommendations"}),e.jsx("div",{className:"space-y-1.5",children:p.recommendations.slice(0,2).map((g,k)=>e.jsxs("div",{className:"flex items-start gap-2 bg-gray-50 rounded-lg p-2",children:[e.jsx("span",{className:"w-4 h-4 rounded-full bg-emerald-500 text-white text-[8px] flex items-center justify-center flex-shrink-0",children:k+1}),e.jsxs("p",{className:"text-[9px] text-gray-700 line-clamp-2",children:[typeof g=="string"?g.replace(/\*\*/g,"").substring(0,100):"","..."]})]},k))})]}),p.riskAssessment&&e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-[9px] text-gray-500",children:"Risk Level"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[8px] font-semibold ${p.riskAssessment.level==="high"?"bg-rose-100 text-rose-600":p.riskAssessment.level==="medium"?"bg-amber-100 text-amber-600":"bg-emerald-100 text-emerald-600"}`,children:p.riskAssessment.level?.toUpperCase()||"LOW"})]})]}):e.jsxs("div",{className:"py-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-robot text-indigo-500 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"No AI Insights Yet"}),e.jsx("p",{className:"text-[10px] text-gray-500 mb-3",children:"Generate insights for personalized advice"})]})]})]})}),e.jsx("div",{className:"row d-none d-md-block",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow mb-4 animate__animated animate__fadeIn",style:{animationDelay:"0.4s"},children:[e.jsxs("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-primary d-flex align-items-center",children:["AI-Powered Insights",e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:g=>n("aiInsights",g),"aria-label":"AI Insights information"})})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[m?.id&&e.jsx("div",{className:"mr-3",children:e.jsx(Se,{userId:m.id,serviceType:"ai_insights",compact:!0})}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:ae,disabled:A,children:A?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-2",role:"status"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-robot mr-2"}),"Generate AI Insights"]})})]})]}),e.jsxs("div",{className:"card-body",children:[M&&e.jsx("div",{className:"alert alert-warning mb-4",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx("i",{className:"fas fa-exclamation-triangle fa-2x text-warning"})}),e.jsxs("div",{children:[e.jsx("h6",{className:"alert-heading",children:"AI Insights Rate Limited"}),e.jsx("p",{className:"mb-2",children:S||"The AI insights service is temporarily rate limited. Please try again later."}),e.jsxs("p",{className:"mb-0 small text-muted",children:[e.jsx("strong",{children:"Note:"})," No fallback insights are generated when rate limited to ensure transparency about AI availability."]})]})]})}),p&&e.jsx("div",{className:"mb-4",ref:q,children:e.jsxs("div",{className:"alert alert-success border-left-success",style:{borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[e.jsxs("h5",{className:"alert-heading mb-0",children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),"AI Financial Analysis"]}),e.jsx("button",{className:"btn btn-sm btn-outline-info",onClick:()=>E(!W),children:W?"Hide Details":"Show Details"})]}),e.jsx("div",{className:"row mb-4",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("h6",{className:"font-weight-bold text-primary mb-3",children:[e.jsx("i",{className:"fas fa-chart-bar mr-2"}),"Financial Overview & Transaction Type Analysis"]}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsx("div",{className:"mb-3",children:e.jsx("textarea",{readOnly:!0,value:(()=>{let g=p.summary||"";if(p.recommendations&&p.recommendations.length>0){const U=p.recommendations.map(Q=>{if(!Q||typeof Q!="string")return"";let f=Q.replace(/\*\*/g,"").replace(/__/g,"").replace(/\*/g,"").replace(/^Priority\s*\d+\s*[‚Äì‚Äî-]\s*/i,"").replace(/^Priority\s*\d+\s*:\s*/i,"").replace(/TOP\s+\d+\s+PRIORITIES/gi,"").trim();return!/^(set|build|start|create|reduce|increase|track|review|consider|establish|open|transfer|allocate|limit|cut|save|invest|plan|define|implement|monitor|adjust|re-categorize|pin|categorize|organize|consolidate|automate|pinpoint|trim|explore|use|re-evaluate|make|channel|break|cap|free|expand|identify|once|prioritize)/i.test(f)||f.startsWith("months of")?f:""}).filter(Q=>Q.length>10);U.length>0&&(g+=" "+U.join(" "))}const C=g.replace(/\*\*/g,"").replace(/__/g,"").replace(/\*/g,"").split(/(?<=[.!?])\s+/).map(U=>U.trim()).filter(U=>U.length>10),j=new Set,_=[];for(const U of C){const Q=U.toLowerCase().replace(/[‚Ç±,\d]/g,"X").replace(/\s+/g," ").trim();j.has(Q)||U.match(/‚âà‚Ç±\s*$/)||U.match(/\(\s*$/)||(j.add(Q),_.push(U))}return _.join(" ").replace(/\s+/g," ").trim()})(),className:"form-control font-weight-medium",style:{minHeight:"200px",resize:"vertical",backgroundColor:"#f8f9fc",border:"1px solid #e3e6f0",borderRadius:"0.35rem",fontSize:"0.95rem",lineHeight:"1.6",padding:"0.75rem",color:"#5a5c69",cursor:"default",overflowY:"auto",whiteSpace:"pre-wrap",fontFamily:"inherit"},"aria-label":"Financial Overview Summary"})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("h6",{className:"text-info mb-2",children:[e.jsx("i",{className:"fas fa-exchange-alt mr-2"}),"Transaction Type Forecast (",new Date().toLocaleString("default",{month:"long",year:"numeric"}),"):"]}),c&&c.length>0&&!c[0]?.isEmptyState?e.jsx("div",{className:"row",children:(()=>{const g=new Date;return g.getMonth(),g.getFullYear(),c})().map((g,k)=>{const C=y=>{switch(y){case"Income":return{icon:"fas fa-arrow-circle-up",color:"#1cc88a"};case"Expense":return{icon:"fas fa-arrow-circle-down",color:"#e74a3b"};case"Savings":return{icon:"fas fa-piggy-bank",color:"#36b9cc"};case"Total":return{icon:"fas fa-balance-scale",color:"#4e73df"};default:return{icon:"fas fa-circle",color:"#858796"}}},j=(y,v)=>{let I="Stable",T="badge-secondary";return y==="Total"?(I=v>0?"Growing":"Declining",T=v>0?"badge-success":"badge-danger"):y==="Income"?(I=v>0?"Increasing":v<-5?"Decreasing":"Stable",T=v>0?"badge-success":v<-5?"badge-danger":"badge-warning"):y==="Expense"?(I=v<0?"Decreasing":v<10?"Stable":"Increasing",T=v<0?"badge-success":v<10?"badge-warning":"badge-danger"):y==="Savings"&&(I=v>0?"Growing":v<-5?"Declining":"Stable",T=v>0?"badge-success":v<-5?"badge-danger":"badge-warning"),{status:I,badgeClass:T}},_=C(g.type),{status:U,badgeClass:Q}=j(g.type,g.changePercent),f=g.change>=0;return e.jsx("div",{className:"col-3 mb-2",children:e.jsx("div",{className:"card shadow-sm h-100",style:{borderLeft:`3px solid ${_.color}`},children:e.jsxs("div",{className:"card-body p-2",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center mr-2",style:{width:"32px",height:"32px",backgroundColor:_.color,color:"white",fontSize:"14px"},children:e.jsx("i",{className:_.icon})}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{className:"text-xs font-weight-bold text-truncate",style:{color:_.color},children:g.type}),e.jsx("span",{className:`badge ${Q} badge-sm`,style:{fontSize:"0.65rem",padding:"2px 6px"},children:U})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs text-muted",children:"This Month"}),e.jsxs("div",{className:"small font-weight-bold text-gray-800 text-truncate",children:["‚Ç±",g.current.toLocaleString()]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-xs text-muted",children:"Next Month"}),e.jsxs("div",{className:"small font-weight-bold text-gray-800 text-truncate",children:["‚Ç±",g.predicted.toLocaleString()]})]}),e.jsx("div",{className:"pt-2 border-top",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:`text-xs font-weight-bold ${f?"text-danger":"text-success"}`,children:[f?"+":"","‚Ç±",Math.abs(g.change).toLocaleString(void 0,{maximumFractionDigits:0})]}),e.jsxs("span",{className:`text-xs font-weight-bold ${f?"text-danger":"text-success"}`,children:[f?"+":"",g.changePercent.toFixed(1),"%"]})]})})]})})},k)})}):e.jsxs("div",{className:"alert alert-info text-center mb-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"No transaction type forecast data available"]})]})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"font-weight-bold text-success mb-3",children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),"Smart Recommendations Based on Your Data"]}),e.jsx("div",{className:"row",children:(()=>{if(!p.recommendations||p.recommendations.length===0)return e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),"No specific recommendations available. Please try regenerating AI insights."]})});const k=p.recommendations.map((C,j)=>{if(!C||typeof C!="string")return"";let _=C.replace(/\*\*/g,"").replace(/__/g,"").replace(/\*/g,"").replace(/^Priority\s*\d+\s*[‚Äì‚Äî-]\s*/i,"").replace(/^Priority\s*\d+\s*:\s*/i,"").replace(/Priority\s*\d+\s*[‚Äì‚Äî-]\s*/gi,"").replace(/TOP\s+\d+\s+PRIORITIES/gi,"").replace(/^[\s‚Ä¢\-\+\>\d\.\)\]]+\s*/,"").replace(/\s*‚Äì\s*/g," ‚Äì ").replace(/\s*‚Äî\s*/g," ‚Äî ").replace(/\r\n/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim();if(_.length<15)return"";const U=/^(set|build|start|create|reduce|increase|track|review|consider|establish|open|transfer|allocate|limit|cut|save|invest|plan|define|implement|monitor|adjust|re-categorize|pin|categorize|organize|consolidate|automate|pinpoint|trim|explore|use|re-evaluate|make|channel|break|cap|free|expand|identify|once|prioritize)/i.test(_),Q=/^(months of|you're|your monthly|the\s|while|however|although|but|with an emergency|top\s+\d+|risk assessment|^\(\d+\))/i.test(_);return!U||Q?"":_}).filter(C=>C.length>=15).slice(0,3);return k.length===0?e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Recommendations are being processed. Please try regenerating AI insights for detailed recommendations."]})}):k.map((C,j)=>e.jsx("div",{className:"col-12 mb-3",children:e.jsx("div",{className:"card border-left-success shadow-sm",style:{borderLeftWidth:"4px"},children:e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"bg-success text-white rounded-circle d-flex align-items-center justify-content-center mr-3",style:{width:"28px",height:"28px",fontSize:"14px",minWidth:"28px",flexShrink:0},children:j+1}),e.jsx("div",{className:"flex-grow-1",style:{minWidth:0},children:e.jsx("textarea",{readOnly:!0,value:C,className:"form-control text-sm border-0",style:{minHeight:"80px",maxHeight:"300px",resize:"vertical",backgroundColor:"transparent",fontSize:"0.9rem",lineHeight:"1.5",padding:"0.25rem 0",color:"#5a5c69",cursor:"default",overflowY:"auto",whiteSpace:"pre-wrap",fontFamily:"inherit",boxShadow:"none"},"aria-label":`Recommendation ${j+1}`})})]})})})},j))})()})]}),W&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx("div",{className:`card border-left-${p.riskAssessment?.level==="high"?"danger":p.riskAssessment?.level==="medium"?"warning":"success"} shadow-sm h-100`,style:{borderLeftWidth:"4px"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"font-weight-bold mb-0",children:[e.jsx("i",{className:"fas fa-shield-alt mr-2"}),"Risk Assessment"]}),e.jsx("span",{className:`badge badge-${p.riskAssessment?.level==="high"?"danger":p.riskAssessment?.level==="medium"?"warning":"success"}`,children:p.riskAssessment?.level?.toUpperCase()||"LOW"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"text-sm font-weight-bold text-muted mb-2",children:"Risk Factors:"}),p.riskAssessment?.factors&&p.riskAssessment.factors.length>0?e.jsx("textarea",{readOnly:!0,value:(()=>{p.riskAssessment.factors.join(" ");const g=p.riskAssessment.factors.map(j=>{let _=j.replace(/\*\*/g,"").replace(/__/g,"").replace(/\*/g,"").replace(/^Risk factors?:\s*/i,"").replace(/^Mitigation strategies?:\s*/i,"").replace(/^TOP\s+\d+\s+PRIORITIES?\s*/i,"").replace(/^RISK ASSESSMENT:\s*\w+\s*/i,"").trim();if(/TOP\s+\d+\s+PRIORITIES|Priority\s+\d+:/i.test(_))return"";if(_.includes("Immediately")||_.includes("Prioritize")||_.includes("Use BudgetMe")||_.includes("Expand your")||/review and tighten|set up|establish|allocate|identify and trim/i.test(_)){const U=_.split(/(?:TOP\s+\d+\s+PRIORITIES|Priority\s+\d+:|(?:\d+\)?\s*)?(?:Immediately|Prioritize|Use|Review|Set|Establish|Create|Build|Expand|Allocate|Identify))/i);if(U.length>1&&U[0].trim().length>15)_=U[0].trim();else return""}return _}).map(j=>j.replace(/^[\d\.\)\]]+\s*/,"").replace(/^[-‚Ä¢]\s*/,"").replace(/,\s*\d+\)\s*$/,"").trim()).filter(j=>!(j.length<15||/^(immediately|prioritize|use|review and|set up|establish|create|build|start)/i.test(j)||/^(risk factors?|mitigation|strategies?):?\s*$/i.test(j))),k=new Map;g.forEach(j=>{const _=j.toLowerCase().replace(/[‚Ç±,\d]/g,"X").replace(/\s+/g," ").trim();k.has(_)||k.set(_,j)});const C=Array.from(k.values());return C.length>0?C.join(`

`):"No specific risk factors identified."})(),className:"form-control text-sm border-0",style:{minHeight:"100px",resize:"vertical",backgroundColor:"transparent",fontSize:"0.875rem",lineHeight:"1.5",padding:"0.5rem",color:"#5a5c69",cursor:"default",overflowY:"auto",whiteSpace:"pre-wrap",fontFamily:"inherit",boxShadow:"none"},"aria-label":"Risk Factors"}):e.jsxs("div",{className:"text-sm text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"No specific risk factors identified at this time."]})]}),c&&c.length>0&&!c[0]?.isEmptyState&&e.jsxs("div",{className:"mt-3 pt-3 border-top",children:[e.jsx("h6",{className:"text-sm font-weight-bold text-muted mb-2",children:"High-Risk Transaction Types:"}),c.filter(g=>g.type!=="Total"&&g.changePercent>10).map((g,k)=>{const C=j=>{switch(j){case"Income":return"fas fa-plus-circle text-success";case"Expense":return"fas fa-minus-circle text-danger";case"Savings":return"fas fa-piggy-bank text-info";default:return"fas fa-circle"}};return e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:`${C(g.type)} mr-2`}),e.jsx("span",{className:"text-xs font-weight-bold",children:g.type})]}),e.jsxs("span",{className:"text-xs text-danger",children:["+",g.changePercent.toFixed(1),"%"]})]},k)}),c.filter(g=>g.type!=="Total"&&g.changePercent>10).length===0&&e.jsxs("div",{className:"text-xs text-muted",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"No high-risk transaction types detected"]})]})]})})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx("div",{className:"card border-left-info shadow-sm h-100",style:{borderLeftWidth:"4px"},children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h6",{className:"font-weight-bold mb-3",children:[e.jsx("i",{className:"fas fa-rocket mr-2"}),"Growth Opportunities"]}),e.jsx("div",{className:"mb-3",children:p.opportunityAreas&&p.opportunityAreas.length>0?e.jsx("textarea",{readOnly:!0,value:(()=>{const g=p.opportunityAreas.map(j=>j.replace(/\*\*/g,"").replace(/__/g,"").replace(/\*/g,"").replace(/^[\d\.\)\]]+\s*/,"").replace(/^[-‚Ä¢]\s*/,"").replace(/^Priority\s*\d+\s*[‚Äì‚Äî:-]\s*/i,"").replace(/^RISK ASSESSMENT:\s*\w+\s*/i,"").replace(/^Risk factors?:\s*/i,"").replace(/^Mitigation strategies?:\s*/i,"").replace(/^OPPORTUNITY AREAS?\s*/i,"").trim()).filter(j=>{if(j.length<20||/^(risk assessment|risk factors?|mitigation|strategies?|opportunity areas?):?\s*$/i.test(j)||/^(months of expenses|below the recommended|emergency fund|rapid rise|no active savings)/i.test(j)||/^\d+\)\s*(rapid|emergency|no active|use budgetme|automate|set up monthly)/i.test(j))return!1;const _=/^(set|build|start|create|reduce|increase|track|review|consider|establish|open|transfer|allocate|limit|cut|save|invest|plan|define|implement|monitor|adjust|re-categorize|pin|categorize|use|automate|prioritize|immediately)/i.test(j);return/threatens your|covers less than|budget review|catch spikes|high-yield savings/i.test(j)?!1:!_}),k=new Map;g.forEach(j=>{const _=j.toLowerCase().replace(/[‚Ç±,\d]/g,"X").replace(/\s+/g," ").trim();k.has(_)||k.set(_,j)});const C=Array.from(k.values());return C.length>0?C.join(`

`):"Analyzing growth opportunities based on your financial data..."})(),className:"form-control text-sm border-0",style:{minHeight:"100px",resize:"vertical",backgroundColor:"transparent",fontSize:"0.875rem",lineHeight:"1.5",padding:"0.5rem",color:"#5a5c69",cursor:"default",overflowY:"auto",whiteSpace:"pre-wrap",fontFamily:"inherit",boxShadow:"none"},"aria-label":"Growth Opportunities"}):e.jsxs("div",{className:"text-sm text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Analyzing growth opportunities based on your spending patterns..."]})}),c&&c.length>0&&!c[0]?.isEmptyState&&e.jsxs("div",{className:"mt-3 pt-3 border-top",children:[e.jsx("h6",{className:"text-sm font-weight-bold text-muted mb-2",children:"Savings Opportunities:"}),c.filter(g=>g.type==="Expense"&&g.change<0||g.type==="Savings"&&g.change>0||g.type==="Income"&&g.change>0).map((g,k)=>{const C=U=>{switch(U){case"Income":return"fas fa-plus-circle text-success";case"Expense":return"fas fa-minus-circle text-success";case"Savings":return"fas fa-piggy-bank text-success";default:return"fas fa-circle"}},j=Math.abs(g.change),_=g.type==="Expense"?`${g.type} Decreasing`:g.type==="Savings"?`${g.type} Growing`:`${g.type} Increasing`;return e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:`${C(g.type)} mr-2`}),e.jsx("span",{className:"text-xs font-weight-bold",children:_})]}),e.jsxs("span",{className:"text-xs text-success",children:["‚Ç±",j.toLocaleString()]})]},k)}),c.filter(g=>g.type==="Expense"&&g.change<0||g.type==="Savings"&&g.change>0||g.type==="Income"&&g.change>0).length===0&&e.jsxs("div",{className:"text-xs text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Monitor your spending to identify savings opportunities"]})]})]})})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"font-weight-bold text-primary",children:[e.jsx("i",{className:"fas fa-shield-alt mr-2"}),"Risk Mitigation:"]}),e.jsx("div",{className:"ml-3",children:p.riskAssessment?.mitigationSuggestions&&p.riskAssessment.mitigationSuggestions.length>0?e.jsx("textarea",{readOnly:!0,value:(()=>{const g=p.riskAssessment.mitigationSuggestions.map(j=>{let _=j.replace(/\*\*/g,"").replace(/__/g,"").replace(/\*/g,"").replace(/^Risk factors?:\s*/i,"").replace(/^Mitigation strategies?:\s*/i,"").replace(/^TOP\s+\d+\s+PRIORITIES?\s*/i,"").replace(/^Priority\s+\d+:\s*/i,"").replace(/^RISK ASSESSMENT:\s*\w+\s*/i,"").trim();if(/^Priority\s+\d+:/i.test(_))return"";const U=_.match(/\(\d+\)\s*(Re-budget|Prioritize|Set clear|Build|Automate|Establish)[^]*$/i);if(U)_=U[0];else if(/^(?:\(\d+\)|)\s*(?:Expense-to-income|Emergency fund|No active)/i.test(_)&&!/Re-budget|Prioritize|Set|Build|Automate/i.test(_))return"";return _}).map(j=>j.replace(/^[\d\.\)\]]+\s*/,"").replace(/^[-‚Ä¢]\s*/,"").replace(/,\s*\d+\)\s*$/,"").trim()).filter(j=>!(j.length<20||/^(risk factors?|mitigation|strategies?):?\s*$/i.test(j)||/^(Rapid|Emergency fund only|No defined|rise in|months of expenses)/i.test(j)||!/immediately|prioritize|use|review|set|establish|create|build|consider|implement|monitor|add|transfer|consolidate|automate/i.test(j))),k=new Map;g.forEach(j=>{const _=j.toLowerCase().replace(/[‚Ç±,\d]/g,"X").replace(/\s+/g," ").trim();k.has(_)||k.set(_,j)});const C=Array.from(k.values());return C.length>0?C.join(`

`):"Analyzing risk mitigation strategies..."})(),className:"form-control small border-0",style:{minHeight:"100px",resize:"vertical",backgroundColor:"transparent",fontSize:"0.875rem",lineHeight:"1.5",padding:"0.5rem",color:"#858796",cursor:"default",overflowY:"auto",whiteSpace:"pre-wrap",fontFamily:"inherit",boxShadow:"none"},"aria-label":"Risk Mitigation Suggestions"}):e.jsxs("div",{className:"mb-1 small text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Analyzing risk mitigation strategies..."]})})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3 pt-3 border-top",children:[e.jsx("div",{children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-clock mr-1"}),"Generated: ",new Date(p.timestamp).toLocaleString()]})}),e.jsx("div",{children:e.jsxs("span",{className:"badge badge-info",children:["Confidence: ",(p.confidenceLevel*100).toFixed(0),"%"]})})]})]})]})}),!p&&!M&&e.jsx("div",{className:"alert alert-info mb-4",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx("i",{className:"fas fa-robot fa-2x text-info"})}),e.jsxs("div",{children:[e.jsx("h6",{className:"alert-heading",children:"AI-Powered Financial Insights"}),e.jsx("p",{className:"mb-2",children:"Get personalized financial advice and recommendations using advanced AI analysis. Our AI analyzes your spending patterns, income trends, and financial goals to provide actionable insights."}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Features:"}),e.jsxs("ul",{className:"mb-0 mt-1",children:[e.jsx("li",{children:"Personalized financial recommendations"}),e.jsx("li",{children:"Risk assessment and mitigation strategies"}),e.jsx("li",{children:"Investment and savings opportunities"}),e.jsx("li",{children:"Budget optimization suggestions"})]})]}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Powered by OpenRouter API ‚Ä¢ Unlimited AI insights generation"]})]})]})}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-4 mb-4",children:e.jsx("div",{className:"card border-left-primary shadow h-100 py-0",children:e.jsx("div",{className:"card-body py-2",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1 d-flex align-items-center",children:["Income Projection",e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:g=>n("incomeProjection",g),"aria-label":"Income projection information"})})]}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[x>0?"+":"",x.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Your income is predicted to ",x>0?"increase":"decrease"," over the next ",Z(),"."]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-chart-line fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-lg-4 mb-4",children:e.jsx("div",{className:"card border-left-danger shadow h-100 py-0",children:e.jsx("div",{className:"card-body py-2",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-danger text-uppercase mb-1 d-flex align-items-center",children:["Expense Projection",e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:g=>n("expenseProjection",g),"aria-label":"Expense projection information"})})]}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[h>0?"+":"",h.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Your expenses are projected to ",h>0?"rise":"fall"," over the selected period."]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-chart-area fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-lg-4 mb-4",children:e.jsx("div",{className:"card border-left-success shadow h-100 py-0",children:e.jsx("div",{className:"card-body py-2",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-success text-uppercase mb-1 d-flex align-items-center",children:["Savings Potential",e.jsx("div",{className:"ml-2 position-relative",children:e.jsx("i",{className:"fas fa-info-circle text-gray-400 cursor-pointer",onClick:g=>n("savingsProjection",g),"aria-label":"Savings projection information"})})]}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[d>0?"+":"",d.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:["Your savings are predicted to ",d>0?"grow":"decline"," during this timeframe."]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-piggy-bank fa-2x text-gray-300"})})]})})})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("h4",{className:"small font-weight-bold text-gray-700",children:["Prophet Model Confidence",e.jsx("i",{className:"fas fa-info-circle text-gray-400 ml-2 cursor-pointer",onClick:g=>n("modelConfidence",g)})]}),e.jsxs("span",{className:"font-weight-bold text-info",children:[s[4]?.value,"%"]})]}),e.jsx("div",{className:"progress",style:{height:"10px",borderRadius:"5px"},children:e.jsx("div",{className:"progress-bar bg-info progress-bar-striped",role:"progressbar",style:{width:`${s[4]?.value}%`,borderRadius:"5px"},"aria-valuenow":s[4]?.value,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("div",{className:"d-flex justify-content-between mt-1",children:[e.jsxs("small",{className:"text-muted",children:["MAPE: ",s[0]?.value,"%"]}),e.jsxs("small",{className:"text-muted",children:["R¬≤ Score: ",s[3]?.value]})]})]}),e.jsx("div",{className:"alert alert-info border-left-info",style:{borderLeftWidth:"4px",background:"rgba(54, 185, 204, 0.05)"},children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx("i",{className:"fa-solid fa-magnifying-glass-chart fa-2x text-gray-300"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Financial Predictions:"})," Income predictions use Facebook's Prophet model or stable baseline analysis from your actual transaction history. Expense predictions are calculated per category based on your spending patterns with realistic 2-3% annual growth assumptions."]}),e.jsxs("p",{className:"mb-0 mt-2",children:[e.jsx("strong",{children:"Calculation Method:"})," Similar to your transaction summary cards, we calculate totals by transaction type (income/expense) and project forward with minimal variance for stable, realistic forecasts!"]}),e.jsxs("p",{className:"mb-0 mt-2",children:[e.jsx("strong",{children:"AI Insights:"})," Enhanced with OpenRouter API integration providing personalized financial advice, risk assessments, and optimization recommendations based on your unique financial profile."]}),e.jsx("p",{className:"mb-0 mt-2",children:e.jsx("small",{children:"* Predictions are based on your actual transaction history. Add more transactions for more accurate forecasts. Results may vary based on unforeseen changes in your financial situation."})})]})]})})]})]})})})]})});Oe.displayName="AIInsightsCard";const Ze=()=>{const[u,t]=D.useState(null),[s,a]=D.useState(null);return{activeTip:u,tooltipPosition:s,toggleTip:(n,r)=>{if(u===n)t(null),a(null);else if(t(n),r){const c=r.currentTarget.getBoundingClientRect();a({top:c.bottom+window.scrollY,left:c.left+c.width/2+window.scrollX})}}}},et=()=>{const[u,t]=D.useState("3months"),[s,a]=D.useState("all");return{timeframe:u,dataType:s,setTimeframe:t,setDataType:a}},tt=()=>{const[u,t]=D.useState(!1),[s,a]=D.useState(!1);return{showModelDetails:u,showAccuracyReport:s,setShowModelDetails:t,setShowAccuracyReport:a}};class ge{static async getPredictionHistory(t,s=50,a=0){try{const{data:i,error:n,count:r}=await L.from("prophet_predictions").select(`
          id,
          timeframe,
          generated_at,
          expires_at,
          confidence_score,
          predictions,
          category_forecasts,
          model_accuracy,
          access_count,
          ai_insights (
            id,
            prediction_id,
            ai_service,
            model_used,
            insights,
            risk_assessment,
            recommendations,
            opportunity_areas,
            confidence_level,
            generated_at,
            access_count
          )
        `,{count:"exact"}).eq("user_id",t).order("generated_at",{ascending:!1}).range(a,a+s-1);return n?(console.error("Error fetching prediction history:",n),{data:[],count:0,error:n}):{data:(i||[]).map(o=>({...o,ai_insights:o.ai_insights?.[0]||null})),count:r||0,error:null}}catch(i){return console.error("Exception in getPredictionHistory:",i),{data:[],count:0,error:i}}}static async getAIInsightsHistory(t,s=50,a=0){try{const{data:i,error:n,count:r}=await L.from("ai_insights").select("*",{count:"exact"}).eq("user_id",t).order("generated_at",{ascending:!1}).range(a,a+s-1);return n?(console.error("Error fetching AI insights history:",n),{data:[],count:0,error:n}):{data:i||[],count:r||0,error:null}}catch(i){return console.error("Exception in getAIInsightsHistory:",i),{data:[],count:0,error:i}}}static async getPredictionRequestsHistory(t,s=50,a=0){try{const{data:i,error:n,count:r}=await L.from("prediction_requests").select(`
          id,
          timeframe,
          prediction_type,
          status,
          request_at,
          completed_at,
          api_response_time_ms,
          transaction_count
        `,{count:"exact"}).eq("user_id",t).order("request_at",{ascending:!1}).range(a,a+s-1);return n?(console.error("Error fetching prediction requests history:",n),{data:[],count:0,error:n}):{data:i||[],count:r||0,error:null}}catch(i){return console.error("Exception in getPredictionRequestsHistory:",i),{data:[],count:0,error:i}}}static async getPredictionById(t,s){try{const{data:a,error:i}=await L.from("prophet_predictions").select(`
          *,
          ai_insights (*)
        `).eq("id",t).eq("user_id",s).single();return i?(console.error("Error fetching prediction by ID:",i),{data:null,error:i}):{data:{...a,ai_insights:a.ai_insights?.[0]||null},error:null}}catch(a){return console.error("Exception in getPredictionById:",a),{data:null,error:a}}}static async deletePrediction(t,s){try{const{error:a}=await L.from("ai_insights").delete().eq("prediction_id",t).eq("user_id",s);if(a)return console.error("Error deleting AI insights:",a),{success:!1,error:a};const{error:i}=await L.from("prophet_predictions").delete().eq("id",t).eq("user_id",s);return i?(console.error("Error deleting prediction:",i),{success:!1,error:i}):{success:!0,error:null}}catch(a){return console.error("Exception in deletePrediction:",a),{success:!1,error:a}}}static exportPredictionsToCSV(t){const s=["ID","Timeframe","Generated At","Confidence Score","MAE","MAPE","RMSE","Data Points","Has AI Insights","Access Count"],a=t.map(n=>[n.id,n.timeframe,new Date(n.generated_at).toLocaleString(),n.confidence_score.toFixed(2),n.model_accuracy.mae.toFixed(2),n.model_accuracy.mape.toFixed(2),n.model_accuracy.rmse.toFixed(2),n.model_accuracy.data_points,n.ai_insights?"Yes":"No",n.access_count]);return[s.join(","),...a.map(n=>n.map(r=>`"${r}"`).join(","))].join(`
`)}static exportAIInsightsToCSV(t){const s=["ID","AI Service","Model Used","Confidence Level","Generated At","Insights Summary","Risk Assessment","Recommendations Count","Access Count"],a=t.map(n=>[n.id,n.ai_service,n.model_used,n.confidence_level.toFixed(2),new Date(n.generated_at).toLocaleString(),n.insights?Object.keys(n.insights).join("; "):"N/A",n.risk_assessment?JSON.stringify(n.risk_assessment).substring(0,50):"N/A",n.recommendations?Object.keys(n.recommendations).length:0,n.access_count]);return[s.join(","),...a.map(n=>n.map(r=>`"${r}"`).join(","))].join(`
`)}static exportAIInsightsToJSON(t){return JSON.stringify(t,null,2)}static downloadFile(t,s,a){const i=new Blob([t],{type:a}),n=window.URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)}static async exportPredictionsHistory(t,s="csv"){const{data:a,error:i}=await this.getPredictionHistory(t,1e3,0);if(i||!a||a.length===0)throw new Error("No predictions to export");const n=new Date().toISOString().split("T")[0];if(s==="csv"){const r=this.exportPredictionsToCSV(a);this.downloadFile(r,`predictions-history-${n}.csv`,"text/csv")}else{const r=JSON.stringify(a,null,2);this.downloadFile(r,`predictions-history-${n}.json`,"application/json")}}static async exportAIInsightsHistory(t,s="csv"){const{data:a,error:i}=await this.getAIInsightsHistory(t,1e3,0);if(i||!a||a.length===0)throw new Error("No AI insights to export");const n=new Date().toISOString().split("T")[0];if(s==="csv"){const r=this.exportAIInsightsToCSV(a);this.downloadFile(r,`ai-insights-history-${n}.csv`,"text/csv")}else{const r=this.exportAIInsightsToJSON(a);this.downloadFile(r,`ai-insights-history-${n}.json`,"application/json")}}static async getPredictionStatistics(t){try{const{data:s}=await L.from("prophet_predictions").select("confidence_score, timeframe").eq("user_id",t),{count:a}=await L.from("ai_insights").select("id",{count:"exact",head:!0}).eq("user_id",t),{count:i}=await L.from("prediction_requests").select("id",{count:"exact",head:!0}).eq("user_id",t),n=s?.length||0,r=n>0?s.reduce((l,m)=>l+m.confidence_score,0)/n:0,c={};s?.forEach(l=>{c[l.timeframe]=(c[l.timeframe]||0)+1});const o=Object.entries(c).sort((l,m)=>m[1]-l[1])[0]?.[0]||"months_3";return{totalPredictions:n,totalAIInsights:a||0,totalRequests:i||0,averageConfidence:r,mostUsedTimeframe:o}}catch(s){return console.error("Error getting prediction statistics:",s),{totalPredictions:0,totalAIInsights:0,totalRequests:0,averageConfidence:0,mostUsedTimeframe:"months_3"}}}}const st=({isOpen:u,onClose:t})=>{const{user:s}=ve(),[a,i]=D.useState(!0),[n,r]=D.useState([]),[c,o]=D.useState(0),[l,m]=D.useState({totalPredictions:0,totalAIInsights:0,totalRequests:0,averageConfidence:0,mostUsedTimeframe:"months_3"}),[x,h]=D.useState(0),d=10,[p,b]=D.useState(null);D.useEffect(()=>{u&&s?.id&&A()},[u,s?.id,x]);const A=async()=>{if(s?.id){i(!0);try{const{data:E,count:M,error:X}=await ge.getPredictionHistory(s.id,d,x*d);if(X){$.error("Failed to load predictions history");return}r(E),o(M);const S=await ge.getPredictionStatistics(s.id);m(S)}catch(E){console.error("Error loading data:",E),$.error("Failed to load data")}finally{i(!1)}}},H=async E=>{try{await ge.exportPredictionsHistory(s.id,E),$.success(`Predictions exported as ${E.toUpperCase()}`)}catch(M){$.error(M.message||"Failed to export predictions")}},ie=async E=>{try{await ge.exportAIInsightsHistory(s.id,E),$.success(`AI Insights exported as ${E.toUpperCase()}`)}catch(M){$.error(M.message||"Failed to export AI insights")}},re=async E=>{if(!confirm("Are you sure you want to delete this prediction? This action cannot be undone."))return;const{success:M}=await ge.deletePrediction(E,s.id);M?($.success("Prediction deleted successfully"),A()):$.error("Failed to delete prediction")},W=async E=>{const{data:M,error:X}=await ge.getPredictionById(E,s.id);if(X||!M){$.error("Failed to load prediction details");return}b(M)};return u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:1060},children:e.jsx("div",{className:"w-[95vw] h-[90vh] mx-auto my-auto",children:e.jsxs("div",{className:"w-full h-full flex flex-col bg-white rounded-lg shadow-2xl border border-gray-200",style:{zIndex:1065},children:[e.jsxs("div",{className:"flex items-center justify-between px-8 py-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-1",children:[e.jsx("i",{className:"fas fa-history mr-3 text-blue-600"}),"Prediction & AI Insights History"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"View and manage your prediction history"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("i",{className:"fas fa-times text-2xl"})})]}),e.jsx("div",{className:"flex-1 flex min-h-0",children:e.jsxs("div",{className:"flex w-full h-full",children:[e.jsx("div",{className:"flex-1 flex flex-col border-r border-gray-200",children:e.jsxs("div",{className:"p-8 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700",children:["Recent Predictions (",c,")"]}),e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn btn-sm btn-success",onClick:()=>H("csv"),disabled:n.length===0,children:[e.jsx("i",{className:"fas fa-file-csv mr-2"}),"Export CSV"]}),e.jsxs("button",{className:"btn btn-sm btn-info ml-2",onClick:()=>ie("json"),disabled:n.length===0,children:[e.jsx("i",{className:"fas fa-file-code mr-2"}),"Export JSON"]})]})]}),a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-gray-500",children:"Loading predictions..."})]}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("i",{className:"fas fa-chart-line text-gray-300 mb-3",style:{fontSize:"3rem"}}),e.jsx("p",{className:"text-gray-500",children:"No predictions found. Generate your first prediction to see history here."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:n.map(E=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>W(E.id),children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"badge badge-primary",children:E.timeframe}),E.ai_insights&&e.jsxs("span",{className:"badge badge-success",children:[e.jsx("i",{className:"fas fa-brain mr-1"}),"AI Insights"]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("i",{className:"far fa-calendar mr-1"}),new Date(E.generated_at).toLocaleString()]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:M=>{M.stopPropagation(),re(E.id)},title:"Delete",children:e.jsx("i",{className:"fas fa-trash"})})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-0",children:"Confidence"}),e.jsxs("span",{className:"text-xs font-weight-bold",children:[(E.confidence_score*100).toFixed(0),"%"]})]}),e.jsx("div",{className:"progress",style:{height:"8px"},children:e.jsx("div",{className:`progress-bar ${E.confidence_score>.8?"bg-success":E.confidence_score>.6?"bg-info":"bg-warning"}`,role:"progressbar",style:{width:`${E.confidence_score*100}%`},"aria-valuenow":E.confidence_score*100,"aria-valuemin":0,"aria-valuemax":100})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"MAE"}),e.jsx("p",{className:"font-semibold",children:E.model_accuracy.mae.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Data Points"}),e.jsx("p",{className:"font-semibold",children:E.model_accuracy.data_points})]})]})]},E.id))}),c>d&&e.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-gray-200",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Showing ",x*d+1," - ",Math.min((x+1)*d,c)," of ",c]}),e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>h(Math.max(0,x-1)),disabled:x===0,children:[e.jsx("i",{className:"fas fa-chevron-left mr-1"}),"Previous"]}),e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>h(x+1),disabled:(x+1)*d>=c,children:["Next",e.jsx("i",{className:"fas fa-chevron-right ml-1"})]})]})]})]})]})}),e.jsx("div",{className:"w-2/5 bg-gray-50 flex flex-col",children:e.jsx("div",{className:"p-8 flex-1 overflow-y-auto",children:p?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Prediction Details"}),e.jsxs("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>b(null),children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-700",children:"Basic Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Generated:"}),e.jsx("span",{className:"font-medium",children:new Date(p.generated_at).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Timeframe:"}),e.jsx("span",{className:"badge badge-primary",children:p.timeframe})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Views:"}),e.jsx("span",{className:"font-medium",children:p.access_count})]})]})]}),p.category_forecasts&&Object.keys(p.category_forecasts).length>0&&e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("h4",{className:"font-semibold mb-3 text-gray-700",children:[e.jsx("i",{className:"fas fa-chart-line mr-2 text-green-600"}),"Projected Growth"]}),e.jsx("div",{className:"space-y-2",children:(()=>{const E=p.category_forecasts;let M=0,X=0;Object.values(E).forEach(F=>{M+=F.historicalAverage||0,X+=F.predicted||0});const S=M>0?((X-M)/M*100).toFixed(1):"0.0";return e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Expense Growth:"}),e.jsxs("span",{className:`font-semibold ${parseFloat(S)>0?"text-red-600":"text-green-600"}`,children:[S,"%"]})]}),e.jsxs("div",{className:"flex justify-between py-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Current: ‚Ç±",M.toLocaleString()]}),e.jsxs("span",{children:["Predicted: ‚Ç±",X.toLocaleString()]})]})]})})()})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("h4",{className:"font-semibold mb-3 text-gray-700",children:[e.jsx("i",{className:"fas fa-bullseye mr-2 text-blue-600"}),"Model Accuracy"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Confidence Score"}),e.jsxs("span",{className:"font-semibold",children:[(p.confidence_score*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"progress w-100",style:{height:"8px"},children:e.jsx("div",{className:"progress-bar bg-success",role:"progressbar",style:{width:`${p.confidence_score*100}%`},"aria-valuenow":p.confidence_score*100,"aria-valuemin":0,"aria-valuemax":100})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"MAE:"}),e.jsx("span",{className:"font-semibold ml-2",children:p.model_accuracy.mae.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"MAPE:"}),e.jsx("span",{className:"font-semibold ml-2",children:p.model_accuracy.mape.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"RMSE:"}),e.jsx("span",{className:"font-semibold ml-2",children:p.model_accuracy.rmse.toFixed(2)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Data Points:"}),e.jsx("span",{className:"font-semibold ml-2",children:p.model_accuracy.data_points})]})]})]})]}),p.category_forecasts&&Object.keys(p.category_forecasts).length>0&&e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("h4",{className:"font-semibold mb-3 text-gray-700",children:[e.jsx("i",{className:"fas fa-layer-group mr-2 text-purple-600"}),"Category Forecasts"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:Object.entries(p.category_forecasts).map(([E,M])=>e.jsxs("div",{className:"text-sm border-b border-gray-100 pb-2",children:[e.jsx("div",{className:"font-medium text-gray-700 mb-1",children:E}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:["Current: ‚Ç±",(M.historicalAverage||0).toFixed(0)]}),e.jsxs("span",{className:M.predicted>M.historicalAverage?"text-red-600":"text-green-600",children:["‚Üí ‚Ç±",(M.predicted||0).toFixed(0)]})]})]},E))})]}),p.ai_insights&&e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("h4",{className:"font-semibold mb-3 text-gray-700",children:[e.jsx("i",{className:"fas fa-brain mr-2 text-purple-600"}),"AI Insights"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Service:"}),e.jsx("span",{className:"badge badge-info",children:p.ai_insights.ai_service})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Model:"}),e.jsx("span",{className:"text-xs font-mono",children:p.ai_insights.model_used})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Confidence:"}),e.jsxs("span",{className:"font-semibold",children:[(p.ai_insights.confidence_level*100).toFixed(1),"%"]})]}),p.ai_insights.recommendations&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-600 block mb-2",children:"Has Recommendations"}),e.jsx("span",{className:"badge badge-success",children:"Yes"})]})]})]})]})]}):e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Statistics Overview"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border-l-4 border-primary",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Total Predictions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:l.totalPredictions})]}),e.jsx("i",{className:"fas fa-chart-line text-3xl text-gray-300"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border-l-4 border-success",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"AI Insights Generated"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:l.totalAIInsights})]}),e.jsx("i",{className:"fas fa-brain text-3xl text-gray-300"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border-l-4 border-info",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Average Confidence"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[(l.averageConfidence*100).toFixed(1),"%"]})]}),e.jsx("i",{className:"fas fa-trophy text-3xl text-gray-300"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border-l-4 border-warning",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase mb-1",children:"Total Requests"}),e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:l.totalRequests})]}),e.jsx("i",{className:"fas fa-server text-3xl text-gray-300"})]})}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200 mt-6",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-2",children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),"Quick Tip"]}),e.jsx("p",{className:"text-sm text-blue-800",children:"Click on any prediction to view detailed information including model accuracy metrics and AI-generated insights."})]})]})]})})})]})})]})})}):null},dt=()=>{const{user:u}=ve(),[t,s]=D.useState({loading:!0,error:null,predictions:null,generating:!1}),[a,i]=D.useState(!1),n=D.useRef(null),[r,c]=D.useState(null),{timeframe:o,dataType:l,setTimeframe:m,setDataType:x}=et(),{showModelDetails:h,showAccuracyReport:d,setShowModelDetails:p,setShowAccuracyReport:b}=tt(),{activeTip:A,tooltipPosition:H,toggleTip:ie}=Ze(),re=[],W=[];D.useEffect(()=>{u?.id&&E()},[u?.id,o]),D.useEffect(()=>{if(r&&clearTimeout(r),t.loading){const f=setTimeout(()=>{console.warn("Loading timeout reached, forcing empty state display"),s(y=>({...y,loading:!1})),$.info("Loading took longer than expected. Please check your transaction data.")},5e3);c(f)}return()=>{r&&clearTimeout(r)}},[t.loading]);const E=D.useCallback(async()=>{if(u?.id)try{const f=fe(o);console.log("üîÑ Loading cached predictions:",{uiTimeframe:o,apiTimeframe:f});const y=await je.getCachedPredictionFromDB(u.id,f);y.found&&y.data?(console.log("‚úì Found cached prediction in database"),s(v=>({...v,predictions:y.data||null,loading:!1})),$.success("Loaded cached predictions from database")):(console.log("No cached predictions found, ready to generate new ones"),s(v=>({...v,predictions:null,loading:!1})))}catch(f){console.error("Error loading cached predictions:",f),s(y=>({...y,loading:!1}))}},[u?.id,o]),M=D.useCallback(async()=>{if(!u?.id){$.error("Please log in to generate predictions");return}s(f=>({...f,generating:!0,error:null}));try{const f=fe(o);console.log("üîÑ Generating predictions:",{uiTimeframe:o,apiTimeframe:f});const y=await je.generateProphetPredictions(u.id,f,!0);s(v=>({...v,predictions:y,generating:!1,error:null})),setTimeout(()=>{E()},500),$.success("Prophet predictions generated and updated successfully!"),console.log("ü§ñ Auto-triggering AI insights generation..."),setTimeout(async()=>{if(n.current)try{console.log("üîÑ Calling AI insights generation..."),await n.current.generateInsights(),console.log("‚úÖ AI insights generated automatically after Prophet predictions"),$.success("AI insights generated successfully!")}catch(v){console.error("‚ùå Failed to auto-generate AI insights:",v),$.info('AI insights generation available - click "Generate AI Insights" button')}else console.warn("‚ö†Ô∏è AI insights ref not available")},2e3)}catch(f){s(y=>({...y,generating:!1,error:f.message})),f.message.includes("At least 7 transactions are required")?(s(y=>({...y,predictions:null,error:null})),$.info("Add more transactions to generate accurate predictions. At least 7 transactions are needed.")):$.error(f.message)}},[u?.id,o]),X=D.useCallback(()=>{i(!0)},[]),S=D.useCallback(async f=>{if(!u?.id){$.error("Please log in to export predictions");return}try{await ge.exportPredictionsHistory(u.id,f),$.success(`Predictions exported as ${f.toUpperCase()}`)}catch(y){$.error(y.message||"Failed to export predictions")}},[u?.id]),F=D.useCallback(async f=>{if(!u?.id){$.error("Please log in to export insights");return}try{await ge.exportAIInsightsHistory(u.id,f),$.success(`AI Insights exported as ${f.toUpperCase()}`)}catch(y){$.error(y.message||"Failed to export AI insights")}},[u?.id]),q=D.useCallback(f=>{if(m(f),u?.id){const y=je.getCachedPredictions(u.id,f);y&&s(v=>({...v,predictions:y}))}},[m,u?.id]),N=t.predictions,Z=N?[{metric:"Mean Absolute Percentage Error (MAPE)",value:N.model_accuracy.mape,description:"Average percentage error across predictions"},{metric:"Mean Absolute Error (MAE)",value:N.model_accuracy.mae,description:"Average prediction error in absolute terms"},{metric:"Root Mean Square Error (RMSE)",value:N.model_accuracy.rmse,description:"Standard deviation of prediction errors"},{metric:"R¬≤ Score",value:N.model_accuracy.r2_score||.85,description:"Coefficient of determination (goodness of fit)"},{metric:"Model Confidence",value:95,description:"Overall prediction confidence percentage"},{metric:"Training Data Points",value:N.model_accuracy.data_points,description:"Number of data points used for model training"}]:re,ae=be.useCallback((f,y,v)=>{if(y<=0)return f;const I=(f-y)/y;if(Math.abs(I)>2){console.error("‚ùå VALIDATION ERROR: Prediction exceeds expected range (3x historical average):",{userId:u?.id||"unknown",timeframe:o,label:v,predicted:f.toFixed(2),historical:y.toFixed(2),growthRate:`${(I*100).toFixed(1)}%`,threshold:"200% (3x historical)",ratio:(f/y).toFixed(2)+"x",timestamp:new Date().toISOString(),validationRule:"prediction_exceeds_3x_historical",action:"Applying conservative fallback (historical + 5%)"});const T=y*1.05;return console.warn("‚ö†Ô∏è FALLBACK APPLIED: Using conservative prediction value:",{userId:u?.id||"unknown",timeframe:o,label:v,originalPredicted:f.toFixed(2),fallbackValue:T.toFixed(2),adjustment:"historical + 5%",reason:"Prediction exceeded 3x historical average",timestamp:new Date().toISOString()}),T}return Math.abs(I)>.5&&Math.abs(I)<=2&&console.warn("‚ö†Ô∏è VALIDATION WARNING: High prediction growth rate detected:",{userId:u?.id||"unknown",timeframe:o,label:v,predicted:f.toFixed(2),historical:y.toFixed(2),growthRate:`${(I*100).toFixed(1)}%`,threshold:"50-200%",ratio:(f/y).toFixed(2)+"x",timestamp:new Date().toISOString(),validationRule:"high_growth_rate_warning",action:"Accepting value but flagging for review"}),f},[u?.id,o]),g=be.useMemo(()=>{if(!N)return[{category:"No Predictions Generated",current:0,predicted:0,change:0,changePercent:0,isEmptyState:!0}];const f=Object.entries(N.category_forecasts||{});if(f.length===0&&N.user_profile){const w=N.user_profile.avgMonthlyExpenses||0;if(w>0)return console.warn("‚ö†Ô∏è FALLBACK APPLIED: No category forecasts available, using user profile:",{userId:u?.id||"unknown",timeframe:o,avgMonthlyExpenses:w.toFixed(2),estimatedGrowth:"5%",reason:"No category forecasts in prediction response",timestamp:new Date().toISOString()}),[{category:"Estimated Total Expenses",current:w,predicted:w*1.05,change:w*.05,changePercent:5,isEmptyState:!1}]}const y=f.map(([w,P])=>{const z=ae(P.predicted,P.historicalAverage,`Category: ${w}`),R=(z-P.historicalAverage)/P.historicalAverage*100;return Math.abs(R)>30&&console.warn("‚ö†Ô∏è VALIDATION WARNING: High category growth rate detected:",{userId:u?.id||"unknown",timeframe:o,category:w,historicalAverage:P.historicalAverage.toFixed(2),predicted:z.toFixed(2),changePercent:R.toFixed(1)+"%",threshold:"30%",timestamp:new Date().toISOString(),validationRule:"category_growth_exceeds_30_percent"}),{category:w,current:P.historicalAverage,predicted:z,change:z-P.historicalAverage,changePercent:R,isEmptyState:!1}}),v=y.reduce((w,P)=>w+P.predicted,0),I=y.reduce((w,P)=>w+P.current,0),T=I>0?(v-I)/I*100:0;return console.log("üìä Category Predictions Summary:",{userId:u?.id||"unknown",timeframe:o,categoryCount:y.length,categories:y.map(w=>w.category),totalCurrent:I.toFixed(2),totalPredicted:v.toFixed(2),overallGrowth:T.toFixed(1)+"%",timestamp:new Date().toISOString()}),v>I*1.5&&console.error("‚ùå VALIDATION ERROR: Total category predictions exceed 150% of current:",{userId:u?.id||"unknown",timeframe:o,totalCurrent:I.toFixed(2),totalPredicted:v.toFixed(2),ratio:(v/I).toFixed(2)+"x",threshold:"1.5x (150%)",timestamp:new Date().toISOString(),validationRule:"total_category_predictions_exceed_150_percent"}),y.length>0?y:[{category:"No Predictions Generated",current:0,predicted:0,change:0,changePercent:0,isEmptyState:!0}]},[N,ae,u?.id,o]),k=be.useMemo(()=>{if(!N)return{"3months":[],"6months":[],"1year":[]};const y=(w=>{const P={};w.forEach(R=>{const O=new Date(R.date).toISOString().substr(0,7);P[O]||(P[O]={sum:0,count:0,dates:[],upperSum:0,lowerSum:0}),P[O].sum+=R.predicted,P[O].count+=1,P[O].dates.push(R.date),P[O].upperSum+=R.upper||R.predicted*1.1,P[O].lowerSum+=R.lower||R.predicted*.9});const z=Object.entries(P).sort(([R],[O])=>R.localeCompare(O)).map(([R,O])=>({month:R,predicted:O.sum,average:O.sum/O.count,daysInMonth:O.count,dates:O.dates,upper:O.upperSum,lower:O.lowerSum}));return z.forEach((R,O)=>{const ee=R.average,te=28;R.daysInMonth<te&&console.warn("‚ö†Ô∏è VALIDATION WARNING: Incomplete month data in aggregation:",{userId:u?.id||"unknown",timeframe:o,month:R.month,daysInMonth:R.daysInMonth,expectedMinimum:te,monthlyTotal:R.predicted.toFixed(2),avgDaily:ee.toFixed(2),timestamp:new Date().toISOString(),validationRule:"incomplete_month_data"}),R.predicted<0&&console.error("‚ùå VALIDATION ERROR: Negative monthly prediction detected:",{userId:u?.id||"unknown",timeframe:o,month:R.month,predicted:R.predicted.toFixed(2),timestamp:new Date().toISOString(),validationRule:"negative_monthly_prediction"})}),z})(N.predictions);console.log("üìä Monthly Aggregation Complete:",{userId:u?.id||"unknown",timeframe:o,totalDailyPredictions:N.predictions.length,monthlyAggregates:y.length,months:y.map(w=>w.month),firstMonthSummary:y[0]?{month:y[0].month,predicted:y[0].predicted.toFixed(2),daysAggregated:y[0].daysInMonth,avgDaily:y[0].average.toFixed(2)}:null,timestamp:new Date().toISOString()});const v=y.map((w,P)=>{const z=g.filter(B=>B.category!=="No Transaction Data"&&B.category!=="No Predictions Generated"),R=z.reduce((B,Y)=>B+(Y.predicted||0),0),O=z.reduce((B,Y)=>B+(Y.current||0),0),ee=O>0?O*1.2:w.predicted*.98,te=O,he=Math.max(0,ee-te);let K=w.predicted,G=R;const V=K,J=G;K=ae(K,ee,"Income"),G=ae(G,te,"Expenses");const le=Math.max(0,K-G);if(P===0){const B=V!==K,Y=J!==G;console.log("üìä Monthly Aggregated Prediction (VALIDATED):",{userId:u?.id||"unknown",timeframe:o,month:w.month,daysAggregated:w.daysInMonth,baseline:{currentIncome:ee.toFixed(2),currentExpenses:te.toFixed(2)},predicted:{income:K.toFixed(2),expenses:G.toFixed(2),savings:le.toFixed(2)},validation:{incomeAdjusted:B,expensesAdjusted:Y,originalIncome:B?V.toFixed(2):null,originalExpenses:Y?J.toFixed(2):null},categoryCount:z.length,timestamp:new Date().toISOString(),note:"Predictions validated against 3x historical threshold"}),(B||Y)&&console.warn("‚ö†Ô∏è VALIDATION ADJUSTMENTS: Predictions were adjusted during validation:",{userId:u?.id||"unknown",timeframe:o,month:w.month,adjustments:{income:B?{original:V.toFixed(2),adjusted:K.toFixed(2),change:(K-V).toFixed(2)}:"No adjustment",expenses:Y?{original:J.toFixed(2),adjusted:G.toFixed(2),change:(G-J).toFixed(2)}:"No adjustment"},timestamp:new Date().toISOString()})}return{month:w.month,income:ee,expenses:te,savings:he,incomePrediction:K,expensesPrediction:G,savingsPrediction:le,incomeUpper:w.upper||K*1.15,incomeLower:w.lower||K*.85,expensesUpper:G*1.15,expensesLower:G*.85}}),T=(w=>{const P=qe(w);return console.log("üìç Mapping timeframe:",{input:w,output:P}),P})(N.timeframe);return{"3months":T==="3months"?v:[],"6months":T==="6months"?v:[],"1year":T==="1year"?v:[]}},[N,g]),j=D.useCallback(()=>{if(!N)return[{type:"Income",current:0,predicted:0,change:0,changePercent:0,isEmptyState:!0}];const f=k[o]&&k[o].length>0?k[o]:null,y=g.length>0&&!g[0]?.isEmptyState;if(!f&&!y)return[{type:"Income",current:0,predicted:0,change:0,changePercent:0,isEmptyState:!0}];let v=0,I=0,T=0,w=0,P=0,z=0;if(f){const se=f[0];v=se.income||0,I=se.expenses||0,T=se.savings||0,w=se.incomePrediction||v,P=se.expensesPrediction||I,z=Math.max(0,w-P),console.log("üìä Transaction Type Predictions - Current vs Next Month:",{source:"First data point (current month baseline)",currentMonth:{income:v,expenses:I,savings:T},nextMonthPredicted:{income:w,expenses:P,savings:z},changes:{income:w-v,expenses:P-I,savings:z-T}})}else if(y){const se=Ae(o),ne=g.filter(oe=>oe.category!=="No Predictions Generated").reduce((oe,ue)=>oe+(ue.current||0),0),xe=g.filter(oe=>oe.category!=="No Predictions Generated").reduce((oe,ue)=>oe+(ue.predicted||0),0);I=ne/se,P=xe/se,v=I>0?I*1.2:0,w=P>0?P*1.2:0,T=Math.max(0,v-I),z=Math.max(0,w-P),console.log("üìä Category Fallback Monthly Calculation:",{totalCurrentExpenses:ne,totalPredictedExpenses:xe,forecastMonths:se,monthlyCurrentExpenses:I,monthlyPredictedExpenses:P})}const R=v-I,O=w-P,ee=v===0&&I===0&&T===0&&w===0&&P===0&&z===0;if(console.log("TransactionTypePredictions Debug:",{dataSource:f?"predictionData":y?"categoryData":"none",timeframe:o,currentIncome:v,currentExpenses:I,currentSavings:T,predictedIncome:w,predictedExpenses:P,predictedSavings:z,currentTotal:R,predictedTotal:O,categoryDataLength:g.length,allValuesZero:ee}),ee)return[{type:"Income",current:0,predicted:0,change:0,changePercent:0,isEmptyState:!0}];const te=w-v,he=v>0?te/v*100:0,K=P-I,G=I>0?K/I*100:0,V=O-R,J=Math.abs(R)>0?V/Math.abs(R)*100:0,le=(se,ne,xe)=>{if(Math.abs(ne)>50){console.error("‚ùå VALIDATION ERROR: Unrealistic growth rate detected:",{userId:u?.id||"unknown",timeframe:o,transactionType:xe,originalChangePercent:ne.toFixed(1)+"%",threshold:"50%",exceedsBy:(Math.abs(ne)-50).toFixed(1)+"%",timestamp:new Date().toISOString(),validationRule:"growth_rate_exceeds_50_percent",action:"Applying conservative cap of ¬±5%"});const oe=Math.sign(ne)*5,ue=se*(1+oe/100);return console.warn("‚ö†Ô∏è FALLBACK APPLIED: Capping growth rate to conservative value:",{userId:u?.id||"unknown",timeframe:o,transactionType:xe,originalValue:se.toFixed(2),cappedValue:ue.toFixed(2),originalGrowth:ne.toFixed(1)+"%",cappedGrowth:oe.toFixed(1)+"%",reason:"Growth rate exceeded 50% threshold",timestamp:new Date().toISOString()}),{value:ue,changePercent:oe,capped:!0}}return Math.abs(ne)>20&&Math.abs(ne)<=50&&console.warn("‚ö†Ô∏è VALIDATION WARNING: High growth rate detected:",{userId:u?.id||"unknown",timeframe:o,transactionType:xe,changePercent:ne.toFixed(1)+"%",threshold:"20-50%",timestamp:new Date().toISOString(),validationRule:"growth_rate_exceeds_20_percent",action:"Accepting value but flagging for review"}),{value:se,changePercent:ne,capped:!1}},B=le(w,he,"Income"),Y=le(P,G,"Expense"),Le=B.value,$e=Y.value,Ne=Math.max(0,Le-$e),Ue=Ne-T,Ge=T>0?Ue/T*100:0,me=le(Ne,Ge,"Savings");return(B.capped||Y.capped||me.capped)&&console.warn("‚ö†Ô∏è VALIDATION SUMMARY: Conservative caps applied to transaction type predictions:",{userId:u?.id||"unknown",timeframe:o,cappingSummary:{income:B.capped?"CAPPED":"OK",expense:Y.capped?"CAPPED":"OK",savings:me.capped?"CAPPED":"OK"},cappedValues:{income:B.capped?{original:w.toFixed(2),capped:B.value.toFixed(2)}:null,expense:Y.capped?{original:P.toFixed(2),capped:Y.value.toFixed(2)}:null,savings:me.capped?{original:Ne.toFixed(2),capped:me.value.toFixed(2)}:null},timestamp:new Date().toISOString(),reason:"One or more predictions exceeded realistic growth thresholds"}),[{type:"Income",current:v,predicted:B.value,change:B.value-v,changePercent:B.changePercent,lowConfidence:B.capped},{type:"Expense",current:I,predicted:Y.value,change:Y.value-I,changePercent:Y.changePercent,lowConfidence:Y.capped},{type:"Savings",current:T,predicted:me.value,change:me.value-T,changePercent:me.changePercent,lowConfidence:me.capped},{type:"Total",current:R,predicted:O,change:V,changePercent:J,lowConfidence:!1}]},[N,k,g,o])(),_=be.useMemo(()=>{if(!N)return{incomeGrowth:0,expenseGrowth:0,savingsGrowth:0,confidenceScore:0};const f=N.user_profile,y=f?.avgMonthlyIncome||0,v=f?.avgMonthlyExpenses||0,I=Math.max(0,y-v),T=k[o]&&k[o].length>0?k[o]:null;if(!T||T.length===0)return{incomeGrowth:0,expenseGrowth:0,savingsGrowth:0,confidenceScore:0};const w=T[0],P=w.incomePrediction||y,z=w.expensesPrediction||v,R=w.savingsPrediction||Math.max(0,P-z);let O=y>0?(P-y)/y*100:0,ee=v>0?(z-v)/v*100:0,te=I>0?(R-I)/I*100:0;const he=(G,V)=>{const J=V==="income"?5:V==="expense"?3:10;if(Math.abs(G)>J)return console.error("‚ùå VALIDATION ERROR: Unrealistic growth rate in insights calculation:",{userId:u?.id||"unknown",timeframe:o,insightType:V,calculatedGrowth:G.toFixed(1)+"%",maxRealisticGrowth:J+"%",exceedsBy:(Math.abs(G)-J).toFixed(1)+"%",timestamp:new Date().toISOString(),validationRule:`${V}_growth_exceeds_realistic_threshold`,action:"Capping to realistic range"}),console.warn("‚ö†Ô∏è FALLBACK APPLIED: Capping insight growth rate:",{userId:u?.id||"unknown",timeframe:o,insightType:V,originalGrowth:G.toFixed(1)+"%",cappedGrowth:(Math.sign(G)*J).toFixed(1)+"%",reason:`Growth exceeded ${J}% threshold for ${V}`,timestamp:new Date().toISOString()}),Math.sign(G)*J;const le=J*.5;return Math.abs(G)>le&&Math.abs(G)<=J&&console.info("‚ÑπÔ∏è VALIDATION INFO: Moderate growth rate in insights:",{userId:u?.id||"unknown",timeframe:o,insightType:V,growth:G.toFixed(1)+"%",threshold:`${le.toFixed(1)}-${J}%`,timestamp:new Date().toISOString(),validationRule:`${V}_growth_moderate`,action:"Accepting value"}),G};O=he(O,"income"),ee=he(ee,"expense"),te=he(te,"savings");const K=(N.confidence_score||.95)*100;return console.log("üìà Growth Insights Calculation (TASK 4.1 - Historical Average Baseline):",{baseline:{avgMonthlyIncome:y,avgMonthlyExpenses:v,avgSavings:I},predicted:{income:P,expenses:z,savings:R},growthRates:{income:O.toFixed(1)+"%",expense:ee.toFixed(1)+"%",savings:te.toFixed(1)+"%"},validation:{incomeLimit:"0-5%",expenseLimit:"2-3%",savingsLimit:"0-10%"},confidenceScore:K+"%",note:"Growth calculated from historical average to first month prediction"}),{incomeGrowth:O,expenseGrowth:ee,savingsGrowth:te,confidenceScore:K}},[N,k,o]);D.useEffect(()=>{},[j.length]);const U=j.length===1&&j[0]?.isEmptyState===!0;j.length,N&&g.length>0&&g[0]?.isEmptyState;const Q=t.generating||t.loading;return D.useEffect(()=>{console.log("üìä PredictionChart Data Debug:",{timeframe:o,hasCurrentPredictions:!!N,currentPredictionDataKeys:Object.keys(k),currentTimeframeData:k[o],dataLength:k[o]?.length||0,firstDataPoint:k[o]?.[0],expenseDataCheck:k[o]?.map(f=>({month:f.month,expenses:f.expenses,expensesPrediction:f.expensesPrediction,expensesUpper:f.expensesUpper,expensesLower:f.expensesLower})),hasValidChartData:k[o]?.some(f=>f.income>0||f.expenses>0||f.savings!==0||f.incomePrediction&&f.incomePrediction>0||f.expensesPrediction&&f.expensesPrediction>0)})},[k,o,N]),Q?(console.log("Showing loading state:",{isLoading:Q,prophetGenerating:t.generating,prophetLoading:t.loading}),e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"block md:hidden py-12 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:t.generating?"Generating predictions...":"Loading predictions..."})]})}),e.jsxs("div",{className:"hidden md:block text-center my-5 py-5 animate__animated animate__fadeIn",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"},children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("h5",{className:"mt-4 text-gray-600 font-weight-light",children:t.generating?"Generating Prophet Predictions":"Loading AI Predictions"}),e.jsx("p",{className:"text-gray-500",children:t.generating?"Analyzing your financial data with Facebook Prophet...":"Please wait while we analyze your financial data..."})]})]})):e.jsxs("div",{className:"container-fluid",children:[e.jsx(st,{isOpen:a,onClose:()=>i(!1)}),t.error&&e.jsxs("div",{className:"alert alert-danger mb-4",children:[e.jsx("strong",{children:"Error:"})," ",t.error,e.jsx("button",{className:"btn btn-sm btn-outline-danger ml-3",onClick:()=>s(f=>({...f,error:null})),children:"Dismiss"})]}),u?.id&&e.jsx(Se,{userId:u.id,serviceType:"prophet"}),N&&e.jsx("div",{className:"alert alert-info mb-4 animate__animated animate__fadeIn",style:{borderLeft:"4px solid #3b82f6"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{className:"fas fa-database mr-2 text-primary"}),e.jsx("strong",{className:"text-primary",children:"Using Cached Predictions"})]}),e.jsxs("small",{className:"text-muted d-block",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Last Generated: ",e.jsx("strong",{children:new Date(N.generated_at).toLocaleString()})]}),e.jsxs("small",{className:"text-muted d-block mt-1",children:[e.jsx("i",{className:"fas fa-chart-line mr-1"}),"Data Points: ",e.jsx("strong",{children:N.model_accuracy.data_points})," transactions ‚Ä¢ Confidence: ",e.jsx("strong",{children:"95.0%"})]})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("span",{className:"badge badge-success px-3 py-2",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Predictions Loaded"]})})]})}),!N&&!t.loading&&!t.generating&&e.jsx("div",{className:"alert alert-warning mb-4 animate__animated animate__fadeIn",style:{borderLeft:"4px solid #f59e0b"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-2 text-warning"}),e.jsx("strong",{className:"text-warning",children:"No Predictions Available"})]}),e.jsx("small",{className:"text-muted",children:'Click "Generate Predictions" to create AI-powered financial forecasts based on your transaction history.'})]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:M,disabled:t.generating,children:[e.jsx("i",{className:"fas fa-magic mr-2"}),"Generate Now"]})]})}),e.jsx(We,{showModelDetails:h,onToggleModelDetails:()=>p(!h),onExportPredictions:S,onViewHistory:X,onExportInsights:F,onGeneratePredictions:M,generating:t.generating,hasProphetData:!!N}),e.jsx(Ke,{showModelDetails:h,modelDetails:N?[...W,{name:"Model Type",value:"Facebook Prophet",description:"Advanced time series forecasting model optimized for business metrics"},{name:"Seasonality Mode",value:"Additive",description:"Seasonal effects are added to the trend component"},{name:"Confidence Interval",value:"80%",description:"Prediction uncertainty bounds for forecast intervals"},{name:"Forecast Horizon",value:N.timeframe,description:"Time period covered by the prediction model"},{name:"Training Data Points",value:N.model_accuracy.data_points.toString(),description:"Number of historical data points used to train the model"}]:W,modelAccuracy:Z,activeTip:A,tooltipPosition:H,onToggleTip:ie,onClose:()=>p(!1)}),e.jsx(Ve,{showAccuracyReport:d,modelAccuracy:Z,activeTip:A,tooltipPosition:H,onToggleAccuracyReport:()=>b(!d),onToggleTip:ie}),e.jsx(Je,{insights:_,activeTip:A,tooltipPosition:H,onToggleTip:ie}),e.jsx(Xe,{timeframe:o,dataType:l,data:k,modelAccuracy:Z,activeTip:A,tooltipPosition:H,onTimeframeChange:q,onDataTypeChange:x,onToggleTip:ie}),e.jsx(Qe,{transactionTypePredictions:j,activeTip:A,tooltipPosition:H,onToggleTip:ie,timeframe:o}),e.jsx(Oe,{ref:n,insights:_,timeframe:o,modelAccuracy:Z,activeTip:A,tooltipPosition:H,onToggleTip:ie,predictionData:N?.predictions||[],transactionTypePredictions:j,userProfile:{avgMonthlyIncome:(()=>{const f=g?.reduce((v,I)=>v+(I.current||0),0)||0,y=N?.predictions?.[0]?.predicted||0;return f>0?Math.max(y,f*1.2):y})(),avgMonthlyExpenses:g?.reduce((f,y)=>f+(y.current||0),0)||0,savingsRate:(()=>{const f=g?.reduce((I,T)=>I+(T.current||0),0)||0,y=N?.predictions?.[0]?.predicted||0,v=f>0?Math.max(y,f*1.2):y;return v>0?(v-f)/v*100:0})(),budgetCategories:g?.map(f=>f.category)||[],financialGoals:[],spendingPatterns:[]}})]})};export{dt as default};
