import{j as e,B as w}from"./ui-vendor-Cn1Vfl4w.js";import{r as o}from"./react-vendor-D4A9EtXC.js";import{b as he,t as q,p as v}from"./index-BbApZ7g3.js";import{d as G,H as Y}from"./chart-vendor-B0c7K_uV.js";const fe=({show:F,onClose:g,session:t,messages:u,loading:b=!1})=>{const[c,C]=o.useState("info");if(!F||!t)return null;const j=a=>a?{label:"Active",color:"#28a745",icon:"fa-circle"}:{label:"Ended",color:"#6c757d",icon:"fa-stop-circle"},N=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=(a,r)=>{const y=new Date(a).getTime(),U=(r?new Date(r).getTime():Date.now())-y,M=Math.floor(U/6e4),E=Math.floor(M/60);return E>0?`${E}h ${M%60}m`:`${M}m`},d=j(t.is_active),T=u.filter(a=>a.message_type==="user").length,D=u.filter(a=>a.message_type==="assistant").length;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:g}),e.jsxs("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:g,children:[e.jsx("div",{className:"block md:hidden fixed inset-0 z-50 flex items-end justify-center",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"bg-white w-full max-h-[90vh] rounded-t-2xl shadow-2xl overflow-hidden flex flex-col animate__animated animate__slideInUp animate__faster",children:[e.jsxs("div",{className:"px-4 py-3 text-white flex items-center justify-between",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-comments text-white text-sm"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h6",{className:"text-sm font-bold mb-0 truncate",children:b?"Loading...":t.session_title||"Chat Session"}),e.jsx("p",{className:"text-[10px] opacity-90 mb-0 truncate",children:b?"Please wait...":t.user_name||t.user_email||"Anonymous User"})]})]}),e.jsx("button",{onClick:g,className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-white flex-shrink-0",children:e.jsx("i",{className:"fas fa-times text-sm"})})]}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fas ${d.icon} text-[10px]`,style:{color:d.color}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 mb-0",children:"Status"}),e.jsx("p",{className:"text-[10px] font-bold mb-0",style:{color:d.color},children:d.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-envelope text-red-500 text-[10px]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 mb-0",children:"Messages"}),e.jsx("p",{className:"text-[10px] font-bold text-red-500 mb-0",children:t.message_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-clock text-red-500 text-[10px]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 mb-0",children:"Duration"}),e.jsx("p",{className:"text-[10px] font-bold text-red-500 mb-0",children:m(t.start_time,t.end_time)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:`fas ${t.user_satisfaction_rating?"fa-star text-amber-500":"fa-star-half-alt text-gray-400"} text-[10px]`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 mb-0",children:"Rating"}),e.jsx("p",{className:`text-[10px] font-bold mb-0 ${t.user_satisfaction_rating?"text-amber-500":"text-gray-400"}`,children:t.user_satisfaction_rating?`${t.user_satisfaction_rating}/5`:"N/A"})]})]})]})}),e.jsx("div",{className:"px-3 py-2 border-b border-gray-100",children:e.jsx("div",{className:"flex gap-2",children:[{id:"info",icon:"fa-info-circle",label:"Info"},{id:"messages",icon:"fa-comments",label:`Messages (${u.length})`}].map(a=>e.jsxs("button",{className:`px-3 py-1.5 rounded-full text-[10px] font-semibold transition-colors ${c===a.id?"bg-red-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,onClick:()=>C(a.id),children:[e.jsx("i",{className:`fas ${a.icon} mr-1`}),a.label]},a.id))})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3",children:b?e.jsxs("div",{className:"py-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading session data..."})]}):e.jsxs(e.Fragment,{children:[c==="info"&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("div",{className:"relative inline-block mb-2",children:[t.user_avatar?e.jsx("img",{src:t.user_avatar,alt:t.user_name||"User",className:"w-16 h-16 rounded-full object-cover border-3 border-red-500",onError:a=>{a.currentTarget.src="../images/placeholder.png"}}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500 flex items-center justify-center text-white font-bold text-xl",children:(t.user_name||t.user_email||"U").charAt(0).toUpperCase()}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white ${t.is_active?"bg-emerald-500":"bg-gray-400"}`})]}),e.jsx("h6",{className:"text-sm font-bold text-gray-800 mb-0",children:t.user_name||"Anonymous User"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:t.user_email||"No email"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2",children:[e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-semibold ${t.is_active?"bg-emerald-100 text-emerald-600":"bg-gray-100 text-gray-600"}`,children:[e.jsx("i",{className:`fas ${d.icon} mr-1`}),d.label]}),e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-[9px] font-semibold bg-blue-100 text-blue-600",children:[e.jsx("i",{className:"fas fa-tag mr-1"}),t.session_type.replace(/_/g," ")]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:[e.jsxs("p",{className:"text-[10px] font-semibold text-red-600 mb-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Session Details"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center py-1 border-b border-gray-200",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"Session ID"}),e.jsxs("code",{className:"text-[9px] bg-gray-200 px-1.5 py-0.5 rounded",children:[t.id?.substring(0,12),"..."]})]}),e.jsxs("div",{className:"flex justify-between items-center py-1 border-b border-gray-200",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"Started"}),e.jsx("span",{className:"text-[10px] text-gray-700",children:N(t.start_time)})]}),t.end_time&&e.jsxs("div",{className:"flex justify-between items-center py-1 border-b border-gray-200",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"Ended"}),e.jsx("span",{className:"text-[10px] text-gray-700",children:N(t.end_time)})]}),e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsx("span",{className:"text-[10px] text-gray-500",children:"AI Model"}),e.jsx("span",{className:"text-[9px] bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded",children:t.ai_model_version||"Default"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-blue-600 mb-0",children:T}),e.jsx("p",{className:"text-[9px] text-gray-500",children:"User Messages"})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-emerald-600 mb-0",children:D}),e.jsx("p",{className:"text-[9px] text-gray-500",children:"AI Responses"})]})]})]}),c==="messages"&&e.jsx("div",{children:u.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-3",children:e.jsx("i",{className:"fas fa-comment-slash text-gray-400 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"No messages"}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"This session has no messages yet"})]}):e.jsx("div",{className:"space-y-3",children:u.map(a=>{const r=a.message_type==="user",y=a.message_type==="assistant";return e.jsxs("div",{className:`p-3 rounded-lg border-l-3 ${r?"bg-blue-50 border-blue-500":y?"bg-emerald-50 border-emerald-500":"bg-gray-50 border-gray-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:`px-1.5 py-0.5 rounded text-[8px] font-semibold ${r?"bg-blue-500 text-white":y?"bg-emerald-500 text-white":"bg-gray-500 text-white"}`,children:[e.jsx("i",{className:`fas ${r?"fa-user":y?"fa-robot":"fa-cog"} mr-0.5`}),a.message_type.toUpperCase()]}),e.jsxs("span",{className:"text-[9px] text-gray-400",children:["#",a.message_order]})]}),e.jsxs("span",{className:"text-[9px] text-gray-400",children:[e.jsx("i",{className:"far fa-clock mr-0.5"}),new Date(a.created_at).toLocaleTimeString()]})]}),e.jsx("p",{className:"text-xs text-gray-700 mb-2 whitespace-pre-wrap",children:a.message_text}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.message_sentiment&&e.jsxs("span",{className:`text-[8px] px-1.5 py-0.5 rounded ${a.message_sentiment==="positive"?"bg-emerald-100 text-emerald-600":a.message_sentiment==="negative"?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"}`,children:[e.jsx("i",{className:`fas ${a.message_sentiment==="positive"?"fa-smile":a.message_sentiment==="negative"?"fa-frown":"fa-meh"} mr-0.5`}),a.message_sentiment]}),a.confidence_score&&e.jsxs("span",{className:`text-[8px] px-1.5 py-0.5 rounded ${a.confidence_score>=.8?"bg-emerald-100 text-emerald-600":a.confidence_score>=.5?"bg-amber-100 text-amber-600":"bg-red-100 text-red-600"}`,children:[e.jsx("i",{className:"fas fa-percentage mr-0.5"}),(a.confidence_score*100).toFixed(0),"%"]}),a.response_time_ms&&e.jsxs("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-gray-100 text-gray-500",children:[e.jsx("i",{className:"fas fa-bolt mr-0.5"}),a.response_time_ms,"ms"]})]})]},a.id)})})})]})}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-gray-400",children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",t.id?.substring(0,8),"..."]}),e.jsxs("button",{onClick:g,className:"px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-lg hover:bg-red-600",children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})]})}),e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable d-none d-md-block",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"12px",overflow:"hidden",maxHeight:"85vh"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:"40px",height:"40px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:"fas fa-comments fa-lg"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"mb-0 font-weight-bold",children:b?"Loading Session...":t.session_title||"Chat Session"}),e.jsx("small",{style:{opacity:.9},children:b?"Please wait...":t.user_name||t.user_email||"Anonymous User"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm",onClick:g,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsx("div",{className:"px-3 py-2",style:{background:"#f8f9fa",borderBottom:"1px solid #e9ecef"},children:e.jsxs("div",{className:"row text-center g-2",children:[e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${d.icon} mr-2`,style:{color:d.color}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Status"}),e.jsx("strong",{style:{color:d.color,fontSize:"0.8rem"},children:d.label})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-envelope text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Messages"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:t.message_count})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-clock text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Duration"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:m(t.start_time,t.end_time)})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${t.user_satisfaction_rating?"fa-star text-warning":"fa-star-half-alt text-muted"} mr-2`}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Rating"}),e.jsx("strong",{style:{fontSize:"0.8rem"},className:t.user_satisfaction_rating?"text-warning":"text-muted",children:t.user_satisfaction_rating?`${t.user_satisfaction_rating}/5`:"N/A"})]})]})})]})}),e.jsx("div",{className:"px-3 pt-2",children:e.jsx("div",{className:"d-flex",style:{gap:"6px"},children:[{id:"info",icon:"fa-info-circle",label:"Session Info"},{id:"messages",icon:"fa-comments",label:`Messages (${u.length})`}].map(a=>e.jsxs("button",{className:`btn btn-sm ${c===a.id?"btn-danger":"btn-outline-secondary"}`,onClick:()=>C(a.id),style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:`fas ${a.icon} mr-1`}),a.label]},a.id))})}),e.jsx("div",{className:"modal-body py-3",style:{maxHeight:"50vh",overflowY:"auto"},children:b?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading session data..."})]}):e.jsxs(e.Fragment,{children:[c==="info"&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-5 text-center mb-3 mb-lg-0",children:[e.jsxs("div",{className:"position-relative d-inline-block mb-3",children:[t.user_avatar?e.jsx("img",{src:t.user_avatar,alt:t.user_name||"User",className:"rounded-circle",style:{width:"80px",height:"80px",objectFit:"cover",border:"3px solid #dc3545"},onError:a=>{a.currentTarget.src="../images/placeholder.png"}}):e.jsx("div",{className:"d-flex align-items-center justify-content-center rounded-circle",style:{width:"80px",height:"80px",background:"#dc3545",color:"white",fontSize:"2rem",fontWeight:600},children:(t.user_name||t.user_email||"U").charAt(0).toUpperCase()}),e.jsx("div",{className:"position-absolute",style:{bottom:"5px",right:"5px",width:"18px",height:"18px",borderRadius:"50%",background:d.color,border:"2px solid white"}})]}),e.jsx("h6",{className:"font-weight-bold mb-1",children:t.user_name||"Anonymous User"}),e.jsx("p",{className:"text-muted mb-2",style:{fontSize:"0.85rem"},children:t.user_email||"No email"}),e.jsxs("div",{className:"d-flex justify-content-center flex-wrap",style:{gap:"6px"},children:[e.jsxs(w,{bg:t.is_active?"success":"secondary",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:`fas ${d.icon} mr-1`}),d.label]}),e.jsxs(w,{bg:"primary",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:"fas fa-tag mr-1"}),t.session_type.replace(/_/g," ")]})]})]}),e.jsxs("div",{className:"col-lg-7",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Session Details"]}),e.jsxs("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px",fontSize:"0.85rem"},children:[e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Session ID"}),e.jsxs("code",{style:{fontSize:"0.75rem"},children:[t.id?.substring(0,16),"..."]})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Started"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:N(t.start_time)})]}),t.end_time&&e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Ended"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:N(t.end_time)})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"AI Model"}),e.jsx(w,{bg:"info",style:{fontSize:"0.65rem"},children:t.ai_model_version||"Default"})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",children:[e.jsx("small",{className:"text-muted",children:"Created"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:N(t.created_at)})]})]}),e.jsxs("h6",{className:"text-danger mb-2 mt-3",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-chart-pie mr-2"}),"Message Breakdown"]}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"p-2 text-center",style:{background:"#e7f1ff",borderRadius:"6px"},children:[e.jsx("div",{className:"text-primary font-weight-bold",style:{fontSize:"1.1rem"},children:T}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:"User Messages"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"p-2 text-center",style:{background:"#e8f5e9",borderRadius:"6px"},children:[e.jsx("div",{className:"text-success font-weight-bold",style:{fontSize:"1.1rem"},children:D}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:"AI Responses"})]})})]})]})]}),c==="messages"&&e.jsx("div",{children:u.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-3",style:{width:"60px",height:"60px",background:"#f8f9fa",borderRadius:"50%",margin:"0 auto"},children:e.jsx("i",{className:"fas fa-comment-slash fa-2x text-muted"})}),e.jsx("p",{className:"text-muted mb-0",children:"No messages in this session"})]}):e.jsx("div",{className:"messages-list",children:u.map(a=>{const r=a.message_type==="user",y=a.message_type==="assistant",l=r?"#e7f1ff":y?"#e8f5e9":"#f8f9fa",U=r?"#007bff":y?"#28a745":"#6c757d";return e.jsxs("div",{className:"mb-3 p-3",style:{background:l,borderRadius:"8px",borderLeft:`3px solid ${U}`},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs(w,{bg:r?"primary":y?"success":"secondary",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:`fas ${r?"fa-user":y?"fa-robot":"fa-cog"} mr-1`}),a.message_type.toUpperCase()]}),e.jsxs("small",{className:"text-muted ml-2",style:{fontSize:"0.75rem"},children:["#",a.message_order]})]}),e.jsxs("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"far fa-clock mr-1"}),new Date(a.created_at).toLocaleTimeString()]})]}),e.jsx("p",{className:"mb-2",style:{fontSize:"0.9rem",whiteSpace:"pre-wrap"},children:a.message_text}),e.jsxs("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:[a.message_sentiment&&e.jsxs(w,{bg:a.message_sentiment==="positive"?"success":a.message_sentiment==="negative"?"danger":"secondary",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:`fas ${a.message_sentiment==="positive"?"fa-smile":a.message_sentiment==="negative"?"fa-frown":"fa-meh"} mr-1`}),a.message_sentiment]}),a.confidence_score&&e.jsxs(w,{bg:a.confidence_score>=.8?"success":a.confidence_score>=.5?"warning":"danger",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-percentage mr-1"}),(a.confidence_score*100).toFixed(0),"%"]}),a.response_time_ms&&e.jsxs(w,{bg:"light",className:"text-muted",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-bolt mr-1"}),a.response_time_ms,"ms"]}),a.intent_classification&&e.jsxs(w,{bg:"info",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-crosshairs mr-1"}),a.intent_classification]}),a.user_feedback&&e.jsxs(w,{bg:a.user_feedback==="helpful"?"success":"warning",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:`fas ${a.user_feedback==="helpful"?"fa-thumbs-up":"fa-thumbs-down"} mr-1`}),a.user_feedback.replace(/_/g," ")]})]})]},a.id)})})})]})}),e.jsxs("div",{className:"modal-footer border-0 py-2",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"0.7rem"},children:[t.id?.substring(0,12),"..."]})]}),e.jsxs("button",{type:"button",className:"btn btn-danger btn-sm",onClick:g,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})]})})]})]})},ge=({show:F,onClose:g,prompt:t,onSave:u,loading:b=!1})=>{const[c,C]=o.useState({prompt:"",version:"1.0"}),[j,N]=o.useState({}),[m,d]=o.useState(!1),[T,D]=o.useState(!1);o.useEffect(()=>{t?(C({prompt:t.setting_value.prompt||"",version:t.setting_value.version||"1.0"}),D(!1)):(C({prompt:"You are a helpful financial assistant for BudgetMe. Help users with budgeting, financial planning, and money management questions.",version:"1.0"}),D(!1)),N({})},[t,F]);const a=x=>{const{name:k,value:Q}=x.target;C(R=>({...R,[k]:Q})),D(!0),j[k]&&N(R=>({...R,[k]:""}))},r=()=>{const x={};return c.prompt.trim()?c.prompt.trim().length<10&&(x.prompt="Prompt must be at least 10 characters"):x.prompt="System prompt is required",c.version.trim()||(x.version="Version is required"),N(x),Object.keys(x).length===0},y=async x=>{if(x.preventDefault(),!!r()){d(!0);try{const k={id:t?.id,setting_key:"chatbot_system_prompt",setting_value:{prompt:c.prompt,version:c.version,last_updated:new Date().toISOString()},setting_type:"json",description:"System prompt for AI chatbot",category:"features",created_at:t?.created_at,updated_at:new Date().toISOString()};await u(k),D(!1)}catch(k){console.error("Error saving prompt:",k)}finally{d(!1)}}},l=()=>{T&&!m?window.confirm("You have unsaved changes. Are you sure you want to close?")&&g():g()};if(!F)return null;const M=(()=>{const x=c.prompt.length;return x===0?{label:"Empty",color:"#6c757d",icon:"fa-minus-circle"}:x<10?{label:"Too Short",color:"#dc3545",icon:"fa-exclamation-circle"}:x<100?{label:"Short",color:"#fd7e14",icon:"fa-exclamation-triangle"}:x<500?{label:"Good",color:"#28a745",icon:"fa-check-circle"}:{label:"Excellent",color:"#17a2b8",icon:"fa-star"}})(),E=t?.setting_value?.last_updated?new Date(t.setting_value.last_updated).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Never";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:l}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:l,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",onClick:x=>x.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"12px",overflow:"hidden",maxHeight:"85vh"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:"40px",height:"40px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:"fas fa-cog fa-lg"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"mb-0 font-weight-bold",children:b?"Loading...":t?"Configure System Prompt":"System Prompt Configuration"}),e.jsx("small",{style:{opacity:.9},children:T?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),"Unsaved changes"]}):e.jsx(e.Fragment,{children:"AI chatbot behavior settings"})})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm",onClick:l,disabled:m,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsx("div",{className:"px-3 py-2",style:{background:"#f8f9fa",borderBottom:"1px solid #e9ecef"},children:e.jsxs("div",{className:"row text-center g-2",children:[e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${M.icon} mr-2`,style:{color:M.color}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Length"}),e.jsx("strong",{style:{color:M.color,fontSize:"0.8rem"},children:M.label})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-text-width text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Characters"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:c.prompt.length})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-tag text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Version"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:c.version||"1.0"})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-calendar-alt text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Updated"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:E})]})]})})]})}),e.jsx("div",{className:"modal-body py-3",style:{maxHeight:"55vh",overflowY:"auto"},children:b?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading prompt configuration..."})]}):e.jsxs("form",{onSubmit:y,id:"systemPromptForm",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-comment-alt mr-2"}),"System Prompt ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("textarea",{id:"prompt",name:"prompt",className:`form-control ${j.prompt?"is-invalid":""}`,rows:8,value:c.prompt,onChange:a,placeholder:"Enter the system prompt for the AI chatbot...",disabled:m,style:{fontSize:"0.85rem",borderRadius:"6px",resize:"vertical"}}),j.prompt&&e.jsxs("div",{className:"invalid-feedback d-block mt-1",style:{fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),j.prompt]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-2",children:[e.jsxs("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Defines AI behavior for all conversations"]}),e.jsxs(w,{bg:c.prompt.length>=500?"info":c.prompt.length>=100?"success":c.prompt.length>=10?"warning":"secondary",style:{fontSize:"0.65rem"},children:[c.prompt.length," chars"]})]})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-tag mr-2"}),"Version ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("input",{type:"text",id:"version",name:"version",className:`form-control ${j.version?"is-invalid":""}`,value:c.version,onChange:a,placeholder:"e.g., 1.0",disabled:m,style:{fontSize:"0.85rem",borderRadius:"6px"}}),j.version&&e.jsxs("div",{className:"invalid-feedback d-block mt-1",style:{fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),j.version]})]})]}),e.jsxs("div",{className:"col-md-8 mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-lightbulb mr-2"}),"Writing Tips"]}),e.jsx("div",{className:"p-3",style:{background:"#e7f6ff",borderRadius:"8px",borderLeft:"3px solid #17a2b8"},children:e.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:[{icon:"fa-bullseye",label:"Be specific"},{icon:"fa-border-all",label:"Set boundaries"},{icon:"fa-comment-dots",label:"Define tone"},{icon:"fa-flask",label:"Test thoroughly"}].map((x,k)=>e.jsxs(w,{bg:"light",className:"text-muted",style:{fontSize:"0.7rem",border:"1px solid #dee2e6"},children:[e.jsx("i",{className:`fas ${x.icon} text-info mr-1`}),x.label]},k))})})]})]}),e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Configuration Info"]}),e.jsx("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px",fontSize:"0.85rem"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Setting Key"}),e.jsx("code",{style:{fontSize:"0.7rem"},children:"chatbot_system_prompt"})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",children:[e.jsx("small",{className:"text-muted",children:"Category"}),e.jsx(w,{bg:"primary",style:{fontSize:"0.65rem"},children:"Features"})]})]}),e.jsxs("div",{className:"col-6",children:[e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Type"}),e.jsx(w,{bg:"secondary",style:{fontSize:"0.65rem"},children:"JSON"})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",children:[e.jsx("small",{className:"text-muted",children:"Status"}),e.jsx(w,{bg:T?"warning":"success",style:{fontSize:"0.65rem"},children:T?"Modified":"Saved"})]})]})]})})]})}),e.jsxs("div",{className:"modal-footer border-0 py-2",style:{background:"#f8f9fa"},children:[e.jsx("small",{className:"text-muted mr-auto",style:{fontSize:"0.75rem"},children:T&&!m?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-warning mr-1"}),"Unsaved changes"]}):t?.id?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"0.7rem"},children:[t.id?.substring(0,12),"..."]})]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-plus-circle text-info mr-1"}),"New configuration"]})}),e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm mr-2",onClick:l,disabled:m,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"submit",form:"systemPromptForm",className:"btn btn-danger btn-sm",disabled:m||!T||b,children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-1"}),"Save Prompt"]})})]})]})})})]})},je=({show:F,onClose:g,title:t,color:u,icon:b,data:c})=>{if(!F)return null;const C=()=>({background:"linear-gradient(135deg, #e74a3b 0%, #be2617 100%)"}),N=(()=>{const m={danger:{bg:"#e74a3b",text:"#ffffff"},success:{bg:"#1cc88a",text:"#ffffff"},info:{bg:"#36b9cc",text:"#ffffff"},warning:{bg:"#f6c23e",text:"#212529"},primary:{bg:"#4e73df",text:"#ffffff"}};return m[u]||m.danger})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:g}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:g,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",onClick:m=>m.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"12px",overflow:"hidden"},children:[e.jsx("div",{className:"modal-header border-0 py-3 px-4",style:{...C(),minHeight:"80px"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-3",style:{width:"48px",height:"48px",background:"rgba(255,255,255,0.25)",borderRadius:"10px",flexShrink:0},children:e.jsx("i",{className:`fas ${b} text-white`,style:{fontSize:"1.25rem"}})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h5",{className:"mb-0 text-white font-weight-bold",style:{fontSize:"1.1rem"},children:t}),e.jsx("small",{className:"text-white",style:{opacity:.9},children:"Detailed breakdown"})]}),e.jsx("button",{type:"button",className:"btn p-0 text-white",onClick:g,style:{fontSize:"1.5rem",lineHeight:1,opacity:.9,background:"none",border:"none"},children:e.jsx("span",{children:"Ã—"})})]})}),e.jsx("div",{className:"modal-body px-4 py-3",children:e.jsx("div",{className:"stats-breakdown-list",children:c.map((m,d)=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-3",style:{borderBottom:d<c.length-1?"1px solid #e9ecef":"none"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-medium",style:{color:"#5a5c69",fontSize:"0.95rem"},children:m.label}),m.subLabel&&e.jsx("small",{className:"text-muted",children:m.subLabel})]}),e.jsx("span",{className:"badge badge-pill px-3 py-2",style:{backgroundColor:N.bg,color:N.text,fontSize:"0.85rem",fontWeight:500,minWidth:"80px",textAlign:"center"},children:m.value})]},d))})}),e.jsx("div",{className:"modal-footer bg-light border-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsx("div",{className:"modal-footer-info",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Data reflects current statistics"]})}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:g,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})})]})})})]})},ye=()=>{const[F,g]=o.useState(!0),[t,u]=o.useState(!1),[b,c]=o.useState(new Date),{showSuccessToast:C,showErrorToast:j}=he(),[N,m]=o.useState(null),[d,T]=o.useState([]),[D,a]=o.useState([]),[r,y]=o.useState({totalSessions:0,activeSessions:0,totalMessages:0,averageMessagesPerSession:0,averageSatisfactionRating:0,sessionsByType:{},messagesByType:{},sentimentDistribution:{}}),[l,U]=o.useState({searchTerm:"",sessionType:"all",messageType:"all",dateFrom:"",dateTo:"",currentPage:1,pageSize:10}),[M,E]=o.useState(null),[x,k]=o.useState(!1),[Q,R]=o.useState(!1),[W,J]=o.useState({show:!1,title:"",color:"",icon:"",data:[]}),[p,ne]=o.useState(1),[V,ce]=o.useState(0),[P,X]=o.useState("sessions"),Z=async()=>{try{const{data:s,error:i}=await v.from("admin_settings").select("*").eq("setting_key","chatbot_system_prompt").single();if(i&&i.code!=="PGRST116")throw i;s&&m(s)}catch(s){console.error("Error fetching system prompt:",s),j("Failed to load system prompt")}},de=async s=>{try{const{data:i}=await v.from("admin_settings").select("id").eq("setting_key","chatbot_system_prompt").single();if(i){const{error:n}=await v.from("admin_settings").update({setting_value:s.setting_value,updated_at:new Date().toISOString()}).eq("setting_key","chatbot_system_prompt");if(n)throw n}else{const{error:n}=await v.from("admin_settings").insert([s]);if(n)throw n}C("System prompt saved successfully"),R(!1),await Z()}catch(i){throw console.error("Error saving system prompt:",i),j("Failed to save system prompt"),i}},re=async()=>{u(!0);try{await Promise.all([K(),ee(),Z()]),c(new Date),C("Data refreshed successfully")}catch(s){console.error("Error refreshing data:",s),j("Failed to refresh data")}finally{u(!1)}},K=async()=>{try{g(!0);let s=v.from("chat_sessions").select("*",{count:"exact"});l.sessionType!=="all"&&(s=s.eq("session_type",l.sessionType)),l.dateFrom&&(s=s.gte("start_time",l.dateFrom)),l.dateTo&&(s=s.lte("start_time",l.dateTo+"T23:59:59")),l.searchTerm&&(s=s.or(`session_title.ilike.%${l.searchTerm}%`));const i=(l.currentPage-1)*l.pageSize,n=i+l.pageSize-1,{data:z,error:A,count:H}=await s.order("start_time",{ascending:!1}).range(i,n);if(A)throw A;const $=(z||[]).map(h=>h.user_id).filter(h=>h!==null);let O={};if($.length>0){const{data:h}=await v.from("profiles").select("id, full_name, email, avatar_url").in("id",$);h&&h.forEach(S=>{O[S.id]=S})}const I=(z||[]).map(h=>{if(!h.user_id)return{...h,user_name:"Anonymous User",user_email:"anonymous@budgetme.local"};const S=O[h.user_id],_=S?.full_name||S?.email?.split("@")[0]||"User",f=S?.email||"No Email",xe=S?.avatar_url||void 0;return{...h,user_name:_,user_email:f,user_avatar:xe}});T(I),ce(H||0),ne(Math.ceil((H||0)/l.pageSize)),c(new Date)}catch(s){console.error("Error fetching sessions:",s),j("Failed to load chat sessions")}finally{g(!1)}},ee=async()=>{try{const{count:s}=await v.from("chat_sessions").select("*",{count:"exact",head:!0}),{count:i}=await v.from("chat_sessions").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:n}=await v.from("chat_messages").select("*",{count:"exact",head:!0}),{data:z}=await v.from("chat_sessions").select("session_type"),A={};z?.forEach(_=>{const f=_.session_type||"general";A[f]=(A[f]||0)+1});const{data:H}=await v.from("chat_messages").select("message_type"),$={};H?.forEach(_=>{const f=_.message_type||"user";$[f]=($[f]||0)+1});const{data:O}=await v.from("chat_messages").select("message_sentiment").not("message_sentiment","is",null),I={};O?.forEach(_=>{const f=_.message_sentiment||"neutral";I[f]=(I[f]||0)+1});const{data:h}=await v.from("chat_sessions").select("user_satisfaction_rating").not("user_satisfaction_rating","is",null),S=h&&h.length>0?h.reduce((_,f)=>_+(f.user_satisfaction_rating||0),0)/h.length:0;y({totalSessions:s||0,activeSessions:i||0,totalMessages:n||0,averageMessagesPerSession:s?(n||0)/s:0,averageSatisfactionRating:S,sessionsByType:A,messagesByType:$,sentimentDistribution:I})}catch(s){console.error("Error fetching analytics:",s)}},oe=async s=>{try{const{data:i,error:n}=await v.from("chat_messages").select("*").eq("session_id",s).order("message_order",{ascending:!0});if(n)throw n;a(i||[])}catch(i){console.error("Error fetching messages:",i),j("Failed to load messages")}},se=async s=>{E(s),await oe(s.id),k(!0)},me=()=>{k(!1),E(null),a([])},B=s=>{const{name:i,value:n}=s.target;U(z=>({...z,[i]:i==="pageSize"?Number(n):n,currentPage:1}))},L=s=>{U(i=>({...i,currentPage:s}))},ae=()=>{U({searchTerm:"",sessionType:"all",messageType:"all",dateFrom:"",dateTo:"",currentPage:1,pageSize:10})},te=()=>{const s=Object.entries(r.sessionsByType).map(([i,n])=>({name:i.replace(/_/g," ").toUpperCase(),y:n}));return{chart:{type:"pie",height:300},credits:{enabled:!1},title:{text:"Sessions by Type"},tooltip:{pointFormat:"{series.name}: <b>{point.y}</b> ({point.percentage:.1f}%)"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f}%"}}},series:[{name:"Sessions",colorByPoint:!0,data:s}]}},le=()=>{const s=Object.entries(r.messagesByType).map(([i,n])=>({name:i.toUpperCase(),y:n,color:i==="user"?"#4e73df":i==="assistant"?"#1cc88a":"#858796"}));return{chart:{type:"column",height:300},credits:{enabled:!1},title:{text:"Messages by Type"},xAxis:{categories:s.map(i=>i.name),title:{text:"Message Type"}},yAxis:{title:{text:"Count"}},series:[{name:"Messages",data:s}]}},ie=()=>{const s=Object.entries(r.sentimentDistribution).map(([i,n])=>({name:i.toUpperCase(),y:n,color:i==="positive"?"#1cc88a":i==="negative"?"#e74a3b":"#858796"}));return{chart:{type:"bar",height:300},credits:{enabled:!1},title:{text:"Message Sentiment Distribution"},xAxis:{categories:s.map(i=>i.name),title:{text:"Sentiment"}},yAxis:{title:{text:"Count"}},series:[{name:"Messages",data:s}]}};return o.useEffect(()=>{(async()=>{await Promise.all([Z(),K(),ee()])})()},[]),o.useEffect(()=>{K()},[l.sessionType,l.dateFrom,l.dateTo,l.currentPage,l.pageSize]),o.useEffect(()=>{const s=setInterval(()=>{d.some(i=>i.is_active)&&(K(),ee(),c(new Date))},3e4);return()=>clearInterval(s)},[d]),F&&d.length===0?e.jsxs("div",{className:"modern-user-management",children:[e.jsx("div",{className:"block md:hidden py-12 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading chatbot management..."})]})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("div",{className:"user-management-header mb-5",children:[e.jsx("div",{className:"skeleton-line skeleton-header-title mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-header-subtitle"})]}),e.jsx("div",{className:"stats-section mb-5",children:e.jsx("div",{className:"row",children:Array.from({length:4}).map((s,i)=>e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-3",children:e.jsx("div",{className:"user-stat-card admin-card-loading",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"skeleton-icon mr-3"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"skeleton-line skeleton-stat-value mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-stat-title"})]})]})})},i))})}),e.jsx("div",{className:"row mb-4",children:Array.from({length:3}).map((s,i)=>e.jsx("div",{className:"col-lg-4 mb-4",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("div",{className:"skeleton-line skeleton-table-header"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"skeleton-chart-container",style:{height:"300px"}})})]})},i))}),e.jsx("div",{className:"controls-section mb-4",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"skeleton-line skeleton-search-bar"})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"skeleton-line skeleton-filter"})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"skeleton-line skeleton-filter"})})]})})})}),e.jsx("div",{className:"table-section",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("div",{className:"skeleton-line skeleton-table-header"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table modern-table",children:[e.jsx("thead",{className:"table-header",children:e.jsx("tr",{children:Array.from({length:7}).map((s,i)=>e.jsx("th",{className:"border-0",children:e.jsx("div",{className:"skeleton-line skeleton-th"})},i))})}),e.jsx("tbody",{children:Array.from({length:5}).map((s,i)=>e.jsx("tr",{className:"table-row",children:Array.from({length:7}).map((n,z)=>e.jsx("td",{className:"py-3",children:e.jsx("div",{className:"skeleton-line skeleton-td"})},z))},i))})]})})})]})})]})]}):e.jsxs("div",{className:"modern-user-management",children:[e.jsx("div",{className:"block md:hidden mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-base font-bold text-gray-800",children:"Chatbot Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:re,className:"w-9 h-9 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95 disabled:opacity-50",disabled:t,"aria-label":"Refresh data",children:e.jsx("i",{className:`fas fa-sync text-xs ${t?"fa-spin":""}`})}),e.jsx("button",{onClick:()=>R(!0),className:"w-9 h-9 rounded-full bg-rose-600 hover:bg-rose-700 text-white flex items-center justify-center shadow-md transition-all active:scale-95","aria-label":"Configure prompt",children:e.jsx("i",{className:"fas fa-cog text-xs"})})]})]})}),e.jsx("div",{className:"user-management-header mb-5 hidden md:block",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start flex-wrap",children:[e.jsx("div",{className:"header-content",children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"header-icon-container mr-3",children:e.jsx("i",{className:"fas fa-robot"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"header-title mb-1",children:"Chatbot Management"}),e.jsx("p",{className:"header-subtitle mb-0",children:"Monitor AI chatbot sessions, analytics, and system configurations"})]})]})}),e.jsxs("div",{className:"header-actions d-flex align-items-center",children:[e.jsx("div",{className:"last-updated-info mr-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Last updated: ",b.toLocaleTimeString()]})}),e.jsxs("button",{className:"btn btn-outline-danger btn-sm shadow-sm refresh-btn mr-2",onClick:re,disabled:t,children:[e.jsx("i",{className:`fas fa-sync-alt mr-1 ${t?"fa-spin":""}`}),t?"Updating...":"Refresh"]}),e.jsxs("button",{className:"btn btn-danger btn-sm shadow-sm",onClick:()=>R(!0),children:[e.jsx("i",{className:"fas fa-cog mr-1"}),"Configure Prompt"]})]})]})}),e.jsx("div",{className:"stats-section mb-5",children:(()=>{const s=r.totalSessions>0?(r.totalMessages/r.totalSessions).toFixed(1):"0",i=r.totalSessions>0?(r.activeSessions/r.totalSessions*100).toFixed(1):"0",n=r.totalSessions-r.activeSessions,z=r.messagesByType.user||0,A=r.messagesByType.assistant||0,H=()=>{J({show:!0,title:"Total Sessions Breakdown",color:"danger",icon:"fa-comments",data:[{label:"Total Sessions",value:r.totalSessions},{label:"Active Sessions",value:r.activeSessions,subLabel:`${i}% of total`},{label:"Ended Sessions",value:n,subLabel:`${(100-Number(i)).toFixed(1)}% of total`},{label:"Avg Messages/Session",value:s}]})},$=()=>{J({show:!0,title:"Active Sessions Breakdown",color:"success",icon:"fa-circle",data:[{label:"Active Sessions",value:r.activeSessions},{label:"Percentage of Total",value:`${i}%`},{label:"Ended Sessions",value:n},{label:"Session Activity Rate",value:`${i}%`}]})},O=()=>{J({show:!0,title:"Total Messages Breakdown",color:"info",icon:"fa-envelope",data:[{label:"Total Messages",value:r.totalMessages},{label:"User Messages",value:z,subLabel:`${r.totalMessages>0?(z/r.totalMessages*100).toFixed(1):0}% of total`},{label:"Assistant Messages",value:A,subLabel:`${r.totalMessages>0?(A/r.totalMessages*100).toFixed(1):0}% of total`},{label:"Avg per Session",value:s}]})},I=()=>{const h=r.sentimentDistribution.positive||0,S=r.sentimentDistribution.negative||0,_=r.sentimentDistribution.neutral||0,f=h+S+_;J({show:!0,title:"Satisfaction Breakdown",color:"warning",icon:"fa-star",data:[{label:"Average Rating",value:`${r.averageSatisfactionRating.toFixed(1)}/5`},{label:"Positive Sentiment",value:h,subLabel:f>0?`${(h/f*100).toFixed(1)}% of messages`:"No data"},{label:"Neutral Sentiment",value:_,subLabel:f>0?`${(_/f*100).toFixed(1)}% of messages`:"No data"},{label:"Negative Sentiment",value:S,subLabel:f>0?`${(S/f*100).toFixed(1)}% of messages`:"No data"}]})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:H,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-red-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-comments text-red-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide truncate",children:"Total Sessions"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:q(r.totalSessions)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-gray-400",children:[e.jsx("i",{className:"fas fa-comments text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium truncate",children:[n," ended"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:$,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-circle text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide truncate",children:"Active Sessions"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:q(r.activeSessions)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-emerald-500",children:[e.jsx("i",{className:"fas fa-arrow-up text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium truncate",children:[i,"% of total"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:O,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-envelope text-blue-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide truncate",children:"Total Messages"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:q(r.totalMessages)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-blue-500",children:[e.jsx("i",{className:"fas fa-chart-line text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium truncate",children:[s," avg/session"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:I,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-star text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide truncate",children:"Avg Satisfaction"}),e.jsxs("p",{className:"text-sm font-bold text-gray-800",children:[r.averageSatisfactionRating.toFixed(1),"/5"]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-amber-500",children:[e.jsx("i",{className:"fas fa-smile text-[8px]"}),e.jsx("span",{className:"text-[9px] font-medium truncate",children:"User rating"})]})]})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-danger h-100 position-relative",onClick:H,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-danger text-uppercase mb-2",children:"Total Sessions"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:q(r.totalSessions)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-muted",children:[e.jsx("i",{className:"fas fa-comments mr-1"}),e.jsxs("span",{className:"font-weight-medium text-truncate",children:[n," ended"]})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-danger",children:e.jsx("i",{className:"fas fa-comments stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-danger",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-success h-100 position-relative",onClick:$,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-success text-uppercase mb-2",children:"Active Sessions"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:q(r.activeSessions)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-success",children:[e.jsx("i",{className:"fas fa-arrow-up mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[i,"%"]}),e.jsx("span",{className:"ml-1 small text-truncate",children:"of total"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-success",children:e.jsx("i",{className:"fas fa-circle stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-success",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-info h-100 position-relative",onClick:O,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-info text-uppercase mb-2",children:"Total Messages"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:q(r.totalMessages)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-info",children:[e.jsx("i",{className:"fas fa-chart-line mr-1"}),e.jsxs("span",{className:"font-weight-medium text-truncate",children:[s," avg/session"]})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-info",children:e.jsx("i",{className:"fas fa-envelope stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-info",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-warning h-100 position-relative",onClick:I,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-warning text-uppercase mb-2",children:"Avg Satisfaction"}),e.jsxs("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:[r.averageSatisfactionRating.toFixed(1),"/5"]}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-warning",children:[e.jsx("i",{className:"fas fa-smile mr-1"}),e.jsx("span",{className:"font-weight-medium text-truncate",children:"User rating"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-warning",children:e.jsx("i",{className:"fas fa-star stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-warning",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})})]})]})})()}),e.jsxs("div",{className:"block md:hidden mb-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h6",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-chart-bar text-red-500 text-xs"}),"Analytics"]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-gray-100",children:e.jsx("h6",{className:"text-xs font-bold text-gray-800 mb-1",children:"Session & Message Analytics"})}),e.jsxs("div",{className:"flex",style:{backgroundColor:"#f8f9fa"},children:[e.jsxs("button",{onClick:()=>X("sessions"),className:`flex-1 py-2 border-0 text-xs position-relative ${P==="sessions"?"text-red-500 bg-white":"text-gray-500 bg-transparent"}`,children:[e.jsx("i",{className:"fas fa-chart-pie mr-1",style:{fontSize:"9px"}}),"Sessions",P==="sessions"&&e.jsx("div",{className:"position-absolute bg-red-500",style:{bottom:0,left:0,right:0,height:"2px"}})]}),e.jsxs("button",{onClick:()=>X("messages"),className:`flex-1 py-2 border-0 text-xs position-relative ${P==="messages"?"text-red-500 bg-white":"text-gray-500 bg-transparent"}`,children:[e.jsx("i",{className:"fas fa-chart-bar mr-1",style:{fontSize:"9px"}}),"Messages",P==="messages"&&e.jsx("div",{className:"position-absolute bg-red-500",style:{bottom:0,left:0,right:0,height:"2px"}})]}),e.jsxs("button",{onClick:()=>X("sentiment"),className:`flex-1 py-2 border-0 text-xs position-relative ${P==="sentiment"?"text-red-500 bg-white":"text-gray-500 bg-transparent"}`,children:[e.jsx("i",{className:"fas fa-smile mr-1",style:{fontSize:"9px"}}),"Sentiment",P==="sentiment"&&e.jsx("div",{className:"position-absolute bg-red-500",style:{bottom:0,left:0,right:0,height:"2px"}})]})]}),e.jsxs("div",{className:"p-3",children:[P==="sessions"&&(Object.keys(r.sessionsByType).length>0?e.jsx(G,{highcharts:Y,options:{...te(),chart:{...te().chart,height:200},title:{text:null}}}):e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400 text-xs",children:"No session data available"})),P==="messages"&&(Object.keys(r.messagesByType).length>0?e.jsx(G,{highcharts:Y,options:{...le(),chart:{...le().chart,height:200},title:{text:null}}}):e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400 text-xs",children:"No message data available"})),P==="sentiment"&&(Object.keys(r.sentimentDistribution).length>0?e.jsx(G,{highcharts:Y,options:{...ie(),chart:{...ie().chart,height:200},title:{text:null}}}):e.jsx("div",{className:"flex items-center justify-center py-8 text-gray-400 text-xs",children:"No sentiment data available"}))]})]})]}),e.jsxs("div",{className:"row mb-4 d-none d-md-flex",children:[e.jsx("div",{className:"col-lg-4 mb-4",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"Sessions by Type"})}),e.jsx("div",{className:"card-body",children:Object.keys(r.sessionsByType).length>0?e.jsx(G,{highcharts:Y,options:te()}):e.jsx("p",{className:"text-center text-muted",children:"No data available"})})]})}),e.jsx("div",{className:"col-lg-4 mb-4",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"Messages by Type"})}),e.jsx("div",{className:"card-body",children:Object.keys(r.messagesByType).length>0?e.jsx(G,{highcharts:Y,options:le()}):e.jsx("p",{className:"text-center text-muted",children:"No data available"})})]})}),e.jsx("div",{className:"col-lg-4 mb-4",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"Sentiment Distribution"})}),e.jsx("div",{className:"card-body",children:Object.keys(r.sentimentDistribution).length>0?e.jsx(G,{highcharts:Y,options:ie()}):e.jsx("p",{className:"text-center text-muted",children:"No data available"})})]})})]}),e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-comments text-red-500 text-[10px]"}),"Chat Sessions",V>0&&e.jsx("span",{className:"bg-red-100 text-red-600 px-1.5 py-0.5 rounded-full text-[9px]",children:V})]}),e.jsxs("button",{className:"text-[10px] text-gray-500 flex items-center gap-1",onClick:ae,children:[e.jsx("i",{className:"fas fa-undo text-[8px]"}),"Reset"]})]}),e.jsxs("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-[10px]"}),e.jsx("input",{type:"text",name:"searchTerm",className:"w-full pl-8 pr-3 py-2 text-xs bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",placeholder:"Search sessions...",value:l.searchTerm,onChange:B})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{name:"sessionType",className:"flex-1 px-2 py-1.5 text-[10px] bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",value:l.sessionType,onChange:B,children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"financial_advice",children:"Financial Advice"}),e.jsx("option",{value:"budget_help",children:"Budget Help"}),e.jsx("option",{value:"goal_planning",children:"Goal Planning"})]}),e.jsx("input",{type:"date",name:"dateFrom",className:"flex-1 px-2 py-1.5 text-[10px] bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",value:l.dateFrom,onChange:B})]})]}),e.jsx("div",{className:"divide-y divide-gray-100 max-h-[60vh] overflow-y-auto",children:t?e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading sessions..."})]}):d.length>0?d.map(s=>e.jsx("div",{className:"px-3 py-3 hover:bg-gray-50 active:bg-gray-100 transition-colors",onClick:()=>se(s),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[s.user_avatar?e.jsx("img",{src:s.user_avatar,alt:s.user_name||"User",className:"w-10 h-10 rounded-full object-cover border-2 border-gray-200",onError:i=>{i.currentTarget.src="../images/placeholder.png"}}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500 flex items-center justify-center text-white font-semibold text-sm border-2 border-gray-200",children:(s.user_name||s.user_email||"U").charAt(0).toUpperCase()}),e.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ${s.is_active?"bg-emerald-500":"bg-gray-400"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-800 truncate",children:s.user_name||"Anonymous User"}),e.jsx("span",{className:`flex-shrink-0 px-1 py-0.5 rounded text-[8px] font-semibold ${s.is_active?"bg-emerald-100 text-emerald-600":"bg-gray-100 text-gray-600"}`,children:s.is_active?"ACTIVE":"ENDED"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 truncate",children:s.session_title||"Untitled Session"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-[9px] text-red-500 font-medium",children:[e.jsx("i",{className:"fas fa-envelope mr-0.5"}),s.message_count," msgs"]}),e.jsx("span",{className:"text-[9px] text-gray-400",children:new Date(s.start_time).toLocaleDateString()}),e.jsx("span",{className:"px-1 py-0.5 bg-blue-50 text-blue-600 rounded text-[8px]",children:s.session_type.replace(/_/g," ")})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{className:"w-7 h-7 rounded-full bg-red-100 hover:bg-red-200 flex items-center justify-center text-red-600 transition-colors",onClick:i=>{i.stopPropagation(),se(s)},"aria-label":"View session",children:e.jsx("i",{className:"fas fa-eye text-[10px]"})})})]})},s.id)):e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-3",children:e.jsx("i",{className:"fas fa-comments text-gray-400 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"No sessions found"}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Try adjusting your filters"})]})}),p>1&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-100 bg-gray-50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-gray-500",children:["Page ",l.currentPage," of ",p]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>L(Math.max(l.currentPage-1,1)),disabled:l.currentPage===1,children:e.jsx("i",{className:"fas fa-chevron-left text-[10px]"})}),e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-[10px] font-medium rounded-lg min-w-[24px] text-center",children:l.currentPage}),e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>L(Math.min(l.currentPage+1,p)),disabled:l.currentPage===p,children:e.jsx("i",{className:"fas fa-chevron-right text-[10px]"})})]})]})]})}),e.jsx("div",{className:"controls-section mb-4 hidden md:block",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6 col-lg-4 mb-3 mb-md-0",children:e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"input-group",children:[e.jsx("div",{className:"input-group-prepend",children:e.jsx("span",{className:"input-group-text bg-white border-right-0",children:e.jsx("i",{className:"fas fa-search text-muted"})})}),e.jsx("input",{type:"text",name:"searchTerm",className:"form-control border-left-0 modern-input",placeholder:"Search sessions by title or user...",value:l.searchTerm,onChange:B})]})})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsxs("select",{name:"sessionType",className:"form-control modern-select",value:l.sessionType,onChange:B,children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"financial_advice",children:"Financial Advice"}),e.jsx("option",{value:"budget_help",children:"Budget Help"}),e.jsx("option",{value:"goal_planning",children:"Goal Planning"}),e.jsx("option",{value:"transaction_query",children:"Transaction Query"})]})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsx("input",{type:"date",name:"dateFrom",className:"form-control modern-input",value:l.dateFrom,onChange:B,placeholder:"From date"})}),e.jsx("div",{className:"col-md-12 col-lg-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"page-size-selector",children:[e.jsx("small",{className:"text-muted mr-2",children:"Show:"}),e.jsxs("select",{name:"pageSize",className:"form-control form-control-sm d-inline-block w-auto",value:l.pageSize,onChange:B,children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("small",{className:"text-muted ml-2",children:"per page"})]}),(l.searchTerm||l.sessionType!=="all"||l.dateFrom||l.dateTo)&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:ae,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Clear Filters"]})]})})]})})})}),e.jsx("div",{className:"table-section hidden md:block",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header bg-white border-0 py-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-danger",children:[e.jsx("i",{className:"fas fa-table mr-2"}),"Chat Sessions (",V,")"]}),e.jsx("div",{className:"table-actions",children:e.jsxs("small",{className:"text-muted",children:["Showing ",Math.min((l.currentPage-1)*l.pageSize+1,V)," to ",Math.min(l.currentPage*l.pageSize,V)," of ",V," entries"]})})]})}),e.jsx("div",{className:"card-body p-0",children:d.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"empty-state-container",children:[e.jsx("i",{className:"fas fa-comments fa-4x text-gray-300 mb-4"}),e.jsx("h4",{className:"text-gray-700 mb-3",children:l.searchTerm||l.sessionType!=="all"||l.dateFrom||l.dateTo?"No Matching Sessions":"No Chat Sessions Yet"}),e.jsx("p",{className:"text-muted mb-4 max-width-sm mx-auto",children:l.searchTerm||l.sessionType!=="all"||l.dateFrom||l.dateTo?"Try adjusting your filters or search criteria to find the sessions you're looking for.":"Chat sessions will appear here once users start interacting with the AI chatbot."}),(l.searchTerm||l.sessionType!=="all"||l.dateFrom||l.dateTo)&&e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:ae,children:[e.jsx("i",{className:"fas fa-filter mr-2"}),"Clear Filters"]})]})}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover modern-table mb-0",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0",children:"User"}),e.jsx("th",{className:"border-0",children:"Session Title"}),e.jsx("th",{className:"border-0",children:"Type"}),e.jsx("th",{className:"border-0",children:"Messages"}),e.jsx("th",{className:"border-0",children:"Status"}),e.jsx("th",{className:"border-0",children:"Started"}),e.jsx("th",{className:"border-0 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"table-row",children:[e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"user-avatar-container mr-3",children:[e.jsx("img",{src:s.user_avatar||"../images/placeholder.png",alt:s.user_name||"User",className:"user-table-avatar",onError:i=>{i.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:`user-status-dot status-${s.is_active?"active":"inactive"}`})]}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name font-weight-medium",children:s.user_name||"Anonymous User"}),e.jsx("div",{className:"user-id text-muted small",children:s.user_email||"No email"})]})]})}),e.jsx("td",{className:"py-3",children:e.jsx("div",{className:"text-sm",children:s.session_title||"Untitled Session"})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:"status-badge status-primary",children:[e.jsx("i",{className:"fas fa-tag mr-1"}),s.session_type.replace(/_/g," ")]})}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:"badge badge-info",children:s.message_count})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:`status-badge ${s.is_active?"status-success":"status-secondary"}`,children:[e.jsx("i",{className:`fas ${s.is_active?"fa-circle":"fa-check-circle"} mr-1`}),s.is_active?"Active":"Ended"]})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"login-date",children:new Date(s.start_time).toLocaleDateString()}),e.jsx("div",{className:"login-time text-muted small",children:new Date(s.start_time).toLocaleTimeString()})]})}),e.jsx("td",{className:"py-3 text-center",children:e.jsx("div",{className:"action-buttons",children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>se(s),title:"View Messages",children:e.jsx("i",{className:"fas fa-eye"})})})})]},s.id))})]})})}),p>1&&e.jsx("div",{className:"card-footer bg-white border-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{className:"pagination-info",children:e.jsxs("small",{className:"text-muted",children:["Page ",l.currentPage," of ",p]})}),e.jsx("nav",{"aria-label":"Sessions pagination",children:e.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[e.jsx("li",{className:`page-item ${l.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>L(1),disabled:l.currentPage===1,children:e.jsx("i",{className:"fas fa-angle-double-left"})})}),e.jsx("li",{className:`page-item ${l.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>L(l.currentPage-1),disabled:l.currentPage===1,children:e.jsx("i",{className:"fas fa-angle-left"})})}),Array.from({length:Math.min(5,p)}).map((s,i)=>{let n;return p<=5||l.currentPage<=3?n=i+1:l.currentPage>=p-2?n=p-4+i:n=l.currentPage-2+i,n<=p?e.jsx("li",{className:`page-item ${n===l.currentPage?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>L(n),children:n})},i):null}),e.jsx("li",{className:`page-item ${l.currentPage===p?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>L(l.currentPage+1),disabled:l.currentPage===p,children:e.jsx("i",{className:"fas fa-angle-right"})})}),e.jsx("li",{className:`page-item ${l.currentPage===p?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>L(p),disabled:l.currentPage===p,children:e.jsx("i",{className:"fas fa-angle-double-right"})})})]})})]})})]})}),e.jsx(fe,{show:x,onClose:me,session:M,messages:D,loading:!1}),e.jsx(ge,{show:Q,onClose:()=>R(!1),prompt:N,onSave:de,loading:!1}),e.jsx(je,{show:W.show,onClose:()=>J(s=>({...s,show:!1})),title:W.title,color:W.color,icon:W.icon,data:W.data})]})};export{ye as default};
