import{s as u}from"./index-BbApZ7g3.js";class m{static async logTransactionCreated(t,e,r,n){try{const{error:c}=await u.from("system_activity_log").insert({user_id:t,activity_type:"transaction_created",activity_description:`${e.type.charAt(0).toUpperCase()+e.type.slice(1)} transaction created: ₱${e.amount.toFixed(2)} - ${e.description||"No description"}`,ip_address:n||null,user_agent:r||(typeof navigator<"u"?navigator.userAgent:null),metadata:{transaction_id:e.transaction_id,account_id:e.account_id,account_name:e.account_name,amount:e.amount,transaction_type:e.type,category_id:e.category_id,category_name:e.category_name,goal_id:e.goal_id,goal_name:e.goal_name,description:e.description,transaction_date:e.date,created_via:"transaction_form"},severity:"info",created_at:new Date().toISOString()});return c?(console.error("Error logging transaction creation:",c),{success:!1,error:c.message}):{success:!0}}catch(c){return console.error("Exception logging transaction creation:",c),{success:!1,error:c instanceof Error?c.message:"Unknown error"}}}static async logTransactionUpdated(t,e,r,n,c){try{const a=Object.entries(r.changes).map(([i,d])=>`${i.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())}: "${d.old}" → "${d.new}"`).join(", "),{error:s}=await u.from("system_activity_log").insert({user_id:t,activity_type:"transaction_updated",activity_description:`Transaction updated: ${a}`,ip_address:c||null,user_agent:n||(typeof navigator<"u"?navigator.userAgent:null),metadata:{transaction_id:e,account_id:r.new_values.account_id||r.old_values.account_id,account_name:r.new_values.account_name||r.old_values.account_name,old_values:r.old_values,new_values:r.new_values,changes:r.changes,updated_via:"transaction_form"},severity:"info",created_at:new Date().toISOString()});return s?(console.error("Error logging transaction update:",s),{success:!1,error:s.message}):{success:!0}}catch(o){return console.error("Exception logging transaction update:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}static async logTransactionDeleted(t,e,r,n,c){try{const{error:o}=await u.from("system_activity_log").insert({user_id:t,activity_type:"transaction_deleted",activity_description:`${e.type.charAt(0).toUpperCase()+e.type.slice(1)} transaction deleted: ₱${e.amount.toFixed(2)} - ${e.description||"No description"}${r?` (${r})`:""}`,ip_address:c||null,user_agent:n||(typeof navigator<"u"?navigator.userAgent:null),metadata:{transaction_id:e.transaction_id,account_id:e.account_id,account_name:e.account_name,amount:e.amount,transaction_type:e.type,category_id:e.category_id,category_name:e.category_name,goal_id:e.goal_id,goal_name:e.goal_name,description:e.description,transaction_date:e.date,deletion_reason:r,deleted_via:"transaction_interface"},severity:"info",created_at:new Date().toISOString()});return o?(console.error("Error logging transaction deletion:",o),{success:!1,error:o.message}):{success:!0}}catch(o){return console.error("Exception logging transaction deletion:",o),{success:!1,error:o instanceof Error?o.message:"Unknown error"}}}static async getTransactionHistory(t,e,r={}){try{const{limit:n=50,offset:c=0,startDate:o,endDate:a,transactionTypes:s=["transaction_created","transaction_updated","transaction_deleted"]}=r;let i=u.from("system_activity_log").select("*",{count:"exact"}).eq("user_id",t).in("activity_type",s).contains("metadata",{account_id:e}).order("created_at",{ascending:!1}).range(c,c+n-1);o&&(i=i.gte("created_at",o)),a&&(i=i.lte("created_at",a));const{data:d,error:_,count:l}=await i;return _?(console.error("Error fetching transaction history:",_),{success:!1,error:_.message}):{success:!0,data:d||[],totalCount:l||0}}catch(n){return console.error("Exception fetching transaction history:",n),{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}static extractTransactionAuditData(t,e,r,n){return{transaction_id:t.id,account_id:t.account_id||e?.id,account_name:e?.account_name,amount:t.amount,type:t.type,category_id:t.income_category_id||t.expense_category_id||r?.id,category_name:r?.category_name,goal_id:t.goal_id||n?.id,goal_name:n?.goal_name,description:t.description||t.notes,date:t.date}}}export{m as T};
