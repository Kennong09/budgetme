import{j as e,B as P}from"./ui-vendor-Cn1Vfl4w.js";import{r as n}from"./react-vendor-D4A9EtXC.js";import{b as ne,p as E,s as be,v as _e,w as ze,x as Ue,t as Z}from"./index-BbApZ7g3.js";import"./chart-vendor-B0c7K_uV.js";const Ce=({show:s,onClose:U,onUserAdded:C})=>{const[h,i]=n.useState({email:"",password:"",fullName:"",role:"user"}),[p,r]=n.useState(!1),[x,u]=n.useState(""),[v,j]=n.useState(!1),[$,y]=n.useState(!1),[g,w]=n.useState(null),[l,d]=n.useState(""),D=n.useRef(null),{showSuccessToast:k,showErrorToast:A}=ne(),T=()=>h.email?/\S+@\S+\.\S+/.test(h.email)?h.password?h.password.length<8?"Password must be at least 8 characters":h.fullName?h.fullName.length<2?"Full name must be at least 2 characters":null:"Full name is required":"Password is required":"Email address is invalid":"Email is required",ae=()=>{const b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let t="";t+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)],t+="abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)],t+="0123456789"[Math.floor(Math.random()*10)],t+="!@#$%^&*"[Math.floor(Math.random()*8)];for(let m=t.length;m<12;m++)t+=b[Math.floor(Math.random()*b.length)];t=t.split("").sort(()=>Math.random()-.5).join(""),i(m=>({...m,password:t})),j(!0)},Q=b=>{if(!b)return{strength:0,label:"",color:"secondary"};let t=0;return b.length>=8&&(t+=25),b.length>=12&&(t+=25),/[a-z]/.test(b)&&/[A-Z]/.test(b)&&(t+=25),/\d/.test(b)&&(t+=15),/[!@#$%^&*]/.test(b)&&(t+=10),t>=75?{strength:t,label:"Strong",color:"success"}:t>=50?{strength:t,label:"Medium",color:"warning"}:{strength:t,label:"Weak",color:"danger"}},te=b=>{const t=b.target.files?.[0];if(!t)return;if(!["image/jpeg","image/png","image/jpg","image/gif","image/webp"].includes(t.type)){A("Please select a valid image file");return}if(t.size>5*1024*1024){A("Image size must be less than 5MB");return}w(t),d(URL.createObjectURL(t))},V=async(b,t)=>{try{y(!0);const m=b.name.split(".").pop(),R=`profiles/${`profile-${t}-${Date.now()}.${m}`}`,{error:W}=await be.storage.from("profile-pictures").upload(R,b,{cacheControl:"3600",upsert:!1});if(W)throw W;const{data:X}=be.storage.from("profile-pictures").getPublicUrl(R);return X.publicUrl}catch(m){return console.warn("Storage upload failed, using base64:",m),new Promise((S,R)=>{const W=new FileReader;W.onload=X=>S(X.target?.result),W.onerror=R,W.readAsDataURL(b)})}finally{y(!1)}},O=b=>{const{name:t,value:m}=b.target;i(S=>({...S,[t]:m})),x&&u("")},I=async()=>{const b=T();if(b){u(b);return}r(!0),u("");try{let t="";if(g){const M=`temp-${Date.now()}`,Y=await V(g,M);Y&&(t=Y)}if(!E)throw new Error("Admin client not available");const{data:m,error:S}=await E.auth.admin.createUser({email:h.email,password:h.password,email_confirm:!0,user_metadata:{full_name:h.fullName,avatar_url:t}});if(S)throw new Error(S.message);if(!m?.user)throw new Error("Failed to create user");const R=m.user.id,{error:W}=await E.from("profiles").upsert({id:R,email:h.email,full_name:h.fullName,avatar_url:t||null,role:h.role,email_verified:!0,is_active:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(W)throw await E.auth.admin.deleteUser(R),new Error(`Profile creation failed: ${W.message}`);await E.from("accounts").insert({user_id:R,account_name:"Primary Account",account_type:"checking",balance:0,initial_balance:0,currency:"PHP",status:"active",is_default:!0,color:"#4CAF50"});const X=[{name:"Food & Dining",icon:"utensils",color:"#FF6B6B"},{name:"Transportation",icon:"car",color:"#4ECDC4"},{name:"Shopping",icon:"shopping-bag",color:"#FFE66D"},{name:"Entertainment",icon:"film",color:"#95E1D3"},{name:"Bills & Utilities",icon:"file-invoice-dollar",color:"#F38181"},{name:"Healthcare",icon:"heartbeat",color:"#AA96DA"},{name:"Education",icon:"graduation-cap",color:"#FCBAD3"},{name:"Other",icon:"ellipsis-h",color:"#A8E6CF"}];await E.from("expense_categories").insert(X.map(M=>({user_id:R,category_name:M.name,icon:M.icon,color:M.color,is_default:!0,is_active:!0})));const ce=[{name:"Salary",icon:"money-bill-wave",color:"#4CAF50"},{name:"Freelance",icon:"laptop",color:"#8BC34A"},{name:"Investment",icon:"chart-line",color:"#CDDC39"},{name:"Gift",icon:"gift",color:"#FFC107"},{name:"Other Income",icon:"plus-circle",color:"#FF9800"}];await E.from("income_categories").insert(ce.map(M=>({user_id:R,category_name:M.name,icon:M.icon,color:M.color,is_default:!0,is_active:!0}))),k(`User ${h.fullName} created successfully!`),F(),C()}catch(t){console.error("Error creating user:",t),u(t.message||"Failed to create user"),A(t.message||"Failed to create user")}finally{r(!1)}},F=()=>{p||(i({email:"",password:"",fullName:"",role:"user"}),u(""),j(!1),w(null),d(""),U())};if(!s)return null;const L=Q(h.password),q=h.email&&h.password&&h.fullName&&h.password.length>=8;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:F}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:F,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered",onClick:b=>b.stopPropagation(),style:{margin:"0 auto"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:window.innerWidth<768?"0":"12px",overflow:"hidden",maxHeight:window.innerWidth<768?"100vh":"85vh",minHeight:window.innerWidth<768?"100vh":"auto"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 md:py-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:window.innerWidth<768?"32px":"40px",height:window.innerWidth<768?"32px":"40px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:`fas fa-user-plus ${window.innerWidth<768?"":"fa-lg"}`})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-sm md:text-base",children:"Add New User"}),e.jsx("small",{className:"d-block truncate",style:{opacity:.9,fontSize:window.innerWidth<768?"0.7rem":"0.8rem"},children:"Create a new user account"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:F,disabled:p,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsxs("div",{className:"modal-body py-3",style:{maxHeight:"60vh",overflowY:"auto"},children:[x&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),x]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#e7f3ff",borderRadius:"8px",borderLeft:"3px solid #007bff"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-info-circle text-primary mr-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-primary",style:{fontSize:"0.9rem"},children:"Auto-Verified Account"}),e.jsx("p",{className:"mb-0 text-muted",style:{fontSize:"0.8rem"},children:"Email will be automatically verified. User can sign in immediately with provided credentials."})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-camera mr-2"}),"Profile Picture",e.jsx(P,{bg:"secondary",className:"ml-2",style:{fontSize:"0.6rem"},children:"Optional"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"position-relative mr-3",children:[e.jsx("img",{src:l||"../images/placeholder.png",alt:"Preview",className:"rounded-circle",style:{width:"60px",height:"60px",objectFit:"cover",border:"2px solid #dee2e6"},onError:b=>{b.currentTarget.src="../images/placeholder.png"}}),$&&e.jsx("div",{className:"position-absolute d-flex align-items-center justify-content-center",style:{top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",borderRadius:"50%"},children:e.jsx("div",{className:"spinner-border text-white spinner-border-sm"})})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",ref:D,accept:"image/*",onChange:te,className:"d-none"}),e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm mr-2",onClick:()=>D.current?.click(),disabled:p||$,style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-upload mr-1"}),"Choose"]}),g&&e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{w(null),d("")},disabled:p,style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Clear"]})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-user mr-2"}),"User Information"]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12 mb-2",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Full Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control form-control-sm",name:"fullName",value:h.fullName,onChange:O,placeholder:"John Doe",disabled:p,style:{fontSize:"0.85rem"}})]}),e.jsxs("div",{className:"col-12 mb-2",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Email Address ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"email",className:"form-control form-control-sm",name:"email",value:h.email,onChange:O,placeholder:"john@example.com",disabled:p,style:{fontSize:"0.85rem"}})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Role ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{className:"form-control form-control-sm",name:"role",value:h.role,onChange:O,disabled:p,style:{fontSize:"0.85rem"},children:[e.jsx("option",{value:"user",children:"Standard User"}),e.jsx("option",{value:"admin",children:"Administrator"})]})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-key mr-2"}),"Password"]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"input-group input-group-sm mb-2",children:[e.jsx("input",{type:v?"text":"password",className:"form-control",name:"password",value:h.password,onChange:O,placeholder:"Min. 8 characters",disabled:p,style:{fontSize:"0.85rem"}}),e.jsxs("div",{className:"input-group-append",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>j(!v),disabled:p,children:e.jsx("i",{className:`fas ${v?"fa-eye-slash":"fa-eye"}`})}),e.jsx("button",{type:"button",className:"btn btn-outline-info",onClick:ae,disabled:p,title:"Generate password",children:e.jsx("i",{className:"fas fa-random"})})]})]}),h.password&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("small",{className:"text-muted mr-2",style:{fontSize:"0.75rem"},children:"Strength:"}),e.jsx("div",{className:"progress flex-grow-1",style:{height:"4px"},children:e.jsx("div",{className:`progress-bar bg-${L.color}`,style:{width:`${L.strength}%`}})}),e.jsx("small",{className:`ml-2 text-${L.color}`,style:{fontSize:"0.75rem"},children:L.label})]})]})]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-list mr-2"}),"What will be created:"]}),e.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:[{icon:"fa-user",label:"Account"},{icon:"fa-id-card",label:"Profile"},{icon:"fa-wallet",label:"Default Account"},{icon:"fa-tags",label:"Categories"},{icon:"fa-check-circle",label:"Verified Email"}].map((b,t)=>e.jsxs("span",{className:"badge badge-light px-2 py-1",style:{fontSize:"0.75rem",border:"1px solid #dee2e6"},children:[e.jsx("i",{className:`fas ${b.icon} text-success mr-1`}),b.label]},t))})]})]}),e.jsxs("div",{className:"modal-footer border-0 py-2",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-user-plus mr-1"}),"User will be created with verified email"]}),e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm mr-2",onClick:F,disabled:p,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:I,disabled:p||$||!q,children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-user-plus mr-1"}),"Create"]})})]})]})})})]})},Re=({user:s,isOpen:U,onClose:C,onEdit:h,onDelete:i,onToggleAdmin:p,onChangeStatus:r,isAdmin:x,loading:u=!1})=>{const[v,j]=n.useState("overview");if(!U||!s)return null;const $=l=>{switch(l){case"active":return{label:"Active",color:"#28a745",bgColor:"rgba(40, 167, 69, 0.1)",icon:"fa-check-circle"};case"suspended":return{label:"Suspended",color:"#dc3545",bgColor:"rgba(220, 53, 69, 0.1)",icon:"fa-ban"};default:return{label:"Inactive",color:"#6c757d",bgColor:"rgba(108, 117, 125, 0.1)",icon:"fa-pause-circle"}}},y=l=>new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),g=$(s.status||"inactive"),w=Math.floor((Date.now()-new Date(s.created_at).getTime())/(1e3*60*60*24));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:C}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:C,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",onClick:l=>l.stopPropagation(),style:{margin:"0 auto"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:window.innerWidth<768?"0":"12px",overflow:"hidden",maxHeight:window.innerWidth<768?"100vh":"85vh",minHeight:window.innerWidth<768?"100vh":"auto"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 md:py-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:window.innerWidth<768?"32px":"40px",height:window.innerWidth<768?"32px":"40px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:`fas fa-user-circle ${window.innerWidth<768?"":"fa-lg"}`})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-sm md:text-base truncate",children:"User Details"}),e.jsx("small",{className:"d-block truncate",style:{opacity:.9,fontSize:window.innerWidth<768?"0.7rem":"0.8rem"},children:s.user_metadata?.full_name||s.email})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:C,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsxs("div",{className:"px-2 md:px-3 py-2",style:{background:"#f8f9fa",borderBottom:"1px solid #e9ecef"},children:[e.jsx("div",{className:"block md:hidden",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 bg-white rounded-lg p-2",children:[e.jsx("i",{className:`fas ${g.icon} text-xs`,style:{color:g.color}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 leading-none",children:"Status"}),e.jsx("p",{className:"text-[10px] font-bold",style:{color:g.color},children:g.label})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white rounded-lg p-2",children:[e.jsx("i",{className:`fas ${x?"fa-shield-alt":"fa-user"} text-red-500 text-xs`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 leading-none",children:"Role"}),e.jsx("p",{className:"text-[10px] font-bold text-red-500",children:x?"Admin":"User"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white rounded-lg p-2",children:[e.jsx("i",{className:"fas fa-calendar-alt text-red-500 text-xs"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 leading-none",children:"Member"}),e.jsxs("p",{className:"text-[10px] font-bold text-red-500",children:[w,"d"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 bg-white rounded-lg p-2",children:[e.jsx("i",{className:`fas ${s.email_confirmed_at?"fa-check-circle text-emerald-500":"fa-exclamation-circle text-amber-500"} text-xs`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[8px] text-gray-500 leading-none",children:"Email"}),e.jsx("p",{className:`text-[10px] font-bold ${s.email_confirmed_at?"text-emerald-500":"text-amber-500"}`,children:s.email_confirmed_at?"Verified":"Pending"})]})]})]})}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"row text-center g-2",children:[e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${g.icon} mr-2`,style:{color:g.color}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Status"}),e.jsx("strong",{style:{color:g.color,fontSize:"0.8rem"},children:g.label})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${x?"fa-shield-alt":"fa-user"} text-danger mr-2`}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Role"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:x?"Admin":"User"})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-calendar-alt text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Member"}),e.jsxs("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:[w,"d"]})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${s.email_confirmed_at?"fa-check-circle text-success":"fa-exclamation-circle text-warning"} mr-2`}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Email"}),e.jsx("strong",{style:{fontSize:"0.8rem"},className:s.email_confirmed_at?"text-success":"text-warning",children:s.email_confirmed_at?"Verified":"Pending"})]})]})})]})})]}),e.jsxs("div",{className:"px-2 md:px-3 pt-2",children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"flex gap-1",children:[{id:"overview",icon:"fa-user",label:"Overview"},{id:"account",icon:"fa-id-card",label:"Account"},{id:"actions",icon:"fa-cogs",label:"Actions"}].map(l=>e.jsxs("button",{className:`flex-1 py-1.5 px-2 rounded-full text-[10px] font-medium transition-colors ${v===l.id?"bg-red-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,onClick:()=>j(l.id),children:[e.jsx("i",{className:`fas ${l.icon} mr-1`}),l.label]},l.id))})}),e.jsx("div",{className:"hidden md:flex",style:{gap:"6px"},children:[{id:"overview",icon:"fa-user",label:"Overview"},{id:"account",icon:"fa-id-card",label:"Account"},{id:"actions",icon:"fa-cogs",label:"Actions"}].map(l=>e.jsxs("button",{className:`btn btn-sm ${v===l.id?"btn-danger":"btn-outline-secondary"}`,onClick:()=>j(l.id),style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:`fas ${l.icon} mr-1`}),l.label]},l.id))})]}),e.jsxs("div",{className:"modal-body py-3",style:{maxHeight:"50vh",overflowY:"auto"},children:[v==="overview"&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-5 text-center mb-3 mb-lg-0",children:[e.jsxs("div",{className:"position-relative d-inline-block mb-3",children:[e.jsx("img",{src:s.user_metadata?.avatar_url||"../images/placeholder.png",alt:s.user_metadata?.full_name||"User",className:"rounded-circle",style:{width:"100px",height:"100px",objectFit:"cover",border:"3px solid #dc3545"},onError:l=>{l.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:"position-absolute",style:{bottom:"5px",right:"5px",width:"20px",height:"20px",borderRadius:"50%",background:g.color,border:"2px solid white"}})]}),e.jsx("h6",{className:"font-weight-bold mb-1",children:s.user_metadata?.full_name||"Unnamed User"}),e.jsx("p",{className:"text-muted mb-2",style:{fontSize:"0.85rem"},children:s.email}),e.jsxs("div",{className:"d-flex justify-content-center flex-wrap",style:{gap:"6px"},children:[e.jsxs(P,{bg:s.status==="active"?"success":s.status==="suspended"?"danger":"secondary",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:`fas ${g.icon} mr-1`}),g.label]}),e.jsxs(P,{bg:x?"danger":"primary",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:`fas ${x?"fa-shield-alt":"fa-user"} mr-1`}),x?"Administrator":"User"]}),s.email_confirmed_at&&e.jsxs(P,{bg:"info",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Verified"]})]})]}),e.jsxs("div",{className:"col-lg-7",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Quick Info"]}),e.jsxs("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px",fontSize:"0.85rem"},children:[e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"User ID"}),e.jsxs("code",{style:{fontSize:"0.75rem"},children:[s.id?.substring(0,16),"..."]})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Member Since"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Last Login"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:s.last_sign_in_at?y(s.last_sign_in_at):"Never"})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",children:[e.jsx("small",{className:"text-muted",children:"Email Verified"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:s.email_confirmed_at?e.jsxs("span",{className:"text-success",children:[e.jsx("i",{className:"fas fa-check mr-1"}),new Date(s.email_confirmed_at).toLocaleDateString()]}):e.jsxs("span",{className:"text-warning",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),"Not verified"]})})]})]})]})]}),v==="account"&&e.jsxs("div",{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-id-card mr-2"}),"Account Details"]}),e.jsx("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("table",{className:"table table-sm table-borderless mb-0",style:{fontSize:"0.8rem"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Full Name"}),e.jsx("td",{className:"text-right py-1",children:e.jsx("strong",{children:s.user_metadata?.full_name||"Not set"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Email"}),e.jsx("td",{className:"text-right py-1",children:s.email})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Role"}),e.jsx("td",{className:"text-right py-1",children:e.jsx(P,{bg:x?"danger":"primary",style:{fontSize:"0.65rem"},children:x?"Admin":"User"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Status"}),e.jsx("td",{className:"text-right py-1",children:e.jsx(P,{bg:s.status==="active"?"success":"secondary",style:{fontSize:"0.65rem"},children:s.status||"Inactive"})})]})]})})})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-clock mr-2"}),"Activity"]}),e.jsx("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("table",{className:"table table-sm table-borderless mb-0",style:{fontSize:"0.8rem"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Created"}),e.jsx("td",{className:"text-right py-1",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Last Login"}),e.jsx("td",{className:"text-right py-1",children:s.last_sign_in_at?new Date(s.last_sign_in_at).toLocaleDateString():"Never"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Days Active"}),e.jsx("td",{className:"text-right py-1",children:e.jsx("strong",{className:"text-danger",children:w})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Verified"}),e.jsx("td",{className:"text-right py-1",children:e.jsx(P,{bg:s.email_confirmed_at?"success":"warning",style:{fontSize:"0.65rem"},children:s.email_confirmed_at?"Yes":"No"})})]})]})})})]})]}),e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-user-cog mr-2"}),"Status Management"]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("p",{className:"text-muted mb-2",style:{fontSize:"0.8rem"},children:"Change user account status:"}),e.jsxs("div",{className:"d-flex flex-wrap",style:{gap:"8px"},children:[e.jsxs("button",{className:`btn btn-sm ${s.status==="active"?"btn-success":"btn-outline-success"}`,onClick:()=>r(s,"active"),disabled:u,style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Active"]}),e.jsxs("button",{className:`btn btn-sm ${s.status==="inactive"?"btn-secondary":"btn-outline-secondary"}`,onClick:()=>r(s,"inactive"),disabled:u,style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-pause-circle mr-1"}),"Inactive"]}),e.jsxs("button",{className:`btn btn-sm ${s.status==="suspended"?"btn-danger":"btn-outline-danger"}`,onClick:()=>r(s,"suspended"),disabled:u,style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-ban mr-1"}),"Suspended"]})]})]})]}),v==="actions"&&e.jsxs("div",{children:[e.jsxs("h6",{className:"text-danger mb-3",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-tools mr-2"}),"User Management Actions"]}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-md-4 mb-2",children:e.jsxs("div",{className:"p-3 text-center h-100",style:{background:"#f8f9fa",borderRadius:"8px",cursor:"pointer",border:"1px solid transparent",transition:"all 0.2s"},onClick:()=>h(s),onMouseEnter:l=>{l.currentTarget.style.borderColor="#007bff",l.currentTarget.style.background="#e7f1ff"},onMouseLeave:l=>{l.currentTarget.style.borderColor="transparent",l.currentTarget.style.background="#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-2",style:{width:"40px",height:"40px",background:"rgba(0, 123, 255, 0.1)",borderRadius:"8px",margin:"0 auto"},children:e.jsx("i",{className:"fas fa-edit text-primary"})}),e.jsx("h6",{className:"mb-1",style:{fontSize:"0.85rem"},children:"Edit User"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:"Modify details & settings"})]})}),e.jsx("div",{className:"col-md-4 mb-2",children:e.jsxs("div",{className:"p-3 text-center h-100",style:{background:"#f8f9fa",borderRadius:"8px",cursor:"pointer",border:"1px solid transparent",transition:"all 0.2s"},onClick:()=>p(s),onMouseEnter:l=>{l.currentTarget.style.borderColor=x?"#6c757d":"#17a2b8",l.currentTarget.style.background=x?"#f5f5f5":"#e7f6f8"},onMouseLeave:l=>{l.currentTarget.style.borderColor="transparent",l.currentTarget.style.background="#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-2",style:{width:"40px",height:"40px",background:x?"rgba(108, 117, 125, 0.1)":"rgba(23, 162, 184, 0.1)",borderRadius:"8px",margin:"0 auto"},children:e.jsx("i",{className:`fas ${x?"fa-user-minus":"fa-user-shield"} ${x?"text-secondary":"text-info"}`})}),e.jsx("h6",{className:"mb-1",style:{fontSize:"0.85rem"},children:x?"Remove Admin":"Make Admin"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:x?"Remove privileges":"Grant admin access"})]})}),e.jsx("div",{className:"col-md-4 mb-2",children:e.jsxs("div",{className:"p-3 text-center h-100",style:{background:"#f8f9fa",borderRadius:"8px",cursor:"pointer",border:"1px solid transparent",transition:"all 0.2s"},onClick:()=>i(s),onMouseEnter:l=>{l.currentTarget.style.borderColor="#dc3545",l.currentTarget.style.background="#fff5f5"},onMouseLeave:l=>{l.currentTarget.style.borderColor="transparent",l.currentTarget.style.background="#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-2",style:{width:"40px",height:"40px",background:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",margin:"0 auto"},children:e.jsx("i",{className:"fas fa-trash-alt text-danger"})}),e.jsx("h6",{className:"mb-1",style:{fontSize:"0.85rem"},children:"Delete User"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:"Permanently remove"})]})})]})]})]}),e.jsxs("div",{className:"modal-footer border-0 py-2 px-2 md:px-3",style:{background:"#f8f9fa"},children:[e.jsx("div",{className:"block md:hidden w-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-gray-400 truncate max-w-[120px]",children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),s.id?.substring(0,8),"..."]}),e.jsxs("button",{type:"button",className:"px-4 py-1.5 bg-red-500 hover:bg-red-600 text-white text-[10px] font-medium rounded-lg transition-colors",onClick:C,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})}),e.jsxs("div",{className:"hidden md:flex w-100 align-items-center",children:[e.jsxs("small",{className:"text-muted mr-auto",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"0.7rem"},children:[s.id?.substring(0,12),"..."]})]}),e.jsxs("button",{type:"button",className:"btn btn-danger btn-sm",onClick:C,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})]})]})})})]})},De=({user:s,isOpen:U,onClose:C,onUserUpdated:h})=>{const[i,p]=n.useState(""),[r,x]=n.useState(!1),[u,v]=n.useState(""),[j,$]=n.useState(!1),[y,g]=n.useState(null),[w,l]=n.useState(""),[d,D]=n.useState(""),[k,A]=n.useState(!1),T=n.useRef(null),{showSuccessToast:ae,showErrorToast:Q}=ne();n.useEffect(()=>{s&&(p(s.user_metadata?.full_name||""),l(s.user_metadata?.avatar_url||""),g(null),D(""),A(!1),v(""))},[s]);const te=t=>{const m=t.target.files?.[0];if(m){if(m.size>5*1024*1024){Q("Image size should be less than 5MB");return}g(m);const S=new FileReader;S.onload=R=>{l(R.target?.result)},S.readAsDataURL(m)}},V=async t=>{$(!0);try{const m=`avatar-${s?.id}-${Date.now()}.${t.name.split(".").pop()}`,{error:S}=await E.storage.from("avatars").upload(m,t);if(S)throw S;const{data:{publicUrl:R}}=E.storage.from("avatars").getPublicUrl(m);return R}catch(m){return console.error("Image upload error:",m),Q("Failed to upload image"),null}finally{$(!1)}},O=()=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let m="";for(let S=0;S<12;S++)m+=t.charAt(Math.floor(Math.random()*t.length));D(m),A(!0)},I=t=>{if(!t)return{strength:0,label:"",color:"secondary"};let m=0;return t.length>=8&&(m+=25),t.length>=12&&(m+=25),/[a-z]/.test(t)&&/[A-Z]/.test(t)&&(m+=25),/\d/.test(t)&&(m+=15),/[!@#$%^&*]/.test(t)&&(m+=10),m>=75?{strength:m,label:"Strong",color:"success"}:m>=50?{strength:m,label:"Medium",color:"warning"}:{strength:m,label:"Weak",color:"danger"}},F=async()=>{if(s){if(!i.trim()){v("Full name is required");return}x(!0),v("");try{let t=s.user_metadata?.avatar_url;if(y&&(t=await V(y),!t)){x(!1);return}const m={user_metadata:{...s.user_metadata,full_name:i.trim(),avatar_url:t}};d&&(m.password=d);const{error:S}=await E.auth.admin.updateUserById(s.id,m);if(S)throw S;await E.from("profiles").update({full_name:i.trim(),avatar_url:t}).eq("id",s.id),ae("User updated successfully");const R={...s,user_metadata:{...s.user_metadata,full_name:i.trim(),avatar_url:t||""}};h(R),L()}catch(t){console.error("Error updating user:",t),v(t.message||"Failed to update user"),Q("Failed to update user")}finally{x(!1)}}},L=()=>{p(""),g(null),l(""),D(""),A(!1),v(""),C()};if(!U||!s)return null;const q=i!==(s.user_metadata?.full_name||"")||y!==null||d!=="",b=I(d);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:L}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:L,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered",onClick:t=>t.stopPropagation(),style:{margin:"0 auto"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:window.innerWidth<768?"0":"12px",overflow:"hidden",maxHeight:window.innerWidth<768?"100vh":"85vh",minHeight:window.innerWidth<768?"100vh":"auto"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 md:py-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:window.innerWidth<768?"32px":"40px",height:window.innerWidth<768?"32px":"40px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:`fas fa-user-edit ${window.innerWidth<768?"":"fa-lg"}`})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-sm md:text-base",children:"Edit User"}),e.jsx("small",{className:"d-block truncate",style:{opacity:.9,fontSize:window.innerWidth<768?"0.7rem":"0.8rem"},children:"Modify user details and settings"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:L,disabled:r,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsxs("div",{className:"modal-body py-3",style:{maxHeight:"60vh",overflowY:"auto"},children:[u&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),u]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"position-relative mr-3",children:[e.jsx("img",{src:w||"../images/placeholder.png",alt:i||"User",className:"rounded-circle",style:{width:"70px",height:"70px",objectFit:"cover",border:"3px solid #dc3545"},onError:t=>{t.currentTarget.src="../images/placeholder.png"}}),j&&e.jsx("div",{className:"position-absolute d-flex align-items-center justify-content-center",style:{top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",borderRadius:"50%"},children:e.jsx("div",{className:"spinner-border text-white spinner-border-sm"})})]}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("strong",{style:{fontSize:"0.95rem"},children:s.user_metadata?.full_name||"Unknown User"}),e.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem"},children:s.email}),e.jsxs("div",{className:"mt-1",children:[e.jsx(P,{bg:s.status==="active"?"success":"secondary",style:{fontSize:"0.65rem"},className:"mr-1",children:s.status||"Inactive"}),q&&e.jsxs(P,{bg:"warning",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),"Unsaved"]})]})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-camera mr-2"}),"Profile Picture"]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"d-flex align-items-center",style:{gap:"10px"},children:[e.jsx("input",{type:"file",ref:T,onChange:te,accept:"image/*",className:"d-none"}),e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>T.current?.click(),disabled:j||r,style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-upload mr-1"}),"Change"]}),(w||y)&&e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{l(""),g(null)},disabled:j||r,style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Remove"]})]}),e.jsxs("small",{className:"text-muted d-block mt-2",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Max 5MB. Formats: JPG, PNG, GIF"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-user mr-2"}),"User Information"]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Full Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:"form-control form-control-sm",value:i,onChange:t=>p(t.target.value),placeholder:"Enter full name",disabled:r,style:{fontSize:"0.85rem"}})]}),e.jsxs("div",{className:"form-group mb-0",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Email Address",e.jsx(P,{bg:"secondary",className:"ml-2",style:{fontSize:"0.6rem"},children:"Read-only"})]}),e.jsx("input",{type:"email",className:"form-control form-control-sm",value:s.email,disabled:!0,readOnly:!0,style:{fontSize:"0.85rem",background:"#e9ecef"}})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-key mr-2"}),"Password",e.jsx(P,{bg:"info",className:"ml-2",style:{fontSize:"0.6rem"},children:"Optional"})]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"input-group input-group-sm mb-2",children:[e.jsx("input",{type:k?"text":"password",className:"form-control",value:d,onChange:t=>D(t.target.value),placeholder:"Leave empty to keep current",disabled:r,style:{fontSize:"0.85rem"}}),e.jsxs("div",{className:"input-group-append",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>A(!k),disabled:r,children:e.jsx("i",{className:`fas ${k?"fa-eye-slash":"fa-eye"}`})}),e.jsx("button",{type:"button",className:"btn btn-outline-info",onClick:O,disabled:r,title:"Generate password",children:e.jsx("i",{className:"fas fa-random"})})]})]}),d&&e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("small",{className:"text-muted mr-2",style:{fontSize:"0.75rem"},children:"Strength:"}),e.jsx("div",{className:"progress flex-grow-1",style:{height:"4px"},children:e.jsx("div",{className:`progress-bar bg-${b.color}`,style:{width:`${b.strength}%`}})}),e.jsx("small",{className:`ml-2 text-${b.color}`,style:{fontSize:"0.75rem"},children:b.label})]})}),d&&e.jsx("div",{className:"p-2",style:{background:"#fff5f5",borderRadius:"6px",borderLeft:"3px solid #dc3545"},children:e.jsxs("small",{className:"text-danger",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),"Password will be changed on save"]})})]})]})]}),e.jsxs("div",{className:"modal-footer border-0 py-2",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"0.7rem"},children:[s.id?.substring(0,12),"..."]})]}),e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm mr-2",onClick:L,disabled:r,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:F,disabled:r||j||!q,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-1"}),"Save"]})})]})]})})})]})},Ee=({user:s,isOpen:U,onClose:C,onUserDeleted:h})=>{const[i,p]=n.useState(""),[r,x]=n.useState(!1),[u,v]=n.useState(""),{showSuccessToast:j,showErrorToast:$}=ne(),y=async()=>{if(s){if(i!=="DELETE"){v("Please type 'DELETE' to confirm");return}x(!0),v("");try{const{error:d}=await E.auth.admin.deleteUser(s.id);if(d)throw d;j("User deleted successfully"),h(s.id),g()}catch(d){console.error("Error deleting user:",d),v(d.message||"Failed to delete user"),$("Failed to delete user")}finally{x(!1)}}},g=()=>{p(""),v(""),C()};if(!U||!s)return null;const w=i==="DELETE",l=Math.floor((Date.now()-new Date(s.created_at).getTime())/(1e3*60*60*24));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:g}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:g,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered",onClick:d=>d.stopPropagation(),style:{margin:"0 auto"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:window.innerWidth<768?"0":"12px",overflow:"hidden",maxHeight:window.innerWidth<768?"100vh":"85vh",minHeight:window.innerWidth<768?"100vh":"auto"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 md:py-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:window.innerWidth<768?"32px":"40px",height:window.innerWidth<768?"32px":"40px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:`fas fa-trash-alt ${window.innerWidth<768?"":"fa-lg"}`})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-sm md:text-base",children:"Delete User"}),e.jsx("small",{className:"d-block truncate",style:{opacity:.9,fontSize:window.innerWidth<768?"0.7rem":"0.8rem"},children:"This action cannot be undone"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:g,disabled:r,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsxs("div",{className:"modal-body py-3",style:{maxHeight:"60vh",overflowY:"auto"},children:[u&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),u]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#fff5f5",borderRadius:"8px",borderLeft:"3px solid #dc3545"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-danger mr-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-danger",style:{fontSize:"0.9rem"},children:"Permanent Deletion"}),e.jsx("p",{className:"mb-0 text-muted",style:{fontSize:"0.8rem"},children:"This will permanently remove the user account and all associated data including transactions, budgets, goals, and family associations."})]})]})}),e.jsxs("div",{className:"p-3 mb-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsxs("div",{className:"position-relative mr-2",children:[e.jsx("img",{src:s.user_metadata?.avatar_url||"../images/placeholder.png",alt:s.user_metadata?.full_name||"User",className:"rounded-circle",style:{width:"50px",height:"50px",objectFit:"cover",border:"2px solid #dc3545"},onError:d=>{d.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:"position-absolute d-flex align-items-center justify-content-center",style:{bottom:"-2px",right:"-2px",width:"20px",height:"20px",background:"#dc3545",borderRadius:"50%",border:"2px solid white"},children:e.jsx("i",{className:"fas fa-times text-white",style:{fontSize:"0.6rem"}})})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.9rem"},children:s.user_metadata?.full_name||"Unknown User"}),e.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem"},children:s.email})]})]}),e.jsxs("div",{className:"row text-center g-2",children:[e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"p-2",style:{background:"white",borderRadius:"6px"},children:[e.jsx("div",{className:"text-danger font-weight-bold",style:{fontSize:"0.95rem"},children:l}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:"Days Member"})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"p-2",style:{background:"white",borderRadius:"6px"},children:[e.jsx(P,{bg:s.status==="active"?"success":"secondary",style:{fontSize:"0.7rem"},children:s.status||"Inactive"}),e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"Status"})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"p-2",style:{background:"white",borderRadius:"6px"},children:[e.jsx(P,{bg:s.email_confirmed_at?"info":"warning",style:{fontSize:"0.7rem"},children:s.email_confirmed_at?"Verified":"Pending"}),e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:"Email"})]})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-list mr-2"}),"Data to be removed:"]}),e.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:[{icon:"fa-user",label:"Account"},{icon:"fa-database",label:"Profile"},{icon:"fa-exchange-alt",label:"Transactions"},{icon:"fa-wallet",label:"Budgets"},{icon:"fa-bullseye",label:"Goals"},{icon:"fa-users",label:"Family Data"}].map((d,D)=>e.jsxs("span",{className:"badge badge-light px-2 py-1",style:{fontSize:"0.75rem",border:"1px solid #dee2e6"},children:[e.jsx("i",{className:`fas ${d.icon} text-danger mr-1`}),d.label]},D))})]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("label",{className:"mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-keyboard text-danger mr-2"}),"Type ",e.jsx("strong",{className:"text-danger",children:"DELETE"})," to confirm:"]}),e.jsx("input",{type:"text",className:`form-control form-control-sm ${i&&!w?"is-invalid":""}`,placeholder:"Type 'DELETE' to confirm",value:i,onChange:d=>p(d.target.value),disabled:r,style:{fontSize:"0.85rem"},autoComplete:"off"}),i&&!w&&e.jsx("div",{className:"invalid-feedback",style:{fontSize:"0.75rem"},children:'Please type "DELETE" exactly as shown above.'})]})]}),e.jsxs("div",{className:"modal-footer border-0 py-2",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"0.7rem"},children:[s.id?.substring(0,12),"..."]})]}),e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm mr-2",onClick:g,disabled:r,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm",onClick:y,disabled:r||!w,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-trash-alt mr-1"}),"Delete"]})})]})]})})})]})},$e=({user:s,isOpen:U,onClose:C,onRoleUpdated:h,isCurrentlyAdmin:i})=>{const[p,r]=n.useState(!1),[x,u]=n.useState(""),{showSuccessToast:v,showErrorToast:j}=ne(),$=async()=>{if(s){r(!0),u("");try{i?(await _e(s.id),v("Admin role removed successfully"),h(s.id,!1)):(await ze(s.id),v("Admin role granted successfully"),h(s.id,!0)),C()}catch(d){console.error("Error updating admin role:",d),u(d.message||"Failed to update admin role"),j("Failed to update admin role")}finally{r(!1)}}},y=()=>{u(""),C()};if(!U||!s)return null;const g=i?"Remove Admin Role":"Grant Admin Role",w=i?"fa-user-minus":"fa-user-shield",l=i?"#fd7e14":"#17a2b8";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:y}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:y,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered",onClick:d=>d.stopPropagation(),style:{margin:"0 auto"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:window.innerWidth<768?"0":"12px",overflow:"hidden",maxHeight:window.innerWidth<768?"100vh":"85vh",minHeight:window.innerWidth<768?"100vh":"auto"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 md:py-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:window.innerWidth<768?"32px":"40px",height:window.innerWidth<768?"32px":"40px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:`fas ${w} ${window.innerWidth<768?"":"fa-lg"}`})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-sm md:text-base",children:g}),e.jsx("small",{className:"d-block truncate",style:{opacity:.9,fontSize:window.innerWidth<768?"0.7rem":"0.8rem"},children:"Administrative permissions"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:y,disabled:p,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsx("div",{className:"px-3 py-2",style:{background:"#f8f9fa",borderBottom:"1px solid #e9ecef"},children:e.jsxs("div",{className:"row text-center g-2",children:[e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${i?"fa-shield-alt":"fa-user"} mr-2`,style:{color:i?"#dc3545":"#007bff"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Current"}),e.jsx("strong",{style:{fontSize:"0.8rem",color:i?"#dc3545":"#007bff"},children:i?"Admin":"User"})]})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-arrow-right text-muted mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Action"}),e.jsx("strong",{style:{fontSize:"0.8rem",color:l},children:i?"Demote":"Promote"})]})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${i?"fa-user":"fa-shield-alt"} mr-2`,style:{color:i?"#007bff":"#dc3545"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"New Role"}),e.jsx("strong",{style:{fontSize:"0.8rem",color:i?"#007bff":"#dc3545"},children:i?"User":"Admin"})]})]})})]})}),e.jsxs("div",{className:"modal-body py-3",style:{maxHeight:"55vh",overflowY:"auto"},children:[x&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),x]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"position-relative mr-3",children:[e.jsx("img",{src:s.user_metadata?.avatar_url||"../images/placeholder.png",alt:s.user_metadata?.full_name||"User",className:"rounded-circle",style:{width:"60px",height:"60px",objectFit:"cover",border:`3px solid ${i?"#dc3545":"#007bff"}`},onError:d=>{d.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:"position-absolute d-flex align-items-center justify-content-center",style:{bottom:"-2px",right:"-2px",width:"22px",height:"22px",background:i?"#dc3545":"#007bff",borderRadius:"50%",border:"2px solid white"},children:e.jsx("i",{className:`fas ${i?"fa-shield-alt":"fa-user"} text-white`,style:{fontSize:"0.6rem"}})})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1 font-weight-bold",children:s.user_metadata?.full_name||"Unknown User"}),e.jsx("p",{className:"text-muted mb-1",style:{fontSize:"0.8rem"},children:s.email}),e.jsxs(P,{bg:i?"danger":"primary",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:`fas ${i?"fa-shield-alt":"fa-user"} mr-1`}),i?"Administrator":"Regular User"]})]})]})}),e.jsx("div",{className:"p-3 mb-3",style:{background:i?"rgba(253, 126, 20, 0.1)":"rgba(23, 162, 184, 0.1)",borderRadius:"8px",borderLeft:`3px solid ${l}`},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:`fas ${i?"fa-exclamation-triangle":"fa-info-circle"} mr-2 mt-1`,style:{color:l}}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:l,fontSize:"0.9rem"},children:g}),e.jsx("p",{className:"mb-0 text-muted",style:{fontSize:"0.8rem"},children:i?"This user will lose administrative privileges and access to admin features.":"This user will gain full administrative access to the system."})]})]})}),e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-key mr-2"}),i?"Permissions to be Removed:":"Permissions to be Granted:"]}),e.jsx("div",{className:"row g-2",children:[{icon:"fa-users",color:"primary",title:"User Management",items:["View all users","Create/edit users","Manage roles"]},{icon:"fa-chart-bar",color:"success",title:"Analytics",items:["Admin dashboard","System stats","Reports"]},{icon:"fa-cog",color:"warning",title:"Settings",items:["System config","Integrations","Security"]},{icon:"fa-database",color:"info",title:"Data",items:["Database admin","Backups","Exports"]}].map((d,D)=>e.jsx("div",{className:"col-6 mb-2",children:e.jsxs("div",{className:"p-2 h-100",style:{background:"#f8f9fa",borderRadius:"6px"},children:[e.jsxs("div",{className:"d-flex align-items-center mb-1",children:[e.jsx("i",{className:`fas ${d.icon} text-${d.color} mr-2`,style:{fontSize:"0.8rem"}}),e.jsx("strong",{style:{fontSize:"0.8rem"},children:d.title})]}),e.jsx("div",{style:{fontSize:"0.7rem"},children:d.items.map((k,A)=>e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:`fas ${i?"fa-minus":"fa-plus"} mr-1`,style:{fontSize:"0.6rem",color:i?"#dc3545":"#28a745"}}),k]},A))})]})},D))}),!i&&e.jsx("div",{className:"mt-3 p-2",style:{background:"#f8f9fa",borderRadius:"6px"},children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-shield-alt mr-1 text-secondary"}),e.jsx("strong",{children:"Security Notice:"})," Admin privileges should only be granted to trusted users. This action will be logged."]})})]}),e.jsxs("div",{className:"modal-footer border-0 py-2",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-clock mr-1"}),"Changes take effect immediately"]}),e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm mr-2",onClick:y,disabled:p,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:`btn btn-sm ${i?"btn-warning":"btn-danger"}`,onClick:$,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${w} mr-1`}),i?"Remove Admin":"Grant Admin"]})})]})]})})})]})},Me=({show:s,onClose:U,title:C,color:h,icon:i,data:p})=>s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:U}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:U,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",onClick:r=>r.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",children:[e.jsxs("div",{className:"modal-header bg-gradient-danger text-white border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center",children:[e.jsx("div",{className:"modal-icon-container mr-3",children:e.jsx("i",{className:`fas ${i}`})}),e.jsxs("div",{children:[e.jsx("div",{className:"modal-title-main",children:C}),e.jsx("div",{className:"modal-subtitle",children:"Detailed breakdown"})]})]}),e.jsx("button",{type:"button",className:"close text-white",onClick:U,style:{textShadow:"none",opacity:.9},children:e.jsx("span",{children:""})})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"stats-breakdown-list",children:p.map((r,x)=>e.jsxs("div",{className:"stats-breakdown-item d-flex justify-content-between align-items-center py-3 border-bottom",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-medium text-gray-800",children:r.label}),r.subLabel&&e.jsx("small",{className:"text-muted",children:r.subLabel})]}),e.jsx("span",{className:`badge badge-${h} badge-pill px-3 py-2`,children:r.value})]},x))})}),e.jsx("div",{className:"modal-footer bg-light border-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsx("div",{className:"modal-footer-info",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Data reflects current statistics"]})}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:U,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})})]})})})]}):null,Le=()=>{const[s,U]=n.useState([]),[C,h]=n.useState(!0),[i,p]=n.useState(!1),[r,x]=n.useState(1),[u,v]=n.useState(1),[j,$]=n.useState(0),[y,g]=n.useState(""),[w,l]=n.useState("all"),[d,D]=n.useState("all"),[k,A]=n.useState([]),[T,ae]=n.useState(10),[Q,te]=n.useState(new Date),[V,O]=n.useState(null),[I,F]=n.useState(null),[L,q]=n.useState(!1),[b,t]=n.useState(!1),[m,S]=n.useState(!1),[R,W]=n.useState(!1),[X,ce]=n.useState(!1),[M,Y]=n.useState({show:!1,title:"",color:"",icon:"",data:[]}),{showSuccessToast:je,showErrorToast:fe}=ne(),pe=n.useCallback(async(c,o)=>{if(!(!o.avatar_url&&!o.full_name))try{const N={};o.avatar_url&&(N.avatar_url=o.avatar_url),o.full_name&&(N.full_name=o.full_name),N.updated_at=new Date().toISOString(),await E.from("profiles").update(N).eq("id",c),console.log(`Synced profile for user ${c}:`,N)}catch(N){console.error(`Failed to sync profile for user ${c}:`,N)}},[]),le=n.useCallback(async(c=!0)=>{c&&h(!0);try{let o=E.from("profiles").select(`
          id,
          email,
          full_name,
          avatar_url,
          role,
          is_active,
          created_at,
          last_login,
          email_verified,
          currency_preference
        `,{count:"exact"});y&&(o=o.or(`full_name.ilike.%${y}%,email.ilike.%${y}%`)),w!=="all"&&(o=o.eq("role",w)),d!=="all"&&(o=o.eq("is_active",d==="active"));const N=(r-1)*T;o=o.range(N,N+T-1).order("created_at",{ascending:!1});const{data:H,error:B,count:K}=await o;if(B)throw B;const J=(H||[]).map(_=>_.id);let se=[];if(J.length>0)try{console.log("Fetching auth user data for IDs:",J);const _=J.map(async a=>{const{data:z,error:f}=await E.auth.admin.getUserById(a);return f?(console.warn(`Failed to fetch auth data for user ${a}:`,f),null):(console.log(`Auth user ${a}:`,z.user),z.user)});se=(await Promise.all(_)).filter(a=>a!==null),console.log("Fetched auth users data:",se.length,"users")}catch(_){console.error("Error fetching auth users:",_)}const he=(H||[]).map(_=>{const ee=se.find(Se=>Se.id===_.id),a=ee?.user_metadata||{};console.log(`User ${_.email} avatar data:`,{authMetadata_avatar_url:a.avatar_url,profiles_avatar_url:_.avatar_url,user_metadata_full:a});const z=a.full_name||_.full_name||a.name||(a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:null)||_.email?.split("@")[0]||"Unnamed User",f=a.avatar_url||"../images/placeholder.png";return a.avatar_url&&_.avatar_url!==a.avatar_url&&pe(_.id,a),{..._,status:_.is_active?"active":"inactive",last_sign_in_at:ee?.last_sign_in_at||_.last_login,email_confirmed_at:ee?.email_confirmed_at||(_.email_verified?new Date().toISOString():null),user_metadata:{full_name:z,avatar_url:f},total_sessions:0,active_sessions:0,last_session_login:null}});U(he),$(K||0),v(Math.ceil((K||0)/T)),te(new Date)}catch(o){console.error("Error fetching users:",o),fe("Failed to fetch users")}finally{c&&h(!1)}},[r,y,w,d,T,fe]),ie=n.useCallback(async()=>{try{const c=await Ue();A(c)}catch(c){console.error("Error fetching admin users:",c)}},[]),ue=n.useCallback(async()=>{p(!0),await Promise.all([le(!1),ie()]),p(!1)},[le,ie]);n.useEffect(()=>{le()},[le]),n.useEffect(()=>{ie()},[ie]),n.useEffect(()=>{const c=o=>{V&&!o.target.closest(".dropdown-menu")&&G()};if(V)return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[V]);const de=c=>{F(c),t(!0)},oe=c=>{F(c),S(!0)},me=c=>{F(c),W(!0)},xe=c=>{F(c),ce(!0)},G=()=>{O(null)},ge=c=>{O(V===c?null:c)},re=()=>{F(null),t(!1),S(!1),W(!1),ce(!1),q(!1)},Ne=c=>{U(o=>o.map(N=>N.id===c.id?c:N))},ve=c=>{U(o=>o.filter(N=>N.id!==c)),$(o=>o-1)},ye=(c,o)=>{A(o?N=>[...N,c]:N=>N.filter(H=>H!==c))},we=()=>{le(),ie()},ke=async(c,o)=>{try{const{error:N}=await E.from("profiles").update({is_active:o==="active"}).eq("id",c.id);if(N)throw N;U(H=>H.map(B=>B.id===c.id?{...B,status:o,is_active:o==="active"}:B)),je(`User status updated to ${o}`)}catch(N){console.error("Error updating user status:",N),fe("Failed to update user status")}};return C?e.jsxs("div",{className:"user-management modern-user-management",children:[e.jsx("div",{className:"block md:hidden py-12 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading user management..."})]})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("div",{className:"user-management-header mb-4",children:[e.jsx("div",{className:"skeleton-line skeleton-header-title mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-header-subtitle"})]}),e.jsx("div",{className:"row mb-4",children:Array.from({length:4}).map((c,o)=>e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-3",children:e.jsx("div",{className:"card shadow h-100 py-3 admin-card admin-card-loading",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"skeleton-line skeleton-stat-value mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-stat-title"})]})})},o))}),e.jsx("div",{className:"controls-section mb-4",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"skeleton-line skeleton-search-bar"})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"skeleton-line skeleton-filter"})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"skeleton-line skeleton-filter"})})]})}),e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"skeleton-line skeleton-table-header"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered admin-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Array.from({length:6}).map((c,o)=>e.jsx("th",{children:e.jsx("div",{className:"skeleton-line skeleton-th"})},o))})}),e.jsx("tbody",{children:Array.from({length:5}).map((c,o)=>e.jsx("tr",{children:Array.from({length:6}).map((N,H)=>e.jsx("td",{children:e.jsx("div",{className:"skeleton-line skeleton-td"})},H))},o))})]})})})]})]})]}):e.jsxs("div",{className:"user-management modern-user-management",children:[e.jsx("div",{className:"block md:hidden mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-base font-bold text-gray-800",children:"User Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ue,className:"w-9 h-9 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95 disabled:opacity-50",disabled:i,"aria-label":"Refresh data",children:e.jsx("i",{className:`fas fa-sync text-xs ${i?"fa-spin":""}`})}),e.jsx("button",{onClick:()=>q(!0),className:"w-9 h-9 rounded-full bg-rose-600 hover:bg-rose-700 text-white flex items-center justify-center shadow-md transition-all active:scale-95","aria-label":"Add user",children:e.jsx("i",{className:"fas fa-user-plus text-xs"})})]})]})}),e.jsx("div",{className:"user-management-header mb-5 hidden md:block",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start flex-wrap",children:[e.jsx("div",{className:"header-content",children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"header-icon-container mr-3",children:e.jsx("i",{className:"fas fa-users"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"header-title mb-1",children:"User Management"}),e.jsx("p",{className:"header-subtitle mb-0",children:"Manage user accounts, roles, and permissions across the platform"})]})]})}),e.jsxs("div",{className:"header-actions d-flex align-items-center",children:[e.jsx("div",{className:"last-updated-info mr-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Last updated: ",Q.toLocaleTimeString()]})}),e.jsxs("button",{className:"btn btn-outline-danger btn-sm shadow-sm refresh-btn mr-2",onClick:ue,disabled:i,children:[e.jsx("i",{className:`fas fa-sync-alt mr-1 ${i?"fa-spin":""}`}),i?"Updating...":"Refresh"]}),e.jsxs("button",{className:"btn btn-danger btn-sm shadow-sm",onClick:()=>q(!0),children:[e.jsx("i",{className:"fas fa-user-plus mr-1"}),"Add User"]})]})]})}),e.jsx("div",{className:"stats-section mb-5",children:(()=>{const c=s.filter(a=>a.status==="active").length,o=s.filter(a=>!a.last_sign_in_at).length,N=j>0?(c/j*100).toFixed(1):0,H=j>0?(k.length/j*100).toFixed(1):0,B=j>0?(o/j*100).toFixed(1):0,K=j-c,J=j-k.length,se=()=>{Y({show:!0,title:"Total Users Breakdown",color:"danger",icon:"fa-users",data:[{label:"Total Users",value:j},{label:"Active Users",value:c,subLabel:`${N}% of total`},{label:"Inactive Users",value:K,subLabel:`${(100-Number(N)).toFixed(1)}% of total`},{label:"Administrators",value:k.length},{label:"Regular Users",value:J}]})},he=()=>{Y({show:!0,title:"Active Users Breakdown",color:"success",icon:"fa-user-check",data:[{label:"Active Users",value:c},{label:"Percentage of Total",value:`${N}%`},{label:"Inactive Users",value:K},{label:"Active Admins",value:k.filter(a=>s.find(z=>z.id===a)?.status==="active").length}]})},_=()=>{Y({show:!0,title:"Administrators Breakdown",color:"warning",icon:"fa-user-shield",data:[{label:"Total Administrators",value:k.length},{label:"Percentage of Total",value:`${H}%`},{label:"Regular Users",value:J},{label:"Admin to User Ratio",value:`1:${J>0?Math.round(J/k.length):0}`}]})},ee=()=>{Y({show:!0,title:"Never Logged In Breakdown",color:"info",icon:"fa-user-clock",data:[{label:"Never Logged In",value:o},{label:"Percentage of Total",value:`${B}%`},{label:"Users Who Logged In",value:j-o},{label:"Activation Rate",value:`${(100-Number(B)).toFixed(1)}%`}]})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:se,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-red-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-users text-red-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Total Users"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:Z(j)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-gray-400",children:[e.jsx("i",{className:"fas fa-users text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium",children:[K," inactive"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:he,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-user-check text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Active Users"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:Z(c)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-emerald-500",children:[e.jsx("i",{className:"fas fa-arrow-up text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium",children:[N,"% of total"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:_,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-user-shield text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Administrators"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:Z(k.length)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-amber-500",children:[e.jsx("i",{className:"fas fa-shield-alt text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium",children:[H,"% of total"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:ee,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-user-clock text-blue-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Never Logged In"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:Z(o)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-blue-500",children:[e.jsx("i",{className:"fas fa-clock text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium",children:[B,"% pending"]})]})]})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-danger h-100 position-relative",onClick:se,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-danger text-uppercase mb-2",children:"Total Users"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:Z(j)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-muted",children:[e.jsx("i",{className:"fas fa-users mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[K," inactive"]})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-danger",children:e.jsx("i",{className:"fas fa-users stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-danger",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-success h-100 position-relative",onClick:he,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-success text-uppercase mb-2",children:"Active Users"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:Z(c)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-success",children:[e.jsx("i",{className:"fas fa-arrow-up mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[N,"%"]}),e.jsx("span",{className:"ml-1 small",children:"of total"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-success",children:e.jsx("i",{className:"fas fa-user-check stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-success",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-warning h-100 position-relative",onClick:_,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-warning text-uppercase mb-2",children:"Administrators"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:Z(k.length)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-warning",children:[e.jsx("i",{className:"fas fa-shield-alt mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[H,"%"]}),e.jsx("span",{className:"ml-1 small",children:"of total"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-warning",children:e.jsx("i",{className:"fas fa-user-shield stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-warning",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-info h-100 position-relative",onClick:ee,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-info text-uppercase mb-2",children:"Never Logged In"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:Z(o)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-info",children:[e.jsx("i",{className:"fas fa-clock mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[B,"%"]}),e.jsx("span",{className:"ml-1 small",children:"pending"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-info",children:e.jsx("i",{className:"fas fa-user-clock stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-info",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})})]}),e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-users text-red-500 text-[10px]"}),"User List",j>0&&e.jsx("span",{className:"bg-red-100 text-red-600 px-1.5 py-0.5 rounded-full text-[9px]",children:j})]}),e.jsxs("button",{className:"text-[10px] text-gray-500 flex items-center gap-1",onClick:()=>{g(""),l("all"),D("all")},children:[e.jsx("i",{className:"fas fa-undo text-[8px]"}),"Reset"]})]}),e.jsxs("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-[10px]"}),e.jsx("input",{type:"text",className:"w-full pl-8 pr-3 py-2 text-xs bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",placeholder:"Search users...",value:y,onChange:a=>g(a.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"flex-1 px-2 py-1.5 text-[10px] bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",value:w,onChange:a=>l(a.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"user",children:"Users"})]}),e.jsxs("select",{className:"flex-1 px-2 py-1.5 text-[10px] bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",value:d,onChange:a=>D(a.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsx("div",{className:"divide-y divide-gray-100 max-h-[60vh] overflow-y-auto",children:s.length>0?s.map(a=>{const z=k.includes(a.id);return e.jsx("div",{className:"px-3 py-3 hover:bg-gray-50 active:bg-gray-100 transition-colors",onClick:()=>de(a),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:a.user_metadata?.avatar_url||"../images/placeholder.png",alt:a.user_metadata?.full_name||"User",className:"w-10 h-10 rounded-full object-cover border-2 border-gray-200",onError:f=>{f.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ${a.status==="active"?"bg-emerald-500":"bg-gray-400"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-800 truncate",children:a.user_metadata?.full_name||"Unnamed User"}),z&&e.jsx("span",{className:"flex-shrink-0 px-1 py-0.5 bg-red-100 text-red-600 rounded text-[8px] font-semibold",children:"ADMIN"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 truncate",children:a.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-[8px] font-medium ${a.status==="active"?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-600"}`,children:a.status?a.status.charAt(0).toUpperCase()+a.status.slice(1):"Inactive"}),a.email_confirmed_at&&e.jsxs("span",{className:"text-[8px] text-blue-500 flex items-center gap-0.5",children:[e.jsx("i",{className:"fas fa-check-circle"}),"Verified"]})]})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"w-7 h-7 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 transition-colors",onClick:f=>{f.stopPropagation(),ge(a.id)},onTouchEnd:f=>{f.stopPropagation(),ge(a.id)},"aria-label":"More actions",children:e.jsx("i",{className:"fas fa-ellipsis-v text-[10px]"})}),V===a.id&&e.jsxs("div",{className:"dropdown-menu fixed w-32 bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden",style:{display:"block",zIndex:9999,transform:"translateX(-100px) translateY(4px)"},children:[e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-gray-50 active:bg-gray-100 flex items-center gap-2 transition-colors",onClick:f=>{f.stopPropagation(),G(),de(a)},onTouchEnd:f=>{f.stopPropagation(),G(),de(a)},children:[e.jsx("i",{className:"fas fa-eye text-gray-500 text-[10px]"}),e.jsx("span",{className:"text-gray-700",children:"View"})]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-gray-50 active:bg-gray-100 flex items-center gap-2 transition-colors",onClick:f=>{f.stopPropagation(),G(),oe(a)},onTouchEnd:f=>{f.stopPropagation(),G(),oe(a)},children:[e.jsx("i",{className:"fas fa-edit text-gray-500 text-[10px]"}),e.jsx("span",{className:"text-gray-700",children:"Edit"})]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-gray-50 active:bg-gray-100 flex items-center gap-2 transition-colors",onClick:f=>{f.stopPropagation(),G(),xe(a)},onTouchEnd:f=>{f.stopPropagation(),G(),xe(a)},children:[e.jsx("i",{className:`fas ${k.includes(a.id)?"fa-user-minus":"fa-user-shield"} text-gray-500 text-[10px]`}),e.jsx("span",{className:"text-gray-700",children:k.includes(a.id)?"Remove Admin":"Make Admin"})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-red-50 active:bg-red-100 flex items-center gap-2 transition-colors",onClick:f=>{f.stopPropagation(),G(),me(a)},onTouchEnd:f=>{f.stopPropagation(),G(),me(a)},children:[e.jsx("i",{className:"fas fa-trash text-red-500 text-[10px]"}),e.jsx("span",{className:"text-red-600",children:"Delete"})]})]})]})})]})},a.id)}):e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-3",children:e.jsx("i",{className:"fas fa-users text-gray-400 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"No users found"}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Try adjusting your filters"})]})}),u>1&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-100 bg-gray-50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-gray-500",children:["Page ",r," of ",u]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>x(a=>Math.max(a-1,1)),disabled:r===1,children:e.jsx("i",{className:"fas fa-chevron-left text-[10px]"})}),e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-[10px] font-medium rounded-lg min-w-[24px] text-center",children:r}),e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>x(a=>Math.min(a+1,u)),disabled:r===u,children:e.jsx("i",{className:"fas fa-chevron-right text-[10px]"})})]})]})]})}),e.jsx("div",{className:"controls-section mb-4 hidden md:block",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6 col-lg-4 mb-3 mb-md-0",children:e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"input-group",children:[e.jsx("div",{className:"input-group-prepend",children:e.jsx("span",{className:"input-group-text bg-white border-right-0",children:e.jsx("i",{className:"fas fa-search text-muted"})})}),e.jsx("input",{type:"text",className:"form-control border-left-0 modern-input",placeholder:"Search users by name or email...",value:y,onChange:a=>g(a.target.value)})]})})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsxs("select",{className:"form-control modern-select",value:w,onChange:a=>l(a.target.value),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"admin",children:"Administrators"}),e.jsx("option",{value:"user",children:"Regular Users"})]})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsxs("select",{className:"form-control modern-select",value:d,onChange:a=>D(a.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})}),e.jsx("div",{className:"col-md-12 col-lg-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"page-size-selector",children:[e.jsx("small",{className:"text-muted mr-2",children:"Show:"}),e.jsxs("select",{className:"form-control form-control-sm d-inline-block w-auto",value:T,onChange:a=>ae(Number(a.target.value)),children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("small",{className:"text-muted ml-2",children:"per page"})]}),(y||w!=="all"||d!=="all")&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>{g(""),l("all"),D("all")},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Clear Filters"]})]})})]})})})}),e.jsx("div",{className:"table-section hidden md:block",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header bg-white border-0 py-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-danger",children:[e.jsx("i",{className:"fas fa-table mr-2"}),"Users (",j,")"]}),e.jsx("div",{className:"table-actions",children:e.jsxs("small",{className:"text-muted",children:["Showing ",Math.min((r-1)*T+1,j)," to ",Math.min(r*T,j)," of ",j," entries"]})})]})}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover modern-table mb-0",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0",children:"User"}),e.jsx("th",{className:"border-0",children:"Email"}),e.jsx("th",{className:"border-0",children:"Status"}),e.jsx("th",{className:"border-0",children:"Role"}),e.jsx("th",{className:"border-0",children:"Last Login"}),e.jsx("th",{className:"border-0 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:s.length>0?s.map(a=>{const z=k.includes(a.id);return e.jsxs("tr",{className:"table-row",children:[e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"user-avatar-container mr-3",children:[e.jsx("img",{src:a.user_metadata?.avatar_url||"../images/placeholder.png",alt:a.user_metadata?.full_name||"User",className:"user-table-avatar",onError:f=>{f.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:`user-status-dot status-${a.status||"inactive"}`})]}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name font-weight-medium",children:a.user_metadata?.full_name||"Unnamed User"}),e.jsxs("div",{className:"user-id text-muted small",children:["ID: ",a.id.substring(0,8),"..."]})]})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"user-email",children:[a.email,a.email_confirmed_at&&e.jsx("i",{className:"fas fa-check-circle text-success ml-2",title:"Verified"})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:`status-badge status-${a.status||"inactive"}`,children:[e.jsx("i",{className:`fas ${a.status==="active"?"fa-check-circle":a.status==="suspended"?"fa-ban":"fa-pause-circle"} mr-1`}),a.status?a.status.charAt(0).toUpperCase()+a.status.slice(1):"Inactive"]})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:`role-badge ${z?"role-admin":"role-user"}`,children:[e.jsx("i",{className:`fas ${z?"fa-shield-alt":"fa-user"} mr-1`}),z?"Administrator":"User"]})}),e.jsx("td",{className:"py-3",children:e.jsx("div",{className:"last-login",children:a.last_sign_in_at?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"login-date",children:new Date(a.last_sign_in_at).toLocaleDateString()}),e.jsx("div",{className:"login-time text-muted small",children:new Date(a.last_sign_in_at).toLocaleTimeString()})]}):e.jsx("span",{className:"text-muted",children:"Never"})})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary mr-1",onClick:()=>de(a),title:"View Details",children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary mr-1",onClick:()=>oe(a),title:"Edit User",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{className:`btn btn-sm ${z?"btn-outline-warning":"btn-outline-info"} mr-1`,onClick:()=>xe(a),title:z?"Remove Admin":"Make Admin",children:e.jsx("i",{className:`fas ${z?"fa-user-minus":"fa-user-shield"}`})}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>me(a),title:"Delete User",children:e.jsx("i",{className:"fas fa-trash"})})]})})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-5",children:e.jsxs("div",{className:"no-users-container",children:[e.jsx("i",{className:"fas fa-users fa-3x text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No users found"}),e.jsx("p",{className:"text-muted",children:"Try adjusting your search or filter criteria"}),(y||w!=="all"||d!=="all")&&e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>{g(""),l("all"),D("all")},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Clear Filters"]})]})})})})]})})}),u>1&&e.jsx("div",{className:"card-footer bg-white border-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{className:"pagination-info",children:e.jsxs("small",{className:"text-muted",children:["Page ",r," of ",u]})}),e.jsx("nav",{"aria-label":"User pagination",children:e.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[e.jsx("li",{className:`page-item ${r===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(1),disabled:r===1,children:e.jsx("i",{className:"fas fa-angle-double-left"})})}),e.jsx("li",{className:`page-item ${r===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(a=>Math.max(a-1,1)),disabled:r===1,children:e.jsx("i",{className:"fas fa-angle-left"})})}),Array.from({length:Math.min(5,u)},(a,z)=>{let f;return u<=5||r<=3?f=z+1:r>=u-2?f=u-4+z:f=r-2+z,e.jsx("li",{className:`page-item ${r===f?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(f),children:f})},f)}),e.jsx("li",{className:`page-item ${r===u?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(a=>Math.min(a+1,u)),disabled:r===u,children:e.jsx("i",{className:"fas fa-angle-right"})})}),e.jsx("li",{className:`page-item ${r===u?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(u),disabled:r===u,children:e.jsx("i",{className:"fas fa-angle-double-right"})})})]})})]})})]})})]})})()}),e.jsx(Ce,{show:L,onClose:re,onUserAdded:we}),e.jsx(Re,{user:I,isOpen:b,onClose:re,onEdit:oe,onDelete:me,onToggleAdmin:xe,onChangeStatus:ke,isAdmin:I?k.includes(I.id):!1}),e.jsx(De,{user:I,isOpen:m,onClose:re,onUserUpdated:Ne}),e.jsx(Ee,{user:I,isOpen:R,onClose:re,onUserDeleted:ve}),e.jsx($e,{user:I,isOpen:X,onClose:re,onRoleUpdated:ye,isCurrentlyAdmin:I?k.includes(I.id):!1}),e.jsx(Me,{show:M.show,onClose:()=>Y(c=>({...c,show:!1})),title:M.title,color:M.color,icon:M.icon,data:M.data})]})};export{Le as default};
