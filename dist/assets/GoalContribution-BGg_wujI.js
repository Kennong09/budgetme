import{j as e}from"./ui-vendor-Cn1Vfl4w.js";import{i as I,u as L,r as o,L as N}from"./react-vendor-D4A9EtXC.js";import{u as O,b as q,g as U,c as y,f as c,d as V,h as k,s as Y}from"./index-BbApZ7g3.js";import{a as W,P as z}from"./PermissionErrorModal-Dc2W8uaB.js";import{G as X}from"./GoalErrorBoundary-DGeAozu0.js";/* empty css                       */import"./chart-vendor-B0c7K_uV.js";import"./ErrorBoundary-BBG4Eo_2.js";const H=()=>{const{id:g}=I(),b=L(),{user:h}=O(),{showSuccessToast:E,showErrorToast:l}=q(),G=W(),[t,P]=o.useState(null),[F,p]=o.useState(!0),[j,D]=o.useState([]),[r,_]=o.useState({amount:"",account_id:"",notes:"Contribution to goal"}),[C,m]=o.useState(null),[v,x]=o.useState(!1),[R,d]=o.useState("form"),[f,S]=o.useState({isOpen:!1,title:"",message:""});o.useEffect(()=>{(async()=>{try{if(p(!0),!h){l("Please sign in to make contributions"),b("/login");return}const s=await k.fetchGoalById(g,h.id);if(s.error)throw new Error(s.error.message);if(!s.data){l("Goal not found or access denied"),b("/goals");return}const n=s.data;P(n),_(B=>({...B,notes:n&&n.goal_name?`Contribution to ${n.goal_name}`:"Contribution to goal"}));const{data:i,error:A}=await Y.from("accounts").select("*").eq("user_id",h.id);if(A)throw new Error(`Error fetching accounts: ${A.message}`);D(i||[]),p(!1)}catch(s){console.error("Error loading data:",s);const n=s instanceof Error?s.message:"Unknown error occurred";l(`Failed to load data: ${n}`),m(n),p(!1)}})()},[g,h,b,l]);const w=a=>{const{name:s,value:n}=a.target;_(i=>({...i,[s]:n}))},T=a=>{if(a.preventDefault(),m(null),!r.amount||parseFloat(r.amount)<=0){m("Please enter a valid amount greater than zero");return}if(!r.account_id){m("Please select an account");return}const s=parseFloat(r.amount),n=j.find(i=>i.id&&i.id.toString()===r.account_id);if(!n){m("Selected account not found");return}if(n.balance<s){m(`Insufficient funds in ${n.account_name}. Available balance: ${c(n.balance)}`);return}d("review"),window.scrollTo(0,0)},M=async()=>{try{if(x(!0),!h){l("You must be signed in to make contributions"),x(!1),d("form");return}if(!t){l("Goal information is missing"),x(!1),d("form");return}if(t.is_family_goal){const i=await G.validateGoalContribution();if(!i.canContribute){S({isOpen:!0,title:i.errorTitle||"Contribution Access Denied",message:i.errorMessage||"You cannot contribute to family goals.",suggestedActions:i.suggestedActions||["Contact your family admin for assistance"],userRole:i.userRole}),x(!1),d("form");return}}const a=parseFloat(r.amount),s=j.find(i=>i.id&&i.id.toString()===r.account_id);if(!s){l("Selected account not found"),x(!1),d("form");return}if(s.balance<a){l("Insufficient funds in the selected account"),x(!1),d("form");return}const n=await k.createGoalContribution(g,h.id,{amount:a,account_id:r.account_id,notes:r.notes});if(!n.success)throw new Error(n.error||"Failed to create contribution");E("Contribution made successfully!"),setTimeout(()=>{b(`/goals/${g}`)},1e3)}catch(a){console.error("Error making contribution:",a);const s=a instanceof Error?a.message:"Unknown error occurred";l(`Failed to make contribution: ${s}`),m(s),x(!1),d("form")}};if(F)return e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"text-center my-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("h4",{className:"text-gray-800 mt-3 mb-2",children:"Loading goal details..."}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we retrieve your goal information"}),e.jsx("div",{className:"progress mt-4",style:{height:"10px",maxWidth:"300px",margin:"0 auto"},children:e.jsx("div",{className:"progress-bar progress-bar-striped progress-bar-animated",style:{width:"100%"}})})]})});if(!t)return e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"text-center my-5 animate__animated animate__fadeIn",children:[e.jsx("div",{className:"error-icon mb-4",children:e.jsx("i",{className:"fas fa-exclamation-triangle fa-4x text-warning"})}),e.jsx("h1",{className:"h3 mb-3 font-weight-bold text-gray-800",children:"Goal not found"}),e.jsx("p",{className:"mb-4 text-gray-600",children:"The goal you're looking for does not exist or has been deleted."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-600",children:"You can try one of the following:"}),e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-center mt-3",children:[e.jsxs(N,{to:"/goals",className:"btn btn-primary mb-2 mb-md-0 mr-md-3",children:[e.jsx("i",{className:"fas fa-arrow-left mr-2"})," View All Goals"]}),e.jsxs(N,{to:"/goals/create",className:"btn btn-success",children:[e.jsx("i",{className:"fas fa-plus-circle mr-2"})," Create New Goal"]})]})]})]})});const u=t.current_amount/t.target_amount*100,$=t.target_amount-t.current_amount;if(U(t.target_date),R==="review"){const a=j.find(s=>s.id&&s.id.toString()===r.account_id);return e.jsxs("div",{className:"container-fluid animate__animated animate__fadeIn",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Review Contribution"}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs(N,{to:"/goals",className:"btn btn-sm btn-secondary shadow-sm",children:[e.jsx("i",{className:"fas fa-arrow-left fa-sm mr-2"})," Cancel"]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-lg-8 mx-auto",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3 d-flex align-items-center",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Goal Contribution Details"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6 mb-4 mb-md-0",children:e.jsx("div",{className:"card border-left-primary shadow h-100 py-2",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1",children:"Contribution Amount"}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:["₱",parseFloat(r.amount).toFixed(2)]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-solid fa-peso-sign fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"card border-left-success shadow h-100 py-2",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"text-xs font-weight-bold text-success text-uppercase mb-1",children:"From Account"}),e.jsx("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:a?.account_name})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-university fa-2x text-gray-300"})})]})})})})]}),e.jsx("div",{className:"card border-left-info shadow h-100 py-2 mb-4",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"text-xs font-weight-bold text-info text-uppercase mb-1",children:"Contributing To Goal"}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[t.goal_name," (",y(u)," complete)"]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-flag fa-2x text-gray-300"})})]})})}),r.notes&&e.jsx("div",{className:"card bg-light mb-4",children:e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1",children:"Notes"}),e.jsx("p",{className:"mb-0",children:r.notes})]})}),e.jsx("div",{className:"card border-left-warning shadow h-100 py-2 mb-4",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"text-xs font-weight-bold text-warning text-uppercase mb-1",children:"New Goal Progress After Contribution"}),e.jsxs("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:[c(t.current_amount+parseFloat(r.amount))," / ",c(t.target_amount)," "," (",y((t.current_amount+parseFloat(r.amount))/t.target_amount*100),")"]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-chart-line fa-2x text-gray-300"})})]})})}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsxs("button",{onClick:()=>d("form"),className:"btn btn-light btn-icon-split mr-2",children:[e.jsx("span",{className:"icon text-gray-600",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("span",{className:"text",children:"Back to Edit"})]}),e.jsxs("button",{onClick:M,disabled:v,className:"btn btn-success btn-icon-split",children:[e.jsx("span",{className:"icon text-white-50",children:e.jsx("i",{className:v?"fas fa-spinner fa-spin":"fas fa-check"})}),e.jsx("span",{className:"text",children:v?"Processing...":"Confirm Contribution"})]})]})]})]})})})]})}return e.jsxs("div",{className:"container-fluid animate__animated animate__fadeIn",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Make a Contribution"}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs(N,{to:`/goals/${g}`,className:"btn btn-sm btn-secondary shadow-sm",children:[e.jsx("i",{className:"fas fa-arrow-left fa-sm mr-2"})," Back to Goal Details"]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-8",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Contribution Details"})}),e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:T,children:[C&&e.jsxs("div",{className:"alert alert-danger animate__animated animate__shakeX",role:"alert",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),C]}),e.jsxs("div",{className:"form-group mb-4",children:[e.jsx("label",{className:"font-weight-bold text-gray-800",children:"Contributing To Goal"}),e.jsx("div",{className:"card bg-light py-3 shadow-sm",children:e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-flag fa-2x text-primary"})}),e.jsxs("div",{className:"col",children:[e.jsx("h5",{className:"mb-0 font-weight-bold",children:t.goal_name}),e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Current Progress: ",y(u)," •"," ",c(t.current_amount)," of ",c(t.target_amount)]})]})]})})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"amount",className:"font-weight-bold text-gray-800",children:["Amount ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("div",{className:"input-group-prepend",children:e.jsx("span",{className:"input-group-text",children:"₱"})}),e.jsx("input",{type:"number",id:"amount",name:"amount",value:r.amount,onChange:w,className:"form-control form-control-user",placeholder:"0.00",step:"0.01",min:"0",required:!0})]}),e.jsx("small",{className:"form-text text-muted",children:"Enter the amount you want to contribute towards this goal"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"account_id",className:"font-weight-bold text-gray-800",children:["From Account ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{id:"account_id",name:"account_id",value:r.account_id,onChange:w,className:"form-control",required:!0,children:[e.jsx("option",{value:"",children:"Select Account"}),j.filter(a=>a.id).map(a=>e.jsxs("option",{value:a.id.toString(),children:[a.account_name," (",c(a.balance),")"]},a.id))]}),e.jsx("small",{className:"form-text text-muted",children:"Select the account to withdraw funds from"})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"notes",className:"font-weight-bold text-gray-800",children:"Description"}),e.jsx("textarea",{id:"notes",name:"notes",value:r.notes,onChange:w,className:"form-control",rows:3,placeholder:"Add any notes about this contribution"}),e.jsx("small",{className:"form-text text-muted",children:"Briefly describe this contribution (optional)"})]}),e.jsx("hr",{className:"my-4"}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{type:"submit",className:"btn btn-primary btn-icon-split",children:[e.jsx("span",{className:"icon text-white-50",children:e.jsx("i",{className:"fas fa-arrow-right"})}),e.jsx("span",{className:"text",children:"Continue to Review"})]})})]})})]})}),e.jsxs("div",{className:"col-lg-4 d-none d-lg-block",children:[e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Goal Tips"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"rounded-circle p-2 mr-3",style:{backgroundColor:"rgba(78, 115, 223, 0.2)"},children:e.jsx("i",{className:"fas fa-piggy-bank text-primary"})}),e.jsx("p",{className:"font-weight-bold mb-0",children:"Regular Contributions"})]}),e.jsx("p",{className:"text-sm text-muted ml-5",children:"Small regular contributions add up quickly"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"rounded-circle p-2 mr-3",style:{backgroundColor:"rgba(28, 200, 138, 0.2)"},children:e.jsx("i",{className:"fas fa-calendar-check text-success"})}),e.jsx("p",{className:"font-weight-bold mb-0",children:"Set Up Auto-Savings"})]}),e.jsx("p",{className:"text-sm text-muted ml-5",children:"Automate transfers to meet goal deadlines"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"rounded-circle p-2 mr-3",style:{backgroundColor:"rgba(246, 194, 62, 0.2)"},children:e.jsx("i",{className:"fas fa-bolt text-warning"})}),e.jsx("p",{className:"font-weight-bold mb-0",children:"Bonus Contributions"})]}),e.jsx("p",{className:"text-sm text-muted ml-5",children:"Add windfalls or bonuses to accelerate progress"})]})]})]}),e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Goal Summary"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1",children:"Current Progress"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"progress",style:{height:"8px"},children:e.jsx("div",{className:`progress-bar bg-${u>=75?"success":u>=40?"warning":"danger"}`,role:"progressbar",style:{width:`${u>100?100:u}%`},"aria-valuenow":u,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("div",{className:"d-flex justify-content-between mt-1",children:[e.jsx("small",{className:"text-gray-500",children:c(t.current_amount)}),e.jsx("small",{className:"text-gray-500",children:c(t.target_amount)})]})]}),e.jsxs("div",{className:"d-flex justify-content-between mt-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-weight-bold text-gray-500",children:"Remaining"}),e.jsx("div",{className:"font-weight-bold",children:c($)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-weight-bold text-gray-500",children:"Target Date"}),e.jsx("div",{className:"font-weight-bold",children:V(t.target_date)})]})]})]})})]})]})]}),e.jsx(z,{isOpen:f.isOpen,onClose:()=>S({isOpen:!1,title:"",message:""}),errorTitle:f.title,errorMessage:f.message,suggestedActions:f.suggestedActions,userRole:f.userRole})]})};function re(){return e.jsx(X,{children:e.jsx(H,{})})}export{re as default};
