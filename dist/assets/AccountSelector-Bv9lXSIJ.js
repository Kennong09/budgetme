import{j as e}from"./ui-vendor-Cn1Vfl4w.js";import{r}from"./react-vendor-D4A9EtXC.js";import{A as T}from"./accountService-CFCTGWw4.js";import{f as R}from"./currencyUtils-BZq_rNNs.js";import{u as B}from"./index-BbApZ7g3.js";const P=({selectedAccountId:l,onAccountSelect:u,required:i=!1,disabled:n=!1,className:o="",label:c="Account",showBalance:v=!0,showAccountType:D=!0,autoSelectDefault:w=!0})=>{const{user:f}=B(),[d,C]=r.useState([]),[S,h]=r.useState(!0),[b,p]=r.useState(""),[m,g]=r.useState(!1),[j,N]=r.useState(""),[t,x]=r.useState(null),y=d.filter(s=>s.account_name.toLowerCase().includes(j.toLowerCase())||s.account_type.toLowerCase().includes(j.toLowerCase()));r.useEffect(()=>{if(l){const s=d.find(a=>a.id===l);x(s||null)}else x(null)},[l,d]),r.useEffect(()=>{A()},[f?.id]);const A=async()=>{if(!f?.id){h(!1);return}try{h(!0),p("");const s=await T.fetchUserAccounts(f.id);if(s.success&&s.data){if(C(s.data),w&&!l&&s.data.length>0){const L=s.data.find(E=>E.is_default)||s.data[0];u(L)}}else p(s.error||"Failed to load accounts")}catch(s){console.error("Error fetching accounts:",s),p("Failed to load accounts")}finally{h(!1)}},_=s=>{x(s),u(s),g(!1),N("")},$=()=>{x(null),u(null),g(!1),N("")},k=(s,a)=>a==="credit"?s<=0?"text-success":"text-warning":s>=0?"text-success":"text-danger";return S?e.jsxs("div",{className:`form-group ${o}`,children:[c&&e.jsxs("label",{className:"font-weight-bold text-gray-800",children:[c," ",i&&e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"spinner-border spinner-border-sm text-primary mr-2",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("span",{className:"text-muted",children:"Loading accounts..."})]})]}):b?e.jsxs("div",{className:`form-group ${o}`,children:[c&&e.jsxs("label",{className:"font-weight-bold text-gray-800",children:[c," ",i&&e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"alert alert-danger py-2 mb-0",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),b]})]}):d.length===0?e.jsxs("div",{className:`form-group ${o}`,children:[c&&e.jsxs("label",{className:"font-weight-bold text-gray-800",children:[c," ",i&&e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"alert alert-warning py-2 mb-0",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"No accounts available. Please create an account first."]})]}):e.jsxs("div",{className:`form-group selector-container ${o}`,children:[e.jsxs("label",{className:"font-weight-bold text-gray-800",children:[c," ",i&&e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"position-relative",children:[e.jsxs("div",{className:`d-flex align-items-center justify-content-between px-3 py-2 border bg-white ${n?"bg-light":""} ${m?"border-primary":"border-secondary"}`,onClick:()=>!n&&g(!m),style:{cursor:n?"not-allowed":"pointer",borderRadius:"0.375rem",minHeight:"38px"},children:[t?e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("div",{children:e.jsxs("div",{className:"font-weight-medium text-gray-800",children:[t.account_name,t.is_default&&e.jsx("span",{className:"badge badge-success ml-2",children:"Default"})]})})}):e.jsx("span",{className:"text-muted",children:"Select account"}),e.jsxs("div",{className:"d-flex align-items-center",children:[t&&!n&&e.jsx("button",{type:"button",className:"btn btn-sm text-danger mr-2",onClick:s=>{s.stopPropagation(),$()},title:"Clear selection",style:{border:"none",background:"none",padding:"2px 6px"},children:e.jsx("i",{className:"fas fa-times"})}),e.jsx("i",{className:`fas fa-chevron-${m?"up":"down"} text-gray-400`})]})]}),m&&!n&&e.jsxs("div",{className:"position-absolute w-100 bg-white border shadow-lg",style:{zIndex:1050,maxHeight:"300px",overflowY:"auto",top:"100%",borderRadius:"0.375rem",borderColor:"#dee2e6"},children:[e.jsx("div",{className:"p-3 border-bottom",children:e.jsx("input",{type:"text",className:"px-3 py-2 w-100 border",placeholder:"Search accounts...",value:j,onChange:s=>N(s.target.value),autoFocus:!0,style:{borderRadius:"0.25rem",fontSize:"14px",borderColor:"#dee2e6",outline:"none"}})}),e.jsx("div",{className:"py-1",children:y.length===0?e.jsx("div",{className:"px-3 py-2 text-muted text-center",children:"No accounts found"}):y.map(s=>e.jsxs("div",{className:`px-3 py-2 d-flex align-items-center ${t?.id===s.id?"bg-primary text-white":""}`,onClick:()=>_(s),style:{cursor:"pointer",transition:"background-color 0.15s ease-in-out"},onMouseEnter:a=>{t?.id!==s.id&&(a.currentTarget.style.backgroundColor="#f8f9fc")},onMouseLeave:a=>{t?.id!==s.id&&(a.currentTarget.style.backgroundColor="")},children:[e.jsx("div",{className:"flex-grow-1",children:e.jsxs("div",{className:"font-weight-medium",children:[s.account_name,s.is_default&&e.jsx("span",{className:"badge badge-success ml-2",children:"Default"})]})}),t?.id===s.id&&e.jsx("i",{className:"fas fa-check text-white"})]},s.id))})]})]}),t&&e.jsx("div",{className:"card mt-3 border-left-primary",children:e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"row no-gutters align-items-center",children:e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"d-flex align-items-center mb-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-weight-bold text-gray-800",children:[t.account_name,t.is_default&&e.jsxs("span",{className:"badge badge-success ml-2",children:[e.jsx("i",{className:"fas fa-star mr-1"}),"Default"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.account_type.charAt(0).toUpperCase()+t.account_type.slice(1)," Account"]})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-xs font-weight-bold text-gray-600 text-uppercase",children:"Current Balance"}),e.jsx("span",{className:`font-weight-bold ${k(t.balance,t.account_type)}`,children:R(t.balance)})]}),t.account_type==="credit"&&t.balance>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"alert alert-warning py-2 px-3 mb-0",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),e.jsx("small",{children:"Credit account has a positive balance"})]})})]})})})}),e.jsx("small",{className:"form-text text-muted",children:v?"Select the account for this transaction. Balance will be updated automatically.":"Select the account for this transaction."})]})};export{P as A};
