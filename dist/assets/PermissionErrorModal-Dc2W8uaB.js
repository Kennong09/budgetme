import{r as t}from"./react-vendor-D4A9EtXC.js";import{u as M,q as u}from"./index-BbApZ7g3.js";import{j as e}from"./ui-vendor-Cn1Vfl4w.js";const N=()=>{const{user:a}=M(),[s,n]=t.useState({isFamilyMember:!1,familyRole:null,familyId:null,canCreateFamilyGoals:!1,canContributeToGoals:!1,canManageFamilyRoles:!1,isOwner:!1}),[y,m]=t.useState(!0),[i,f]=t.useState(null),c=t.useCallback(async()=>{if(!a?.id){n({isFamilyMember:!1,familyRole:null,familyId:null,canCreateFamilyGoals:!1,canContributeToGoals:!1,canManageFamilyRoles:!1,isOwner:!1}),m(!1);return}try{m(!0),f(null);const r=await u.getFamilyPermissionState(a.id);n(r)}catch(r){console.error("Error loading family permissions:",r),f(r instanceof Error?r.message:"Failed to load permissions")}finally{m(!1)}},[a?.id]);t.useEffect(()=>{c()},[c]);const d=t.useCallback(async()=>a?.id?await u.canCreateFamilyGoals(a.id):{hasPermission:!1,errorMessage:"You must be logged in to create family goals",restrictions:["Please sign in to continue"]},[a?.id]),b=t.useCallback(async()=>a?.id?await u.canContributeToGoals(a.id):{hasPermission:!1,errorMessage:"You must be logged in to contribute to goals",restrictions:["Please sign in to continue"]},[a?.id]),h=t.useCallback(async r=>a?.id?await u.canAccessGoal(a.id,r):{hasPermission:!1,errorMessage:"You must be logged in to access goals",restrictions:["Please sign in to continue"]},[a?.id]),E=t.useCallback(r=>s.familyRole?u.getPermissionErrorMessage(s.familyRole,r):"You must be a family member to perform this action.",[s.familyRole]),C=t.useCallback(async r=>a?.id?await u.validatePermissions(a.id,r):{hasPermission:!1,errorMessage:"You must be logged in to perform this action",restrictions:["Please sign in to continue"]},[a?.id]),g=t.useCallback(()=>{c()},[c]);return{...s,loading:y,error:i,checkCanCreateFamilyGoals:d,checkCanContributeToGoals:b,checkCanAccessGoal:h,validatePermissions:C,getPermissionErrorMessage:E,refreshPermissions:g,hasBasicAccess:s.isFamilyMember,hasAdminAccess:s.isOwner||s.familyRole==="admin",hasContributionAccess:s.canContributeToGoals,hasGoalCreationAccess:s.canCreateFamilyGoals,isViewer:s.familyRole==="viewer",isMember:s.familyRole==="member",isAdmin:s.familyRole==="admin"}},v=()=>{const a=N(),s=t.useCallback(async()=>{const n=await a.checkCanCreateFamilyGoals();return n.hasPermission?{canCreate:!0}:a.isFamilyMember?a.familyRole==="member"?{canCreate:!1,errorTitle:"Family Goal Creation Restricted",errorMessage:"As a family member, you can contribute to existing goals but cannot create new family goals. Only family admins can create goals for the entire family.",suggestedActions:["Ask a family admin to create the goal","Create a personal goal instead","Contribute to existing family goals"],userRole:"member"}:a.familyRole==="viewer"?{canCreate:!1,errorTitle:"Family Goal Creation Denied",errorMessage:"Viewers have read-only access to family financial information. You cannot create family goals.",suggestedActions:["Contact your family admin to upgrade your role","Create a personal goal instead"],userRole:"viewer"}:{canCreate:!1,errorTitle:"Permission Denied",errorMessage:n.errorMessage||"You do not have permission to create family goals.",suggestedActions:["Contact your family admin for assistance"],userRole:n.userRole}:{canCreate:!1,errorTitle:"Family Membership Required",errorMessage:"You must be part of a family to create family goals.",suggestedActions:["Join an existing family","Create a new family","Create a personal goal instead"]}},[a]);return{...a,validateFamilyGoalCreation:s}},j=()=>{const a=N(),s=t.useCallback(async()=>{const n=await a.checkCanContributeToGoals();return n.hasPermission?{canContribute:!0}:a.isFamilyMember?a.familyRole==="viewer"?{canContribute:!1,errorTitle:"Contribution Access Denied",errorMessage:"Viewers have read-only access to family financial information. You cannot make contributions to family goals.",suggestedActions:["Contact your family admin to upgrade your role if you need contribution access"],userRole:"viewer"}:{canContribute:!1,errorTitle:"Permission Denied",errorMessage:n.errorMessage||"You do not have permission to contribute to goals.",suggestedActions:["Contact your family admin for assistance"],userRole:n.userRole}:{canContribute:!1,errorTitle:"Family Membership Required",errorMessage:"You must be part of a family to contribute to family goals.",suggestedActions:["Join an existing family","Create a new family"]}},[a]);return{...a,validateGoalContribution:s}};var l=(a=>(a.FAMILY_MEMBERSHIP_REQUIRED="FAMILY_MEMBERSHIP_REQUIRED",a.ROLE_RESTRICTED="ROLE_RESTRICTED",a.FAMILY_GOAL_CREATION_DENIED="FAMILY_GOAL_CREATION_DENIED",a.CONTRIBUTION_ACCESS_DENIED="CONTRIBUTION_ACCESS_DENIED",a.GOAL_ACCESS_DENIED="GOAL_ACCESS_DENIED",a.PERMISSION_CHECK_FAILED="PERMISSION_CHECK_FAILED",a.ROLE_MANAGEMENT_DENIED="ROLE_MANAGEMENT_DENIED",a.ADMIN_LIMITATION="ADMIN_LIMITATION",a))(l||{});const A={member:"Members can participate in family activities and contribute to goals, but cannot create family-wide goals or manage other members.",viewer:"Viewers have read-only access to family financial information. They can view data but cannot make changes or contributions.",admin:"Admins can manage most family activities but may have some limitations compared to the family owner.",owner:"Family owners have complete control over all family activities and member management."},p=({isOpen:a,onClose:s,errorTitle:n,errorMessage:y,suggestedActions:m=[],userRole:i,showUpgradeOption:f=!1,onUpgradeRole:c,errorType:d,showRoleContext:b=!0})=>{if(!a)return null;const h=o=>{switch(o){case"viewer":return"fas fa-eye";case"member":return"fas fa-user";case"admin":return"fas fa-user-shield";case"owner":return"fas fa-crown";default:return"fas fa-exclamation-triangle"}},E=o=>{switch(o){case l.FAMILY_MEMBERSHIP_REQUIRED:return"fas fa-users";case l.FAMILY_GOAL_CREATION_DENIED:return"fas fa-bullseye";case l.CONTRIBUTION_ACCESS_DENIED:return"fas fa-coins";case l.ROLE_MANAGEMENT_DENIED:return"fas fa-user-shield";case l.ADMIN_LIMITATION:return"fas fa-crown";default:return"fas fa-exclamation-triangle"}},C=o=>{switch(o){case l.FAMILY_MEMBERSHIP_REQUIRED:return"text-primary";case l.FAMILY_GOAL_CREATION_DENIED:case l.CONTRIBUTION_ACCESS_DENIED:return"text-warning";case l.ROLE_MANAGEMENT_DENIED:return"text-danger";case l.ADMIN_LIMITATION:return"text-info";default:return"text-warning"}},g=o=>{switch(o){case"viewer":return"text-info";case"member":return"text-success";case"admin":return"text-primary";case"owner":return"text-warning";default:return"text-warning"}},r=()=>d?E(d):h(i),x=()=>d?C(d):g(i);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",onClick:s,style:{zIndex:1040}}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,role:"dialog",style:{zIndex:1050},"aria-labelledby":"permissionErrorModalLabel","aria-hidden":"false",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:"modal-header border-0 pb-0",children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"mr-3",children:e.jsx("div",{className:`rounded-circle p-3 ${x()} bg-light`,style:{fontSize:"1.5rem"},children:e.jsx("i",{className:r()})})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h5",{className:"modal-title font-weight-bold text-gray-800 mb-0",id:"permissionErrorModalLabel",children:n}),i&&e.jsxs("small",{className:`text-muted ${g(i)}`,children:["Your current role: ",e.jsx("span",{className:"font-weight-bold text-capitalize",children:i})]})]}),e.jsx("button",{type:"button",className:"close",onClick:s,"aria-label":"Close",children:e.jsx("span",{"aria-hidden":"true",children:"Ã—"})})]})}),e.jsxs("div",{className:"modal-body pt-2",children:[e.jsx("div",{className:"alert alert-warning border-left-warning mb-4",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"mr-2 mt-1",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-warning"})}),e.jsx("div",{children:e.jsx("p",{className:"mb-0",children:y})})]})}),m.length>0&&e.jsx("div",{className:"card bg-light border-0 mb-3",children:e.jsxs("div",{className:"card-body py-3",children:[e.jsxs("h6",{className:"card-title font-weight-bold text-gray-800 mb-3",children:[e.jsx("i",{className:"fas fa-lightbulb text-warning mr-2"}),"What you can do:"]}),e.jsx("ul",{className:"list-unstyled mb-0",children:m.map((o,I)=>e.jsxs("li",{className:"mb-2 d-flex align-items-start",children:[e.jsx("div",{className:"mr-2 mt-1",children:e.jsx("i",{className:"fas fa-check-circle text-success",style:{fontSize:"0.8rem"}})}),e.jsx("span",{className:"text-gray-700",children:o})]},I))})]})}),b&&i&&e.jsx("div",{className:"card border-left-info mb-3",children:e.jsxs("div",{className:"card-body py-3",children:[e.jsxs("h6",{className:"card-title font-weight-bold text-info mb-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"About ",i==="member"?"Member":i==="viewer"?"Viewer":i==="admin"?"Admin":i==="owner"?"Owner":"your"," Role:"]}),e.jsx("p",{className:"text-gray-700 mb-0 small",children:A[i]||"Your role determines what actions you can perform within the family."})]})})]}),e.jsx("div",{className:"modal-footer border-0 pt-0",children:e.jsxs("div",{className:"d-flex justify-content-between w-100",children:[e.jsx("div",{children:f&&c&&e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:c,children:[e.jsx("i",{className:"fas fa-level-up-alt mr-2"}),"Request Role Upgrade"]})}),e.jsx("div",{children:e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:s,children:[e.jsx("i",{className:"fas fa-check mr-2"}),"I Understand"]})})]})})]})})})]})};export{p as P,j as a,N as b,v as u};
