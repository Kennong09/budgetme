import{j as e,B as G}from"./ui-vendor-Cn1Vfl4w.js";import{r}from"./react-vendor-D4A9EtXC.js";import{b as ye,p as f,f as k,d as xe,t as De,z as re}from"./index-BbApZ7g3.js";import{r as Ie,s as Ee,f as ke}from"./currencyUtils-BZq_rNNs.js";import{C as Re}from"./CentavoInput-HJGBXETA.js";import{A as $e}from"./AccountSelector-Bv9lXSIJ.js";import{C as Fe}from"./CategorySelector-DIi64-QW.js";import{G as Pe}from"./GoalSelector-BkgJuR_a.js";import"./chart-vendor-B0c7K_uV.js";import"./accountService-CFCTGWw4.js";import"./PermissionErrorModal-Dc2W8uaB.js";const We=({show:t,onClose:w,onTransactionAdded:C})=>{const{showSuccessToast:z,showErrorToast:g}=ye(),[_,y]=r.useState(!1),[A,D]=r.useState([]),[h,q]=r.useState([]),[T,i]=r.useState([]),[R,m]=r.useState(""),[U,p]=r.useState(!1),[x,N]=r.useState(null),[Y,I]=r.useState(null),[o,S]=r.useState({type:"expense",user_id:"",account_id:"",category_id:"",goal_id:"",budget_id:"",amount:0,date:new Date().toISOString().slice(0,10),description:""});r.useEffect(()=>{t&&ie()},[t]),r.useEffect(()=>{o.user_id&&a(o.user_id)},[o.user_id]);const ie=async()=>{try{if(!f)throw new Error("Supabase admin client not initialized");const{data:l,error:n}=await f.auth.admin.listUsers({page:1,perPage:1e3});if(n)throw n;D((l?.users||[]).map(u=>({id:u.id,email:u.email||"",user_metadata:u.user_metadata||{}})))}catch(l){console.error("Error fetching users:",l)}},a=async l=>{try{if(!f)throw new Error("Supabase admin client not initialized");const[n,u]=await Promise.all([f.from("income_categories").select("*").eq("user_id",l),f.from("expense_categories").select("*").eq("user_id",l)]);if(n.error)throw n.error;if(u.error)throw u.error;q(n.data||[]),i(u.data||[])}catch(n){console.error("Error fetching user data:",n),g("Failed to load user data")}},E=l=>{const{name:n,value:u}=l.target;S(v=>({...v,[n]:u}))},te=l=>{S(n=>({...n,amount:l}))},se=l=>{S(n=>({...n,user_id:l.id,account_id:"",category_id:"",goal_id:"",budget_id:""})),m(l.user_metadata?.full_name||l.email),p(!1),N(null)},B=l=>{S(n=>({...n,account_id:l?.id||""}))},ce=l=>{S(n=>({...n,category_id:l?.id||""}))},oe=l=>{N(l),S(n=>({...n,goal_id:l?.id||""}))},de=async l=>{if(l.preventDefault(),!o.user_id){g("Please select a user");return}if(!o.account_id){g("Please select an account");return}if(!o.category_id&&o.type!=="contribution"){g("Please select a category");return}if(o.type==="contribution"&&!o.goal_id){g("Please select a goal");return}if(o.amount<=0){g("Please enter a valid amount");return}try{if(y(!0),!f)throw new Error("Supabase admin client not initialized");const n=Ie(o.amount);if(!isFinite(n)||isNaN(n))throw new Error("Invalid amount");if(n>9999999999999e-2)throw new Error("Amount too large");const u={user_id:o.user_id,account_id:o.account_id,type:o.type,amount:n,date:o.date,description:Ee(o.description),created_at:new Date().toISOString()};o.type==="income"?(u.income_category_id=o.category_id||null,u.expense_category_id=null):(u.expense_category_id=o.category_id||null,u.income_category_id=null),o.goal_id&&(u.goal_id=o.goal_id);const{error:v}=await f.from("transactions").insert([u]);if(v)throw v;const $=o.type==="income"?n:-n;await f.rpc("update_account_balance",{p_account_id:o.account_id,p_amount_change:$}),o.goal_id&&await f.rpc("update_goal_progress",{p_goal_id:o.goal_id,p_amount:n}),z("Transaction added successfully!"),C&&C(),Q()}catch(n){g(n.message||"Failed to add transaction")}finally{y(!1)}},Q=()=>{S({type:"expense",user_id:"",account_id:"",category_id:"",goal_id:"",budget_id:"",amount:0,date:new Date().toISOString().slice(0,10),description:""}),m(""),p(!1),N(null),I(null),w()},P=A.filter(l=>{const n=R.toLowerCase();return(l.user_metadata?.full_name?.toLowerCase()||"").includes(n)||l.email.toLowerCase().includes(n)}),J=A.find(l=>l.id===o.user_id),K=(l=>{switch(l){case"income":return{label:"Income",color:"#28a745",bg:"success",icon:"fa-plus-circle"};case"expense":return{label:"Expense",color:"#dc3545",bg:"danger",icon:"fa-minus-circle"};case"contribution":return{label:"Contribution",color:"#17a2b8",bg:"info",icon:"fa-flag"};default:return{label:"Transaction",color:"#6c757d",bg:"secondary",icon:"fa-exchange-alt"}}})(o.type),H=o.user_id&&o.account_id&&o.amount>0&&(o.type==="contribution"?o.goal_id:o.category_id);return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:Q}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:Q,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered",onClick:l=>l.stopPropagation(),style:{margin:"auto",maxWidth:"500px",width:"calc(100% - 16px)"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"16px",overflow:"hidden",maxHeight:"90vh",margin:"8px"},children:[e.jsx("div",{className:"modal-header border-0 text-white",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",padding:"12px 16px"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"10px",marginRight:"10px"},children:e.jsx("i",{className:"fas fa-plus-circle",style:{fontSize:"16px"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold",style:{fontSize:"14px"},children:"Add Transaction"}),e.jsx("small",{className:"d-none d-sm-block",style:{opacity:.9,fontSize:"11px"},children:"Create a transaction record"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:Q,disabled:_,style:{width:"30px",height:"30px",borderRadius:"8px",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:"fas fa-times text-danger",style:{fontSize:"12px"}})})]})}),e.jsxs("div",{className:"modal-body",style:{maxHeight:"calc(90vh - 140px)",overflowY:"auto",padding:"12px 16px",WebkitOverflowScrolling:"touch"},children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-user mr-2"}),"Select User ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"position-relative mb-2",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Search for a user...",value:R,onChange:l=>{m(l.target.value),p(!0)},onFocus:()=>p(!0),style:{fontSize:"0.85rem"}}),U&&P.length>0&&e.jsx("div",{className:"dropdown-menu show w-100",style:{maxHeight:"150px",overflowY:"auto",position:"absolute",zIndex:1e3},children:P.slice(0,8).map(l=>e.jsxs("button",{type:"button",className:"dropdown-item d-flex align-items-center py-2",onClick:()=>se(l),children:[e.jsx("img",{src:l.user_metadata?.avatar_url||"../images/placeholder.png",alt:"",className:"rounded-circle mr-2",style:{width:"24px",height:"24px",objectFit:"cover"},onError:n=>{n.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"0.8rem"},children:l.user_metadata?.full_name||l.email.split("@")[0]}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:l.email})]})]},l.id))})]}),J&&e.jsxs("div",{className:"d-flex align-items-center p-2",style:{background:"#e8f5e9",borderRadius:"6px",border:"1px solid #c8e6c9"},children:[e.jsx("img",{src:J.user_metadata?.avatar_url||"../images/placeholder.png",alt:"",className:"rounded-circle mr-2",style:{width:"32px",height:"32px",objectFit:"cover"},onError:l=>{l.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-weight-bold text-success",style:{fontSize:"0.8rem"},children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),J.user_metadata?.full_name||J.email.split("@")[0]]}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:J.email})]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exchange-alt mr-2"}),"Transaction Type ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("div",{className:"d-flex",style:{gap:"8px"},children:[{type:"income",icon:"fa-plus-circle",label:"Income",color:"success"},{type:"expense",icon:"fa-minus-circle",label:"Expense",color:"danger"},{type:"contribution",icon:"fa-flag",label:"Contribute",color:"info"}].map(l=>e.jsxs("button",{type:"button",className:`btn btn-sm flex-fill ${o.type===l.type?`btn-${l.color}`:"btn-outline-secondary"}`,onClick:()=>S(n=>({...n,type:l.type,category_id:"",goal_id:""})),style:{borderRadius:"8px",padding:"8px 4px",fontSize:"0.8rem"},children:[e.jsx("i",{className:`fas ${l.icon} mr-1`}),l.label]},l.type))})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-coins mr-2"}),"Amount & Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-7",children:e.jsx(Re,{value:o.amount,onChange:te,currency:"PHP",label:"Amount",placeholder:"0.00",required:!0,min:.01,max:9999999999999e-2,disabled:!o.user_id})}),e.jsxs("div",{className:"col-5",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.8rem"},children:["Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"date",name:"date",value:o.date,onChange:E,className:"form-control form-control-sm",required:!0,disabled:!o.user_id,style:{fontSize:"0.85rem"}})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-wallet mr-2"}),"Account & Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("div",{className:"mb-2",children:e.jsx($e,{selectedAccountId:o.account_id,onAccountSelect:B,required:!0,label:"Account",showBalance:!0,showAccountType:!0,autoSelectDefault:!0,disabled:!o.user_id})}),o.type!=="contribution"?e.jsx(Fe,{selectedCategoryId:o.category_id,onCategorySelect:ce,transactionType:o.type,incomeCategories:h,expenseCategories:T,required:!0,label:"Category",showIcons:!0,disabled:!o.user_id}):e.jsxs("div",{children:[e.jsx("label",{className:"mb-1",style:{fontSize:"0.8rem"},children:"Category"}),e.jsxs("div",{className:"form-control form-control-sm d-flex align-items-center bg-info text-white",children:[e.jsx("i",{className:"fas fa-flag mr-2"}),e.jsx("span",{className:"font-weight-bold",children:"Goal Contribution"}),e.jsx(G,{bg:"light",className:"text-info ml-auto",style:{fontSize:"0.6rem"},children:"Auto"})]})]})]})]}),o.type==="contribution"&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-flag mr-2"}),"Goal Selection ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:Y===!1?e.jsxs("div",{className:"text-center py-3",children:[e.jsx("i",{className:"fas fa-flag fa-2x text-muted mb-2"}),e.jsx("p",{className:"text-muted mb-0",style:{fontSize:"0.8rem"},children:"No active goals available for this user"})]}):e.jsx(Pe,{selectedGoal:x,onGoalSelect:oe,required:!0,label:"",isContributionType:!0,showValidationError:!x,onGoalsLoaded:I,validateFamilyGoalAccess:!1})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-align-left mr-2"}),"Description ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("textarea",{name:"description",value:o.description,onChange:E,className:"form-control form-control-sm",rows:2,placeholder:"Enter a description for this transaction...",required:!0,disabled:!o.user_id,style:{fontSize:"0.85rem"}})})]}),H&&e.jsx("div",{className:"p-3",style:{background:"#fff5f5",borderRadius:"8px",borderLeft:"3px solid #dc3545"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:`fas ${K.icon} mr-2`,style:{color:K.color}}),e.jsxs("div",{children:[e.jsxs("strong",{style:{color:K.color,fontSize:"0.9rem"},children:["₱",o.amount.toLocaleString()]}),e.jsx("span",{className:"text-muted mx-2",children:"•"}),e.jsx("span",{style:{fontSize:"0.85rem"},children:K.label})]}),e.jsxs(G,{bg:"success",className:"ml-auto",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-check mr-1"}),"Ready"]})]})})]}),e.jsxs("div",{className:"modal-footer border-0",style:{background:"#f8f9fa",padding:"10px 16px",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("small",{className:"text-muted d-none d-sm-block",style:{fontSize:"11px",flex:"1 1 100%",marginBottom:"4px"},children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),H?"Ready to submit":"Complete all required fields"]}),e.jsxs("div",{className:"d-flex w-100 gap-2",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary flex-1",onClick:Q,disabled:_,style:{flex:1,padding:"10px 16px",fontSize:"13px",borderRadius:"8px",minHeight:"42px"},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger flex-1",onClick:de,disabled:_||!H,style:{flex:1,padding:"10px 16px",fontSize:"13px",borderRadius:"8px",minHeight:"42px"},children:_?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add"]})})]})]})]})})})]}):null},Ve=({transaction:t,show:w,onClose:C,onEdit:z,onDelete:g})=>{const[_,y]=r.useState("overview");if(!w||!t)return null;const A=i=>{switch(i){case"income":return{label:"Income",color:"#28a745",bgColor:"rgba(40, 167, 69, 0.1)",icon:"fa-plus-circle",badge:"success"};case"expense":return{label:"Expense",color:"#dc3545",bgColor:"rgba(220, 53, 69, 0.1)",icon:"fa-minus-circle",badge:"danger"};case"contribution":return{label:"Contribution",color:"#17a2b8",bgColor:"rgba(23, 162, 184, 0.1)",icon:"fa-flag",badge:"info"};default:return{label:"Transaction",color:"#6c757d",bgColor:"rgba(108, 117, 125, 0.1)",icon:"fa-exchange-alt",badge:"secondary"}}},D=i=>new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),h=A(t.type),q=new Date(t.date),T=Math.floor((Date.now()-q.getTime())/(1e3*60*60*24));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:C}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:C,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",onClick:i=>i.stopPropagation(),style:{margin:"auto",maxWidth:"600px",width:"calc(100% - 16px)"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"16px",overflow:"hidden",maxHeight:"90vh",margin:"8px"},children:[e.jsx("div",{className:"modal-header border-0 text-white",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",padding:"12px 16px"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"10px",marginRight:"10px"},children:e.jsx("i",{className:`fas ${h.icon}`,style:{fontSize:"16px"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold",style:{fontSize:"14px"},children:"Transaction Details"}),e.jsxs("small",{className:"d-none d-sm-block",style:{opacity:.9,fontSize:"11px"},children:[h.label," • ",k(t.amount)]})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:C,style:{width:"30px",height:"30px",borderRadius:"8px",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:"fas fa-times text-danger",style:{fontSize:"12px"}})})]})}),e.jsx("div",{className:"px-3 py-2",style:{background:"#f8f9fa",borderBottom:"1px solid #e9ecef"},children:e.jsxs("div",{className:"row text-center g-2",children:[e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${h.icon} mr-2`,style:{color:h.color}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Type"}),e.jsx("strong",{style:{color:h.color,fontSize:"0.8rem"},children:h.label})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-coins text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Amount"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:k(t.amount)})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:"fas fa-calendar-alt text-danger mr-2"}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Days Ago"}),e.jsxs("strong",{className:"text-danger",style:{fontSize:"0.8rem"},children:[T,"d"]})]})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{className:`fas ${t.goal_id?"fa-flag text-info":"fa-tag text-secondary"} mr-2`}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem",lineHeight:1},children:"Goal"}),e.jsx("strong",{style:{fontSize:"0.8rem"},className:t.goal_id?"text-info":"text-secondary",children:t.goal_id?"Linked":"None"})]})]})})]})}),e.jsx("div",{className:"px-3 pt-2",children:e.jsx("div",{className:"d-flex",style:{gap:"6px"},children:[{id:"overview",icon:"fa-chart-pie",label:"Overview"},{id:"details",icon:"fa-info-circle",label:"Details"},{id:"actions",icon:"fa-cogs",label:"Actions"}].map(i=>e.jsxs("button",{className:`btn btn-sm ${_===i.id?"btn-danger":"btn-outline-secondary"}`,onClick:()=>y(i.id),style:{borderRadius:"16px",padding:"4px 12px",fontSize:"0.8rem"},children:[e.jsx("i",{className:`fas ${i.icon} mr-1`}),i.label]},i.id))})}),e.jsxs("div",{className:"modal-body",style:{maxHeight:"calc(90vh - 180px)",overflowY:"auto",padding:"12px 16px",WebkitOverflowScrolling:"touch"},children:[_==="overview"&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-lg-5 text-center mb-3 mb-lg-0",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-3",style:{width:"80px",height:"80px",background:h.bgColor,borderRadius:"50%",margin:"0 auto",border:`3px solid ${h.color}`},children:e.jsx("i",{className:`fas ${h.icon} fa-2x`,style:{color:h.color}})}),e.jsx("h5",{className:"font-weight-bold mb-1",style:{color:h.color},children:k(t.amount)}),e.jsxs("p",{className:"text-muted mb-2",style:{fontSize:"0.85rem"},children:[h.label," Transaction"]}),e.jsxs("div",{className:"d-flex justify-content-center flex-wrap",style:{gap:"6px"},children:[e.jsxs(G,{bg:h.badge,style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:`fas ${h.icon} mr-1`}),h.label]}),t.goal_id&&e.jsxs(G,{bg:"info",style:{fontSize:"0.7rem"},children:[e.jsx("i",{className:"fas fa-flag mr-1"}),"Goal Linked"]})]})]}),e.jsxs("div",{className:"col-lg-7",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Quick Info"]}),e.jsxs("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px",fontSize:"0.85rem"},children:[e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Transaction ID"}),e.jsxs("code",{style:{fontSize:"0.75rem"},children:[t.id?.substring(0,16),"..."]})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Date"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:xe(t.date)})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("small",{className:"text-muted",children:"Account"}),e.jsx("span",{style:{fontSize:"0.8rem"},children:t.account_name||"N/A"})]}),e.jsxs("div",{className:"d-flex justify-content-between py-1",children:[e.jsx("small",{className:"text-muted",children:"Category"}),e.jsxs("span",{style:{fontSize:"0.8rem"},children:[t.category_icon&&e.jsx("span",{className:"mr-1",children:t.category_icon}),t.category_name||"Uncategorized"]})]})]}),e.jsxs("h6",{className:"text-danger mb-2 mt-3",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-user mr-2"}),"User"]}),e.jsxs("div",{className:"d-flex align-items-center p-2",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("img",{src:t.user_avatar||"../images/placeholder.png",alt:t.user_name||"User",className:"rounded-circle mr-2",style:{width:"36px",height:"36px",objectFit:"cover"},onError:i=>{i.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-medium",style:{fontSize:"0.85rem"},children:t.user_name||"Unknown User"}),e.jsx("small",{className:"text-muted",children:t.user_email||"No email"})]})]})]})]}),_==="details"&&e.jsxs("div",{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-receipt mr-2"}),"Transaction Info"]}),e.jsx("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("table",{className:"table table-sm table-borderless mb-0",style:{fontSize:"0.8rem"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Amount"}),e.jsx("td",{className:"text-right py-1",children:e.jsx("strong",{style:{color:h.color},children:k(t.amount)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Type"}),e.jsx("td",{className:"text-right py-1",children:e.jsx(G,{bg:h.badge,style:{fontSize:"0.65rem"},children:h.label})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Date"}),e.jsx("td",{className:"text-right py-1",children:xe(t.date)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Created"}),e.jsx("td",{className:"text-right py-1",children:D(t.created_at)})]})]})})})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-wallet mr-2"}),"Account & Category"]}),e.jsx("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("table",{className:"table table-sm table-borderless mb-0",style:{fontSize:"0.8rem"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Account"}),e.jsx("td",{className:"text-right py-1",children:e.jsx("strong",{children:t.account_name||"N/A"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Account Type"}),e.jsx("td",{className:"text-right py-1",children:t.account_type||"N/A"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Category"}),e.jsx("td",{className:"text-right py-1",children:t.category_name||"Uncategorized"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"text-muted py-1",children:"Category Icon"}),e.jsx("td",{className:"text-right py-1",children:t.category_icon||"—"})]})]})})})]})]}),(t.notes||t.description)&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-align-left mr-2"}),"Description"]}),e.jsx("div",{className:"p-2",style:{background:"#fff5f5",borderRadius:"8px",borderLeft:"3px solid #dc3545"},children:e.jsx("p",{className:"mb-0",style:{fontSize:"0.85rem",lineHeight:1.6},children:t.notes||t.description})})]}),t.goal_id&&e.jsxs("div",{children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-flag mr-2"}),"Goal Information"]}),e.jsx("div",{className:"p-2",style:{background:"rgba(23, 162, 184, 0.1)",borderRadius:"8px",border:"1px solid rgba(23, 162, 184, 0.2)"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-flag text-info mr-2"}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.85rem"},children:t.goal_name||"Unknown Goal"}),e.jsx("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:"This transaction contributes to a financial goal"})]})]})})]})]}),_==="actions"&&e.jsxs("div",{children:[e.jsxs("h6",{className:"text-danger mb-3",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-tools mr-2"}),"Transaction Actions"]}),e.jsxs("div",{className:"row g-2",children:[z&&e.jsx("div",{className:"col-md-6 mb-2",children:e.jsxs("div",{className:"p-3 text-center h-100",style:{background:"#f8f9fa",borderRadius:"8px",cursor:"pointer",border:"1px solid transparent",transition:"all 0.2s"},onClick:()=>z(t),onMouseEnter:i=>{i.currentTarget.style.borderColor="#ffc107",i.currentTarget.style.background="#fff8e1"},onMouseLeave:i=>{i.currentTarget.style.borderColor="transparent",i.currentTarget.style.background="#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-2",style:{width:"40px",height:"40px",background:"rgba(255, 193, 7, 0.1)",borderRadius:"8px",margin:"0 auto"},children:e.jsx("i",{className:"fas fa-edit text-warning"})}),e.jsx("h6",{className:"mb-1",style:{fontSize:"0.85rem"},children:"Edit Transaction"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:"Modify amount, date, or details"})]})}),g&&e.jsx("div",{className:"col-md-6 mb-2",children:e.jsxs("div",{className:"p-3 text-center h-100",style:{background:"#f8f9fa",borderRadius:"8px",cursor:"pointer",border:"1px solid transparent",transition:"all 0.2s"},onClick:()=>g(t),onMouseEnter:i=>{i.currentTarget.style.borderColor="#dc3545",i.currentTarget.style.background="#fff5f5"},onMouseLeave:i=>{i.currentTarget.style.borderColor="transparent",i.currentTarget.style.background="#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mb-2",style:{width:"40px",height:"40px",background:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",margin:"0 auto"},children:e.jsx("i",{className:"fas fa-trash-alt text-danger"})}),e.jsx("h6",{className:"mb-1",style:{fontSize:"0.85rem"},children:"Delete Transaction"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:"Permanently remove this record"})]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.9rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Impact Summary"]}),e.jsxs("div",{className:"p-2",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{className:`fas ${t.type==="income"?"fa-arrow-up text-success":"fa-arrow-down text-danger"} mr-2`}),e.jsx("small",{children:t.type==="income"?`Added ${k(t.amount)} to account balance`:`Deducted ${k(t.amount)} from account balance`})]}),t.goal_id&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-flag text-info mr-2"}),e.jsxs("small",{children:["Contributed ",k(t.amount)," toward goal progress"]})]})]})]})]})]}),e.jsxs("div",{className:"modal-footer border-0",style:{background:"#f8f9fa",padding:"10px 16px",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("small",{className:"text-muted d-none d-sm-block",style:{fontSize:"10px",flex:"1 1 100%",marginBottom:"4px"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"9px"},children:[t.id?.substring(0,12),"..."]})]}),e.jsxs("button",{type:"button",className:"btn btn-danger w-100",onClick:C,style:{padding:"10px 16px",fontSize:"13px",borderRadius:"8px",minHeight:"42px"},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})]})})})]})},Ye=({transaction:t,show:w,onClose:C,onTransactionUpdated:z})=>{const{showSuccessToast:g,showErrorToast:_}=ye(),[y,A]=r.useState(!1),[D,h]=r.useState(!1),[q,T]=r.useState(""),[i,R]=r.useState(null),[m,U]=r.useState(null),[p,x]=r.useState([]),[N,Y]=r.useState([]),[I,o]=r.useState(null),[S,ie]=r.useState(null),[a,E]=r.useState({type:"expense",account_id:"",category_id:"",goal_id:"",amount:0,date:new Date().toISOString().slice(0,10),description:""});r.useEffect(()=>{w&&t&&(R(t),E({type:t.type,account_id:t.account_id,category_id:t.category_id||"",goal_id:t.goal_id||"",amount:t.amount,date:new Date(t.date).toISOString().slice(0,10),description:t.notes||t.description||""}),te(t.user_id))},[w,t]);const te=async l=>{try{if(A(!0),!f)throw new Error("Supabase admin client not initialized");const{data:n,error:u}=await f.auth.admin.getUserById(l);if(u)throw u;n.user&&U({id:n.user.id,email:n.user.email||"",full_name:n.user.user_metadata?.full_name,avatar_url:n.user.user_metadata?.avatar_url,user_metadata:n.user.user_metadata||{}});const[v,$]=await Promise.all([f.from("income_categories").select("id, category_name, icon").eq("user_id",l).order("category_name"),f.from("expense_categories").select("id, category_name, icon").eq("user_id",l).order("category_name")]);if(v.error)throw v.error;if($.error)throw $.error;x(v.data||[]),Y($.data||[])}catch(n){console.error("Error fetching user data:",n),_("Failed to load user data")}finally{A(!1)}},se=l=>{const{name:n,value:u}=l.target;n==="type"?(E(v=>({...v,type:u,category_id:"",goal_id:""})),o(null)):E(v=>({...v,[n]:u}))},B=l=>{if(l>9999999999999e-2){_("Amount too large");return}E(n=>({...n,amount:l}))},ce=l=>{E(n=>({...n,account_id:l?.id||""}))},oe=l=>{E(n=>({...n,category_id:l?.id||""}))},de=l=>{o(l),E(n=>({...n,goal_id:l?.id||""}))},Q=async l=>{if(l.preventDefault(),T(""),!i){T("Original transaction data is missing");return}if(!a.amount||a.amount<=0){T("Please enter a valid amount");return}if(!a.date){T("Please select a date");return}if(!a.account_id){T("Please select an account");return}if(!a.category_id&&a.type!=="contribution"){T("Please select a category");return}if(a.type==="contribution"&&!a.goal_id){T("Please select a goal");return}try{if(h(!0),!f)throw new Error("Supabase admin client not initialized");const n=Ie(a.amount);if(!isFinite(n)||isNaN(n)||n<=0)throw new Error("Invalid amount");if(n>9999999999999e-2)throw new Error("Amount too large");const u={type:a.type,amount:n,date:a.date,account_id:a.account_id,goal_id:a.goal_id||null,notes:Ee(a.description),updated_at:new Date().toISOString()};a.type==="income"?(u.income_category_id=a.category_id||null,u.expense_category_id=null):(u.expense_category_id=a.category_id||null,u.income_category_id=null);const{data:v,error:$}=await f.from("transactions").update(u).eq("id",i.id).select().single();if($)throw $;const O=i.amount,Z=i.type,ee=i.account_id,Ne=Z==="income"?-O:O,W=a.type==="income"?n:-n;if(ee!==a.account_id)await f.rpc("update_account_balance",{p_account_id:ee,p_amount_change:Ne}),await f.rpc("update_account_balance",{p_account_id:a.account_id,p_amount_change:W});else{const ue=W-(Z==="income"?O:-O);await f.rpc("update_account_balance",{p_account_id:a.account_id,p_amount_change:ue})}i.goal_id!==a.goal_id?(i.goal_id&&await f.rpc("update_goal_progress",{p_goal_id:i.goal_id,p_amount:-O}),a.goal_id&&await f.rpc("update_goal_progress",{p_goal_id:a.goal_id,p_amount:n})):a.goal_id&&O!==n&&await f.rpc("update_goal_progress",{p_goal_id:a.goal_id,p_amount:n-O}),g("Transaction updated successfully!"),z&&v&&z(v),P()}catch(n){console.error("Error updating transaction:",n),T(n.message||"Failed to update transaction")}finally{h(!1)}},P=()=>{E({type:"expense",account_id:"",category_id:"",goal_id:"",amount:0,date:new Date().toISOString().slice(0,10),description:""}),U(null),x([]),Y([]),R(null),o(null),T(""),C()};if(!w||!t)return null;const ae=(l=>{switch(l){case"income":return{label:"Income",color:"#28a745",bg:"success",icon:"fa-plus-circle"};case"expense":return{label:"Expense",color:"#dc3545",bg:"danger",icon:"fa-minus-circle"};case"contribution":return{label:"Contribution",color:"#17a2b8",bg:"info",icon:"fa-flag"};default:return{label:"Transaction",color:"#6c757d",bg:"secondary",icon:"fa-exchange-alt"}}})(a.type),K=a.account_id&&a.amount>0&&(a.type==="contribution"?a.goal_id:a.category_id),H=i&&(a.type!==i.type||a.amount!==i.amount||a.account_id!==i.account_id||a.category_id!==(i.category_id||"")||a.goal_id!==(i.goal_id||"")||a.date!==new Date(i.date).toISOString().slice(0,10)||a.description!==(i.notes||i.description||""));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:P}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:P,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered",onClick:l=>l.stopPropagation(),style:{margin:"auto",maxWidth:"500px",width:"calc(100% - 16px)"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"16px",overflow:"hidden",maxHeight:"90vh",margin:"8px"},children:[e.jsx("div",{className:"modal-header border-0 text-white",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",padding:"12px 16px"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"10px",marginRight:"10px"},children:e.jsx("i",{className:"fas fa-edit",style:{fontSize:"16px"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold",style:{fontSize:"14px"},children:"Edit Transaction"}),e.jsx("small",{className:"d-none d-sm-block",style:{opacity:.9,fontSize:"11px"},children:"Modify transaction details"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:P,disabled:y||D,style:{width:"30px",height:"30px",borderRadius:"8px",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:"fas fa-times text-danger",style:{fontSize:"12px"}})})]})}),e.jsxs("div",{className:"modal-body",style:{maxHeight:"calc(90vh - 140px)",overflowY:"auto",padding:"12px 16px",WebkitOverflowScrolling:"touch"},children:[q&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),q]}),y?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",style:{fontSize:"0.85rem"},children:"Loading transaction data..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 mb-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:m?.avatar_url||"../images/placeholder.png",alt:m?.full_name||"User",className:"rounded-circle mr-3",style:{width:"50px",height:"50px",objectFit:"cover",border:"2px solid #dc3545"},onError:l=>{l.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("strong",{style:{fontSize:"0.95rem"},children:m?.full_name||m?.email?.split("@")[0]||"Unknown User"}),e.jsx("div",{className:"text-muted",style:{fontSize:"0.8rem"},children:m?.email}),e.jsxs("div",{className:"mt-1",children:[e.jsxs(G,{bg:ae.bg,style:{fontSize:"0.65rem"},className:"mr-1",children:[e.jsx("i",{className:`fas ${ae.icon} mr-1`}),ae.label]}),e.jsx(G,{bg:"secondary",style:{fontSize:"0.65rem"},className:"mr-1",children:ke(i?.amount||0)}),H&&e.jsxs(G,{bg:"warning",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),"Unsaved"]})]})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exchange-alt mr-2"}),"Transaction Type ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("div",{className:"d-flex",style:{gap:"8px"},children:[{type:"income",icon:"fa-plus-circle",label:"Income",color:"success"},{type:"expense",icon:"fa-minus-circle",label:"Expense",color:"danger"},{type:"contribution",icon:"fa-flag",label:"Contribute",color:"info"}].map(l=>e.jsxs("button",{type:"button",className:`btn btn-sm flex-fill ${a.type===l.type?`btn-${l.color}`:"btn-outline-secondary"}`,onClick:()=>{E(n=>({...n,type:l.type,category_id:"",goal_id:""})),o(null)},style:{borderRadius:"8px",padding:"8px 4px",fontSize:"0.8rem"},children:[e.jsx("i",{className:`fas ${l.icon} mr-1`}),l.label]},l.type))})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-coins mr-2"}),"Amount & Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-7",children:e.jsx(Re,{value:a.amount,onChange:B,currency:"PHP",label:"Amount",placeholder:"0.00",required:!0,min:.01,max:9999999999999e-2})}),e.jsxs("div",{className:"col-5",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.8rem"},children:["Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"date",name:"date",value:a.date,onChange:se,className:"form-control form-control-sm",required:!0,style:{fontSize:"0.85rem"}})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-wallet mr-2"}),"Account & Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsx("div",{className:"mb-2",children:e.jsx($e,{selectedAccountId:a.account_id,onAccountSelect:ce,required:!0,label:"Account",showBalance:!0,showAccountType:!0,autoSelectDefault:!1})}),a.type!=="contribution"?e.jsx(Fe,{selectedCategoryId:a.category_id,onCategorySelect:oe,transactionType:a.type,incomeCategories:p,expenseCategories:N,required:!0,label:"Category",showIcons:!0}):e.jsxs("div",{children:[e.jsx("label",{className:"mb-1",style:{fontSize:"0.8rem"},children:"Category"}),e.jsxs("div",{className:"form-control form-control-sm d-flex align-items-center bg-info text-white",children:[e.jsx("i",{className:"fas fa-flag mr-2"}),e.jsx("span",{className:"font-weight-bold",children:"Goal Contribution"}),e.jsx(G,{bg:"light",className:"text-info ml-auto",style:{fontSize:"0.6rem"},children:"Auto"})]})]})]})]}),a.type==="contribution"&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-flag mr-2"}),"Goal Selection ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:S===!1?e.jsxs("div",{className:"text-center py-3",children:[e.jsx("i",{className:"fas fa-flag fa-2x text-muted mb-2"}),e.jsx("p",{className:"text-muted mb-0",style:{fontSize:"0.8rem"},children:"No active goals available"})]}):e.jsx(Pe,{selectedGoal:I,onGoalSelect:de,required:!0,label:"",isContributionType:!0,showValidationError:!I,onGoalsLoaded:ie,validateFamilyGoalAccess:!1})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-align-left mr-2"}),"Description ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsx("textarea",{name:"description",value:a.description,onChange:se,className:"form-control form-control-sm",rows:2,placeholder:"Enter a description...",required:!0,style:{fontSize:"0.85rem"}})})]}),H&&e.jsx("div",{className:"p-3",style:{background:"#fff5f5",borderRadius:"8px",borderLeft:"3px solid #dc3545"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-warning mr-2"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-danger",style:{fontSize:"0.85rem"},children:"Unsaved Changes"}),e.jsxs("p",{className:"mb-0 text-muted",style:{fontSize:"0.75rem"},children:[ke(i?.amount||0)," → ",ke(a.amount)]})]})]})})]})]}),e.jsxs("div",{className:"modal-footer border-0",style:{background:"#f8f9fa",padding:"10px 16px",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("small",{className:"text-muted d-none d-sm-block",style:{fontSize:"10px",flex:"1 1 100%",marginBottom:"4px"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"9px"},children:[t.id?.substring(0,12),"..."]})]}),e.jsxs("div",{className:"d-flex w-100 gap-2",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary flex-1",onClick:P,disabled:y||D,style:{flex:1,padding:"10px 16px",fontSize:"13px",borderRadius:"8px",minHeight:"42px"},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger flex-1",onClick:Q,disabled:y||D||!K||!H,style:{flex:1,padding:"10px 16px",fontSize:"13px",borderRadius:"8px",minHeight:"42px"},children:D?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-1"}),"Save"]})})]})]})]})})})]})},Qe=({transaction:t,show:w,onClose:C,onTransactionDeleted:z})=>{const[g,_]=r.useState(!1),[y,A]=r.useState(""),[D,h]=r.useState(""),{showSuccessToast:q,showErrorToast:T}=ye();if(!w||!t)return null;const i=async()=>{_(!0),A("");try{if(!f)throw new Error("Supabase admin client not initialized");const{data:x,error:N}=await f.from("transactions").select("*").eq("id",t.id).single();if(N)throw N;if(!x)throw new Error("Transaction not found");const{error:Y}=await f.from("transactions").delete().eq("id",t.id);if(Y)throw Y;const I=x.type==="income"?-x.amount:x.amount;await f.rpc("update_account_balance",{p_account_id:x.account_id,p_amount_change:I}),x.goal_id&&await f.rpc("update_goal_progress",{p_goal_id:x.goal_id,p_amount:-x.amount}),q("Transaction deleted successfully"),z&&z(t.id),R()}catch(x){A(x.message||"Failed to delete transaction"),T(x.message||"Failed to delete transaction"),_(!1)}},R=()=>{h(""),A(""),C()},U=(x=>{switch(x){case"income":return{label:"Income",color:"#28a745",bg:"success",icon:"fa-plus-circle",impact:"decrease account balance"};case"expense":return{label:"Expense",color:"#dc3545",bg:"danger",icon:"fa-minus-circle",impact:"increase account balance"};case"contribution":return{label:"Contribution",color:"#17a2b8",bg:"info",icon:"fa-flag",impact:"increase account balance and decrease goal progress"};default:return{label:"Transaction",color:"#6c757d",bg:"secondary",icon:"fa-exchange-alt",impact:"affect account balance"}}})(t.type),p=D.toLowerCase()==="delete";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:R}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:R,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered",onClick:x=>x.stopPropagation(),style:{margin:"auto",maxWidth:"480px",width:"calc(100% - 16px)"},children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"16px",overflow:"hidden",maxHeight:"90vh",margin:"8px"},children:[e.jsx("div",{className:"modal-header border-0 text-white",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)",padding:"12px 16px"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"10px",marginRight:"10px"},children:e.jsx("i",{className:"fas fa-trash-alt",style:{fontSize:"16px"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold",style:{fontSize:"14px"},children:"Delete Transaction"}),e.jsx("small",{className:"d-none d-sm-block",style:{opacity:.9,fontSize:"11px"},children:"This action cannot be undone"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:R,disabled:g,style:{width:"30px",height:"30px",borderRadius:"8px",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:"fas fa-times text-danger",style:{fontSize:"12px"}})})]})}),e.jsxs("div",{className:"modal-body",style:{maxHeight:"calc(90vh - 140px)",overflowY:"auto",padding:"12px 16px",WebkitOverflowScrolling:"touch"},children:[y&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),y]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#fff5f5",borderRadius:"8px",borderLeft:"3px solid #dc3545"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-danger mr-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-danger",style:{fontSize:"0.9rem"},children:"Permanent Deletion"}),e.jsxs("p",{className:"mb-0 text-muted",style:{fontSize:"0.8rem"},children:["This will permanently remove the transaction and ",U.impact,". All associated data will be lost."]})]})]})}),e.jsxs("div",{className:"p-3 mb-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[t.user_avatar?e.jsx("img",{src:t.user_avatar,alt:t.user_name,className:"rounded-circle mr-2",style:{width:"36px",height:"36px",objectFit:"cover"},onError:x=>{x.currentTarget.src="../images/placeholder.png"}}):e.jsx("div",{className:"d-flex align-items-center justify-content-center bg-danger text-white rounded-circle mr-2",style:{width:"36px",height:"36px",fontSize:"0.9rem",fontWeight:600},children:(t.user_name||t.user_email||"U")?.charAt(0)?.toUpperCase()}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.9rem"},children:t.user_name||t.user_email||"Unknown User"}),e.jsxs("div",{className:"d-flex align-items-center",style:{gap:"6px"},children:[e.jsxs(G,{bg:U.bg,style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:`fas ${U.icon} mr-1`}),U.label]}),e.jsx(G,{bg:"secondary",style:{fontSize:"0.65rem"},children:t.account_name||"N/A"})]})]})]}),e.jsxs("div",{className:"row text-center g-2",children:[e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"p-2",style:{background:"white",borderRadius:"6px"},children:[e.jsx("div",{className:"font-weight-bold",style:{color:U.color,fontSize:"0.95rem"},children:k(t.amount)}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:"Amount"})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"p-2",style:{background:"white",borderRadius:"6px"},children:[e.jsx("div",{className:"text-danger font-weight-bold",style:{fontSize:"0.95rem"},children:xe(t.date)}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:"Date"})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"p-2",style:{background:"white",borderRadius:"6px"},children:[e.jsx("div",{className:"text-danger font-weight-bold",style:{fontSize:"0.95rem"},children:t.category_name?.substring(0,8)||"N/A"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:"Category"})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"p-2",style:{background:"white",borderRadius:"6px"},children:[e.jsx("div",{className:`font-weight-bold ${t.goal_id?"text-info":"text-secondary"}`,style:{fontSize:"0.95rem"},children:t.goal_id?"Yes":"No"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:"Has Goal"})]})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-list mr-2"}),"What will be affected:"]}),e.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:[{icon:"fa-receipt",label:"Transaction Record"},{icon:"fa-wallet",label:"Account Balance"},{icon:"fa-chart-line",label:"Statistics"},...t.goal_id?[{icon:"fa-flag",label:"Goal Progress"}]:[]].map((x,N)=>e.jsxs("span",{className:"badge badge-light px-2 py-1",style:{fontSize:"0.75rem",border:"1px solid #dee2e6"},children:[e.jsx("i",{className:`fas ${x.icon} text-danger mr-1`}),x.label]},N))})]}),t.goal_id&&e.jsx("div",{className:"p-2 mb-3",style:{background:"rgba(23, 162, 184, 0.1)",borderRadius:"8px",border:"1px solid rgba(23, 162, 184, 0.2)"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-flag text-info mr-2"}),e.jsxs("small",{children:[e.jsx("strong",{children:"Goal Impact:"})," This will reduce goal progress by ",k(t.amount)]})]})}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("label",{className:"mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-keyboard text-danger mr-2"}),"Type ",e.jsx("strong",{className:"text-danger",children:"delete"})," to confirm:"]}),e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"Type 'delete' to confirm",value:D,onChange:x=>h(x.target.value),disabled:g,style:{fontSize:"0.85rem"}})]})]}),e.jsxs("div",{className:"modal-footer border-0",style:{background:"#f8f9fa",padding:"10px 16px",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("small",{className:"text-muted d-none d-sm-block",style:{fontSize:"10px",flex:"1 1 100%",marginBottom:"4px"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"9px"},children:[t.id?.substring(0,12),"..."]})]}),e.jsxs("div",{className:"d-flex w-100 gap-2",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary flex-1",onClick:R,disabled:g,style:{flex:1,padding:"10px 16px",fontSize:"13px",borderRadius:"8px",minHeight:"42px"},children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger flex-1",onClick:i,disabled:g||!p,style:{flex:1,padding:"10px 16px",fontSize:"13px",borderRadius:"8px",minHeight:"42px"},children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-trash-alt mr-1"}),"Delete"]})})]})]})]})})})]})},Xe=({show:t,onClose:w,title:C,color:z,icon:g,data:_})=>t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:w}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:w,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",onClick:y=>y.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",children:[e.jsxs("div",{className:"modal-header bg-gradient-danger text-white border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center",children:[e.jsx("div",{className:"modal-icon-container mr-3",children:e.jsx("i",{className:`fas ${g}`})}),e.jsxs("div",{children:[e.jsx("div",{className:"modal-title-main",children:C}),e.jsx("div",{className:"modal-subtitle",children:"Detailed breakdown"})]})]}),e.jsx("button",{type:"button",className:"close text-white",onClick:w,style:{textShadow:"none",opacity:.9},children:e.jsx("span",{children:"×"})})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"stats-breakdown-list",children:_.map((y,A)=>e.jsxs("div",{className:"stats-breakdown-item d-flex justify-content-between align-items-center py-3 border-bottom",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-medium text-gray-800",children:y.label}),y.subLabel&&e.jsx("small",{className:"text-muted",children:y.subLabel})]}),e.jsx("span",{className:`badge badge-${z} badge-pill px-3 py-2`,children:y.value})]},A))})}),e.jsx("div",{className:"modal-footer bg-light border-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsx("div",{className:"modal-footer-info",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Data reflects current statistics"]})}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:w,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})})]})})})]}):null,Je={"💰":"fa-money-bill-wave","💵":"fa-dollar-sign","💸":"fa-hand-holding-usd","🏦":"fa-university","💳":"fa-credit-card","📈":"fa-chart-line","📊":"fa-chart-bar","💲":"fa-dollar-sign","💱":"fa-exchange-alt","🏧":"fa-credit-card","💼":"fa-briefcase","🏢":"fa-building","👔":"fa-user-tie","📝":"fa-pen","📋":"fa-clipboard","🏠":"fa-home","🛋️":"fa-couch","🛏️":"fa-bed","🚿":"fa-shower","💡":"fa-lightbulb","🔌":"fa-plug","🧹":"fa-broom","🚗":"fa-car","✈️":"fa-plane","🚌":"fa-bus","🚇":"fa-subway","🚕":"fa-taxi","🚲":"fa-bicycle","⛽":"fa-gas-pump","🚀":"fa-rocket","🍔":"fa-utensils","🍕":"fa-pizza-slice","☕":"fa-coffee","🍺":"fa-beer","🍷":"fa-wine-glass","🛒":"fa-shopping-cart","🧺":"fa-shopping-basket","🏥":"fa-hospital","💊":"fa-pills","🏋️":"fa-dumbbell","💉":"fa-syringe","🩺":"fa-stethoscope","❤️":"fa-heart","🎓":"fa-graduation-cap","📚":"fa-book","🏫":"fa-school","💻":"fa-laptop","📱":"fa-mobile-alt","🖥️":"fa-desktop","📺":"fa-tv","🎧":"fa-headphones","📷":"fa-camera","🌐":"fa-globe","📞":"fa-phone","🎬":"fa-film","🎮":"fa-gamepad","🎵":"fa-music","🎭":"fa-theater-masks","🎪":"fa-ticket-alt","🎨":"fa-palette","⚽":"fa-futbol","🏀":"fa-basketball-ball","🎾":"fa-table-tennis","🏊":"fa-swimmer","🎿":"fa-skiing","🏆":"fa-trophy","👕":"fa-tshirt","👗":"fa-female","👟":"fa-shoe-prints","💄":"fa-spa","💍":"fa-ring","💎":"fa-gem","🎁":"fa-gift","🐕":"fa-dog","🐈":"fa-cat","🏕️":"fa-campground","🏖️":"fa-umbrella-beach","🏨":"fa-hotel","👶":"fa-baby","🎂":"fa-birthday-cake","🎉":"fa-birthday-cake","🔧":"fa-wrench","⚙️":"fa-cogs","🧰":"fa-toolbox","📦":"fa-box","🔒":"fa-lock","🛡️":"fa-shield-alt","☀️":"fa-sun","🌙":"fa-moon","🌧️":"fa-cloud-rain","❄️":"fa-snowflake","🔥":"fa-fire","💧":"fa-tint","🌱":"fa-seedling","🌴":"fa-tree","🎯":"fa-bullseye","⭐":"fa-star","✅":"fa-check-circle","⚡":"fa-bolt","🔔":"fa-bell","📌":"fa-thumbtack","🗑️":"fa-trash","⚖️":"fa-balance-scale"},Ke=(t,w)=>t?t.startsWith("fa-")?t:Je[t]||"fa-tag":w==="income"?"fa-plus-circle":w==="expense"?"fa-minus-circle":w==="contribution"?"fa-flag":"fa-tag",Ze=t=>{switch(t){case"income":return"text-success";case"expense":return"text-danger";case"contribution":return"text-info";default:return"text-secondary"}},ms=()=>{const{showSuccessToast:t,showErrorToast:w}=ye(),[C,z]=r.useState([]),[g,_]=r.useState([]),[y,A]=r.useState([]),[D,h]=r.useState([]),[q,T]=r.useState(!0),[i,R]=r.useState(!1),[m,U]=r.useState({totalTransactions:0,totalIncome:0,totalExpenses:0,netAmount:0,avgTransactionAmount:0,transactionsByType:{income:0,expense:0,contribution:0},monthlyTrend:{income:0,expenses:0,net:0}}),[p,x]=r.useState(1),[N,Y]=r.useState(1),[I,o]=r.useState(0),[S,ie]=r.useState(20),[a,E]=r.useState({type:"",user:"",account:"",category:"",startDate:"",endDate:"",minAmount:"",maxAmount:"",search:"",sortBy:"created_at",sortOrder:"desc"}),[te,se]=r.useState(!1),[B,ce]=r.useState(null),[oe,de]=r.useState(new Date),[Q,P]=r.useState(!1),[J,ae]=r.useState(!1),[K,H]=r.useState(!1),[l,n]=r.useState(!1),[u,v]=r.useState(null),[$,O]=r.useState(null),[Z,ee]=r.useState({show:!1,title:"",color:"",icon:"",data:[]}),Ne=r.useRef(!0),W=()=>{O(null)},ue=s=>{O($===s?null:s)};r.useEffect(()=>{const s=d=>{$&&!d.target.closest(".dropdown-menu")&&W()};if($)return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[$]),r.useEffect(()=>(Ue(),()=>{Ne.current=!1,B&&clearTimeout(B)}),[]);const me=r.useCallback((s,d)=>{console.error(`Error during ${d}:`,s);let c=`Failed to ${d}`;if(s?.message)c+=`: ${s.message}`;else if(s?.code)switch(s.code){case"PGRST116":c="No data found or access denied";break;case"PGRST301":c="Database connection error";break;case"42501":c="Insufficient permissions to access this data";break;default:c+=` (Error code: ${s.code})`}w(c)},[w]);r.useEffect(()=>{g.length>0&&X()},[p,a,g.length]),r.useEffect(()=>{if(B&&clearTimeout(B),a.search!==""){const s=setTimeout(()=>{x(1),X()},500);ce(s)}return()=>{B&&clearTimeout(B)}},[a.search]);const Ue=async()=>{try{T(!0),await Promise.all([Me(),Le(),Ge()])}catch(s){me(s,"load initial data")}finally{T(!1)}},Me=async()=>{try{const{data:s,error:d}=await f.auth.admin.listUsers({page:1,perPage:1e3});if(d)throw d;const c=(s?.users||[]).map(b=>({id:b.id,email:b.email||"",user_metadata:b.user_metadata||{}}));_(c)}catch(s){throw console.error("Error fetching users:",s),s}},Le=async()=>{try{const{data:s,error:d}=await f.from("accounts").select("id, account_name, account_type, user_id, status, balance, currency").eq("status","active").order("account_name");if(d)throw d;A(s||[])}catch(s){throw console.error("Error fetching accounts:",s),s}},Ge=async()=>{try{const[s,d]=await Promise.all([f.from("income_categories").select("id, category_name, icon, user_id").order("category_name"),f.from("expense_categories").select("id, category_name, icon, user_id").order("category_name")]);if(s.error)throw s.error;if(d.error)throw d.error;const c=[...(s.data||[]).map(b=>({...b,type:"income"})),...(d.data||[]).map(b=>({...b,type:"expense"}))];h(c)}catch(s){throw console.error("Error fetching categories:",s),s}},Ce=r.useCallback(async()=>{try{let s=f.from("transactions").select("type, amount",{count:"exact"});a.type&&(s=s.eq("type",a.type)),a.user&&(s=s.eq("user_id",a.user)),a.account&&(s=s.eq("account_id",a.account)),a.startDate&&(s=s.gte("date",a.startDate)),a.endDate&&(s=s.lte("date",a.endDate)),a.minAmount&&(s=s.gte("amount",parseFloat(a.minAmount))),a.maxAmount&&(s=s.lte("amount",parseFloat(a.maxAmount))),a.search&&(s=s.or(`notes.ilike.%${a.search}%,description.ilike.%${a.search}%`));const{data:d,error:c,count:b}=await s;if(c)throw c;const V=(d||[]).filter(j=>j.type==="income").reduce((j,F)=>j+parseFloat(F.amount),0),L=(d||[]).filter(j=>j.type==="expense"||j.type==="contribution").reduce((j,F)=>j+parseFloat(F.amount),0),le=(d||[]).reduce((j,F)=>(j[F.type]=(j[F.type]||0)+1,j),{income:0,expense:0,contribution:0});U({totalTransactions:b||0,totalIncome:V,totalExpenses:L,netAmount:V-L,avgTransactionAmount:b&&b>0?(V+L)/b:0,transactionsByType:le,monthlyTrend:{income:0,expenses:0,net:0}}),o(b||0),Y(Math.ceil((b||0)/S))}catch(s){me(s,"load transaction summary")}},[a,S,me]),X=r.useCallback(async()=>{try{R(!0),await Ce();let s=f.from("transactions").select(`
          *,
          income_categories(
            id,
            category_name,
            icon
          ),
          expense_categories(
            id,
            category_name,
            icon
          ),
          goals(
            id,
            goal_name,
            target_amount,
            current_amount
          )
        `);a.type&&(s=s.eq("type",a.type)),a.user&&(s=s.eq("user_id",a.user)),a.account&&(s=s.eq("account_id",a.account)),a.startDate&&(s=s.gte("date",a.startDate)),a.endDate&&(s=s.lte("date",a.endDate)),a.minAmount&&(s=s.gte("amount",parseFloat(a.minAmount))),a.maxAmount&&(s=s.lte("amount",parseFloat(a.maxAmount))),a.search&&(s=s.or(`notes.ilike.%${a.search}%,description.ilike.%${a.search}%`));const d=a.sortOrder==="asc";s=s.order(a.sortBy,{ascending:d});const c=(p-1)*S,b=c+S-1;s=s.range(c,b);const{data:V,error:L}=await s;if(L)throw L;const le=(V||[]).map(j=>{const F=g.find(Se=>Se.id===j.user_id),be=j.income_categories,je=j.expense_categories,ne=be||je,Ae=y.find(Se=>Se.id===j.account_id);let we="Uncategorized",_e="";return j.type==="contribution"?(we="Goal Contribution",_e="fa-flag"):ne&&(we=ne.category_name,_e=ne.icon||""),{...j,user_name:F?.user_metadata?.full_name||F?.email?.split("@")[0]||"Unknown User",user_email:F?.email||"",user_avatar:F?.user_metadata?.avatar_url||"",account_name:Ae?.account_name||"",account_type:Ae?.account_type||"",category_id:j.income_category_id||j.expense_category_id||"",category_name:we,category_icon:_e,goal_name:j.goals?.goal_name||"",notes:j.notes||j.description||""}});z(le),de(new Date)}catch(s){me(s,"load transactions")}finally{R(!1)}},[p,a,S,g,me,Ce]),Te=async()=>{await X(),t("Transactions refreshed")},M=(s,d)=>{E(c=>({...c,[s]:d})),x(1)},ve=()=>{E({type:"",user:"",account:"",category:"",startDate:"",endDate:"",minAmount:"",maxAmount:"",search:"",sortBy:"created_at",sortOrder:"desc"}),x(1)},fe=s=>{v(s),ae(!0)},he=s=>{v(s),H(!0)},ge=s=>{v(s),n(!0)},qe=r.useCallback(s=>{z(d=>d.map(c=>c.id===s.id?{...c,...s}:c)),X(),t("Transaction updated successfully")},[X,t]),Be=r.useCallback(s=>{z(d=>d.filter(c=>c.id!==s)),X(),t("Transaction deleted successfully")},[X,t]),He=r.useCallback(()=>{X(),t("Transaction added successfully")},[X,t]),ze=s=>{switch(s){case"income":return{label:"Income",color:"success",icon:"fa-plus-circle",bgClass:"bg-success"};case"expense":return{label:"Expense",color:"danger",icon:"fa-minus-circle",bgClass:"bg-danger"};case"contribution":return{label:"Contribution",color:"info",icon:"fa-flag",bgClass:"bg-info"};default:return{label:"Unknown",color:"secondary",icon:"fa-question",bgClass:"bg-secondary"}}},pe=s=>s.user_name?s.user_name:s.user_email?s.user_email.split("@")[0]:"Unknown User",Oe=r.useMemo(()=>a.user?y.filter(s=>s.user_id===a.user):y,[y,a.user]);return r.useMemo(()=>{if(!a.user&&!a.type)return D;let s=D;return a.user&&(s=s.filter(d=>d.user_id===a.user)),a.type&&a.type!=="contribution"&&(s=s.filter(d=>d.type===a.type)),s},[D,a.user,a.type]),q?e.jsxs("div",{className:"modern-user-management",children:[e.jsx("div",{className:"block md:hidden py-12 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading transactions..."})]})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("div",{className:"user-management-header mb-5",children:[e.jsx("div",{className:"skeleton-line skeleton-header-title mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-header-subtitle"})]}),e.jsx("div",{className:"stats-cards-container mb-5",children:e.jsx("div",{className:"row",children:Array.from({length:4}).map((s,d)=>e.jsx("div",{className:"col-xl-3 col-md-6 mb-3",children:e.jsx("div",{className:"user-stat-card admin-card-loading",children:e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"skeleton-icon mr-3"}),e.jsxs("div",{className:"stat-info",children:[e.jsx("div",{className:"skeleton-line skeleton-stat-value mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-stat-title"})]})]})})},d))})}),e.jsx("div",{className:"controls-section mb-4",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"skeleton-line skeleton-section-title"})})})}),e.jsx("div",{className:"table-section",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("div",{className:"skeleton-line skeleton-section-title"})}),e.jsx("div",{className:"card-body p-0",children:e.jsxs("div",{className:"skeleton-table",children:[e.jsx("div",{className:"skeleton-table-header mb-3"}),Array.from({length:8}).map((s,d)=>e.jsx("div",{className:"skeleton-table-row mb-2",children:e.jsx("div",{className:"skeleton-line skeleton-table-cell"})},d))]})})]})})]})]}):e.jsxs("div",{className:"modern-user-management",children:[e.jsx("div",{className:"block md:hidden mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-base font-bold text-gray-800",children:"Transactions"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Te,className:"w-9 h-9 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95 disabled:opacity-50",disabled:i,"aria-label":"Refresh data",children:e.jsx("i",{className:`fas fa-sync text-xs ${i?"fa-spin":""}`})}),e.jsx("button",{onClick:()=>P(!0),className:"w-9 h-9 rounded-full bg-rose-600 hover:bg-rose-700 text-white flex items-center justify-center shadow-md transition-all active:scale-95","aria-label":"Add transaction",children:e.jsx("i",{className:"fas fa-plus text-xs"})})]})]})}),e.jsx("div",{className:"user-management-header mb-5 hidden md:block",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start flex-wrap",children:[e.jsx("div",{className:"header-content",children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"header-icon-container mr-3",children:e.jsx("i",{className:"fas fa-exchange-alt"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"header-title mb-1",children:"Transaction Management"}),e.jsx("p",{className:"header-subtitle mb-0",children:"Monitor and manage financial transactions across all user accounts"})]})]})}),e.jsxs("div",{className:"header-actions d-flex align-items-center",children:[e.jsx("div",{className:"last-updated-info mr-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Last updated: ",oe.toLocaleTimeString()]})}),e.jsxs("button",{className:"btn btn-outline-danger btn-sm shadow-sm refresh-btn mr-2",onClick:Te,disabled:i,children:[e.jsx("i",{className:`fas fa-sync-alt mr-1 ${i?"fa-spin":""}`}),i?"Updating...":"Refresh"]}),e.jsxs("button",{className:"btn btn-danger btn-sm shadow-sm",onClick:()=>P(!0),children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Transaction"]})]})]})}),e.jsx("div",{className:"stats-section mb-5",children:(()=>{const s=m.transactionsByType.income||0,d=m.transactionsByType.expense||0,c=m.transactionsByType.contribution||0,b=m.totalTransactions||0,V=b>0?(s/b*100).toFixed(1):0,L=b>0?(d/b*100).toFixed(1):0,le=b>0?(c/b*100).toFixed(1):0,j=m.avgTransactionAmount||0,F=()=>{ee({show:!0,title:"Total Transactions Breakdown",color:"danger",icon:"fa-exchange-alt",data:[{label:"Total Transactions",value:b.toLocaleString()},{label:"Income Transactions",value:s.toLocaleString(),subLabel:`${V}% of total`},{label:"Expense Transactions",value:d.toLocaleString(),subLabel:`${L}% of total`},{label:"Goal Contributions",value:c.toLocaleString(),subLabel:`${le}% of total`},{label:"Average Amount",value:k(j)}]})},be=()=>{ee({show:!0,title:"Total Income Breakdown",color:"success",icon:"fa-plus-circle",data:[{label:"Total Income",value:k(m.totalIncome)},{label:"Income Transactions",value:s.toLocaleString()},{label:"Percentage of Transactions",value:`${V}%`},{label:"Average Income",value:k(s>0?m.totalIncome/s:0)}]})},je=()=>{ee({show:!0,title:"Total Expenses Breakdown",color:"warning",icon:"fa-minus-circle",data:[{label:"Total Expenses",value:k(m.totalExpenses)},{label:"Expense Transactions",value:d.toLocaleString()},{label:"Goal Contributions",value:c.toLocaleString()},{label:"Percentage of Transactions",value:`${(Number(L)+Number(le)).toFixed(1)}%`},{label:"Average Expense",value:k(d+c>0?m.totalExpenses/(d+c):0)}]})},ne=()=>{ee({show:!0,title:"Net Amount Breakdown",color:"info",icon:"fa-balance-scale",data:[{label:"Net Amount",value:k(m.netAmount)},{label:"Total Income",value:k(m.totalIncome)},{label:"Total Expenses",value:k(m.totalExpenses)},{label:"Status",value:m.netAmount>=0?"Surplus":"Deficit"},{label:"Savings Rate",value:`${m.totalIncome>0?(m.netAmount/m.totalIncome*100).toFixed(1):0}%`}]})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:F,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-red-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-exchange-alt text-red-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Total Transactions"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:De(b)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-gray-400",children:[e.jsx("i",{className:"fas fa-chart-bar text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium",children:[s," income, ",d," expense"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:be,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-plus-circle text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Total Income"}),e.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",children:re(m.totalIncome)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-emerald-500",children:[e.jsx("i",{className:"fas fa-arrow-up text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium",children:[V,"% of transactions"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:je,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-rose-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-minus-circle text-rose-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Total Expenses"}),e.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",children:re(m.totalExpenses)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-rose-500",children:[e.jsx("i",{className:"fas fa-arrow-down text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium",children:[L,"% of transactions"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:ne,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-balance-scale text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Net Amount"}),e.jsx("p",{className:`text-sm font-bold truncate ${m.netAmount>=0?"text-emerald-600":"text-rose-600"}`,children:re(m.netAmount)}),e.jsxs("div",{className:`flex items-center gap-1 mt-1 ${m.netAmount>=0?"text-emerald-500":"text-rose-500"}`,children:[e.jsx("i",{className:`fas fa-${m.netAmount>=0?"arrow-up":"arrow-down"} text-[8px]`}),e.jsx("span",{className:"text-[9px] font-medium",children:m.netAmount>=0?"Surplus":"Deficit"})]})]})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-danger h-100 position-relative",onClick:F,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-danger text-uppercase mb-2",children:"Total Transactions"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:De(b)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-muted",children:[e.jsx("i",{className:"fas fa-chart-bar mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[s," income, ",d," expense"]})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-danger",children:e.jsx("i",{className:"fas fa-exchange-alt stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-danger",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-success h-100 position-relative",onClick:be,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-success text-uppercase mb-2",children:"Total Income"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:re(m.totalIncome)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-success",children:[e.jsx("i",{className:"fas fa-arrow-up mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[V,"%"]}),e.jsx("span",{className:"ml-1 small",children:"of transactions"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-success",children:e.jsx("i",{className:"fas fa-plus-circle stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-success",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-warning h-100 position-relative",onClick:je,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-warning text-uppercase mb-2",children:"Total Expenses"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:re(m.totalExpenses)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-danger",children:[e.jsx("i",{className:"fas fa-arrow-down mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[L,"%"]}),e.jsx("span",{className:"ml-1 small",children:"of transactions"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-warning",children:e.jsx("i",{className:"fas fa-minus-circle stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-warning",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-info h-100 position-relative",onClick:ne,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-info text-uppercase mb-2",children:"Net Amount"}),e.jsx("div",{className:`stat-value mb-0 font-weight-bold ${m.netAmount>=0?"text-success":"text-danger"}`,children:re(m.netAmount)}),e.jsxs("div",{className:`stat-change mt-2 d-flex align-items-center ${m.netAmount>=0?"text-success":"text-danger"}`,children:[e.jsx("i",{className:`fas fa-${m.netAmount>=0?"arrow-up":"arrow-down"} mr-1`}),e.jsx("span",{className:"font-weight-medium",children:m.netAmount>=0?"Surplus":"Deficit"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-info",children:e.jsx("i",{className:"fas fa-balance-scale stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-info",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})})]})]})})()}),e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-exchange-alt text-red-500 text-[10px]"}),"Transactions",I>0&&e.jsx("span",{className:"bg-red-100 text-red-600 px-1.5 py-0.5 rounded-full text-[9px]",children:I})]}),e.jsxs("button",{className:"text-[10px] text-gray-500 flex items-center gap-1",onClick:ve,children:[e.jsx("i",{className:"fas fa-undo text-[8px]"}),"Reset"]})]}),e.jsxs("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-[10px]"}),e.jsx("input",{type:"text",className:"w-full pl-8 pr-3 py-2 text-xs bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",placeholder:"Search transactions...",value:a.search,onChange:s=>M("search",s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"flex-1 px-2 py-1.5 text-[10px] bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",value:a.type,onChange:s=>M("type",s.target.value),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"income",children:"Income"}),e.jsx("option",{value:"expense",children:"Expense"}),e.jsx("option",{value:"contribution",children:"Contribution"})]}),e.jsxs("select",{className:"flex-1 px-2 py-1.5 text-[10px] bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",value:a.user,onChange:s=>M("user",s.target.value),children:[e.jsx("option",{value:"",children:"All Users"}),g.slice(0,20).map(s=>e.jsx("option",{value:s.id,children:s.user_metadata?.full_name||s.email?.split("@")[0]},s.id))]})]})]}),e.jsx("div",{className:"divide-y divide-gray-100 max-h-[60vh] overflow-y-auto",children:i?e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading transactions..."})]}):C.length>0?C.map(s=>{const d=ze(s.type);return e.jsx("div",{className:"px-3 py-3 hover:bg-gray-50 active:bg-gray-100 transition-colors",onClick:()=>fe(s),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:s.user_avatar||"../images/placeholder.png",alt:pe(s),className:"w-10 h-10 rounded-full object-cover border-2 border-gray-200",onError:c=>{c.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ${s.type==="income"?"bg-emerald-500":s.type==="expense"?"bg-rose-500":"bg-blue-500"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-800 truncate",children:pe(s)}),e.jsx("span",{className:`flex-shrink-0 px-1 py-0.5 rounded text-[8px] font-semibold ${s.type==="income"?"bg-emerald-100 text-emerald-600":s.type==="expense"?"bg-rose-100 text-rose-600":"bg-blue-100 text-blue-600"}`,children:d.label.toUpperCase()})]}),e.jsx("p",{className:"text-[10px] text-gray-500 truncate",children:s.category_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`text-xs font-bold ${s.type==="income"?"text-emerald-600":s.type==="expense"?"text-rose-600":"text-blue-600"}`,children:k(s.amount)}),e.jsx("span",{className:"text-[9px] text-gray-400",children:xe(s.date)})]})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"w-7 h-7 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 transition-colors",onClick:c=>{c.stopPropagation(),ue(s.id)},onTouchEnd:c=>{c.stopPropagation(),ue(s.id)},"aria-label":"More actions",children:e.jsx("i",{className:"fas fa-ellipsis-v text-[10px]"})}),$===s.id&&e.jsxs("div",{className:"dropdown-menu fixed w-28 bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden",style:{display:"block",zIndex:9999,transform:"translateX(-84px) translateY(4px)"},children:[e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-gray-50 active:bg-gray-100 flex items-center gap-2 transition-colors",onClick:c=>{c.stopPropagation(),W(),fe(s)},onTouchEnd:c=>{c.stopPropagation(),W(),fe(s)},children:[e.jsx("i",{className:"fas fa-eye text-gray-500 text-[10px]"}),e.jsx("span",{className:"text-gray-700",children:"View"})]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-gray-50 active:bg-gray-100 flex items-center gap-2 transition-colors",onClick:c=>{c.stopPropagation(),W(),he(s)},onTouchEnd:c=>{c.stopPropagation(),W(),he(s)},children:[e.jsx("i",{className:"fas fa-edit text-gray-500 text-[10px]"}),e.jsx("span",{className:"text-gray-700",children:"Edit"})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-red-50 active:bg-red-100 flex items-center gap-2 transition-colors",onClick:c=>{c.stopPropagation(),W(),ge(s)},onTouchEnd:c=>{c.stopPropagation(),W(),ge(s)},children:[e.jsx("i",{className:"fas fa-trash text-red-500 text-[10px]"}),e.jsx("span",{className:"text-red-600",children:"Delete"})]})]})]})})]})},s.id)}):e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-3",children:e.jsx("i",{className:"fas fa-exchange-alt text-gray-400 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"No transactions found"}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Try adjusting your filters"})]})}),N>1&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-100 bg-gray-50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-gray-500",children:["Page ",p," of ",N]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>x(s=>Math.max(s-1,1)),disabled:p===1,children:e.jsx("i",{className:"fas fa-chevron-left text-[10px]"})}),e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-[10px] font-medium rounded-lg min-w-[24px] text-center",children:p}),e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>x(s=>Math.min(s+1,N)),disabled:p===N,children:e.jsx("i",{className:"fas fa-chevron-right text-[10px]"})})]})]})]})}),e.jsx("div",{className:"controls-section mb-4 hidden md:block",children:e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6 col-lg-4 mb-3 mb-md-0",children:e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"input-group",children:[e.jsx("div",{className:"input-group-prepend",children:e.jsx("span",{className:"input-group-text bg-white border-right-0",children:e.jsx("i",{className:"fas fa-search text-muted"})})}),e.jsx("input",{type:"text",className:"form-control border-left-0 modern-input",placeholder:"Search transactions by description...",value:a.search,onChange:s=>M("search",s.target.value)})]})})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsxs("select",{className:"form-control modern-select",value:a.type,onChange:s=>M("type",s.target.value),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"income",children:"Income"}),e.jsx("option",{value:"expense",children:"Expense"}),e.jsx("option",{value:"contribution",children:"Contribution"})]})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsxs("select",{className:"form-control modern-select",value:a.user,onChange:s=>M("user",s.target.value),children:[e.jsx("option",{value:"",children:"All Users"}),g.map(s=>e.jsx("option",{value:s.id,children:s.user_metadata?.full_name||s.email},s.id))]})}),e.jsx("div",{className:"col-md-12 col-lg-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"page-size-selector",children:[e.jsx("small",{className:"text-muted mr-2",children:"Show:"}),e.jsxs("select",{className:"form-control form-control-sm d-inline-block w-auto",value:S,onChange:s=>{ie(Number(s.target.value)),x(1)},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("small",{className:"text-muted ml-2",children:"per page"})]}),(a.search||a.type||a.user||a.startDate||a.endDate)&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:ve,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Clear Filters"]})]})})]}),te&&e.jsxs("div",{className:"row mt-3",children:[e.jsx("div",{className:"col-md-3 mb-3",children:e.jsxs("select",{className:"form-control modern-select",value:a.account,onChange:s=>M("account",s.target.value),disabled:!a.user,children:[e.jsx("option",{value:"",children:"All Accounts"}),Oe.map(s=>e.jsxs("option",{value:s.id,children:[s.account_name," (",s.account_type,")"]},s.id))]})}),e.jsx("div",{className:"col-md-2 mb-3",children:e.jsx("input",{type:"date",className:"form-control modern-input",placeholder:"Start Date",value:a.startDate,onChange:s=>M("startDate",s.target.value)})}),e.jsx("div",{className:"col-md-2 mb-3",children:e.jsx("input",{type:"date",className:"form-control modern-input",placeholder:"End Date",value:a.endDate,onChange:s=>M("endDate",s.target.value)})}),e.jsx("div",{className:"col-md-2 mb-3",children:e.jsx("input",{type:"number",className:"form-control modern-input",placeholder:"Min Amount",step:"0.01",value:a.minAmount,onChange:s=>M("minAmount",s.target.value)})}),e.jsx("div",{className:"col-md-2 mb-3",children:e.jsx("input",{type:"number",className:"form-control modern-input",placeholder:"Max Amount",step:"0.01",value:a.maxAmount,onChange:s=>M("maxAmount",s.target.value)})}),e.jsx("div",{className:"col-md-1 mb-3",children:e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:()=>se(!1),children:[e.jsx("i",{className:"fas fa-chevron-up mr-1"}),"Hide"]})})]}),!te&&e.jsx("div",{className:"row mt-2",children:e.jsx("div",{className:"col-12",children:e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>se(!0),children:[e.jsx("i",{className:"fas fa-filter mr-1"}),"Advanced Filters"]})})})]})})}),e.jsx("div",{className:"table-section hidden md:block",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header bg-white border-0 py-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-danger",children:[e.jsx("i",{className:"fas fa-table mr-2"}),"Transactions (",I,")"]}),e.jsx("div",{className:"table-actions",children:e.jsxs("small",{className:"text-muted",children:["Showing ",Math.min((p-1)*S+1,I)," to ",Math.min(p*S,I)," of ",I," entries"]})})]})}),e.jsx("div",{className:"card-body p-0",children:i?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("h6",{className:"text-muted mb-2",children:"Refreshing transactions..."}),e.jsx("p",{className:"text-sm text-muted",children:"Fetching latest transaction data and statistics"})]}):C.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"empty-state-container",children:[e.jsx("i",{className:"fas fa-exchange-alt fa-4x text-gray-300 mb-4"}),e.jsx("h4",{className:"text-gray-700 mb-3",children:Object.values(a).some(s=>s!==""&&s!=="created_at"&&s!=="desc")?"No Matching Transactions":"No Transactions Yet"}),e.jsx("p",{className:"text-muted mb-4 max-width-sm mx-auto",children:Object.values(a).some(s=>s!==""&&s!=="created_at"&&s!=="desc")?"Try adjusting your filters or search criteria to find the transactions you're looking for.":"Users haven't created any transactions yet. Once they start adding transactions, they will appear here."}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[Object.values(a).some(s=>s!==""&&s!=="created_at"&&s!=="desc")&&e.jsxs("button",{className:"btn btn-outline-primary btn-sm mr-2",onClick:ve,children:[e.jsx("i",{className:"fas fa-filter mr-2"}),"Clear Filters"]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>P(!0),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Add First Transaction"]})]})]})}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover modern-table mb-0",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0",children:"User"}),e.jsx("th",{className:"border-0",children:"Type"}),e.jsx("th",{className:"border-0",children:"Amount"}),e.jsx("th",{className:"border-0",children:"Account"}),e.jsx("th",{className:"border-0",children:"Category"}),e.jsx("th",{className:"border-0",children:"Date"}),e.jsx("th",{className:"border-0",children:"Description"}),e.jsx("th",{className:"border-0 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:C.map(s=>{const d=ze(s.type);return e.jsxs("tr",{className:"table-row",children:[e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"user-avatar-container mr-3",children:[e.jsx("img",{src:s.user_avatar||"../images/placeholder.png",alt:pe(s),className:"user-table-avatar",onError:c=>{c.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{className:`user-status-dot status-${s.type||"inactive"}`})]}),e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-name font-weight-medium",children:pe(s)}),e.jsx("div",{className:"user-id text-muted small",children:s.user_email})]})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:`status-badge status-${d.color}`,children:[e.jsx("i",{className:`fas ${d.icon} mr-1`}),d.label]})}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`font-weight-bold text-${d.color}`,children:k(s.amount)})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-medium text-sm",children:s.account_name}),e.jsx("div",{className:"text-xs text-muted",children:s.account_type})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:`fas ${Ke(s.category_icon,s.type)} ${Ze(s.type)} mr-2`}),e.jsx("span",{className:"text-sm",children:s.category_name||"Uncategorized"})]})}),e.jsx("td",{className:"py-3",children:e.jsx("div",{className:"text-sm",children:xe(s.date)})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"text-sm",style:{maxWidth:"200px"},children:[s.notes&&s.notes.length>50?`${s.notes.substring(0,50)}...`:s.notes||"No description",s.goal_name&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"badge badge-info badge-sm",children:[e.jsx("i",{className:"fas fa-flag mr-1"}),s.goal_name]})})]})}),e.jsx("td",{className:"py-3 text-center",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary mr-1",onClick:()=>fe(s),title:"View Details",children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx("button",{className:"btn btn-sm btn-outline-warning mr-1",onClick:()=>he(s),title:"Edit Transaction",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>ge(s),title:"Delete Transaction",children:e.jsx("i",{className:"fas fa-trash"})})]})})]},s.id)})})]})})}),N>1&&e.jsx("div",{className:"card-footer bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsxs("small",{className:"text-muted",children:["Page ",p," of ",N," (",I," total transactions)"]})}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[e.jsx("li",{className:`page-item ${p===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(p-1),disabled:p===1,children:"Previous"})}),Array.from({length:Math.min(5,N)},(s,d)=>{const c=Math.max(1,Math.min(N-4,p-2))+d;return c<=N?e.jsx("li",{className:`page-item ${p===c?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(c),children:c})},c):null}),e.jsx("li",{className:`page-item ${p===N?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(p+1),disabled:p===N,children:"Next"})})]})})]})})]})}),e.jsx(We,{show:Q,onClose:()=>P(!1),onTransactionAdded:He}),e.jsx(Ve,{show:J,onClose:()=>{ae(!1),v(null)},transaction:u,onEdit:he,onDelete:ge}),e.jsx(Ye,{show:K,onClose:()=>{H(!1),v(null)},transaction:u,onTransactionUpdated:qe}),e.jsx(Qe,{show:l,onClose:()=>{n(!1),v(null)},transaction:u,onTransactionDeleted:Be}),e.jsx(Xe,{show:Z.show,onClose:()=>ee(s=>({...s,show:!1})),title:Z.title,color:Z.color,icon:Z.icon,data:Z.data})]})};export{ms as default};
