import{j as e}from"./ui-vendor-Cn1Vfl4w.js";import{r as h,L as T}from"./react-vendor-D4A9EtXC.js";import{t as G,b as K,p as i}from"./index-BbApZ7g3.js";import{d as O,H as V}from"./chart-vendor-B0c7K_uV.js";const Q=({statCards:c,loading:l=!1,onRefresh:g})=>{const[p,N]=h.useState(!1),v=async()=>{g&&(N(!0),await g(),setTimeout(()=>N(!1),500))},a=s=>{switch(s){case"danger":return{bg:"bg-red-100",text:"text-red-500",icon:"bg-red-500"};case"success":return{bg:"bg-emerald-100",text:"text-emerald-500",icon:"bg-emerald-500"};case"warning":return{bg:"bg-amber-100",text:"text-amber-500",icon:"bg-amber-500"};case"info":return{bg:"bg-blue-100",text:"text-blue-500",icon:"bg-blue-500"};case"primary":return{bg:"bg-indigo-100",text:"text-indigo-500",icon:"bg-indigo-500"};default:return{bg:"bg-red-100",text:"text-red-500",icon:"bg-red-500"}}};return l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Array.from({length:4}).map((s,t)=>e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100 animate-pulse",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-gray-200 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-16 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"})]},t))})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"row",children:Array.from({length:4}).map((s,t)=>e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"card shadow h-100 py-3 admin-card admin-card-loading",children:[e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"skeleton-line skeleton-title mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-value mb-3"}),e.jsx("div",{className:"skeleton-line skeleton-change"})]}),e.jsx("div",{className:"col-auto d-none d-sm-block",children:e.jsx("div",{className:"skeleton-icon"})})]})}),e.jsx("div",{className:"card-footer",children:e.jsx("div",{className:"skeleton-line skeleton-footer"})})]})},t))})})]}):e.jsxs("div",{className:"stats-cards-container",children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:c.map((s,t)=>{const y=a(s.color);return e.jsxs(T,{to:s.link,className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:`w-7 h-7 rounded-lg ${y.bg} flex items-center justify-center mb-2`,children:e.jsx("i",{className:`fas ${s.icon} ${y.text} text-xs`})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:s.title}),e.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",children:typeof s.value=="number"?G(s.value):s.value}),s.change&&e.jsxs("div",{className:`flex items-center gap-1 mt-1 ${s.changeType==="increase"?"text-emerald-500":s.changeType==="decrease"?"text-rose-500":"text-gray-400"}`,children:[e.jsx("i",{className:`fas fa-${s.changeType==="increase"?"arrow-up":s.changeType==="decrease"?"arrow-down":"minus"} text-[8px]`}),e.jsx("span",{className:"text-[9px] font-medium",children:s.change})]})]},t)})})}),e.jsxs("div",{className:"d-none d-md-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-gray-800 font-weight-bold mb-0",children:"Dashboard Overview"}),e.jsx("p",{className:"text-muted small mb-0",children:"Real-time statistics and key metrics"})]}),g&&e.jsxs("button",{className:"btn btn-outline-danger btn-sm shadow-sm",onClick:v,disabled:p,children:[e.jsx("i",{className:`fas fa-sync-alt mr-1 ${p?"fa-spin":""}`}),p?"Updating...":"Refresh"]})]}),e.jsx("div",{className:"row d-none d-md-flex",children:c.map((s,t)=>e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:`admin-stat-card admin-stat-card-${s.color} h-100 position-relative`,children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:`stat-title text-${s.color} text-uppercase mb-2`,children:s.title}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:typeof s.value=="number"?G(s.value):s.value}),s.change&&e.jsxs("div",{className:`stat-change mt-2 d-flex align-items-center ${s.changeType==="increase"?"text-success":s.changeType==="decrease"?"text-danger":"text-muted"}`,children:[e.jsx("i",{className:`fas ${s.changeType==="increase"?"fa-arrow-up":s.changeType==="decrease"?"fa-arrow-down":"fa-equals"} mr-1`}),e.jsx("span",{className:"font-weight-medium",children:s.change}),e.jsx("span",{className:"ml-1 small",children:"vs last month"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:`stat-icon-container stat-icon-${s.color}`,children:e.jsx("i",{className:`fas ${s.icon} stat-icon`})})})]})}),e.jsx(T,{to:s.link,className:`card-footer-link bg-${s.color}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})},t))})]})},X=({chartData:c,loading:l=!1})=>{const[g,p]=h.useState("users"),N=()=>({chart:{type:"spline",height:null,reflow:!0,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'}},credits:{enabled:!1},title:{text:"User Growth (Last 30 Days)",style:{fontSize:"16px"}},xAxis:{categories:c.users.map(t=>t.date),labels:{step:window.innerWidth<576?10:5,style:{fontSize:"11px"},rotation:window.innerWidth<576?-45:0}},yAxis:{title:{text:"New Users",style:{fontSize:"12px"}}},legend:{itemStyle:{fontSize:"12px"}},responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{enabled:!1}}}]},tooltip:{crosshairs:!0,shared:!0},series:[{name:"New Users",data:c.users.map(t=>t.count),color:"#dc2626"}]}),v=()=>({chart:{type:"column",height:null,reflow:!0,style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'}},credits:{enabled:!1},title:{text:"Transaction Volume (Last 30 Days)",style:{fontSize:"16px"}},xAxis:{categories:c.transactions.map(t=>t.date),labels:{step:window.innerWidth<576?10:5,style:{fontSize:"11px"},rotation:window.innerWidth<576?-45:0}},yAxis:{title:{text:"Transaction Count",style:{fontSize:"12px"}}},legend:{itemStyle:{fontSize:"12px"}},responsive:{rules:[{condition:{maxWidth:500},chartOptions:{legend:{enabled:!1}}}]},series:[{name:"Transactions",data:c.transactions.map(t=>t.count),color:"#b91c1c"}]}),a=()=>({chart:{type:"spline",height:280,spacing:[10,10,10,10],style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'}},credits:{enabled:!1},title:{text:null},xAxis:{categories:c.users.map(t=>t.date),labels:{step:7,style:{fontSize:"10px",color:"#6b7280"},rotation:-45}},yAxis:{title:{text:null},labels:{style:{fontSize:"10px",color:"#6b7280"}}},legend:{enabled:!1},tooltip:{crosshairs:!0,shared:!0},series:[{name:"New Users",data:c.users.map(t=>t.count),color:"#dc2626"}]}),s=()=>({chart:{type:"column",height:280,spacing:[10,10,10,10],style:{fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'}},credits:{enabled:!1},title:{text:null},xAxis:{categories:c.transactions.map(t=>t.date),labels:{step:7,style:{fontSize:"10px",color:"#6b7280"},rotation:-45}},yAxis:{title:{text:null},labels:{style:{fontSize:"10px",color:"#6b7280"}}},legend:{enabled:!1},series:[{name:"Transactions",data:c.transactions.map(t=>t.count),color:"#b91c1c"}]});return l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-block d-md-none",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"d-flex bg-light",children:[e.jsx("div",{className:"flex-fill py-3 text-center",children:e.jsx("div",{className:"bg-secondary rounded mx-auto",style:{height:"12px",width:"64px",opacity:.3}})}),e.jsx("div",{className:"flex-fill py-3 text-center",children:e.jsx("div",{className:"bg-secondary rounded mx-auto",style:{height:"12px",width:"80px",opacity:.3}})})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"bg-light rounded d-flex align-items-center justify-content-center",style:{height:"256px"},children:e.jsx("i",{className:"fas fa-chart-line text-secondary fa-2x",style:{opacity:.3}})})})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-xl-6 col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between admin-card-header",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"User Growth"})}),e.jsx("div",{className:"card-body text-center",children:e.jsx("div",{style:{minHeight:"250px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{children:[e.jsx("i",{className:"fas fa-spinner fa-spin fa-2x text-gray-300"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading chart data..."})]})})})]})}),e.jsx("div",{className:"col-xl-6 col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between admin-card-header",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"Transaction Volume"})}),e.jsx("div",{className:"card-body text-center",children:e.jsx("div",{style:{minHeight:"250px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{children:[e.jsx("i",{className:"fas fa-spinner fa-spin fa-2x text-gray-300"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading chart data..."})]})})})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-block d-md-none mb-4",children:e.jsxs("div",{className:"bg-white rounded shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"d-flex",style:{backgroundColor:"#f8f9fa"},children:[e.jsxs("button",{onClick:()=>p("users"),className:`flex-fill py-3 border-0 font-weight-semibold position-relative ${g==="users"?"text-danger bg-white":"text-secondary bg-transparent"}`,style:{fontSize:"14px"},children:[e.jsx("i",{className:"fas fa-users mr-2",style:{fontSize:"12px"}}),"User Growth",g==="users"&&e.jsx("div",{className:"position-absolute bg-danger",style:{bottom:0,left:0,right:0,height:"2px"}})]}),e.jsxs("button",{onClick:()=>p("transactions"),className:`flex-fill py-3 border-0 font-weight-semibold position-relative ${g==="transactions"?"text-danger bg-white":"text-secondary bg-transparent"}`,style:{fontSize:"14px"},children:[e.jsx("i",{className:"fas fa-exchange-alt mr-2",style:{fontSize:"12px"}}),"Transactions",g==="transactions"&&e.jsx("div",{className:"position-absolute bg-danger",style:{bottom:0,left:0,right:0,height:"2px"}})]})]}),e.jsx("div",{className:"p-3",children:g==="users"?c.users.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-center mb-3",children:e.jsxs("span",{className:"d-flex align-items-center text-secondary",style:{fontSize:"12px"},children:[e.jsx("span",{className:"rounded-circle bg-danger mr-2",style:{width:"12px",height:"12px"}}),"New Users"]})}),e.jsx(O,{highcharts:V,options:a()})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto mb-3",style:{width:"64px",height:"64px"},children:e.jsx("i",{className:"fas fa-users text-secondary fa-2x"})}),e.jsx("p",{className:"text-secondary",children:"No user data available"})]}):c.transactions.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"d-flex justify-content-center mb-3",children:e.jsxs("span",{className:"d-flex align-items-center text-secondary",style:{fontSize:"12px"},children:[e.jsx("span",{className:"rounded-circle mr-2",style:{width:"12px",height:"12px",backgroundColor:"#b91c1c"}}),"Transactions"]})}),e.jsx(O,{highcharts:V,options:s()})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"rounded-circle bg-light d-flex align-items-center justify-content-center mx-auto mb-3",style:{width:"64px",height:"64px"},children:e.jsx("i",{className:"fas fa-exchange-alt text-secondary fa-2x"})}),e.jsx("p",{className:"text-secondary",children:"No transaction data available"})]})})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-xl-6 col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsxs("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between admin-card-header",children:[e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"User Growth"}),e.jsx("div",{className:"dropdown no-arrow",children:e.jsx("a",{className:"dropdown-toggle",href:"#",role:"button",id:"dropdownMenuLink","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:e.jsx("i",{className:"fas fa-ellipsis-v fa-sm fa-fw text-gray-400"})})})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"admin-chart-container",style:{minHeight:"250px",width:"100%"},children:e.jsx(O,{highcharts:V,options:N()})})})]})}),e.jsx("div",{className:"col-xl-6 col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsxs("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between admin-card-header",children:[e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"Transaction Volume"}),e.jsx("div",{className:"dropdown no-arrow",children:e.jsx("a",{className:"dropdown-toggle",href:"#",role:"button",id:"dropdownMenuLink","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",children:e.jsx("i",{className:"fas fa-ellipsis-v fa-sm fa-fw text-gray-400"})})})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"admin-chart-container",style:{minHeight:"250px",width:"100%"},children:e.jsx(O,{highcharts:V,options:v()})})})]})})]})]})},Z=({user:c,isOpen:l,onClose:g,onUserUpdate:p})=>{const[N,v]=h.useState(!1),[a,s]=h.useState(null),[t,y]=h.useState(!1),{showSuccessToast:_,showErrorToast:S}=K();h.useEffect(()=>{c&&l&&r()},[c,l]);const r=async()=>{if(c){v(!0);try{const{data:m,error:C}=await i.from("profiles").select("*").eq("id",c.id).single();if(C)throw C;const{data:F,error:A}=await i.from("admin_users").select("user_id").eq("user_id",c.id);A&&A.code!=="PGRST116"&&console.warn("Error checking admin status:",A),y(!!(F&&F.length>0)),s({...c,...m})}catch(m){console.error("Error fetching user details:",m),S("Failed to load user details")}finally{v(!1)}}},f=async()=>{if(a){v(!0);try{if(t){const{error:m}=await i.from("admin_users").delete().eq("user_id",a.id);if(m)throw m;y(!1),_("Admin role removed successfully")}else{const{error:m}=await i.from("admin_users").insert({user_id:a.id});if(m)throw m;y(!0),_("Admin role granted successfully")}p&&p({...a,role:t?"user":"admin"})}catch(m){console.error("Error updating admin role:",m),S("Failed to update admin role")}finally{v(!1)}}},R=async()=>{if(a){v(!0);try{const m=!a.is_active,{error:C}=await i.from("profiles").update({is_active:m}).eq("id",a.id);if(C)throw C;s({...a,is_active:m}),_(`User ${m?"activated":"deactivated"} successfully`),p&&p({...a,is_active:m})}catch(m){console.error("Error updating user status:",m),S("Failed to update user status")}finally{v(!1)}}};return!l||!c?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:g}),e.jsx("div",{className:"block md:hidden fixed inset-0 z-[1050]",onClick:g,children:e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl max-h-[90vh] overflow-y-auto animate__animated animate__slideInUp animate__faster",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white pt-3 pb-2 px-4 border-b border-gray-100 z-10",children:[e.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full mx-auto mb-3"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h5",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-circle text-red-500"}),"User Details"]}),e.jsx("button",{onClick:g,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200 transition-colors",children:e.jsx("i",{className:"fas fa-times text-xs"})})]})]}),N?e.jsxs("div",{className:"p-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading user details..."})]}):a?e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.avatar_url||a.user_metadata?.avatar_url||"/images/placeholder.png",alt:a.full_name||a.user_metadata?.full_name||"User",className:"w-16 h-16 rounded-full object-cover border-2 border-white shadow-lg"}),e.jsx("span",{className:`absolute bottom-0 right-0 w-4 h-4 rounded-full border-2 border-white ${a.is_active?"bg-emerald-500":"bg-gray-400"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-base font-bold text-gray-800 truncate",children:a.full_name||a.user_metadata?.full_name||"Unnamed User"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:a.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-semibold ${t?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"}`,children:t?"Administrator":"User"}),a.email_confirmed_at&&e.jsxs("span",{className:"px-2 py-0.5 rounded-full text-[9px] font-semibold bg-emerald-100 text-emerald-600",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Verified"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-red-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-calendar-plus text-red-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase",children:"Joined"}),e.jsx("p",{className:"text-xs font-semibold text-gray-800",children:new Date(a.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-sign-in-alt text-blue-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase",children:"Last Sign In"}),e.jsx("p",{className:"text-xs font-semibold text-gray-800",children:a.last_sign_in_at?new Date(a.last_sign_in_at).toLocaleDateString():"Never"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-envelope-open text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase",children:"Email Verified"}),e.jsx("p",{className:"text-xs font-semibold text-gray-800",children:a.email_confirmed_at?new Date(a.email_confirmed_at).toLocaleDateString():"Not verified"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-coins text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase",children:"Currency"}),e.jsx("p",{className:"text-xs font-semibold text-gray-800",children:a?.currency_preference||"USD"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 mb-4",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase mb-1",children:"User ID"}),e.jsx("p",{className:"text-[10px] text-gray-600 font-mono truncate",children:a.id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:f,disabled:N,className:`w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 transition-colors ${t?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-red-50 text-red-600 hover:bg-red-100"}`,children:[e.jsx("i",{className:`fas ${t?"fa-user-minus":"fa-user-shield"} text-xs`}),t?"Remove Admin Role":"Grant Admin Role"]}),e.jsxs("button",{onClick:R,disabled:N,className:`w-full py-3 rounded-xl text-sm font-semibold flex items-center justify-center gap-2 transition-colors ${a.is_active?"bg-amber-50 text-amber-600 hover:bg-amber-100":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100"}`,children:[e.jsx("i",{className:`fas ${a.is_active?"fa-user-slash":"fa-user-check"} text-xs`}),a.is_active?"Deactivate User":"Activate User"]})]})]}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-amber-500 text-2xl"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Failed to load user details"})]})]})}),e.jsx("div",{className:"modal fade show d-none d-md-block",tabIndex:-1,style:{zIndex:1050,display:"block"},onClick:g,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",onClick:m=>m.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",children:[e.jsxs("div",{className:"modal-header bg-gradient-danger text-white border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-user-circle mr-2"}),"User Details"]}),e.jsx("button",{type:"button",className:"close text-white",onClick:g,style:{textShadow:"none",opacity:.8},children:e.jsx("span",{children:"Ã—"})})]}),e.jsx("div",{className:"modal-body p-0",children:N?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading user details..."})]}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"user-profile-header bg-light p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-auto",children:e.jsxs("div",{className:"position-relative",children:[e.jsx("img",{src:a.avatar_url||a.user_metadata?.avatar_url||"/images/placeholder.png",alt:a.full_name||a.user_metadata?.full_name||"User",className:"rounded-circle shadow",style:{width:"80px",height:"80px",objectFit:"cover"}}),e.jsx("span",{className:`badge badge-${a.is_active?"success":"secondary"} position-absolute`,style:{bottom:"5px",right:"5px"},children:a.is_active?"Active":"Inactive"})]})}),e.jsxs("div",{className:"col",children:[e.jsx("h4",{className:"mb-1 font-weight-bold text-gray-800",children:a.full_name||a.user_metadata?.full_name||"Unnamed User"}),e.jsxs("p",{className:"text-muted mb-2",children:[e.jsx("i",{className:"fas fa-envelope mr-1"}),a.email]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:`badge badge-${t?"danger":"primary"} mr-2`,children:t?"Administrator":"User"}),a.email_confirmed_at&&e.jsxs("span",{className:"badge badge-success",children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Verified"]})]})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card mb-3",children:[e.jsxs("h6",{className:"text-danger font-weight-bold mb-2",children:[e.jsx("i",{className:"fas fa-calendar-plus mr-2"}),"Account Information"]}),e.jsxs("div",{className:"info-item mb-2",children:[e.jsx("span",{className:"text-muted small",children:"Joined:"}),e.jsx("div",{className:"font-weight-medium",children:new Date(a.created_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"info-item mb-2",children:[e.jsx("span",{className:"text-muted small",children:"Last Sign In:"}),e.jsx("div",{className:"font-weight-medium",children:a.last_sign_in_at?new Date(a.last_sign_in_at).toLocaleString():"Never"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"text-muted small",children:"Email Verified:"}),e.jsx("div",{className:"font-weight-medium",children:a.email_confirmed_at?new Date(a.email_confirmed_at).toLocaleDateString():"Not verified"})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"info-card mb-3",children:[e.jsxs("h6",{className:"text-danger font-weight-bold mb-2",children:[e.jsx("i",{className:"fas fa-cogs mr-2"}),"Account Settings"]}),e.jsxs("div",{className:"info-item mb-2",children:[e.jsx("span",{className:"text-muted small",children:"User ID:"}),e.jsx("div",{className:"font-weight-medium small font-monospace",children:a.id})]}),e.jsxs("div",{className:"info-item mb-2",children:[e.jsx("span",{className:"text-muted small",children:"Currency:"}),e.jsx("div",{className:"font-weight-medium",children:a?.currency_preference||"USD"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"text-muted small",children:"Timezone:"}),e.jsx("div",{className:"font-weight-medium",children:a?.timezone||"UTC"})]})]})})]})})]}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-warning mb-3"}),e.jsx("p",{className:"text-muted",children:"Failed to load user details"})]})}),a&&e.jsx("div",{className:"modal-footer bg-light border-0",children:e.jsxs("div",{className:"w-100 d-flex justify-content-between",children:[e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:`btn ${t?"btn-outline-secondary":"btn-outline-info"}`,onClick:f,disabled:N,children:[e.jsx("i",{className:`fas ${t?"fa-user-minus":"fa-user-shield"} mr-1`}),t?"Remove Admin":"Make Admin"]}),e.jsxs("button",{className:`btn ${a.is_active?"btn-outline-warning":"btn-outline-success"}`,onClick:R,disabled:N,children:[e.jsx("i",{className:`fas ${a.is_active?"fa-user-slash":"fa-user-check"} mr-1`}),a.is_active?"Deactivate":"Activate"]})]}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:g,children:"Close"})]})})]})})})]})},ee=({recentUsers:c,systemStatus:l,loading:g=!1})=>{const[p,N]=h.useState(null),[v,a]=h.useState(!1),[s,t]=h.useState("users"),y=r=>{N(r),a(!0)},_=()=>{a(!1),N(null)},S=(r,f)=>f==="error"?r<2?"bg-emerald-500":r<5?"bg-amber-500":"bg-rose-500":r<50?"bg-emerald-500":r<80?"bg-amber-500":"bg-rose-500";return g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex bg-slate-50",children:[e.jsx("div",{className:"flex-1 py-3.5 text-center",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16 mx-auto animate-pulse"})}),e.jsx("div",{className:"flex-1 py-3.5 text-center",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-20 mx-auto animate-pulse"})})]}),e.jsx("div",{className:"p-4 space-y-3",children:Array.from({length:3}).map((r,f)=>e.jsxs("div",{className:"flex items-center gap-3 animate-pulse",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-16"})]})]},f))})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4 admin-card",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"Recent Users"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered admin-table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Joined"}),e.jsx("th",{className:"d-none d-md-table-cell",children:"Account"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:Array.from({length:3}).map((r,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"skeleton-avatar mr-2"}),e.jsx("div",{className:"skeleton-line skeleton-user-name"})]})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton-line skeleton-date"})}),e.jsx("td",{className:"d-none d-md-table-cell",children:e.jsx("div",{className:"skeleton-badge"})}),e.jsx("td",{children:e.jsx("div",{className:"skeleton-button"})})]},f))})]})})})]})}),e.jsx("div",{className:"col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4 admin-card",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"System Status"})}),e.jsx("div",{className:"card-body",children:Array.from({length:4}).map((r,f)=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("div",{className:"skeleton-line skeleton-status-title"}),e.jsx("div",{className:"skeleton-line skeleton-percentage"})]}),e.jsx("div",{className:"skeleton-progress-bar"})]},f))})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex bg-slate-50",children:[e.jsxs("button",{onClick:()=>t("users"),className:`flex-1 py-3.5 text-sm font-semibold transition-all relative ${s==="users"?"text-red-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-users mr-2 text-xs"}),"Recent Users",s==="users"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600"})]}),e.jsxs("button",{onClick:()=>t("status"),className:`flex-1 py-3.5 text-sm font-semibold transition-all relative ${s==="status"?"text-red-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-server mr-2 text-xs"}),"System Status",s==="status"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600"})]})]}),e.jsx("div",{className:"p-4",children:s==="users"?e.jsx("div",{className:"animate__animated animate__fadeIn",children:c.length>0?e.jsxs("div",{className:"space-y-3",children:[c.slice(0,5).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:r.user_metadata.avatar_url||"../images/placeholder.png",alt:r.user_metadata.full_name||"User",className:"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800 truncate max-w-[120px]",children:r.user_metadata.full_name||"N/A"}),e.jsx("p",{className:"text-[10px] text-gray-500",children:new Date(r.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-semibold ${r.role==="admin"?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"}`,children:r.role}),e.jsx("button",{onClick:()=>y(r),className:"w-7 h-7 rounded-full bg-red-50 text-red-500 flex items-center justify-center hover:bg-red-100 transition-colors","aria-label":"View user",children:e.jsx("i",{className:"fas fa-eye text-[10px]"})})]})]},r.id)),e.jsxs(T,{to:"/admin/users",className:"flex items-center justify-center gap-2 py-3 text-red-600 text-sm font-medium hover:bg-red-50 rounded-xl transition-colors",children:[e.jsx("i",{className:"fas fa-users text-xs"}),"View All Users"]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4",children:e.jsx("i",{className:"fas fa-users text-gray-400 text-2xl"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No users found"})]})}):e.jsxs("div",{className:"animate__animated animate__fadeIn space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-database text-blue-500 text-[10px]"}),"Database Storage"]}),e.jsxs("span",{className:"text-xs font-bold text-gray-800",children:[l.dbStorage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${S(l.dbStorage,"db")}`,style:{width:`${l.dbStorage}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-bolt text-amber-500 text-[10px]"}),"API Request Rate"]}),e.jsxs("span",{className:"text-xs font-bold text-gray-800",children:[l.apiRequestRate,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${S(l.apiRequestRate,"api")}`,style:{width:`${l.apiRequestRate}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-rose-500 text-[10px]"}),"Error Rate"]}),e.jsxs("span",{className:"text-xs font-bold text-gray-800",children:[l.errorRate,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${S(l.errorRate,"error")}`,style:{width:`${Math.max(l.errorRate*10,5)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-700 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-server text-indigo-500 text-[10px]"}),"Server Load"]}),e.jsxs("span",{className:"text-xs font-bold text-gray-800",children:[l.serverLoad,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-500 ${S(l.serverLoad,"load")}`,style:{width:`${l.serverLoad}%`}})})]}),e.jsxs("div",{className:"pt-3 border-t border-gray-100",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Recent Logs"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:l.logs.slice(0,3).map((r,f)=>e.jsxs("div",{className:`px-3 py-2 rounded-lg text-[10px] ${f===0?"bg-emerald-50 text-emerald-700":f===1?"bg-blue-50 text-blue-700":"bg-amber-50 text-amber-700"}`,children:[e.jsx("i",{className:`fas fa-${f===0?"check-circle":f===1?"info-circle":"exclamation-triangle"} mr-1`}),r]},f))})]}),e.jsxs(T,{to:"/admin/settings",className:"flex items-center justify-center gap-2 py-3 text-red-600 text-sm font-medium hover:bg-red-50 rounded-xl transition-colors",children:[e.jsx("i",{className:"fas fa-cog text-xs"}),"System Settings"]})]})})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"Recent Users"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered admin-table table-sm",width:"100%",cellSpacing:"0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Joined"}),e.jsx("th",{className:"d-none d-md-table-cell",children:"Account"}),e.jsx("th",{children:"Action"})]})}),e.jsxs("tbody",{children:[c.map(r=>e.jsxs("tr",{className:"admin-user-row",children:[e.jsxs("td",{className:"d-flex align-items-center",children:[e.jsx("img",{src:r.user_metadata.avatar_url||"../images/placeholder.png",alt:r.user_metadata.full_name||"User",className:"admin-user-avatar mr-2",style:{maxWidth:"32px",height:"32px"}}),e.jsx("div",{className:"text-truncate",style:{maxWidth:"120px"},children:r.user_metadata.full_name||"N/A"})]}),e.jsx("td",{className:"small",children:new Date(r.created_at).toLocaleDateString()}),e.jsx("td",{className:"d-none d-md-table-cell",children:e.jsx("span",{className:`badge ${r.role==="admin"?"badge-danger":"badge-primary"}`,children:r.role})}),e.jsx("td",{children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>y(r),children:[e.jsx("i",{className:"fas fa-eye"}),e.jsx("span",{className:"d-none d-sm-inline ml-1",children:"View"})]})})]},r.id)),c.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-3",children:e.jsx("p",{className:"text-muted mb-0",children:"No users found"})})})]})]})}),e.jsxs(T,{to:"/admin/users",className:"btn btn-outline-primary btn-sm mt-1",children:[e.jsx("i",{className:"fas fa-users mr-1"}),e.jsx("span",{children:"View All Users"})]})]})]})}),e.jsx("div",{className:"col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("h6",{className:"m-0 font-weight-bold text-danger",children:"System Status"})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("h4",{className:"small font-weight-bold",children:["Database Storage ",e.jsxs("span",{className:"float-right",children:[l.dbStorage,"%"]})]}),e.jsx("div",{className:"progress mb-4",children:e.jsx("div",{className:"progress-bar bg-info",role:"progressbar",style:{width:`${l.dbStorage}%`},"aria-valuenow":l.dbStorage,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("h4",{className:"small font-weight-bold",children:["API Request Rate ",e.jsxs("span",{className:"float-right",children:[l.apiRequestRate,"%"]})]}),e.jsx("div",{className:"progress mb-4",children:e.jsx("div",{className:"progress-bar bg-success",role:"progressbar",style:{width:`${l.apiRequestRate}%`},"aria-valuenow":l.apiRequestRate,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("h4",{className:"small font-weight-bold",children:["Error Rates ",e.jsxs("span",{className:"float-right",children:[l.errorRate,"%"]})]}),e.jsx("div",{className:"progress mb-4",children:e.jsx("div",{className:"progress-bar bg-danger",role:"progressbar",style:{width:`${l.errorRate}%`},"aria-valuenow":l.errorRate,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("h4",{className:"small font-weight-bold",children:["Server Load ",e.jsxs("span",{className:"float-right",children:[l.serverLoad,"%"]})]}),e.jsx("div",{className:"progress mb-4",children:e.jsx("div",{className:"progress-bar bg-warning",role:"progressbar",style:{width:`${l.serverLoad}%`},"aria-valuenow":l.serverLoad,"aria-valuemin":0,"aria-valuemax":100})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"mb-2",children:"Recent System Logs"}),e.jsx("div",{className:"system-logs-container",style:{maxHeight:"200px",overflowY:"auto"},children:l.logs.map((r,f)=>e.jsx("div",{className:`alert alert-${f===0?"success":f===1?"info":"warning"} mb-2 py-2`,children:e.jsxs("small",{children:[e.jsx("i",{className:`fas fa-${f===0?"check-circle":f===1?"info-circle":"exclamation-triangle"} mr-1`}),r]})},f))}),e.jsxs(T,{to:"/admin/settings",className:"btn btn-outline-primary btn-sm mt-3",children:[e.jsx("i",{className:"fas fa-cog mr-1"}),e.jsx("span",{children:"View System Settings"})]})]})]})]})})]}),e.jsx(Z,{user:p,isOpen:v,onClose:_,onUserUpdate:()=>{}})]})},se=()=>{const[c,l]=h.useState(!0),[g,p]=h.useState([]),[N,v]=h.useState({users:[],transactions:[],budgets:[],goals:[]}),[a,s]=h.useState([]),[t,y]=h.useState({dbStorage:0,apiRequestRate:0,errorRate:0,serverLoad:0,logs:[]}),[_,S]=h.useState(!1),[r,f]=h.useState([]),R=h.useCallback(async()=>{try{if(!i){console.error("Admin client not available");return}const{count:d,error:n}=await i.from("profiles").select("*",{count:"exact",head:!0}),u=new Date,o=new Date(u.getFullYear(),u.getMonth(),1).toISOString().split("T")[0],j=new Date(u.getFullYear(),u.getMonth()+1,0).toISOString().split("T")[0],{count:b,error:M}=await i.from("transactions").select("*",{count:"exact",head:!0}).gte("date",o).lte("date",j),{data:w,error:$}=await i.from("budgets").select("id"),I=w?w.length:0,{data:L,error:E}=await i.from("goals").select("id"),x=L?L.length:0,D=1.5,k=2.3,z=.5,H=[{title:"Total Users",value:d||0,icon:"fa-users",color:"primary",change:`+${3.5.toFixed(1)}%`,changeType:"increase",link:"/admin/users"},{title:"Monthly Transactions",value:b||31,icon:"fa-exchange-alt",color:"success",change:`${D>0?"+":""}${D.toFixed(1)}%`,changeType:D>0?"increase":"decrease",link:"/admin/transactions"},{title:"Active Budgets",value:I||0,icon:"fa-wallet",color:"info",change:`${k>0?"+":""}${k.toFixed(1)}%`,changeType:k>0?"increase":k<0?"decrease":"neutral",link:"/admin/budgets"},{title:"Progress Goals",value:x||0,icon:"fa-bullseye",color:"warning",change:`${z>0?"+":""}${z.toFixed(1)}%`,changeType:z>0?"increase":z<0?"decrease":"neutral",link:"/admin/goals"}];p(H)}catch{p([{title:"Total Users",value:0,icon:"fa-users",color:"primary",change:"+3.5%",changeType:"increase",link:"/admin/users"},{title:"Monthly Transactions",value:31,icon:"fa-exchange-alt",color:"success",change:"0.0%",changeType:"neutral",link:"/admin/transactions"},{title:"Active Budgets",value:0,icon:"fa-wallet",color:"info",change:"0.0%",changeType:"neutral",link:"/admin/budgets"},{title:"Progress Goals",value:0,icon:"fa-bullseye",color:"warning",change:"0.0%",changeType:"neutral",link:"/admin/goals"}])}},[]),m=(d,n,u)=>{Object.keys(d).forEach(o=>{d[o]=Math.floor(Math.random()*(u-n+1))+n})},C=()=>{const d=new Date,n=[];for(let o=29;o>=0;o--){const j=new Date(d);j.setDate(j.getDate()-o),n.push(j.toISOString().split("T")[0])}const u={users:n.map(o=>({date:o,count:Math.floor(Math.random()*3)})),transactions:n.map(o=>({date:o,count:Math.floor(Math.random()*5)+1})),budgets:n.map(o=>({date:o,count:Math.floor(Math.random()*2)})),goals:n.map(o=>({date:o,count:Math.floor(Math.random()*1)}))};v(u)},F=h.useCallback(async()=>{try{const d=new Date,n=new Date(d);n.setDate(n.getDate()-29);const u=n.toISOString().split("T")[0],o=d.toISOString().split("T")[0],j=[],b=new Date(u),M=new Date(o);for(;b<=M;)j.push(b.toISOString().split("T")[0]),b.setDate(b.getDate()+1);const w=j.reduce((x,D)=>(x[D]=0,x),{}),$={...w},I={...w},L={...w};try{if(i){const{data:x}=await i.from("profiles").select("created_at").gte("created_at",u).lte("created_at",o+"T23:59:59");x&&x.forEach(D=>{const k=new Date(D.created_at).toISOString().split("T")[0];w[k]!==void 0&&w[k]++})}}catch{m(w,0,3)}try{if(i){const{data:x}=await i.from("transactions").select("date").gte("date",u).lte("date",o);x?x.forEach(D=>{const k=D.date;$[k]!==void 0&&$[k]++}):m($,1,5)}}catch{m($,1,5)}m(I,0,2),m(L,0,1);const E={users:j.map(x=>({date:x,count:w[x]||0})),transactions:j.map(x=>({date:x,count:$[x]||0})),budgets:j.map(x=>({date:x,count:I[x]||0})),goals:j.map(x=>({date:x,count:L[x]||0}))};v(E)}catch{C()}},[]),A=h.useCallback(async()=>{try{if(!i){console.error("Admin client not available");return}const{data:d,error:n}=await i.auth.admin.listUsers({page:1,perPage:8});if(n)throw n;const u=[],o=b=>b.banned?"suspended":b.email_confirmed_at?"active":"inactive",j=d?.users?.map(b=>{const M=u.includes(b.id),w=o(b);return{id:b.id,email:b.email||"",created_at:b.created_at,last_sign_in_at:b.last_sign_in_at,user_metadata:b.user_metadata||{full_name:"Unknown User"},role:M?"admin":"user",status:w,banned:b.banned,email_confirmed_at:b.email_confirmed_at}})||[];s(j.slice(0,10))}catch{s([])}},[]),P=h.useCallback(async()=>{try{if(!i){console.error("Admin client not available");return}const d=500,{data:n}=await i.rpc("get_database_size").maybeSingle();let u=5;if(n&&typeof n=="object"&&"size_bytes"in n){const U=n.size_bytes/1048576;u=Math.round(U/d*100)}else{const{count:U}=await i.from("system_activity_log").select("*",{count:"exact",head:!0});u=Math.round(25/d*100)}const o=new Date(Date.now()-24*60*60*1e3).toISOString(),{count:j}=await i.from("prediction_requests").select("*",{count:"exact",head:!0}).gte("request_at",o),{count:b}=await i.from("ai_insights").select("*",{count:"exact",head:!0}).gte("generated_at",o),{count:M}=await i.from("system_activity_log").select("*",{count:"exact",head:!0}).gte("created_at",o),w=(j||0)+(b||0)+(M||0),I=Math.min(Math.round(w/1e3*100),100),{count:L}=await i.from("system_activity_log").select("*",{count:"exact",head:!0}).in("severity",["error","critical"]),{count:E}=await i.from("system_activity_log").select("*",{count:"exact",head:!0}),x=E&&E>0?Math.round((L||0)/E*100):0,{count:D}=await i.from("transactions").select("*",{count:"exact",head:!0}).gte("created_at",o),k=(j||0)*5+(b||0)*3+(D||0)*1,z=Math.min(Math.max(Math.round(k/100*100),10),95),{data:q}=await i.from("system_activity_log").select("activity_type, activity_description, severity, created_at").order("created_at",{ascending:!1}).limit(5),H=q&&q.length>0?q.map(U=>{const Y=new Date(U.created_at).toLocaleDateString(),J=U.activity_description.length>60?U.activity_description.substring(0,57)+"...":U.activity_description;return`[${Y}] ${J}`}):["All systems operational","Database backup completed successfully","Application performance within expected parameters"],W=[x===0?"All systems operational - No errors detected":`System status: ${x}% error rate detected`,...H.slice(0,4)];y({dbStorage:u,apiRequestRate:I,errorRate:x,serverLoad:z,logs:W})}catch(d){console.error("Error fetching system status:",d),y({dbStorage:5,apiRequestRate:10,errorRate:0,serverLoad:25,logs:["All systems operational","Database connection established","Application running normally"]})}},[]),B=h.useCallback(async()=>{try{l(!0),await Promise.all([R(),F(),A(),P()]),l(!1)}catch{l(!1)}},[R,F,A,P]);return h.useEffect(()=>{B()},[B]),h.useEffect(()=>{if(_)return;const d=[];try{if(!i){console.error("Admin client not available");return}const n=i.channel("admin-dashboard-users-changes").on("postgres_changes",{event:"*",schema:"auth",table:"users"},()=>{R(),A()});n.subscribe(),d.push(n);const u=i.channel("admin-dashboard-transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},()=>{R()});u.subscribe(),d.push(u);const o=i.channel("admin-dashboard-budgets-changes").on("postgres_changes",{event:"*",schema:"public",table:"budgets"},()=>{R()});o.subscribe(),d.push(o);const j=i.channel("admin-dashboard-goals-changes").on("postgres_changes",{event:"*",schema:"public",table:"goals"},()=>{R()});j.subscribe(),d.push(j),S(!0),f(d)}catch(n){console.error("Error setting up real-time subscriptions:",n);for(const u of d)try{u&&i&&i.removeChannel(u)}catch(o){console.error("Error cleaning up channel:",o)}}return()=>{for(const n of d)try{n&&i&&i.removeChannel(n)}catch(u){console.error("Error removing channel:",u)}}},[_,R,A]),h.useEffect(()=>()=>{r.forEach(d=>{try{d&&i&&i.removeChannel(d)}catch(n){console.error("Error removing channel on unmount:",n)}})},[r]),{loading:c,statCards:g,chartData:N,recentUsers:a,systemStatus:t,refreshData:B}},ne=()=>{const[c,l]=h.useState(new Date),[g,p]=h.useState(!1),{statCards:N,chartData:v,recentUsers:a,systemStatus:s,loading:t,refreshData:y}=se(),_=h.useCallback(async()=>{p(!0),await y(),l(new Date),p(!1)},[y]);return t?e.jsxs("div",{className:"admin-dashboard admin-dashboard-loading",children:[e.jsx("div",{className:"block md:hidden py-12 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading admin dashboard..."})]})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("div",{className:"dashboard-header mb-4",children:[e.jsx("div",{className:"skeleton-line skeleton-header-title mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-header-subtitle"})]}),e.jsx("div",{className:"row mb-4",children:Array.from({length:4}).map((S,r)=>e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsx("div",{className:"card shadow h-100 py-3 admin-card admin-card-loading",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"skeleton-line skeleton-title mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-value mb-3"}),e.jsx("div",{className:"skeleton-line skeleton-change"})]}),e.jsx("div",{className:"col-auto d-none d-sm-block",children:e.jsx("div",{className:"skeleton-icon"})})]})})})},r))}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-xl-6 col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4 admin-card",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("div",{className:"skeleton-line skeleton-chart-title"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"skeleton-chart"})})]})}),e.jsx("div",{className:"col-xl-6 col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4 admin-card",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("div",{className:"skeleton-line skeleton-chart-title"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"skeleton-chart"})})]})})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4 admin-card",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("div",{className:"skeleton-line skeleton-section-title"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"skeleton-table"})})]})}),e.jsx("div",{className:"col-lg-6 col-md-12 mb-4",children:e.jsxs("div",{className:"card shadow mb-4 admin-card",children:[e.jsx("div",{className:"card-header py-3 admin-card-header",children:e.jsx("div",{className:"skeleton-line skeleton-section-title"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"skeleton-progress-section"})})]})})]})]})]}):e.jsxs("div",{className:"admin-dashboard modern-dashboard",children:[e.jsx("div",{className:"block md:hidden mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-base font-bold text-gray-800",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:_,className:"w-9 h-9 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95 disabled:opacity-50",disabled:g,"aria-label":"Refresh data",children:e.jsx("i",{className:`fas fa-sync text-xs ${g?"fa-spin":""}`})}),e.jsx(T,{to:"/admin/users",className:"w-9 h-9 rounded-full bg-rose-600 hover:bg-rose-700 text-white flex items-center justify-center shadow-md transition-all active:scale-95","aria-label":"Manage users",children:e.jsx("i",{className:"fas fa-users text-xs"})})]})]})}),e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:`bg-gradient-to-br ${s.errorRate===0?"from-emerald-500 via-teal-500 to-cyan-500":s.errorRate<5?"from-amber-500 via-orange-500 to-yellow-500":"from-rose-500 via-red-500 to-orange-500"} rounded-2xl p-4 shadow-lg`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-white/80 text-xs font-medium",children:"System Status"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:`fas fa-${s.errorRate===0?"check-circle":s.errorRate<5?"exclamation-circle":"exclamation-triangle"} text-white text-sm`})})]}),e.jsx("div",{className:"text-white text-lg font-bold mb-1",children:s.errorRate===0?"All Systems Operational":s.errorRate<5?"Minor Issues Detected":"System Issues"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-white/70 text-xs",children:[e.jsx("i",{className:"fas fa-clock text-[10px] mr-1"}),"Updated: ",c.toLocaleTimeString()]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-white/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-white/60 text-[9px] uppercase",children:"DB"}),e.jsxs("p",{className:"text-white text-sm font-bold",children:[s.dbStorage,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-white/60 text-[9px] uppercase",children:"Load"}),e.jsxs("p",{className:"text-white text-sm font-bold",children:[s.serverLoad,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-white/60 text-[9px] uppercase",children:"Errors"}),e.jsxs("p",{className:"text-white text-sm font-bold",children:[s.errorRate,"%"]})]})]})]})}),e.jsxs("div",{className:"dashboard-header mb-5 hidden md:block",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start flex-wrap",children:[e.jsx("div",{className:"header-content",children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"dashboard-icon-container mr-3",children:e.jsx("i",{className:"fas fa-tachometer-alt"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"dashboard-title mb-1",children:"Admin Dashboard"}),e.jsx("p",{className:"dashboard-subtitle mb-0",children:"Comprehensive overview of BudgetMe platform analytics and operations"})]})]})}),e.jsxs("div",{className:"header-actions d-flex align-items-center",children:[e.jsx("div",{className:"last-updated-info mr-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Last updated: ",c.toLocaleTimeString()]})}),e.jsxs("button",{className:"btn btn-outline-danger btn-sm shadow-sm refresh-btn",onClick:_,disabled:g,children:[e.jsx("i",{className:`fas fa-sync-alt mr-1 ${g?"fa-spin":""}`}),g?"Refreshing...":"Refresh All"]})]})]}),e.jsx("div",{className:"dashboard-status-bar mt-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`status-indicator ${s.errorRate===0?"status-online":s.errorRate<5?"status-warning":"status-error"} mr-2`}),e.jsx("span",{className:`small font-weight-medium ${s.errorRate===0?"text-success":s.errorRate<5?"text-warning":"text-danger"}`,children:s.errorRate===0?"System operational - All services running normally":s.errorRate<5?`Minor issues detected - ${s.errorRate}% error rate`:`System issues - ${s.errorRate}% error rate`}),e.jsxs("div",{className:"ml-auto d-flex align-items-center",children:[e.jsxs("span",{className:"small text-muted mr-2",children:["DB: ",s.dbStorage,"% | Load: ",s.serverLoad,"%"]}),e.jsxs("span",{className:`badge ${s.errorRate===0?"badge-success":s.errorRate<5?"badge-warning":"badge-danger"} badge-pill`,children:[e.jsx("i",{className:`fas ${s.errorRate===0?"fa-check-circle":"fa-exclamation-circle"} mr-1`}),"Live Data"]})]})]})})]}),e.jsx("div",{className:"dashboard-section stats-section mb-5",children:e.jsx(Q,{statCards:N,loading:t,onRefresh:_})}),e.jsxs("div",{className:"dashboard-section charts-section mb-5",children:[e.jsxs("div",{className:"block md:hidden mb-3",children:[e.jsxs("h6",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-chart-line text-red-500 text-xs"}),"Analytics & Insights"]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Last 30 days data visualization"})]}),e.jsxs("div",{className:"section-header mb-4 hidden md:block",children:[e.jsx("h5",{className:"section-title text-gray-800 font-weight-bold mb-1",children:"Analytics & Insights"}),e.jsx("p",{className:"section-subtitle text-muted mb-0",children:"Detailed charts and data visualization for the last 30 days"})]}),e.jsx(X,{chartData:v,loading:t})]}),e.jsxs("div",{className:"dashboard-section activity-section",children:[e.jsxs("div",{className:"block md:hidden mb-3",children:[e.jsxs("h6",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-history text-red-500 text-xs"}),"Recent Activity"]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Latest users and system metrics"})]}),e.jsxs("div",{className:"section-header mb-4 hidden md:block",children:[e.jsx("h5",{className:"section-title text-gray-800 font-weight-bold mb-1",children:"Recent Activity & System Status"}),e.jsx("p",{className:"section-subtitle text-muted mb-0",children:"Latest user registrations and real-time system performance metrics"})]}),e.jsx(ee,{recentUsers:a,systemStatus:s,loading:t})]}),e.jsx("div",{className:"block md:hidden mt-4 mb-4",children:e.jsx("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-shield-alt text-red-500 text-[10px]"})}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Admin Dashboard v2.0"})]}),e.jsx("span",{className:"text-[9px] text-gray-400",children:"Auto-refresh: 5min"})]})})}),e.jsx("div",{className:"dashboard-footer mt-5 pt-4 border-top hidden md:block",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-8",children:e.jsxs("p",{className:"text-muted small mb-0",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"Data is refreshed automatically every 5 minutes. Use the refresh button for immediate updates."]})}),e.jsx("div",{className:"col-md-4 text-md-right",children:e.jsxs("p",{className:"text-muted small mb-0",children:[e.jsx("i",{className:"fas fa-shield-alt mr-1 text-success"}),"Admin Dashboard v2.0 | Secure & Optimized"]})})]})})]})};export{ne as default};
