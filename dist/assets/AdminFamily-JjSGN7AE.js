import{j as e,B as J}from"./ui-vendor-Cn1Vfl4w.js";import{r}from"./react-vendor-D4A9EtXC.js";import{b as Z,p,t as K,d as ae}from"./index-BbApZ7g3.js";import"./chart-vendor-B0c7K_uV.js";const re=()=>{const[n,a]=r.useState([]),[y,F]=r.useState([]),[i,_]=r.useState({totalFamilies:0,activeFamilies:0,totalMembers:0,avgMembersPerFamily:0}),[c,o]=r.useState(!0),[N,b]=r.useState(!1),[D,P]=r.useState(1),[w,T]=r.useState(0),[x,A]=r.useState({}),[d,O]=r.useState(null),{showSuccessToast:U,showErrorToast:k}=Z(),v=r.useCallback(async()=>{try{if(!p)throw new Error("Admin client not available");const{data:s,error:l}=await p.auth.admin.listUsers({page:1,perPage:1e3});if(l)throw l;const g={};s?.users?.forEach(m=>{const j=m.user_metadata||{},M=j.full_name||j.name||(j.first_name&&j.last_name?`${j.first_name} ${j.last_name}`:null)||m.email?.split("@")[0]||"Unknown User",S=j.avatar_url||j.picture||"../images/placeholder.png";g[m.id]={id:m.id,full_name:M,email:m.email||"No Email",avatar_url:S}}),A(g)}catch(s){console.error("Error fetching user profiles:",s),k("Failed to load user data")}},[k]),C=r.useCallback(async()=>{try{if(!p)throw new Error("Admin client not available");const{data:s,error:l}=await p.auth.admin.listUsers({page:1,perPage:1e3});if(l)throw l;const g=(s?.users||[]).map(m=>({id:m.id,email:m.email||"",user_metadata:m.user_metadata||{}}));F(g)}catch(s){console.error("Error fetching users:",s),k("Failed to load users")}},[k]);r.useEffect(()=>{v(),C()},[v,C]),r.useEffect(()=>{Object.keys(x).length>0&&n.length>0&&a(s=>s.map(l=>({...l,owner:x[l.created_by]||l.owner})))},[x]);const I=r.useCallback(s=>{const l=s.filter(m=>m.status==="active").length,g=s.reduce((m,j)=>m+(j.members_count||0),0);_({totalFamilies:s.length,activeFamilies:l,totalMembers:g,avgMembersPerFamily:s.length>0?g/s.length:0})},[]),H=r.useCallback((s,l)=>(l.name&&(s=s.ilike("family_name",`%${l.name}%`)),s),[]),L=r.useCallback(async s=>{try{if(o(!0),!p)throw new Error("Admin client not available");let l=p.from("families").select("id",{count:"exact"});l=H(l,s);const{count:g,error:m}=await l;if(m)throw m;let j=p.from("families").select("id, family_name, description, created_by, created_at, updated_at, currency_pref, is_public, status");s.sortBy==="name"?j=j.order("family_name",{ascending:s.sortOrder==="asc"}):s.sortBy!=="members"&&(j=j.order(s.sortBy,{ascending:s.sortOrder==="asc"})),j=H(j,s);const M=(s.currentPage-1)*s.pageSize,S=M+s.pageSize-1,{data:R,error:$}=await j.range(M,S);if($)throw $;if(!R){a([]),T(0),P(1),I([]),o(!1);return}const G=R.map(f=>f.id),Q={};await Promise.all(G.map(async f=>{try{const{count:E,error:V}=await p.from("family_members").select("*",{count:"exact",head:!0}).eq("family_id",f).eq("status","active");!V&&E!==null&&(Q[f]=E)}catch(E){console.warn(`Error getting count for family ${f}:`,E)}}));let Y=[...await Promise.all(R.map(async f=>{let E=x[f.created_by];if(!E&&p)try{const{data:z,error:X}=await p.auth.admin.getUserById(f.created_by);if(!X&&z?.user){const t=z.user.user_metadata||{};E={id:z.user.id,full_name:t.full_name||t.name||z.user.email?.split("@")[0]||"Unknown Owner",email:z.user.email||"No email",avatar_url:t.avatar_url||t.picture||"../images/placeholder.png"}}}catch(z){console.warn(`Error fetching owner for family ${f.id}:`,z)}if(!E&&p)try{const{data:z,error:X}=await p.from("profiles").select("id, full_name, email, avatar_url").eq("id",f.created_by).single();!X&&z&&(E={id:z.id,full_name:z.full_name||"Unknown Owner",email:z.email||"No email",avatar_url:z.avatar_url||"../images/placeholder.png"})}catch(z){console.warn(`Error fetching profile for family ${f.id}:`,z)}const V=E||{id:f.created_by,full_name:"Unknown Owner",email:"No email",avatar_url:"../images/placeholder.png"};return{id:f.id,family_name:f.family_name,description:f.description,created_by:f.created_by,created_at:f.created_at,updated_at:f.updated_at,currency_pref:f.currency_pref||"PHP",is_public:f.is_public!==void 0?f.is_public:!1,status:f.status||"active",members_count:Q[f.id]||0,owner:V}}))];if(s.status!=="all"&&(Y=Y.filter(f=>f.status===s.status)),s.minMembers){const f=parseInt(s.minMembers);Y=Y.filter(E=>(E.members_count||0)>=f)}if(s.maxMembers){const f=parseInt(s.maxMembers);Y=Y.filter(E=>(E.members_count||0)<=f)}s.sortBy==="members"&&(Y=Y.sort((f,E)=>{const V=f.members_count||0,z=E.members_count||0;return s.sortOrder==="asc"?V-z:z-V})),a(Y),I(Y),T(g||0),P(Math.max(1,Math.ceil((g||0)/s.pageSize))),o(!1)}catch(l){console.error("Error fetching families:",l),k("Failed to load family data"),o(!1)}},[H,I,k]),B=r.useCallback(async s=>{b(!0);try{await v(),await C(),await L(s),U("Family data refreshed successfully")}catch(l){k("Failed to refresh family data"),console.error("Error refreshing family data:",l)}finally{b(!1)}},[v,C,L,U,k]),h=r.useCallback(async s=>{try{if(!p)throw new Error("Admin client not available");const{error:l}=await p.from("families").delete().eq("id",s);if(l)throw l;return a(g=>g.filter(m=>m.id!==s)),U("Family deleted successfully!"),!0}catch(l){return console.error("Error deleting family:",l),k("Failed to delete family"),!1}},[U,k]),q=r.useCallback(async s=>{try{if(!p)throw new Error("Admin client not available");const{data:l,error:g}=await p.from("family_members").select("*").eq("family_id",s).eq("status","active").order("role",{ascending:!1}).order("created_at",{ascending:!0});if(g)throw g;if(!l||l.length===0)return[];const m=l.map(S=>S.user_id),j={};await Promise.all(m.map(async S=>{try{const{data:R,error:$}=await p.auth.admin.getUserById(S);if(!$&&R?.user){const G=R.user.user_metadata||{};j[S]={id:R.user.id,full_name:G.full_name||G.name||R.user.email?.split("@")[0]||"Unknown User",email:R.user.email||"No Email",avatar_url:G.avatar_url||G.picture||"../images/placeholder.png"}}}catch(R){console.warn(`Error fetching auth user ${S}:`,R)}}));const M=m.filter(S=>!j[S]);if(M.length>0){const{data:S,error:R}=await p.from("profiles").select("id, full_name, email, avatar_url").in("id",M);!R&&S&&S.forEach($=>{j[$.id]={id:$.id,full_name:$.full_name||"Unknown User",email:$.email||"No Email",avatar_url:$.avatar_url||"../images/placeholder.png"}})}return l.map(S=>({...S,user:j[S.user_id]||{id:S.user_id,full_name:"Unknown User",email:"No Email",avatar_url:"../images/placeholder.png"}}))}catch(l){return console.error("Error fetching family members:",l),k("Failed to fetch family members"),[]}},[k]),ee=r.useCallback(async(s,l)=>{try{if(!p)throw new Error("Admin client not available");const{error:g}=await p.from("family_members").delete().eq("id",s);if(g)throw g;return U("Family member removed successfully"),!0}catch(g){return console.error("Error removing family member:",g),k("Failed to remove family member"),!1}},[U,k]);return r.useEffect(()=>{let s;try{if(!p){console.error("Admin client not available");return}s=p.channel("admin-families-channel"),s.on("postgres_changes",{event:"*",schema:"public",table:"families"},()=>{}).subscribe(),O(s)}catch(l){console.error("Error setting up real-time subscriptions:",l)}return()=>{if(s&&p)try{p.removeChannel(s)}catch(l){console.error("Error cleaning up channel:",l)}}},[]),r.useEffect(()=>()=>{if(d&&p)try{p.removeChannel(d)}catch(s){console.error("Error removing channel on unmount:",s)}},[d]),{families:n,users:y,stats:i,loading:c,refreshing:N,totalPages:D,totalItems:w,userProfiles:x,fetchFamilies:L,fetchUsers:C,refreshFamilyData:B,deleteFamily:h,getFamilyMembers:q,removeFamilyMember:ee}},ie=({show:n,onClose:a,title:y,icon:F,color:i,data:_})=>n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:a}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:a,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",onClick:c=>c.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"modal-header bg-gradient-danger text-white border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center",children:[e.jsx("div",{className:"modal-icon-container mr-3",style:{width:"45px",height:"45px",borderRadius:"12px",background:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:`fas ${F}`,style:{fontSize:"1.25rem"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"modal-title-main font-weight-bold",children:y}),e.jsx("div",{className:"modal-subtitle",style:{opacity:.85,fontSize:"0.85rem"},children:"Detailed breakdown"})]})]}),e.jsx("button",{type:"button",className:"close text-white",onClick:a,style:{textShadow:"none",opacity:.9},children:e.jsx("span",{children:"×"})})]}),e.jsx("div",{className:"modal-body bg-white p-0",children:e.jsx("div",{className:"stats-breakdown-list",children:_.map((c,o)=>e.jsxs("div",{className:"stats-breakdown-item d-flex justify-content-between align-items-center py-3 px-4",style:{borderBottom:o<_.length-1?"1px solid #f0f0f0":"none",transition:"background-color 0.2s ease"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-medium text-gray-800",children:c.label}),c.subLabel&&e.jsx("small",{className:"text-muted",children:c.subLabel})]}),e.jsx("span",{className:`badge badge-${i} badge-pill px-3 py-2`,style:{fontSize:"0.9rem",fontWeight:600,minWidth:"60px",textAlign:"center"},children:c.value})]},o))})}),e.jsx("div",{className:"modal-footer bg-light border-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsx("div",{className:"modal-footer-info",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-info-circle mr-1 text-danger"}),"Data reflects current statistics"]})}),e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:a,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Close"]})]})})]})})})]}):null,te=({stats:n,loading:a=!1})=>{const[y,F]=r.useState({show:!1,title:"",icon:"",color:"",data:[]});if(a)return e.jsx("div",{className:"stats-section mb-5",children:e.jsx("div",{className:"row",children:Array.from({length:4}).map((D,P)=>e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsx("div",{className:"card shadow h-100 py-3 admin-card admin-card-loading",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"skeleton-line skeleton-stat-value mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-stat-title"})]})})},P))})});const i=n.totalFamilies>0?(n.activeFamilies/n.totalFamilies*100).toFixed(1):"0",_=n.totalFamilies-n.activeFamilies,c=()=>{F({show:!0,title:"Total Families Breakdown",icon:"fa-users",color:"danger",data:[{label:"Total Families",value:n.totalFamilies},{label:"Active Families",value:n.activeFamilies,subLabel:`${i}% of total`},{label:"Inactive Families",value:_,subLabel:`${(100-Number(i)).toFixed(1)}% of total`},{label:"Total Members",value:n.totalMembers}]})},o=()=>{F({show:!0,title:"Active Families Breakdown",icon:"fa-user-check",color:"success",data:[{label:"Active Families",value:n.activeFamilies},{label:"Percentage of Total",value:`${i}%`},{label:"Inactive Families",value:_},{label:"Avg. Members",value:n.avgMembersPerFamily.toFixed(1)}]})},N=()=>{F({show:!0,title:"Total Members Breakdown",icon:"fa-user-friends",color:"warning",data:[{label:"Total Members",value:n.totalMembers},{label:"Across Families",value:n.totalFamilies},{label:"Avg. Per Family",value:n.avgMembersPerFamily.toFixed(1)},{label:"Active Families",value:n.activeFamilies}]})},b=()=>{F({show:!0,title:"Average Members Overview",icon:"fa-chart-line",color:"info",data:[{label:"Avg. Members Per Family",value:n.avgMembersPerFamily.toFixed(1)},{label:"Total Members",value:n.totalMembers},{label:"Total Families",value:n.totalFamilies},{label:"Active Families",value:n.activeFamilies}]})};return e.jsxs("div",{className:"stats-section mb-5",children:[e.jsx(ie,{show:y.show,onClose:()=>F({...y,show:!1}),title:y.title,icon:y.icon,color:y.color,data:y.data}),e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:c,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-red-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-users text-red-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Total Families"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:K(n.totalFamilies)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-gray-400",children:[e.jsx("i",{className:"fas fa-users text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium truncate",children:[_," inactive"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:o,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-user-check text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Active Families"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:K(n.activeFamilies)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-emerald-500",children:[e.jsx("i",{className:"fas fa-arrow-up text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium truncate",children:[i,"% of total"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:N,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-user-friends text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Total Members"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:K(n.totalMembers)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-amber-500",children:[e.jsx("i",{className:"fas fa-home text-[8px]"}),e.jsxs("span",{className:"text-[9px] font-medium truncate",children:[n.totalFamilies," families"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",onClick:b,children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-chart-line text-blue-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Avg. Members"}),e.jsx("p",{className:"text-sm font-bold text-gray-800",children:n.avgMembersPerFamily.toFixed(1)}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-blue-500",children:[e.jsx("i",{className:"fas fa-users text-[8px]"}),e.jsx("span",{className:"text-[9px] font-medium truncate",children:"per family"})]})]})]})}),e.jsxs("div",{className:"row d-none d-md-flex",children:[e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-danger h-100 position-relative",onClick:c,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-danger text-uppercase mb-2",children:"Total Families"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:K(n.totalFamilies)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-muted",children:[e.jsx("i",{className:"fas fa-users mr-1"}),e.jsxs("span",{className:"font-weight-medium text-truncate",children:[_," inactive"]})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-danger",children:e.jsx("i",{className:"fas fa-users stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-danger",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-success h-100 position-relative",onClick:o,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-success text-uppercase mb-2",children:"Active Families"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:K(n.activeFamilies)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-success",children:[e.jsx("i",{className:"fas fa-arrow-up mr-1"}),e.jsxs("span",{className:"font-weight-medium",children:[i,"%"]}),e.jsx("span",{className:"ml-1 small text-truncate",children:"of total"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-success",children:e.jsx("i",{className:"fas fa-user-check stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-success",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-warning h-100 position-relative",onClick:N,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-warning text-uppercase mb-2",children:"Total Members"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:K(n.totalMembers)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-warning",children:[e.jsx("i",{className:"fas fa-home mr-1"}),e.jsx("span",{className:"font-weight-medium",children:n.totalFamilies}),e.jsx("span",{className:"ml-1 small text-truncate",children:"families"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-warning",children:e.jsx("i",{className:"fas fa-user-friends stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-warning",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})}),e.jsx("div",{className:"col-xl-3 col-md-6 col-sm-12 mb-4",children:e.jsxs("div",{className:"admin-stat-card admin-stat-card-info h-100 position-relative",onClick:b,style:{cursor:"pointer"},children:[e.jsx("div",{className:"card-bg-pattern"}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsx("div",{className:"stat-title text-info text-uppercase mb-2",children:"Avg. Members"}),e.jsx("div",{className:"stat-value mb-0 font-weight-bold text-gray-800",children:n.avgMembersPerFamily.toFixed(1)}),e.jsxs("div",{className:"stat-change mt-2 d-flex align-items-center text-info",children:[e.jsx("i",{className:"fas fa-users mr-1"}),e.jsx("span",{className:"font-weight-medium text-truncate",children:"per family"})]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"stat-icon-container stat-icon-info",children:e.jsx("i",{className:"fas fa-chart-line stat-icon"})})})]})}),e.jsx("div",{className:"card-footer-link bg-info",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2 px-4",children:[e.jsx("span",{className:"font-weight-medium",children:"View Details"}),e.jsx("div",{className:"footer-arrow",children:e.jsx("i",{className:"fas fa-chevron-right"})})]})}),e.jsx("div",{className:"card-hover-overlay"})]})})]})]})},ne=({show:n,onClose:a,onFamilyAdded:y,users:F})=>{const[i,_]=r.useState({family_name:"",description:"",currency_pref:"PHP",is_public:!1}),[c,o]=r.useState(""),[N,b]=r.useState(""),[D,P]=r.useState(!1),[w,T]=r.useState(!1),[x,A]=r.useState({}),[d,O]=r.useState(""),{showSuccessToast:U,showErrorToast:k}=Z(),v=[{value:"PHP",label:"Philippine Peso (PHP)"},{value:"USD",label:"US Dollar (USD)"},{value:"EUR",label:"Euro (EUR)"},{value:"GBP",label:"British Pound (GBP)"},{value:"JPY",label:"Japanese Yen (JPY)"},{value:"CAD",label:"Canadian Dollar (CAD)"},{value:"AUD",label:"Australian Dollar (AUD)"}],C=()=>{const s={};return i.family_name.trim()?i.family_name.trim().length<2?s.family_name="Family name must be at least 2 characters":i.family_name.trim().length>50&&(s.family_name="Family name must be less than 50 characters"):s.family_name="Family name is required",i.description&&i.description.length>255&&(s.description="Description must be less than 255 characters"),c||(s.creator="Please select a family creator"),A(s),Object.keys(s).length===0},I=s=>{const{name:l,value:g,type:m}=s.target,j=s.target.checked;_(M=>({...M,[l]:m==="checkbox"?j:g})),x[l]&&A(M=>({...M,[l]:""}))},H=s=>{o(s.id),b(""),P(!1),A(l=>({...l,creator:""}))},L=F.filter(s=>{const l=N.toLowerCase(),g=s.user_metadata?.full_name?.toLowerCase()||"",m=s.email.toLowerCase();return g.includes(l)||m.includes(l)}),B=F.find(s=>s.id===c);r.useEffect(()=>{const s=l=>{l.target.closest(".position-relative")||P(!1)};return D&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[D]);const h=async s=>{if(s.preventDefault(),!!C()){T(!0);try{if(!p)throw new Error("Admin client not available");const{data:l,error:g}=await p.from("families").insert({family_name:i.family_name.trim(),description:i.description.trim()||null,created_by:c,currency_pref:i.currency_pref,is_public:i.is_public,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(g)throw g;if(!l)throw new Error("Failed to create family");const{error:m}=await p.from("family_members").insert({family_id:l.id,user_id:c,role:"admin",status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(m)throw await p.from("families").delete().eq("id",l.id),m;U(`Family "${i.family_name}" created successfully!`),_({family_name:"",description:"",currency_pref:"PHP",is_public:!1}),o(""),y(),a()}catch(l){console.error("Error creating family:",l),k(l.message||"Failed to create family")}finally{T(!1)}}},q=()=>{w||(_({family_name:"",description:"",currency_pref:"PHP",is_public:!1}),o(""),b(""),P(!1),A({}),a())};if(!n)return null;const ee=i.family_name.trim()&&c;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:q}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:q,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered mx-2 mx-md-auto",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"12px",overflow:"hidden",maxHeight:"90vh"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 py-md-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:"fas fa-users",style:{fontSize:"1rem"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-truncate",style:{fontSize:"0.9rem"},children:"Create Family Group"}),e.jsx("small",{className:"d-none d-md-block",style:{opacity:.9,fontSize:"0.75rem"},children:"Set up a new family for financial management"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:q,disabled:w,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsxs("div",{className:"modal-body py-2 py-md-3 px-2 px-md-3",style:{maxHeight:"65vh",overflowY:"auto"},children:[d&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),d]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#e7f3ff",borderRadius:"8px",borderLeft:"3px solid #007bff"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-info-circle text-primary mr-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-primary",style:{fontSize:"0.9rem"},children:"Family Administrator"}),e.jsx("p",{className:"mb-0 text-muted",style:{fontSize:"0.8rem"},children:"The selected user will become the family administrator and be automatically added as the first member."})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-home mr-2"}),"Family Information"]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12 mb-2",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Family Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:`form-control form-control-sm ${x.family_name?"is-invalid":""}`,name:"family_name",value:i.family_name,onChange:I,placeholder:"The Johnson Family",disabled:w,style:{fontSize:"0.85rem"}}),x.family_name&&e.jsx("div",{className:"invalid-feedback",style:{fontSize:"0.75rem"},children:x.family_name})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Description ",e.jsx(J,{bg:"secondary",className:"ml-2",style:{fontSize:"0.6rem"},children:"Optional"})]}),e.jsx("textarea",{className:`form-control form-control-sm ${x.description?"is-invalid":""}`,name:"description",rows:2,value:i.description,onChange:I,placeholder:"Brief description of this family group...",disabled:w,style:{fontSize:"0.85rem"}}),x.description&&e.jsx("div",{className:"invalid-feedback",style:{fontSize:"0.75rem"},children:x.description})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-user-shield mr-2"}),"Family Creator"]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Select Administrator ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:`form-control form-control-sm ${x.creator?"is-invalid":""}`,placeholder:"Search for a user...",value:N,onChange:s=>{b(s.target.value),P(!0)},onFocus:()=>P(!0),disabled:w,style:{fontSize:"0.85rem"}}),D&&L.length>0&&e.jsx("div",{className:"dropdown-menu show w-100",style:{maxHeight:"150px",overflowY:"auto",position:"absolute",zIndex:1e3},children:L.slice(0,5).map(s=>e.jsxs("button",{type:"button",className:"dropdown-item d-flex align-items-center py-2",onClick:()=>H(s),style:{fontSize:"0.85rem"},children:[e.jsx("img",{src:s.user_metadata?.avatar_url||"../images/placeholder.png",alt:"Avatar",className:"rounded-circle mr-2",style:{width:"28px",height:"28px",objectFit:"cover"},onError:l=>{l.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{children:[e.jsx("strong",{children:s.user_metadata?.full_name||s.email.split("@")[0]}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.email})]})]},s.id))})]}),B&&e.jsxs("div",{className:"mt-2 p-2 d-flex align-items-center",style:{background:"#d4edda",borderRadius:"6px"},children:[e.jsx("img",{src:B.user_metadata?.avatar_url||"../images/placeholder.png",alt:"Selected User",className:"rounded-circle mr-2",style:{width:"32px",height:"32px",objectFit:"cover",border:"2px solid #28a745"},onError:s=>{s.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("strong",{style:{fontSize:"0.85rem"},children:B.user_metadata?.full_name||B.email.split("@")[0]}),e.jsx("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:B.email})]}),e.jsxs(J,{bg:"success",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-check mr-1"}),"Selected"]})]}),x.creator&&e.jsxs("div",{className:"text-danger mt-1",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),x.creator]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-cog mr-2"}),"Family Settings"]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Currency ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("select",{className:"form-control form-control-sm",name:"currency_pref",value:i.currency_pref,onChange:I,disabled:w,style:{fontSize:"0.85rem"},children:v.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:"Visibility"}),e.jsx("div",{className:"p-2",style:{background:"#fff",borderRadius:"6px",border:"1px solid #dee2e6"},children:e.jsxs("div",{className:"form-check mb-0",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",id:"is_public",name:"is_public",checked:i.is_public,onChange:I,disabled:w}),e.jsx("label",{className:"form-check-label",htmlFor:"is_public",style:{fontSize:"0.8rem"},children:"Make family public"})]})})]})]})})]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-list mr-2"}),"What will be created:"]}),e.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:[{icon:"fa-users",label:"Family Group"},{icon:"fa-user-shield",label:"Admin Member"},{icon:"fa-coins",label:"Currency Settings"},{icon:"fa-share-alt",label:"Sharing Access"}].map((s,l)=>e.jsxs("span",{className:"badge badge-light px-2 py-1",style:{fontSize:"0.75rem",border:"1px solid #dee2e6"},children:[e.jsx("i",{className:`fas ${s.icon} text-success mr-1`}),s.label]},l))})]})]}),e.jsxs("div",{className:"modal-footer border-0 py-2 px-2 px-md-3 flex-column flex-md-row",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto mb-2 mb-md-0 d-none d-md-block",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-users mr-1"}),"Family will be created with admin user"]}),e.jsxs("div",{className:"d-flex w-100 w-md-auto gap-2",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm flex-grow-1 flex-md-grow-0",onClick:q,disabled:w,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm flex-grow-1 flex-md-grow-0",onClick:h,disabled:w||!ee,children:w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Create"]})})]})]})]})})})]})},ce=({show:n,family:a,onClose:y,onEdit:F,onDelete:i,onGetMembers:_,onRemoveMember:c})=>{const[o,N]=r.useState([]),[b,D]=r.useState(!1),[P,w]=r.useState(null),{showSuccessToast:T}=Z();r.useEffect(()=>{n&&a&&x()},[n,a]);const x=async()=>{if(a){D(!0);try{const d=await _(a.id);N(d)}catch(d){console.error("Error loading family members:",d)}finally{D(!1)}}},A=async d=>{if(!(!a||d.user_id===a.created_by)){w(d.id);try{await c(d.id,a.id)&&(N(U=>U.filter(k=>k.id!==d.id)),T("Member removed from family"))}catch(O){console.error("Error removing member:",O)}finally{w(null)}}};return!n||!a?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:y}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:y,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable mx-2 mx-md-auto",onClick:d=>d.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"12px",overflow:"hidden",maxHeight:"90vh"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 py-md-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:"fas fa-users",style:{fontSize:"1rem"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-truncate",style:{fontSize:"0.9rem"},children:a.family_name}),e.jsx("small",{className:"d-none d-md-block",style:{opacity:.9,fontSize:"0.75rem"},children:"Family Details & Members"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:y,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsx("div",{className:"px-2 px-md-3 py-2",style:{background:"#f8f9fa",borderBottom:"1px solid #e9ecef"},children:e.jsxs("div",{className:"row text-center g-1 g-md-2",children:[e.jsx("div",{className:"col-6 col-md-3 mb-1 mb-md-0",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center p-1 rounded",style:{background:"rgba(255,255,255,0.5)"},children:[e.jsx("i",{className:`fas fa-${a.status==="active"?"check-circle text-success":"pause-circle text-secondary"} mr-1`,style:{fontSize:"0.8rem"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.6rem",lineHeight:1},children:"Status"}),e.jsx("strong",{style:{fontSize:"0.7rem"},className:a.status==="active"?"text-success":"text-secondary",children:a.status==="active"?"Active":"Inactive"})]})]})}),e.jsx("div",{className:"col-6 col-md-3 mb-1 mb-md-0",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center p-1 rounded",style:{background:"rgba(255,255,255,0.5)"},children:[e.jsx("i",{className:"fas fa-user-friends text-danger mr-1",style:{fontSize:"0.8rem"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.6rem",lineHeight:1},children:"Members"}),e.jsx("strong",{className:"text-danger",style:{fontSize:"0.7rem"},children:a.members_count||0})]})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center p-1 rounded",style:{background:"rgba(255,255,255,0.5)"},children:[e.jsx("i",{className:"fas fa-coins text-warning mr-1",style:{fontSize:"0.8rem"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.6rem",lineHeight:1},children:"Currency"}),e.jsx("strong",{className:"text-warning",style:{fontSize:"0.7rem"},children:a.currency_pref})]})]})}),e.jsx("div",{className:"col-6 col-md-3",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center p-1 rounded",style:{background:"rgba(255,255,255,0.5)"},children:[e.jsx("i",{className:`fas fa-${a.is_public?"globe text-info":"lock text-secondary"} mr-1`,style:{fontSize:"0.8rem"}}),e.jsxs("div",{className:"text-left",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.6rem",lineHeight:1},children:"Visibility"}),e.jsx("strong",{style:{fontSize:"0.7rem"},className:a.is_public?"text-info":"text-secondary",children:a.is_public?"Public":"Private"})]})]})})]})}),e.jsxs("div",{className:"modal-body py-2 py-md-3 px-2 px-md-3",style:{maxHeight:"55vh",overflowY:"auto"},children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Family Details"]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px",height:"100%"},children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.75rem"},children:"Family Name"}),e.jsx("strong",{style:{fontSize:"0.9rem"},children:a.family_name})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.75rem"},children:"Description"}),e.jsx("span",{style:{fontSize:"0.85rem"},children:a.description||"No description provided"})]}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.75rem"},children:"Created"}),e.jsx("span",{style:{fontSize:"0.85rem"},children:ae(a.created_at)})]})]})}),e.jsx("div",{className:"col-md-6 mt-2 mt-md-0",children:e.jsxs("div",{className:"p-3 text-center",style:{background:"#f8f9fa",borderRadius:"8px",height:"100%"},children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-crown mr-1"}),"Owner"]}),a.owner?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a.owner.avatar_url||"../images/placeholder.png",alt:a.owner.full_name,className:"rounded-circle mb-2",style:{width:"50px",height:"50px",objectFit:"cover",border:"2px solid #dc3545"},onError:d=>{d.currentTarget.src="../images/placeholder.png"}}),e.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600},children:a.owner.full_name}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:a.owner.email}),e.jsx("div",{className:"mt-2",children:e.jsxs(J,{bg:"primary",style:{fontSize:"0.65rem"},children:[e.jsx("i",{className:"fas fa-shield-alt mr-1"}),"Admin"]})})]}):e.jsx("span",{className:"text-muted",style:{fontSize:"0.85rem"},children:"Owner info not available"})]})})]})]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("h6",{className:"text-danger mb-0",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-users mr-2"}),"Family Members (",o.length,")"]}),e.jsxs("button",{className:"btn btn-outline-danger btn-sm",onClick:x,disabled:b,style:{fontSize:"0.75rem",padding:"2px 8px"},children:[e.jsx("i",{className:`fas fa-sync-alt ${b?"fa-spin":""} mr-1`}),"Refresh"]})]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:b?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border spinner-border-sm text-danger",role:"status"}),e.jsx("p",{className:"mb-0 text-muted mt-2",style:{fontSize:"0.8rem"},children:"Loading members..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx("i",{className:"fas fa-users fa-2x mb-2"}),e.jsx("p",{className:"mb-0",style:{fontSize:"0.85rem"},children:"No members found"})]}):e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:o.map(d=>e.jsxs("div",{className:"d-flex align-items-center py-2 px-2 mb-1",style:{background:"#fff",borderRadius:"6px",border:"1px solid #e9ecef"},children:[e.jsx("img",{src:d.user?.avatar_url||"../images/placeholder.png",alt:"",className:"rounded-circle mr-2",style:{width:"32px",height:"32px",objectFit:"cover"},onError:O=>{O.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:d.user?.full_name||"Unknown"}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:d.user?.email||"No email"})]}),e.jsxs("div",{className:"d-flex align-items-center",style:{gap:"6px"},children:[e.jsx(J,{bg:d.role==="admin"?"primary":"secondary",style:{fontSize:"0.6rem"},children:d.role}),d.user_id===a.created_by&&e.jsx(J,{bg:"warning",style:{fontSize:"0.6rem"},children:"Owner"}),d.user_id!==a.created_by?e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>A(d),disabled:P===d.id,style:{padding:"2px 6px",fontSize:"0.7rem"},children:P===d.id?e.jsx("span",{className:"spinner-border spinner-border-sm"}):e.jsx("i",{className:"fas fa-user-minus"})}):e.jsx("i",{className:"fas fa-lock text-muted",style:{fontSize:"0.75rem"}})]})]},d.id))})})]})]}),e.jsxs("div",{className:"modal-footer border-0 py-2 px-2 px-md-3 flex-column flex-md-row",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto mb-2 mb-md-0 d-none d-md-block",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-users mr-1"}),o.length," member",o.length!==1?"s":""," • Created ",ae(a.created_at)]}),e.jsxs("div",{className:"d-flex w-100 w-md-auto",style:{gap:"6px"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm flex-grow-1 flex-md-grow-0",onClick:y,children:[e.jsx("i",{className:"fas fa-times mr-1"}),e.jsx("span",{className:"d-none d-md-inline",children:"Close"})]}),e.jsxs("button",{type:"button",className:"btn btn-warning btn-sm flex-grow-1 flex-md-grow-0",onClick:()=>F(a),children:[e.jsx("i",{className:"fas fa-edit mr-1"}),e.jsx("span",{className:"d-none d-md-inline",children:"Edit"})]}),e.jsxs("button",{type:"button",className:"btn btn-danger btn-sm flex-grow-1 flex-md-grow-0",onClick:()=>i(a),children:[e.jsx("i",{className:"fas fa-trash mr-1"}),e.jsx("span",{className:"d-none d-md-inline",children:"Delete"})]})]})]})]})})})]})},de=({show:n,family:a,onClose:y,onFamilyUpdated:F})=>{const[i,_]=r.useState({id:"",family_name:"",description:"",currency_pref:"PHP",is_public:!1,status:"active"}),[c,o]=r.useState(!1),[N,b]=r.useState({}),[D,P]=r.useState(""),{showSuccessToast:w,showErrorToast:T}=Z(),x=[{value:"PHP",label:"Philippine Peso (PHP)"},{value:"USD",label:"US Dollar (USD)"},{value:"EUR",label:"Euro (EUR)"},{value:"GBP",label:"British Pound (GBP)"},{value:"JPY",label:"Japanese Yen (JPY)"},{value:"CAD",label:"Canadian Dollar (CAD)"},{value:"AUD",label:"Australian Dollar (AUD)"}];r.useEffect(()=>{a&&(_({id:a.id,family_name:a.family_name,description:a.description||"",currency_pref:a.currency_pref,is_public:a.is_public,status:a.status}),b({}))},[a]);const A=()=>{const v={};return i.family_name.trim()?i.family_name.trim().length<2?v.family_name="Family name must be at least 2 characters":i.family_name.trim().length>50&&(v.family_name="Family name must be less than 50 characters"):v.family_name="Family name is required",i.description&&i.description.length>255&&(v.description="Description must be less than 255 characters"),b(v),Object.keys(v).length===0},d=v=>{const{name:C,value:I,type:H}=v.target,L=v.target.checked;_(B=>({...B,[C]:H==="checkbox"?L:I})),N[C]&&b(B=>({...B,[C]:""}))},O=async v=>{if(v.preventDefault(),!(!A()||!a)){o(!0);try{if(!p)throw new Error("Admin client not available");const{data:C,error:I}=await p.from("families").update({family_name:i.family_name.trim(),description:i.description.trim()||null,currency_pref:i.currency_pref,is_public:i.is_public,status:i.status,updated_at:new Date().toISOString()}).eq("id",i.id).select().single();if(I)throw I;if(!C)throw new Error("Failed to update family");const H={...C,members_count:a.members_count,owner:a.owner};w(`Family "${i.family_name}" updated successfully!`),F(H),y()}catch(C){console.error("Error updating family:",C),T(C.message||"Failed to update family")}finally{o(!1)}}},U=()=>{c||(b({}),y())};if(!n||!a)return null;const k=i.family_name!==a.family_name||i.description!==(a.description||"")||i.currency_pref!==a.currency_pref||i.is_public!==a.is_public||i.status!==a.status;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:U}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:U,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered mx-2 mx-md-auto",onClick:v=>v.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"12px",overflow:"hidden",maxHeight:"90vh"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 py-md-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:"fas fa-edit",style:{fontSize:"1rem"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-truncate",style:{fontSize:"0.9rem"},children:"Edit Family Group"}),e.jsx("small",{className:"d-none d-md-block",style:{opacity:.9,fontSize:"0.75rem"},children:"Update family information and settings"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:U,disabled:c,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsxs("div",{className:"modal-body py-2 py-md-3 px-2 px-md-3",style:{maxHeight:"65vh",overflowY:"auto"},children:[D&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),D]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"position-relative mr-3",children:e.jsx("img",{src:a.owner?.avatar_url||"../images/placeholder.png",alt:a.owner?.full_name||"Owner",className:"rounded-circle",style:{width:"50px",height:"50px",objectFit:"cover",border:"2px solid #dc3545"},onError:v=>{v.currentTarget.src="../images/placeholder.png"}})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("strong",{style:{fontSize:"0.9rem"},children:a.family_name}),e.jsxs("div",{className:"text-muted",style:{fontSize:"0.75rem"},children:["Owner: ",a.owner?.full_name||"Unknown"," • ",a.members_count||0," members"]}),e.jsxs("div",{className:"mt-1",children:[e.jsx(J,{bg:a.status==="active"?"success":"secondary",style:{fontSize:"0.6rem"},className:"mr-1",children:a.status}),k&&e.jsxs(J,{bg:"warning",style:{fontSize:"0.6rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),"Unsaved"]})]})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-home mr-2"}),"Family Information"]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Family Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:`form-control form-control-sm ${N.family_name?"is-invalid":""}`,name:"family_name",value:i.family_name,onChange:d,placeholder:"The Johnson Family",disabled:c,style:{fontSize:"0.85rem"}}),N.family_name&&e.jsx("div",{className:"invalid-feedback",style:{fontSize:"0.75rem"},children:N.family_name})]}),e.jsxs("div",{className:"form-group mb-0",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Description ",e.jsx(J,{bg:"secondary",className:"ml-2",style:{fontSize:"0.6rem"},children:"Optional"})]}),e.jsx("textarea",{className:`form-control form-control-sm ${N.description?"is-invalid":""}`,name:"description",rows:2,value:i.description,onChange:d,placeholder:"Brief description of this family group...",disabled:c,style:{fontSize:"0.85rem"}}),N.description&&e.jsx("div",{className:"invalid-feedback",style:{fontSize:"0.75rem"},children:N.description})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-cog mr-2"}),"Family Settings"]}),e.jsx("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6 mb-2",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Status ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{className:"form-control form-control-sm",name:"status",value:i.status,onChange:d,disabled:c,style:{fontSize:"0.85rem"},children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"col-6 mb-2",children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Currency ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("select",{className:"form-control form-control-sm",name:"currency_pref",value:i.currency_pref,onChange:d,disabled:c,style:{fontSize:"0.85rem"},children:x.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:"Visibility"}),e.jsx("div",{className:"p-2",style:{background:"#fff",borderRadius:"6px",border:"1px solid #dee2e6"},children:e.jsxs("div",{className:"form-check mb-0",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",id:"is_public_edit",name:"is_public",checked:i.is_public,onChange:d,disabled:c}),e.jsx("label",{className:"form-check-label",htmlFor:"is_public_edit",style:{fontSize:"0.8rem"},children:"Make family public (visible to other users)"})]})})]})]})})]}),k&&e.jsx("div",{className:"p-3 mb-0",style:{background:"#fff5f5",borderRadius:"8px",borderLeft:"3px solid #dc3545"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-danger mr-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-danger",style:{fontSize:"0.85rem"},children:"Pending Changes"}),e.jsxs("p",{className:"mb-0 text-muted",style:{fontSize:"0.75rem"},children:["Your changes will affect ",a.members_count||0," member",(a.members_count||0)!==1?"s":"",". Status and visibility changes take effect immediately."]})]})]})})]}),e.jsxs("div",{className:"modal-footer border-0 py-2 px-2 px-md-3 flex-column flex-md-row",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto mb-2 mb-md-0 d-none d-md-block",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-fingerprint mr-1"}),"ID: ",e.jsxs("code",{style:{fontSize:"0.7rem"},children:[a.id?.substring(0,12),"..."]})]}),e.jsxs("div",{className:"d-flex w-100 w-md-auto gap-2",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm flex-grow-1 flex-md-grow-0",onClick:U,disabled:c,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm flex-grow-1 flex-md-grow-0",onClick:O,disabled:c||!k,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save mr-1"}),"Save"]})})]})]})]})})})]})},oe=({show:n,family:a,onClose:y,onConfirmDelete:F})=>{const[i,_]=r.useState(!1),[c,o]=r.useState(""),[N,b]=r.useState(""),{showSuccessToast:D}=Z(),P=async()=>{if(a){_(!0),b("");try{await F(a.id)&&(D(`Family "${a.family_name}" has been deleted successfully`),w())}catch(x){console.error("Error in delete confirmation:",x),b(x.message||"Failed to delete family")}finally{_(!1)}}},w=()=>{i||(o(""),b(""),y())},T=c.toLowerCase()==="delete";return!n||!a?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1040},onClick:w}),e.jsx("div",{className:"modal fade show d-block",tabIndex:-1,style:{zIndex:1050},onClick:w,children:e.jsx("div",{className:"modal-dialog modal-md modal-dialog-centered mx-2 mx-md-auto",onClick:x=>x.stopPropagation(),children:e.jsxs("div",{className:"modal-content border-0 shadow-lg",style:{borderRadius:"12px",overflow:"hidden",maxHeight:"90vh"},children:[e.jsx("div",{className:"modal-header border-0 text-white py-2 py-md-3",style:{background:"linear-gradient(135deg, #dc3545 0%, #c82333 100%)"},children:e.jsxs("div",{className:"d-flex align-items-center w-100",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center mr-2",style:{width:"36px",height:"36px",background:"rgba(255,255,255,0.2)",borderRadius:"8px"},children:e.jsx("i",{className:"fas fa-trash-alt",style:{fontSize:"1rem"}})}),e.jsxs("div",{className:"flex-grow-1 min-w-0",children:[e.jsx("h6",{className:"mb-0 font-weight-bold text-truncate",style:{fontSize:"0.9rem"},children:"Delete Family Group"}),e.jsx("small",{className:"d-none d-md-block",style:{opacity:.9,fontSize:"0.75rem"},children:"This action cannot be undone"})]}),e.jsx("button",{type:"button",className:"btn btn-light btn-sm flex-shrink-0",onClick:w,disabled:i,style:{width:"32px",height:"32px",borderRadius:"6px",padding:0},children:e.jsx("i",{className:"fas fa-times text-danger"})})]})}),e.jsxs("div",{className:"modal-body py-2 py-md-3 px-2 px-md-3",style:{maxHeight:"65vh",overflowY:"auto"},children:[N&&e.jsxs("div",{className:"alert alert-danger py-2 mb-3",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),N]}),e.jsx("div",{className:"p-3 mb-3",style:{background:"#fff5f5",borderRadius:"8px",borderLeft:"3px solid #dc3545"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-exclamation-triangle text-danger mr-2 mt-1"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-danger",style:{fontSize:"0.9rem"},children:"Permanent Deletion"}),e.jsx("p",{className:"mb-0 text-muted",style:{fontSize:"0.8rem"},children:"This will permanently remove the family group and all associated data including members, shared finances, and settings."})]})]})}),e.jsxs("div",{className:"p-3 mb-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[a.owner?.avatar_url?e.jsx("img",{src:a.owner.avatar_url,alt:a.owner.full_name,className:"rounded-circle mr-2",style:{width:"36px",height:"36px",objectFit:"cover"}}):e.jsx("div",{className:"d-flex align-items-center justify-content-center bg-danger text-white rounded-circle mr-2",style:{width:"36px",height:"36px",fontSize:"0.9rem",fontWeight:600},children:a.family_name?.charAt(0)?.toUpperCase()||"F"}),e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"0.9rem"},children:a.family_name}),e.jsxs("div",{className:"d-flex align-items-center",style:{gap:"6px"},children:[e.jsx(J,{bg:a.status==="active"?"success":"secondary",style:{fontSize:"0.65rem"},children:a.status}),e.jsx(J,{bg:a.is_public?"info":"secondary",style:{fontSize:"0.65rem"},children:a.is_public?"Public":"Private"})]})]})]}),e.jsxs("div",{className:"row",style:{fontSize:"0.8rem"},children:[e.jsxs("div",{className:"col-6 mb-2",children:[e.jsx("small",{className:"text-muted d-block",children:"Owner"}),e.jsx("span",{children:a.owner?.full_name||"Unknown"})]}),e.jsxs("div",{className:"col-6 mb-2",children:[e.jsx("small",{className:"text-muted d-block",children:"Members"}),e.jsx("span",{className:"text-danger font-weight-bold",children:a.members_count||0})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Currency"}),e.jsx("span",{children:a.currency_pref})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Family ID"}),e.jsxs("code",{style:{fontSize:"0.7rem"},children:[a.id?.substring(0,8),"..."]})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-list mr-2"}),"What will be deleted:"]}),e.jsx("div",{className:"d-flex flex-wrap",style:{gap:"6px"},children:[{icon:"fa-users",label:"Family Group"},{icon:"fa-user-friends",label:`${a.members_count||0} Members`},{icon:"fa-chart-pie",label:"Shared Finances"},{icon:"fa-cog",label:"Settings"}].map((x,A)=>e.jsxs("span",{className:"badge badge-light px-2 py-1",style:{fontSize:"0.75rem",border:"1px solid #dee2e6"},children:[e.jsx("i",{className:`fas ${x.icon} text-danger mr-1`}),x.label]},A))})]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("h6",{className:"text-danger mb-2",style:{fontSize:"0.85rem"},children:[e.jsx("i",{className:"fas fa-shield-alt mr-2"}),"Confirmation Required"]}),e.jsxs("div",{className:"p-3",style:{background:"#f8f9fa",borderRadius:"8px"},children:[e.jsxs("label",{className:"mb-1",style:{fontSize:"0.85rem"},children:["Type ",e.jsx("code",{className:"text-danger",children:"delete"})," to confirm:"]}),e.jsx("input",{type:"text",className:`form-control form-control-sm ${T?"is-valid":c?"is-invalid":""}`,value:c,onChange:x=>o(x.target.value),placeholder:'Type "delete" to confirm',disabled:i,autoComplete:"off",style:{fontSize:"0.85rem"}}),c&&!T&&e.jsxs("small",{className:"text-danger",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-1"}),'Please type "delete" to confirm']}),T&&e.jsxs("small",{className:"text-success",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-check-circle mr-1"}),"Confirmed. You can now proceed with deletion."]})]})]})]}),e.jsxs("div",{className:"modal-footer border-0 py-2 px-2 px-md-3 flex-column flex-md-row",style:{background:"#f8f9fa"},children:[e.jsxs("small",{className:"text-muted mr-auto mb-2 mb-md-0 d-none d-md-block",style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),a.members_count||0," member",(a.members_count||0)!==1?"s":""," will be affected"]}),e.jsxs("div",{className:"d-flex w-100 w-md-auto gap-2",style:{gap:"8px"},children:[e.jsxs("button",{type:"button",className:"btn btn-secondary btn-sm flex-grow-1 flex-md-grow-0",onClick:w,disabled:i,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Cancel"]}),e.jsx("button",{type:"button",className:"btn btn-danger btn-sm flex-grow-1 flex-md-grow-0",onClick:P,disabled:i||!T,children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-trash mr-1"}),"Delete"]})})]})]})]})})})]})},ue=()=>{const{showSuccessToast:n,showErrorToast:a}=Z(),{families:y,users:F,stats:i,loading:_,refreshing:c,totalPages:o,totalItems:N,fetchFamilies:b,refreshFamilyData:D,deleteFamily:P,getFamilyMembers:w,removeFamilyMember:T}=re(),[x,A]=r.useState(null),[d,O]=r.useState(!1),[U,k]=r.useState(!1),[v,C]=r.useState(!1),[I,H]=r.useState(!1),[L,B]=r.useState(null),[h,q]=r.useState({name:"",status:"all",minMembers:"",maxMembers:"",sortBy:"created_at",sortOrder:"desc",currentPage:1,pageSize:10}),[ee,s]=r.useState(new Date),[l,g]=r.useState(""),[m,j]=r.useState("all"),M=()=>B(null),S=t=>{B(L===t?null:t)};r.useEffect(()=>{const t=u=>{L&&!u.target.closest(".dropdown-menu")&&M()};if(L)return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[L]),r.useEffect(()=>{b(h)},[]),r.useEffect(()=>{const t={...h,name:l,status:m,currentPage:1};q(t),b(t)},[l,m]);const R=r.useCallback(async()=>{await D(h),s(new Date)},[D,h]),$=t=>{A(t),k(!0)},G=t=>{A(t),C(!0)},Q=t=>{A(t),H(!0)},se=()=>{A(null),O(!1),k(!1),C(!1),H(!1)},Y=r.useCallback(()=>{b(h),s(new Date)},[b,h]),f=r.useCallback(t=>{b(h),s(new Date)},[b,h]),E=r.useCallback(async t=>{const u=await P(t);return u&&s(new Date),u},[P]),V=t=>{const u={...h,currentPage:t};q(u),b(u)},z=t=>{const u=parseInt(t.target.value,10),W={...h,pageSize:u,currentPage:1};q(W),b(W)},X=()=>{g(""),j("all");const t={name:"",status:"all",minMembers:"",maxMembers:"",sortBy:"created_at",sortOrder:"desc",currentPage:1,pageSize:10};q(t),b(t)};return _?e.jsxs("div",{className:"modern-user-management",children:[e.jsx("div",{className:"block md:hidden py-12 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading families..."})]})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("div",{className:"user-management-header mb-5",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"skeleton-icon mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"skeleton-line skeleton-header-title mb-2"}),e.jsx("div",{className:"skeleton-line skeleton-header-subtitle"})]})]}),e.jsx("div",{className:"skeleton-line",style:{width:"120px",height:"40px"}})]})}),e.jsx("div",{className:"stats-cards-container mb-5",children:e.jsx(te,{stats:{totalFamilies:0,activeFamilies:0,totalMembers:0,avgMembersPerFamily:0},loading:!0})}),e.jsx("div",{className:"controls-section mb-4",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"skeleton-line skeleton-search-bar"})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"skeleton-line skeleton-filter"})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"skeleton-line skeleton-filter"})})]})}),e.jsx("div",{className:"table-section",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"skeleton-line skeleton-table-header"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table modern-table",children:[e.jsx("thead",{className:"table-header",children:e.jsx("tr",{children:Array.from({length:5}).map((t,u)=>e.jsx("th",{children:e.jsx("div",{className:"skeleton-line skeleton-th"})},u))})}),e.jsx("tbody",{children:Array.from({length:5}).map((t,u)=>e.jsx("tr",{className:"table-row",children:Array.from({length:5}).map((W,le)=>e.jsx("td",{children:e.jsx("div",{className:"skeleton-line skeleton-td"})},le))},u))})]})})})]})})]})]}):e.jsxs("div",{className:"modern-user-management",children:[e.jsx("div",{className:"block md:hidden mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-base font-bold text-gray-800",children:"Families"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:R,className:"w-9 h-9 rounded-full bg-red-500 hover:bg-red-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95 disabled:opacity-50",disabled:c,"aria-label":"Refresh data",children:e.jsx("i",{className:`fas fa-sync text-xs ${c?"fa-spin":""}`})}),e.jsx("button",{onClick:()=>O(!0),className:"w-9 h-9 rounded-full bg-rose-600 hover:bg-rose-700 text-white flex items-center justify-center shadow-md transition-all active:scale-95","aria-label":"Add family",children:e.jsx("i",{className:"fas fa-plus text-xs"})})]})]})}),e.jsx("div",{className:"user-management-header mb-5 hidden md:block",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start flex-wrap",children:[e.jsx("div",{className:"header-content",children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"header-icon-container mr-3",children:e.jsx("i",{className:"fas fa-users"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"header-title mb-1",children:"Family Management"}),e.jsx("p",{className:"header-subtitle mb-0",children:"Manage family groups, members, and shared financial access across the platform"})]})]})}),e.jsxs("div",{className:"header-actions d-flex align-items-center",children:[e.jsx("div",{className:"last-updated-info mr-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"far fa-clock mr-1"}),"Last updated: ",ee.toLocaleTimeString()]})}),e.jsxs("button",{className:"btn btn-outline-danger btn-sm shadow-sm refresh-btn mr-2",onClick:R,disabled:c,children:[e.jsx("i",{className:`fas fa-sync-alt mr-1 ${c?"fa-spin":""}`}),c?"Updating...":"Refresh"]}),e.jsxs("button",{className:"btn btn-danger btn-sm shadow-sm",onClick:()=>O(!0),children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Add Family"]})]})]})}),e.jsx("div",{className:"stats-cards-container mb-5",children:e.jsx(te,{stats:i,loading:c})}),e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-users text-red-500 text-[10px]"}),"Family List",N>0&&e.jsx("span",{className:"bg-red-100 text-red-600 px-1.5 py-0.5 rounded-full text-[9px]",children:N})]}),e.jsxs("button",{className:"text-[10px] text-gray-500 flex items-center gap-1",onClick:X,children:[e.jsx("i",{className:"fas fa-undo text-[8px]"}),"Reset"]})]}),e.jsxs("div",{className:"px-3 py-2 border-b border-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-[10px]"}),e.jsx("input",{type:"text",className:"w-full pl-8 pr-3 py-2 text-xs bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",placeholder:"Search families...",value:l,onChange:t=>g(t.target.value)})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"flex-1 px-2 py-1.5 text-[10px] bg-white border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-200 focus:border-red-400 outline-none",value:m,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})})]}),e.jsx("div",{className:"divide-y divide-gray-100 max-h-[60vh] overflow-y-auto",children:c?e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading families..."})]}):y.length>0?y.map(t=>e.jsx("div",{className:"px-3 py-3 hover:bg-gray-50 active:bg-gray-100 transition-colors",onClick:()=>$(t),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-users text-red-500 text-sm"})}),e.jsx("div",{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ${t.status==="active"?"bg-emerald-500":"bg-gray-400"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-800 truncate",children:t.family_name}),e.jsx("span",{className:`flex-shrink-0 px-1 py-0.5 rounded text-[8px] font-semibold ${t.status==="active"?"bg-emerald-100 text-emerald-600":"bg-gray-100 text-gray-600"}`,children:t.status?.toUpperCase()})]}),e.jsxs("p",{className:"text-[10px] text-gray-500 truncate",children:["Owner: ",t.owner?.full_name||"Unknown"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-600 rounded text-[8px] font-medium",children:[e.jsx("i",{className:"fas fa-user-friends mr-1"}),t.members_count||0," members"]}),e.jsx("span",{className:"text-[9px] text-gray-400",children:ae(t.created_at)})]})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"w-7 h-7 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 transition-colors",onClick:u=>{u.stopPropagation(),S(t.id)},onTouchEnd:u=>{u.stopPropagation(),S(t.id)},"aria-label":"More actions",children:e.jsx("i",{className:"fas fa-ellipsis-v text-[10px]"})}),L===t.id&&e.jsxs("div",{className:"dropdown-menu fixed w-32 bg-white rounded-lg shadow-xl border border-gray-200 overflow-hidden",style:{display:"block",zIndex:9999,transform:"translateX(-100px) translateY(4px)"},children:[e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-gray-50 active:bg-gray-100 flex items-center gap-2 transition-colors",onClick:u=>{u.stopPropagation(),M(),$(t)},onTouchEnd:u=>{u.stopPropagation(),M(),$(t)},children:[e.jsx("i",{className:"fas fa-eye text-gray-500 text-[10px]"}),e.jsx("span",{className:"text-gray-700",children:"View"})]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-gray-50 active:bg-gray-100 flex items-center gap-2 transition-colors",onClick:u=>{u.stopPropagation(),M(),G(t)},onTouchEnd:u=>{u.stopPropagation(),M(),G(t)},children:[e.jsx("i",{className:"fas fa-edit text-gray-500 text-[10px]"}),e.jsx("span",{className:"text-gray-700",children:"Edit"})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-xs hover:bg-red-50 active:bg-red-100 flex items-center gap-2 transition-colors",onClick:u=>{u.stopPropagation(),M(),Q(t)},onTouchEnd:u=>{u.stopPropagation(),M(),Q(t)},children:[e.jsx("i",{className:"fas fa-trash text-red-500 text-[10px]"}),e.jsx("span",{className:"text-red-600",children:"Delete"})]})]})]})})]})},t.id)):e.jsxs("div",{className:"px-3 py-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center mb-3",children:e.jsx("i",{className:"fas fa-users text-gray-400 text-lg"})}),e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"No families found"}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Try adjusting your filters"})]})}),o>1&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-100 bg-gray-50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-[9px] text-gray-500",children:["Page ",h.currentPage," of ",o]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>V(h.currentPage-1),disabled:h.currentPage===1,children:e.jsx("i",{className:"fas fa-chevron-left text-[10px]"})}),e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-[10px] font-medium rounded-lg min-w-[24px] text-center",children:h.currentPage}),e.jsx("button",{className:"w-7 h-7 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>V(h.currentPage+1),disabled:h.currentPage===o,children:e.jsx("i",{className:"fas fa-chevron-right text-[10px]"})})]})]})]})}),e.jsx("div",{className:"controls-section mb-4 hidden md:block",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-6 col-lg-4 mb-3 mb-md-0",children:e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"input-group",children:[e.jsx("div",{className:"input-group-prepend",children:e.jsx("span",{className:"input-group-text bg-white border-right-0",children:e.jsx("i",{className:"fas fa-search text-muted"})})}),e.jsx("input",{type:"text",className:"form-control border-left-0 modern-input",placeholder:"Search families by name...",value:l,onChange:t=>g(t.target.value)})]})})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsxs("select",{className:"form-control modern-select",value:m,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})}),e.jsx("div",{className:"col-md-3 col-lg-2 mb-3 mb-md-0",children:e.jsxs("div",{className:"page-size-selector",children:[e.jsx("small",{className:"text-muted mr-2",children:"Show:"}),e.jsxs("select",{className:"form-control form-control-sm d-inline-block w-auto",value:h.pageSize,onChange:z,children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("small",{className:"text-muted ml-2",children:"per page"})]})}),e.jsx("div",{className:"col-md-12 col-lg-4",children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:(l||m!=="all")&&e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:X,children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Clear Filters"]})})})]})})})}),e.jsx("div",{className:"table-section hidden md:block",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header bg-white border-0 py-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-danger",children:[e.jsx("i",{className:"fas fa-table mr-2"}),"Families (",N,")"]}),e.jsx("div",{className:"table-actions",children:e.jsxs("small",{className:"text-muted",children:["Showing ",Math.min((h.currentPage-1)*h.pageSize+1,N)," to ",Math.min(h.currentPage*h.pageSize,N)," of ",N," entries"]})})]})}),e.jsx("div",{className:"card-body p-0",children:c?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("h6",{className:"text-muted mb-2",children:"Refreshing families..."}),e.jsx("p",{className:"text-sm text-muted",children:"Fetching latest family data and statistics"})]}):y.length===0?e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"empty-state-container",children:[e.jsx("i",{className:"fas fa-users fa-4x text-gray-300 mb-4"}),e.jsx("h4",{className:"text-gray-700 mb-3",children:l||m!=="all"?"No Matching Families":"No Families Yet"}),e.jsx("p",{className:"text-muted mb-4 max-width-sm mx-auto",children:l||m!=="all"?"Try adjusting your filters or search criteria to find the families you're looking for.":"No family groups have been created yet. Create the first family to get started."}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[(l||m!=="all")&&e.jsxs("button",{className:"btn btn-outline-primary btn-sm mr-2",onClick:X,children:[e.jsx("i",{className:"fas fa-filter mr-2"}),"Clear Filters"]}),e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>O(!0),children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Create First Family"]})]})]})}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover modern-table mb-0",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0",children:"Family Name"}),e.jsx("th",{className:"border-0",children:"Owner"}),e.jsx("th",{className:"border-0",children:"Members"}),e.jsx("th",{className:"border-0",children:"Status"}),e.jsx("th",{className:"border-0",children:"Created"}),e.jsx("th",{className:"border-0 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:y.map(t=>e.jsxs("tr",{className:"table-row",children:[e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"family-icon mr-3",children:e.jsx("i",{className:"fas fa-users text-primary fa-2x"})}),e.jsxs("div",{children:[e.jsx("div",{className:"family-name font-weight-medium",children:t.family_name}),e.jsx("div",{className:"family-desc text-muted small",children:t.description||"No description"})]})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:t.owner?.avatar_url||"../images/placeholder.png",className:"rounded-circle mr-2",width:"30",height:"30",alt:t.owner?.full_name||"Owner",onError:u=>{u.currentTarget.src="../images/placeholder.png"}}),e.jsxs("div",{children:[e.jsx("div",{className:"owner-name text-sm font-weight-medium",children:t.owner?.full_name||"Unknown Owner"}),e.jsx("div",{className:"owner-email text-muted small",children:t.owner?.email||"No email"})]})]})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:"badge badge-primary p-2",children:[e.jsx("i",{className:"fas fa-user-friends mr-1"}),t.members_count||0]})}),e.jsx("td",{className:"py-3",children:e.jsxs("span",{className:`status-badge status-${t.status==="active"?"success":"danger"}`,children:[e.jsx("i",{className:`fas ${t.status==="active"?"fa-check-circle":"fa-pause-circle"} mr-1`}),t.status==="active"?"Active":"Inactive"]})}),e.jsx("td",{className:"py-3",children:e.jsx("div",{className:"created-date text-sm",children:ae(t.created_at)})}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary mr-1",onClick:()=>$(t),title:"View Details",children:e.jsx("i",{className:"fas fa-eye"})}),e.jsx("button",{className:"btn btn-sm btn-outline-warning mr-1",onClick:()=>G(t),title:"Edit Family",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>Q(t),title:"Delete Family",children:e.jsx("i",{className:"fas fa-trash"})})]})})]},t.id))})]})})}),o>1&&e.jsx("div",{className:"card-footer bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsxs("small",{className:"text-muted",children:["Page ",h.currentPage," of ",o]})}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[e.jsx("li",{className:`page-item ${h.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>V(h.currentPage-1),disabled:h.currentPage===1,children:e.jsx("i",{className:"fas fa-chevron-left"})})}),Array.from({length:Math.min(5,o)},(t,u)=>{const W=Math.max(1,Math.min(o-4,h.currentPage-2))+u;return W<=o?e.jsx("li",{className:`page-item ${h.currentPage===W?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>V(W),children:W})},W):null}),e.jsx("li",{className:`page-item ${h.currentPage===o?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>V(h.currentPage+1),disabled:h.currentPage===o,children:e.jsx("i",{className:"fas fa-chevron-right"})})})]})})]})})]})}),e.jsx(ne,{show:d,onClose:se,onFamilyAdded:Y,users:F}),e.jsx(ce,{show:U,family:x,onClose:se,onEdit:G,onDelete:Q,onGetMembers:w,onRemoveMember:T}),e.jsx(de,{show:v,family:x,onClose:se,onFamilyUpdated:f}),e.jsx(oe,{show:I,family:x,onClose:se,onConfirmDelete:E})]})};export{ue as default};
