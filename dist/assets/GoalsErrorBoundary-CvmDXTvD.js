var o=Object.defineProperty;var c=(r,a,e)=>a in r?o(r,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[a]=e;var i=(r,a,e)=>c(r,typeof a!="symbol"?a+"":a,e);import{j as s}from"./ui-vendor-Cn1Vfl4w.js";import{r as h}from"./react-vendor-D4A9EtXC.js";import{h as n}from"./index-BbApZ7g3.js";class g extends h.Component{constructor(e){super(e);i(this,"retryCount",0);i(this,"maxRetries",3);i(this,"handleRetry",async()=>{if(this.retryCount<this.maxRetries){this.retryCount++,console.log(`Retrying goals component (attempt ${this.retryCount}/${this.maxRetries})`);try{const e=await n.performHealthCheck();this.setState({serviceHealth:e}),(e.status==="healthy"||e.status==="degraded")&&this.setState({hasError:!1,error:null,errorInfo:null})}catch(e){console.error("Retry health check failed:",e)}}});i(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null,serviceHealth:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}async componentDidCatch(e,t){console.error("GoalsErrorBoundary caught an error:",e,t);try{const l=await n.performHealthCheck();this.setState({errorInfo:t,serviceHealth:l})}catch(l){console.error("Health check failed:",l),this.setState({errorInfo:t,serviceHealth:{status:"error",details:{error:"Health check failed"}}})}}getErrorMessage(){const{error:e,serviceHealth:t}=this.state;return t?.status==="error"?"Goals service is currently unavailable. This may be due to database connectivity issues.":t?.status==="degraded"?"Goals service is running in limited mode. Some features may be unavailable.":e?.message?.includes("goal_details")?"The goals database view is being updated. Please try again in a moment.":e?.message?.includes("auth")?"Authentication error. Please sign in again.":e?.message||"An unexpected error occurred in the goals system."}getRecoveryOptions(){const{serviceHealth:e}=this.state;return{showRetry:this.retryCount<this.maxRetries&&(e?.status==="healthy"||e?.status==="degraded"),showReload:!0,showFallbackLink:e?.status==="error"}}render(){if(this.state.hasError){const e=this.getErrorMessage(),t=this.getRecoveryOptions();return this.props.fallback?this.props.fallback:s.jsx("div",{className:"container-fluid",children:s.jsx("div",{className:"row justify-content-center",children:s.jsx("div",{className:"col-xl-8 col-lg-10",children:s.jsx("div",{className:"card border-left-danger shadow h-100 py-2 animate__animated animate__fadeIn",children:s.jsx("div",{className:"card-body",children:s.jsxs("div",{className:"row no-gutters align-items-center",children:[s.jsxs("div",{className:"col mr-2",children:[s.jsx("div",{className:"text-xs font-weight-bold text-danger text-uppercase mb-1",children:"Goals System Error"}),s.jsx("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:e}),this.state.serviceHealth&&s.jsxs("div",{className:"mt-3",children:[s.jsx("div",{className:"text-xs font-weight-bold text-gray-600 text-uppercase mb-1",children:"Service Status"}),s.jsxs("div",{className:"small text-gray-600",children:["Status: ",s.jsx("span",{className:`badge badge-${this.state.serviceHealth.status==="healthy"?"success":this.state.serviceHealth.status==="degraded"?"warning":"danger"}`,children:this.state.serviceHealth.status.toUpperCase()})]}),this.state.serviceHealth.details&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("div",{className:"small text-gray-600",children:["• Goals Table: ",this.state.serviceHealth.details.goalsTableAvailable?"✓ Available":"✗ Unavailable"]}),s.jsxs("div",{className:"small text-gray-600",children:["• Enhanced View: ",this.state.serviceHealth.details.goalDetailsAvailable?"✓ Available":"✗ Unavailable"]}),this.state.serviceHealth.details.fallbackMode&&s.jsx("div",{className:"small text-warning",children:"• Running in fallback mode"})]})]}),s.jsxs("div",{className:"mt-4",children:[t.showRetry&&s.jsxs("button",{className:"btn btn-primary btn-sm mr-2",onClick:this.handleRetry,children:[s.jsx("i",{className:"fas fa-redo fa-sm text-white-50 mr-1"}),"Retry (",this.maxRetries-this.retryCount," attempts left)"]}),t.showReload&&s.jsxs("button",{className:"btn btn-secondary btn-sm mr-2",onClick:this.handleReload,children:[s.jsx("i",{className:"fas fa-sync fa-sm text-white-50 mr-1"}),"Reload Page"]}),t.showFallbackLink&&s.jsxs("a",{href:"/dashboard",className:"btn btn-outline-primary btn-sm",children:[s.jsx("i",{className:"fas fa-arrow-left fa-sm mr-1"}),"Go to Dashboard"]})]}),!1]}),s.jsx("div",{className:"col-auto",children:s.jsx("i",{className:"fas fa-exclamation-triangle fa-2x text-danger"})})]})})})})})})}return this.props.children}}export{g as G};
