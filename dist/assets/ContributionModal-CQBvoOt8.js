import{j as e}from"./ui-vendor-Cn1Vfl4w.js";import{r as h,b as de}from"./react-vendor-D4A9EtXC.js";import{s as R,f as g,g as L,c as _,d as O,u as me,b as ue,h as xe}from"./index-BbApZ7g3.js";import{b as ge,P as be}from"./PermissionErrorModal-Dc2W8uaB.js";import{C as q}from"./ContributionMobileFooter-vJRvixwu.js";import{A as fe}from"./AccountSelector-Bv9lXSIJ.js";class te{static async logContributionCreated(t,r,s,a){try{const{error:i}=await R.from("system_activity_log").insert({user_id:t,activity_type:"goal_contribution_created",activity_description:`Goal contribution made: â‚±${r.amount.toFixed(2)} to "${r.goal_name}"${r.notes?` - ${r.notes}`:""}`,ip_address:a||null,user_agent:s||(typeof navigator<"u"?navigator.userAgent:null),metadata:{contribution_id:r.contribution_id,goal_id:r.goal_id,goal_name:r.goal_name,account_id:r.account_id,account_name:r.account_name,transaction_id:r.transaction_id,amount:r.amount,contribution_type:r.contribution_type,notes:r.notes,contribution_date:r.contribution_date,created_via:"goal_contribution_form"},severity:"info",created_at:new Date().toISOString()});return i?(console.error("Error logging goal contribution creation:",i),{success:!1,error:i.message}):{success:!0}}catch(i){return console.error("Exception logging goal contribution creation:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}static async logContributionUpdated(t,r,s,a,i){try{const u=Object.entries(s.changes).map(([f,d])=>{const y=f.replace(/_/g," ").replace(/\b\w/g,j=>j.toUpperCase());return f==="amount"?`${y}: â‚±${d.old} â†’ â‚±${d.new}`:`${y}: "${d.old}" â†’ "${d.new}"`}).join(", "),x=s.new_values.goal_name||s.old_values.goal_name,{error:o}=await R.from("system_activity_log").insert({user_id:t,activity_type:"goal_contribution_updated",activity_description:`Goal contribution to "${x}" updated: ${u}`,ip_address:i||null,user_agent:a||(typeof navigator<"u"?navigator.userAgent:null),metadata:{contribution_id:r,goal_id:s.new_values.goal_id||s.old_values.goal_id,goal_name:x,account_id:s.new_values.account_id||s.old_values.account_id,account_name:s.new_values.account_name||s.old_values.account_name,old_values:s.old_values,new_values:s.new_values,changes:s.changes,updated_via:"goal_contribution_form"},severity:"info",created_at:new Date().toISOString()});return o?(console.error("Error logging goal contribution update:",o),{success:!1,error:o.message}):{success:!0}}catch(m){return console.error("Exception logging goal contribution update:",m),{success:!1,error:m instanceof Error?m.message:"Unknown error"}}}static async logContributionDeleted(t,r,s,a,i){try{const{error:m}=await R.from("system_activity_log").insert({user_id:t,activity_type:"goal_contribution_deleted",activity_description:`Goal contribution deleted: â‚±${r.amount.toFixed(2)} to "${r.goal_name}"${s?` (${s})`:""}`,ip_address:i||null,user_agent:a||(typeof navigator<"u"?navigator.userAgent:null),metadata:{contribution_id:r.contribution_id,goal_id:r.goal_id,goal_name:r.goal_name,account_id:r.account_id,account_name:r.account_name,transaction_id:r.transaction_id,amount:r.amount,contribution_type:r.contribution_type,notes:r.notes,contribution_date:r.contribution_date,deletion_reason:s,deleted_via:"goal_contribution_interface"},severity:"info",created_at:new Date().toISOString()});return m?(console.error("Error logging goal contribution deletion:",m),{success:!1,error:m.message}):{success:!0}}catch(m){return console.error("Exception logging goal contribution deletion:",m),{success:!1,error:m instanceof Error?m.message:"Unknown error"}}}static async getContributionHistory(t,r,s={}){try{const{limit:a=50,offset:i=0,startDate:m,endDate:u,goalId:x}=s;let o=R.from("system_activity_log").select("*",{count:"exact"}).eq("user_id",t).in("activity_type",["goal_contribution_created","goal_contribution_updated","goal_contribution_deleted"]).contains("metadata",{account_id:r}).order("created_at",{ascending:!1}).range(i,i+a-1);m&&(o=o.gte("created_at",m)),u&&(o=o.lte("created_at",u)),x&&(o=o.contains("metadata",{goal_id:x}));const{data:f,error:d,count:y}=await o;return d?(console.error("Error fetching goal contribution history:",d),{success:!1,error:d.message}):{success:!0,data:f||[],totalCount:y||0}}catch(a){return console.error("Exception fetching goal contribution history:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}static extractContributionAuditData(t,r,s,a){return{contribution_id:t.id,goal_id:t.goal_id||r?.id,goal_name:r?.goal_name||"Unknown Goal",account_id:t.source_account_id||s?.id,account_name:s?.account_name,transaction_id:t.transaction_id||a?.id,amount:t.amount,contribution_type:t.contribution_type||"manual",notes:t.notes,contribution_date:t.contribution_date||t.created_at}}}const he=({currentStep:n,onClose:t,onShowMobileSidebar:r})=>{const s=()=>{switch(n){case"selection":return"Select Goal to Contribute";case"contribution":return"Make Your Contribution";case"review":return"Review Your Contribution";default:return"Goal Contribution"}},a=()=>n==="selection"?"Skip for now":"Cancel",i=()=>{switch(n){case"selection":return 1;case"contribution":return 2;case"review":return 3;default:return 1}},m=i()/3*100;return e.jsxs("div",{className:"border-b border-gray-200 bg-white",children:[e.jsx("div",{className:"px-4 py-3 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-blue-100 rounded-full",children:e.jsx("i",{className:"fas fa-bullseye text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:s()}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Step ",i()," of 3"]})]}),r&&e.jsx("button",{onClick:r,className:"md:hidden ml-2 w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 transition-colors duration-200",type:"button",title:"Goal Information",children:e.jsx("i",{className:"fas fa-info-circle text-gray-600"})})]}),e.jsxs("button",{onClick:t,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",type:"button",children:[e.jsx("i",{className:"fas fa-times text-sm mr-2"}),a()]})]})}),e.jsx("div",{className:"w-full bg-gray-200 h-1",children:e.jsx("div",{className:"bg-blue-600 h-1 transition-all duration-300 ease-out",style:{width:`${m}%`}})})]})};class v{static validateContribution(t,r,s){if(!t.amount||parseFloat(t.amount)<=0)return{isValid:!1,error:"Please enter a valid amount greater than zero"};if(!t.account_id)return{isValid:!1,error:"Please select an account"};if(!r)return{isValid:!1,error:"No goal selected"};if(!s)return{isValid:!1,error:"Selected account not found"};const a=parseFloat(t.amount);if(s.balance<a)return{isValid:!1,error:`Insufficient funds in ${s.account_name}. Available balance: ${g(s.balance)}`};const i=r.target_amount-r.current_amount;return a>i?{isValid:!1,error:`Contribution exceeds goal target. Maximum contribution: ${g(i)}`}:{isValid:!0}}static createContributionError(t,r,s,a,i){const m=s?.is_family_goal,u=m?"Family Goal":"Personal Goal";switch(t){case"validation":return{type:"validation",title:`${u} - Validation Error`,message:r,details:i,suggestedActions:["Check that all required fields are filled","Ensure the amount is greater than zero","Select a valid account"],isRetryable:!0};case"balance":return{type:"balance",title:`${u} - Insufficient Balance`,message:r,details:a?`Available in ${a.account_name}: ${g(a.balance)}`:void 0,suggestedActions:["Choose a different account with sufficient balance","Reduce the contribution amount",m?"Ask family admin to add funds to family accounts":"Transfer funds to this account first"],isRetryable:!0};case"family_restriction":return{type:"family_restriction",title:"Family Goal - Access Restricted",message:r,details:i,suggestedActions:["Contact your family administrator for permission","Use a family account instead of personal account","Check if this goal allows contributions from your role"],isRetryable:!1};case"goal_limit":return{type:"goal_limit",title:`${u} - Contribution Limit Exceeded`,message:r,details:s?`Goal Target: ${g(s.target_amount)}`:void 0,suggestedActions:["Reduce the contribution amount","Check the remaining amount needed for this goal"],isRetryable:!0};case"permission":return{type:"permission",title:`${u} - Permission Denied`,message:r,details:i,suggestedActions:[m?"Contact your family administrator":"Check your account permissions","Try using a different account","Verify your family role allows this action"],isRetryable:!1};case"network":return{type:"network",title:`${u} - Connection Error`,message:r,details:i,suggestedActions:["Check your internet connection","Try again in a few moments","Refresh the page if the problem persists"],isRetryable:!0};default:return{type:"validation",title:`${u} - Error`,message:r,details:i,isRetryable:!0}}}static validateContributionWithDetails(t,r,s){if(!t.amount||parseFloat(t.amount)<=0)return{isValid:!1,error:this.createContributionError("validation","Please enter a valid amount greater than zero",r,s)};if(!t.account_id)return{isValid:!1,error:this.createContributionError("validation","Please select an account to contribute from",r,s)};if(!r)return{isValid:!1,error:this.createContributionError("validation","No goal selected for contribution",r,s)};if(!s)return{isValid:!1,error:this.createContributionError("validation","Selected account not found or no longer available",r,s)};const a=parseFloat(t.amount);if(s.balance<a)return{isValid:!1,error:this.createContributionError("balance",`Insufficient funds in ${s.account_name}`,r,s,`You need ${g(a-s.balance)} more to make this contribution`)};const i=r.target_amount-r.current_amount;return a>i?{isValid:!1,error:this.createContributionError("goal_limit","Contribution amount exceeds what's needed to complete this goal",r,s,`Maximum needed: ${g(i)}`)}:(r.is_family_goal&&["checking","savings","cash"].includes(s.account_type)&&console.warn("Using individual account for family goal - this may require additional permissions"),{isValid:!0})}static calculateGoalCardAnalytics(t){const r=t.current_amount/t.target_amount*100,s=t.target_amount-t.current_amount,a=t.target_date?L(t.target_date):null,i=a!==null&&a<=30,m=r>=80,u=a&&a>0?s/a:void 0;return{progressPercentage:r,remainingAmount:s,remainingDays:a,isUrgent:i,isNearComplete:m,dailyTarget:u}}static filterEligibleGoals(t,r){return t.filter(s=>{const a=s.status?.toLowerCase(),i=s.target_amount-s.current_amount>0,m=(a==="not_started"||a==="in_progress")&&i;return m&&s.is_family_goal?r:m})}static calculateGoalStatistics(t){const r=t.length,s=t.reduce((u,x)=>u+x.target_amount,0),a=t.reduce((u,x)=>u+x.current_amount,0),i=t.reduce((u,x)=>u+(x.target_amount-x.current_amount),0),m=s>0?a/s*100:0;return{totalGoals:r,totalTarget:s,totalCurrent:a,totalRemaining:i,overallProgress:m}}static calculateNewProgress(t,r){const s=t.current_amount+r,a=s/t.target_amount*100,i=t.target_amount-s;return{newAmount:s,newProgress:a,remainingAfterContribution:i,willComplete:a>=100}}static getCompletionStatusMessage(t){return t>=100?"Goal will be completed! ðŸŽ‰":t>=75?"Almost there! Keep it up!":t>=50?"Halfway milestone reached!":"Great progress, keep going!"}}const F=({currentStep:n,selectedGoal:t,selectedAccount:r,contributionAmount:s,eligibleGoals:a=[],onTipClick:i})=>{const m=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center text-gray-800 font-semibold",children:[e.jsx("i",{className:"fas fa-lightbulb text-blue-600 mr-2"}),e.jsx("span",{children:"Smart Tips"}),i&&e.jsx("i",{className:"fas fa-info-circle ml-2 text-gray-400 cursor-pointer hover:text-blue-500 transition-colors",onClick:o=>i("contribution-tips",o)})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-chart-line text-sm"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 text-sm",children:"Prioritize High Impact"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Focus on goals closest to completion"})]})]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-clock text-sm"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 text-sm",children:"Mind the Deadlines"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Urgent goals need immediate attention"})]})]})}),e.jsx("div",{className:"mb-0",children:e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-coins text-sm"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 text-sm",children:"Regular Contributions"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Small, consistent amounts work best"})]})]})})]})]}),a.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center text-gray-800 font-semibold",children:[e.jsx("i",{className:"fas fa-chart-bar text-blue-600 mr-2"}),e.jsx("span",{children:"Your Goals Overview"}),i&&e.jsx("i",{className:"fas fa-info-circle ml-2 text-gray-400 cursor-pointer hover:text-blue-500 transition-colors",onClick:o=>i("goal-analytics",o)})]})}),e.jsx("div",{className:"p-4",children:(()=>{const o=v.calculateGoalStatistics(a);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Total Goals"}),e.jsx("span",{className:"font-bold text-blue-600",children:o.totalGoals})]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Total Target"}),e.jsx("span",{className:"font-bold text-green-600",children:g(o.totalTarget)})]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Current Total"}),e.jsx("span",{className:"font-bold text-cyan-600",children:g(o.totalCurrent)})]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 uppercase",children:"Remaining"}),e.jsx("span",{className:"font-bold text-orange-600",children:g(o.totalRemaining)})]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(o.overallProgress,100)}%`}})}),e.jsx("div",{className:"text-center",children:e.jsxs("small",{className:"text-gray-500",children:["Overall Progress: ",_(o.overallProgress)]})})]})})()})]})]}),u=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:e.jsx("h6",{className:"text-gray-800 font-semibold",children:"Goal Tips"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-piggy-bank text-sm"})}),e.jsx("p",{className:"font-semibold text-gray-800 mb-0",children:"Regular Contributions"})]}),e.jsx("p",{className:"text-sm text-gray-500 ml-11",children:"Small regular contributions add up quickly"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-calendar-check text-sm"})}),e.jsx("p",{className:"font-semibold text-gray-800 mb-0",children:"Set Up Auto-Savings"})]}),e.jsx("p",{className:"text-sm text-gray-500 ml-11",children:"Automate transfers to meet goal deadlines"})]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-bolt text-sm"})}),e.jsx("p",{className:"font-semibold text-gray-800 mb-0",children:"Bonus Contributions"})]}),e.jsx("p",{className:"text-sm text-gray-500 ml-11",children:"Add windfalls or bonuses to accelerate progress"})]})]})]}),t&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:e.jsx("h6",{className:"text-gray-800 font-semibold",children:"Goal Summary"})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-bold text-blue-600 uppercase mb-2",children:"Current Progress"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${t.current_amount/t.target_amount*100>=75?"bg-green-500":t.current_amount/t.target_amount*100>=40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(t.current_amount/t.target_amount*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsx("small",{className:"text-gray-500",children:g(t.current_amount)}),e.jsx("small",{className:"text-gray-500",children:g(t.target_amount)})]})]}),e.jsxs("div",{className:"flex justify-between mt-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Remaining"}),e.jsx("div",{className:"font-bold text-gray-800",children:g(t.target_amount-t.current_amount)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Target Date"}),e.jsx("div",{className:"font-bold text-gray-800",children:O(t.target_date)})]})]})]})})]})]}),x=()=>e.jsxs(e.Fragment,{children:[t&&r&&s&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50 rounded-t-lg",children:e.jsx("h6",{className:"text-gray-800 font-semibold",children:"Contribution Summary"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-1",children:"Amount"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g(parseFloat(s))})]}),e.jsxs("div",{className:"mb-4 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-1",children:"From Account"}),e.jsx("div",{className:"font-bold text-gray-800",children:r.account_name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Balance: ",g(r.balance)]})]}),e.jsxs("div",{className:"mb-4 pb-3 border-b border-gray-200",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-1",children:"Goal"}),e.jsx("div",{className:"font-bold text-gray-800",children:t.goal_name})]}),e.jsxs("div",{className:"mb-0",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase mb-1",children:"Target Date"}),e.jsx("div",{className:"font-bold text-gray-800",children:O(t.target_date)}),t.target_date&&(()=>{const o=L(t.target_date);return e.jsx("div",{className:`text-xs mt-1 ${o<0?"text-red-600":o<=30?"text-yellow-600":"text-gray-500"}`,children:o<0?`${Math.abs(o)} days overdue`:o===0?"Due today":`${o} days remaining`})})()]})]})]}),t&&s&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-green-50 rounded-t-lg",children:e.jsx("h6",{className:"text-green-800 font-semibold",children:"Goal Impact"})}),e.jsx("div",{className:"p-4",children:(()=>{const o=parseFloat(s),f=v.calculateNewProgress(t,o);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 text-green-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-chart-line text-sm"})}),e.jsx("p",{className:"font-semibold text-gray-800 mb-0",children:"Progress Boost"})]}),e.jsxs("p",{className:"text-sm text-gray-500 ml-11",children:["Your goal will increase by ",_(o/t.target_amount*100)]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-bullseye text-sm"})}),e.jsx("p",{className:"font-semibold text-gray-800 mb-0",children:"Remaining Amount"})]}),e.jsxs("p",{className:"text-sm text-gray-500 ml-11",children:[g(f.remainingAfterContribution)," left after this contribution"]})]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:e.jsx("i",{className:"fas fa-check-circle text-sm"})}),e.jsx("p",{className:"font-semibold text-gray-800 mb-0",children:"Completion Status"})]}),e.jsx("p",{className:"text-sm text-gray-500 ml-11",children:v.getCompletionStatusMessage(f.newProgress)})]})]})})()})]})]});return e.jsxs(e.Fragment,{children:[n==="selection"&&m(),n==="contribution"&&u(),n==="review"&&x()]})},pe=({isOpen:n,error:t,onClose:r,onRetry:s})=>{if(!n||!t)return null;const a=()=>{switch(t.type){case"balance":return"fas fa-wallet text-red-500";case"family_restriction":return"fas fa-users-slash text-orange-500";case"goal_limit":return"fas fa-exclamation-triangle text-yellow-500";case"permission":return"fas fa-lock text-red-500";case"network":return"fas fa-wifi text-gray-500";default:return"fas fa-exclamation-circle text-red-500"}},i=()=>{switch(t.type){case"balance":return"border-red-500 bg-red-50";case"family_restriction":return"border-orange-500 bg-orange-50";case"goal_limit":return"border-yellow-500 bg-yellow-50";case"permission":return"border-red-500 bg-red-50";case"network":return"border-gray-500 bg-gray-50";default:return"border-red-500 bg-red-50"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1070] p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-md w-full mx-auto animate-fadeIn",children:[e.jsx("div",{className:`px-6 py-4 border-b border-l-4 ${i()} rounded-t-lg`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:e.jsx("i",{className:`${a()} text-2xl`})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:t.title})}),e.jsx("button",{onClick:r,className:"flex-shrink-0 ml-3 w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors",children:e.jsx("i",{className:"fas fa-times text-gray-600"})})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-800 font-medium mb-2",children:t.message}),t.details&&e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("i",{className:"fas fa-info-circle mr-2 text-blue-500"}),t.details]})})]}),t.suggestedActions&&t.suggestedActions.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mr-2"}),"Suggestions to resolve this:"]}),e.jsx("ul",{className:"space-y-2",children:t.suggestedActions.map((m,u)=>e.jsxs("li",{className:"flex items-start text-sm text-gray-600",children:[e.jsx("i",{className:"fas fa-chevron-right text-blue-500 mr-2 mt-0.5 text-xs flex-shrink-0"}),e.jsx("span",{children:m})]},u))})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.type==="family_restriction"?"bg-orange-100 text-orange-800":t.type==="balance"?"bg-red-100 text-red-800":t.type==="goal_limit"?"bg-yellow-100 text-yellow-800":t.type==="permission"?"bg-red-100 text-red-800":t.type==="network"?"bg-gray-100 text-gray-800":"bg-blue-100 text-blue-800"}`,children:[t.type==="family_restriction"?"Family Restriction":t.type==="goal_limit"?"Goal Limit":t.type.charAt(0).toUpperCase()+t.type.slice(1)," Error"]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-lg flex justify-between items-center",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium",children:"Close"}),t.isRetryable&&s&&e.jsxs("button",{onClick:()=>{s(),r()},className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center",children:[e.jsx("i",{className:"fas fa-redo mr-2"}),"Try Again"]})]})]})})},ye=({eligibleGoals:n,onGoalSelection:t})=>{if(n.length===0)return e.jsxs("div",{className:"text-center py-12 px-4",children:[e.jsx("div",{className:"mb-6",children:e.jsx("i",{className:"fas fa-exclamation-circle text-6xl text-yellow-500 animate-pulse"})}),e.jsx("h4",{className:"text-gray-700 mb-4 text-xl font-semibold",children:"No Active Goals Available"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"You don't have any active goals to contribute to. Create a new goal to start tracking your financial objectives."}),e.jsxs("button",{type:"button",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors duration-200",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),e.jsx("span",{children:"Create a New Goal"})]})]});const r=v.calculateGoalStatistics(n);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-6 space-y-3 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-1",children:"Choose Your Goal"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["You have ",n.length," active goal",n.length!==1?"s":""," ready for contributions"]})]}),e.jsxs("div",{className:"text-center md:text-right",children:[e.jsx("div",{className:"text-xs uppercase text-gray-500 font-bold mb-1",children:"Total Progress"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:_(r.overallProgress)})]})]}),e.jsx("div",{className:"space-y-3",children:n.map(s=>{const a=v.calculateGoalCardAnalytics(s);return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:`bg-white rounded-lg shadow-sm border-l-4 cursor-pointer transition-all duration-200 hover:shadow-md hover:scale-[1.01] ${a.isNearComplete?"border-l-green-500":a.isUrgent?"border-l-yellow-500":"border-l-blue-500"} border border-gray-200`,onClick:()=>t(s),children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white ${a.isNearComplete?"bg-green-500":a.isUrgent?"bg-yellow-500":"bg-blue-500"}`,children:e.jsx("i",{className:"fas fa-bullseye text-sm"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-bold text-gray-800 text-base leading-tight",children:s.goal_name}),(a.isUrgent||a.isNearComplete)&&e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ml-2 flex-shrink-0 ${a.isNearComplete?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:a.isNearComplete?"Near Complete":"Urgent"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${a.progressPercentage>=75?"bg-green-500":a.progressPercentage>=40?"bg-yellow-500":"bg-blue-500"}`,style:{width:`${Math.min(a.progressPercentage,100)}%`}})}),e.jsxs("div",{className:"space-y-2 text-sm mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Progress"}),e.jsxs("span",{className:"text-green-600 text-xs font-medium",children:[_(a.progressPercentage)," Complete"]})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("span",{className:"font-medium text-blue-600 text-sm",children:[g(s.current_amount)," / ",g(s.target_amount)]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Remaining"}),e.jsx("span",{className:"font-medium text-orange-600 text-sm",children:g(a.remainingAmount)})]}),a.remainingDays!==null&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Days Left"}),e.jsx("span",{className:`text-xs font-medium ${a.remainingDays<=30?"text-red-600":a.remainingDays<=90?"text-yellow-600":"text-gray-600"}`,children:a.remainingDays>0?`${a.remainingDays} days`:"Overdue"})]})]}),a.remainingDays!==null&&a.remainingDays>0&&a.dailyTarget&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-gray-600 flex items-center",children:[e.jsx("i",{className:"fas fa-lightbulb text-yellow-500 mr-1 text-xs"}),"Daily: ",g(a.dailyTarget)]}),e.jsx("span",{className:`font-medium ${a.progressPercentage>=50?"text-green-600":"text-blue-600"}`,children:a.progressPercentage>=50?"On Track":"Needs Attention"})]})})]}),e.jsx("div",{className:"flex-shrink-0 ml-3",children:e.jsx("i",{className:"fas fa-chevron-right text-gray-400"})})]})})})},s.id)})})]})},je=({selectedGoal:n,contributionData:t,selectedAccount:r,error:s,onInputChange:a,onAccountSelect:i,onBackToSelection:m,onSubmit:u,onAmountChange:x})=>{const o=()=>[{label:"Complete Goal",className:"px-3 py-1 text-sm border border-green-500 text-green-600 hover:bg-green-50 rounded transition-colors",amount:(n.target_amount-n.current_amount).toFixed(2)},{label:"Half Remaining",className:"px-3 py-1 text-sm border border-blue-500 text-blue-600 hover:bg-blue-50 rounded transition-colors",amount:((n.target_amount-n.current_amount)/2).toFixed(2)},{label:"Quarter",className:"px-3 py-1 text-sm border border-blue-500 text-blue-600 hover:bg-blue-50 rounded transition-colors",amount:((n.target_amount-n.current_amount)/4).toFixed(2)}],f=()=>[{label:"â‚±100",amount:"100",className:"px-3 py-1 text-sm border border-gray-300 text-gray-600 hover:bg-gray-50 rounded transition-colors"},{label:"â‚±500",amount:"500",className:"px-3 py-1 text-sm border border-gray-300 text-gray-600 hover:bg-gray-50 rounded transition-colors"},{label:"â‚±1,000",amount:"1000",className:"px-3 py-1 text-sm border border-gray-300 text-gray-600 hover:bg-gray-50 rounded transition-colors"},{label:"â‚±5,000",amount:"5000",className:"px-3 py-1 text-sm border border-gray-300 text-gray-600 hover:bg-gray-50 rounded transition-colors"}];return e.jsxs("form",{onSubmit:u,children:[s&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),e.jsx("span",{children:s})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",children:"Contributing To Goal"}),e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 mr-4",children:e.jsx("i",{className:"fas fa-flag text-2xl text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-1",children:n.goal_name}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Current Progress: ",_(n.current_amount/n.target_amount*100)," â€¢"," ",g(n.current_amount)," of ",g(n.target_amount)]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${n.current_amount/n.target_amount*100>=75?"bg-green-500":n.current_amount/n.target_amount*100>=40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(n.current_amount/n.target_amount*100,100)}%`}})})]})]})})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-lightbulb text-lg text-blue-600 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-blue-800 mb-1",children:"Smart Suggestion"}),e.jsxs("div",{className:"text-sm text-blue-700",children:["Just ",g(n.target_amount-n.current_amount)," more to complete this goal!",n.target_date&&(()=>{const d=L(n.target_date),y=d>0?(n.target_amount-n.current_amount)/d:0;return d>0?e.jsxs("span",{className:"block mt-1",children:["Contribute ",g(y)," per day to meet your deadline on ",O(n.target_date)]}):null})()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"amount",className:"block text-sm font-bold text-gray-700 mb-2",children:["Amount ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"â‚±"})}),e.jsx("input",{type:"number",id:"amount",name:"amount",value:t.amount,onChange:a,className:"block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"0.00",step:"0.01",min:"0",required:!0})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("small",{className:"text-gray-500 block mb-2 text-sm",children:"Quick amounts:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:o().map((d,y)=>e.jsx("button",{type:"button",className:d.className,onClick:()=>x(d.amount),children:d.label},y))}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f().map((d,y)=>e.jsx("button",{type:"button",className:d.className,onClick:()=>x(d.amount),children:d.label},y))})]}),e.jsx("small",{className:"text-gray-500 text-xs mt-2 block",children:"Enter the amount you want to contribute towards this goal"})]})}),e.jsx("div",{children:e.jsx(fe,{selectedAccountId:t.account_id,onAccountSelect:i,required:!0,label:"From Account",showBalance:!0,showAccountType:!0,autoSelectDefault:!0})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-bold text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{id:"notes",name:"notes",value:t.notes,onChange:a,className:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm resize-none",rows:3,placeholder:"Add any notes about this contribution"}),e.jsx("small",{className:"text-gray-500 text-xs mt-1 block",children:"Briefly describe this contribution (optional)"})]}),e.jsxs("div",{className:"hidden md:flex justify-between pt-6 border-t border-gray-200",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-50 transition-colors duration-200",onClick:m,children:[e.jsx("i",{className:"fas fa-arrow-left mr-2"}),"Back to Goals"]}),e.jsxs("button",{type:"submit",className:"inline-flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:["Continue to Review",e.jsx("i",{className:"fas fa-arrow-right ml-2"})]})]})]})},ve=({selectedGoal:n,selectedAccount:t,contributionData:r,error:s,isSubmitting:a,onBack:i,onSubmit:m})=>{const u=parseFloat(r.amount),x=v.calculateNewProgress(n,u);return e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-exclamation-circle mr-2"}),e.jsx("span",{children:s})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",children:"Contributing To Goal"}),e.jsx("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 mr-4",children:e.jsx("i",{className:"fas fa-flag text-2xl text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-1",children:n.goal_name}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Current Progress: ",_(n.current_amount/n.target_amount*100)," â€¢"," ",g(n.current_amount)," of ",g(n.target_amount)]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${n.current_amount/n.target_amount*100>=75?"bg-green-500":n.current_amount/n.target_amount*100>=40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(n.current_amount/n.target_amount*100,100)}%`}})})]})]})})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-check-circle text-lg text-green-600 mr-3 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-800 mb-1",children:"Ready to Contribute!"}),e.jsxs("div",{className:"text-sm text-green-700",children:["You're contributing ",g(u)," from ",t.account_name,".",x.willComplete?e.jsx("span",{className:"block mt-1",children:"ðŸŽ‰ This will complete your goal!"}):e.jsxs("span",{className:"block mt-1",children:["Just ",g(x.remainingAfterContribution)," more to reach your goal!"]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:["Amount ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"â‚±"})}),e.jsx("input",{type:"text",value:u.toFixed(2),className:"block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 text-sm",disabled:!0,readOnly:!0})]}),e.jsx("small",{className:"text-gray-500 text-xs mt-1 block",children:"The amount you're contributing towards this goal"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:["From Account ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{type:"text",value:t.account_name,className:"block w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 text-sm",disabled:!0,readOnly:!0}),e.jsxs("small",{className:"text-gray-500 text-xs mt-1 block",children:["Available balance: ",g(t.balance)]})]})]}),r.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:r.notes,className:"block w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 text-sm resize-none",rows:3,disabled:!0,readOnly:!0})]}),e.jsx("div",{className:"bg-white border-l-4 border-l-green-500 rounded-lg shadow-sm border border-gray-200 mb-6",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-xs font-bold text-green-600 uppercase mb-2 flex items-center",children:[e.jsx("i",{className:"fas fa-arrow-up mr-2"}),"New Goal Progress After Contribution"]}),e.jsxs("div",{className:"text-xl font-bold text-gray-800 mb-3 flex items-center gap-3",children:[e.jsxs("span",{children:[g(x.newAmount)," / ",g(n.target_amount)]}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:_(x.newProgress)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-green-500 h-3 rounded-full transition-all duration-500 bg-gradient-to-r from-green-400 to-green-600",style:{width:`${Math.min(x.newProgress,100)}%`}})})]})}),e.jsxs("div",{className:"hidden md:flex justify-between pt-6 border-t border-gray-200",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-50 transition-colors duration-200",onClick:i,children:[e.jsx("i",{className:"fas fa-arrow-left mr-2"}),"Back to Edit"]}),e.jsxs("button",{onClick:m,disabled:a,className:"inline-flex items-center px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:[e.jsx("i",{className:`fas ${a?"fa-spinner fa-spin":"fa-check"} mr-2`}),a?"Processing...":"Confirm Contribution"]})]})]})},Ne=`
  .hover-lift {
    transition: all 0.3s ease;
  }
  .hover-lift:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.25) !important;
  }
  .icon-circle {
    width: 2.5rem !important;
    height: 2.5rem !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 1rem !important;
    flex-shrink: 0 !important;
    min-width: 2.5rem !important;
    min-height: 2.5rem !important;
    box-sizing: border-box !important;
  }
  .icon-circle-sm {
    width: 35px !important;
    height: 35px !important;
    border-radius: 50% !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 14px !important;
    flex-shrink: 0 !important;
    min-width: 35px !important;
    min-height: 35px !important;
    box-sizing: border-box !important;
  }
  .cursor-pointer {
    cursor: pointer;
  }
  .animate-pulse {
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  .goal-card {
    overflow: hidden !important;
    border-radius: 0.35rem !important;
    border: 1px solid #e3e6f0 !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
  .goal-card .card-body {
    padding: 1rem !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }
  .goal-card .row {
    margin: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: center !important;
  }
  .goal-card .col-auto {
    padding: 0 0.75rem 0 0 !important;
    flex: 0 0 auto !important;
    width: auto !important;
  }
  .goal-card .col {
    flex: 1 1 0% !important;
    min-width: 0 !important;
    padding: 0 0.75rem 0 0 !important;
  }
  .modal-dialog {
    max-width: 90% !important;
  }
  @media (min-width: 1200px) {
    .modal-dialog {
      max-width: 1140px !important;
    }
  }
  .goal-card:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.25) !important;
  }
  .modal-body .container-fluid {
    padding: 0 !important;
  }
  .modal-body .row {
    margin: 0 !important;
  }
  .col-12.mb-3 {
    padding: 0 15px !important;
    margin-bottom: 1rem !important;
  }
  .goal-card .card-body.p-3 {
    padding: 1rem !important;
  }
  .goal-card .row.align-items-center {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    flex-wrap: nowrap !important;
    width: 100% !important;
  }
  .goal-card .progress {
    height: 10px !important;
    background-color: #e9ecef !important;
    border-radius: 0.25rem !important;
    overflow: hidden !important;
  }
  .goal-card * {
    box-sizing: border-box !important;
  }
  
  /* Mobile sidebar animations */
  .animate-fadeIn {
    animation: fadeIn 0.2s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }
  
  /* Smooth scrolling for mobile */
  .smooth-scroll {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Custom scrollbar for mobile sidebar */
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }
`,Te=({isOpen:n,onClose:t,goals:r,onContributionSuccess:s,preSelectedGoal:a})=>{const{user:i}=me(),{showSuccessToast:m,showErrorToast:u}=ue(),x=ge(),[o,f]=h.useState("selection"),[d,y]=h.useState(null),[j,H]=h.useState(null),[p,S]=h.useState({goalId:"",amount:"",account_id:"",notes:""}),[Q,w]=h.useState(null),[I,M]=h.useState(null),[U,z]=h.useState(null),[we,_e]=h.useState(!1),[Ce,re]=h.useState(null),[W,C]=h.useState(!1),[se,V]=h.useState(!1),[B,J]=h.useState(null),[X,A]=h.useState({hasError:!1,error:null,showErrorModal:!1}),[Y,$]=h.useState(!1),k=h.useMemo(()=>n?v.filterEligibleGoals(r,x.canContributeToGoals):[],[n,r,x.canContributeToGoals]);h.useEffect(()=>{n||(f("selection"),y(null),H(null),S({goalId:"",amount:"",account_id:"",notes:""}),w(null),C(!1),M(null),z(null),V(!1),J(null),$(!1),A({hasError:!1,error:null,showErrorModal:!1}))},[n]),h.useEffect(()=>{n&&a&&k.some(c=>c.id===a.id)&&Z(a)},[n,a,k]),h.useEffect(()=>{if(!n)return;const l="contribution-modal-styles";if(!document.getElementById(l)){const c=document.createElement("style");c.id=l,c.textContent=Ne,document.head.appendChild(c)}return()=>{const c=document.getElementById(l);c&&c.remove()}},[n]),h.useEffect(()=>{Y&&setTimeout(()=>{const l=document.querySelector(".smooth-scroll.custom-scrollbar");l&&l.scrollTo({top:0,behavior:"smooth"})},100)},[Y]);const E=l=>{A({hasError:!0,error:l,showErrorModal:!0}),w(l.message)},P=()=>{A({hasError:!1,error:null,showErrorModal:!1}),w(null)},ae=()=>{P()},K=()=>{const l=v.validateContributionWithDetails(p,d,j);return!l.isValid&&l.error?(E(l.error),!1):(P(),!0)};if(!n)return null;const ne=l=>{H(l),S(c=>({...c,account_id:l?.id||""})),w(null)},Z=async l=>{if(l.is_family_goal){const b=await x.checkCanAccessGoal(l.id.toString());if(!b.hasPermission){const N=x.familyRole;J({title:"Goal Contribution Restricted",message:b.errorMessage||`As a family ${N}, you cannot contribute to this family goal.`,suggestedActions:b.restrictions}),V(!0);return}}y(l),S(b=>({...b,goalId:l.id.toString(),notes:`Contribution to ${l.goal_name}`}));const c=v.calculateGoalCardAnalytics(l);re({progressPercentage:c.progressPercentage,remainingAmount:c.remainingAmount,remainingDays:c.remainingDays,dailyRequired:c.dailyTarget||0,isOnTrack:c.remainingDays?(c.dailyTarget||0)*c.remainingDays<=c.remainingAmount:!0}),f("contribution"),w(null)},T=(l,c)=>{if(I===l)M(null),z(null);else if(M(l),c){const b=c.currentTarget.getBoundingClientRect();z({top:b.bottom+window.scrollY,left:b.left+b.width/2+window.scrollX})}},ie=()=>{const c={"goal-selection":{title:"Goal Selection Tips",description:"Choose goals that need the most attention. Focus on goals with approaching deadlines or those closest to completion for maximum impact."},"contribution-tips":{title:"Contribution Strategy",description:"Regular small contributions are often more effective than large irregular ones. Consider your budget and make sustainable contributions."},"goal-analytics":{title:"Goals Overview",description:"View summary statistics of all your goals including total targets, current progress, and remaining amounts to track your overall financial progress."},"smart-suggestions":{title:"Smart Suggestions",description:"AI-powered recommendations based on your spending patterns and goal priorities to optimize your contribution strategy."}}[I||""];return c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-weight-bold mb-2 text-primary",children:c.title}),e.jsx("p",{className:"mb-0 small",children:c.description})]}):null},oe=l=>{const{name:c,value:b}=l.target;S(N=>({...N,[c]:b})),w(null)},D=()=>{f("selection"),y(null),w(null)},le=l=>{S(c=>({...c,amount:l})),w(null)},ce=async l=>{if(l.preventDefault(),!i||!d){const c=v.createContributionError("validation","Please ensure you are signed in and have selected a goal",d);E(c);return}K()&&(f("review"),P())},G=async()=>{try{if(C(!0),w(null),!i){const b=v.createContributionError("permission","You must be signed in to make contributions",d);E(b),C(!1),f("contribution");return}if(!d){u("Goal information is missing"),C(!1),f("contribution");return}if(d.is_family_goal){const b=await x.checkCanAccessGoal(d.id.toString());if(!b.hasPermission){const N=x.familyRole,ee=v.createContributionError("family_restriction",b.errorMessage||`As a family ${N}, you cannot contribute to this family goal.`,d,j,`Your role: ${N}`);b.restrictions&&(ee.suggestedActions=b.restrictions),E(ee),C(!1),f("contribution");return}}const l=parseFloat(p.amount),c=await xe.createGoalContribution(p.goalId,i.id,{amount:l,account_id:p.account_id,notes:p.notes});if(!c.success)throw new Error(c.error||"Failed to create contribution");try{if(c.data&&d&&j){const b=te.extractContributionAuditData({id:c.data.contribution_id,goal_id:p.goalId,source_account_id:p.account_id,amount:l,contribution_type:"manual",notes:p.notes,contribution_date:new Date().toISOString()},d,j);te.logContributionCreated(i.id,b,navigator.userAgent).catch(N=>{console.error("Failed to log goal contribution to audit:",N)})}}catch(b){console.error("Error preparing goal contribution audit log:",b)}m("Contribution made successfully!"),s(),t()}catch(l){console.error("Error making contribution:",l);const c=l instanceof Error?l.message:"Unknown error occurred";let b="network";c.includes("permission")||c.includes("access")?b="permission":(c.includes("validation")||c.includes("invalid"))&&(b="validation");const N=v.createContributionError(b,`Failed to ${d?.is_family_goal?"contribute to family goal":"make contribution"}: ${c}`,d,j,"Please try again or contact support if the problem persists");E(N),f("contribution")}finally{C(!1)}};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:1060},children:[e.jsx("div",{className:"w-[95vw] h-[90vh] mx-auto my-auto",children:e.jsxs("div",{className:"w-full h-full flex flex-col bg-white rounded-lg shadow-2xl border border-gray-200",style:{zIndex:1065},children:[I&&U&&e.jsx("div",{className:"tip-box light",style:{position:"absolute",top:`${U.top}px`,left:`${U.left}px`,transform:"translateX(-50%)",zIndex:1e3,background:"white",padding:"12px 15px",borderRadius:"8px",boxShadow:"0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15)",maxWidth:"300px",border:"1px solid rgba(0, 0, 0, 0.05)"},children:ie()}),e.jsx(he,{currentStep:o,onClose:t,onShowMobileSidebar:()=>$(!0)}),o==="selection"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 flex min-h-0",children:e.jsxs("div",{className:"flex w-full h-full",children:[e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx("div",{className:"p-3 md:p-6 lg:p-8 flex-1 overflow-y-auto pb-20 md:pb-6",children:e.jsx(ye,{eligibleGoals:k,onGoalSelection:Z})})}),e.jsx("div",{className:"hidden md:flex md:w-1/3 bg-gray-50 border-l border-gray-200 flex-col",children:e.jsx("div",{className:"p-3 md:p-6 lg:p-8 flex-1 overflow-y-auto",children:e.jsx(F,{currentStep:o,eligibleGoals:k,onTipClick:T})})})]})}),e.jsx(q,{currentStep:o,eligibleGoalsCount:k.length})]}),o==="contribution"&&d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 flex min-h-0",children:e.jsxs("div",{className:"flex w-full h-full",children:[e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx("div",{className:"p-3 md:p-6 lg:p-8 flex-1 overflow-y-auto pb-20 md:pb-6",children:e.jsx(je,{selectedGoal:d,contributionData:p,selectedAccount:j,error:Q,onInputChange:oe,onAccountSelect:ne,onBackToSelection:D,onSubmit:ce,onAmountChange:le})})}),e.jsx("div",{className:"hidden md:flex md:w-1/3 bg-gray-50 border-l border-gray-200 flex-col",children:e.jsx("div",{className:"p-3 md:p-6 lg:p-8 flex-1 overflow-y-auto",children:e.jsx(F,{currentStep:o,selectedGoal:d,selectedAccount:j,contributionAmount:p.amount,onTipClick:T})})})]})}),e.jsx(q,{currentStep:o,onPrevious:D,onNext:()=>{K()&&(f("review"),P())},isNextDisabled:!p.amount||!p.account_id,showPrevious:!0})]}),o==="review"&&d&&j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 flex min-h-0",children:e.jsxs("div",{className:"flex w-full h-full",children:[e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx("div",{className:"p-3 md:p-6 lg:p-8 flex-1 overflow-y-auto pb-20 md:pb-6",children:e.jsx(ve,{selectedGoal:d,selectedAccount:j,contributionData:p,error:Q,isSubmitting:W,onBack:()=>f("contribution"),onSubmit:G})})}),e.jsx("div",{className:"hidden md:flex md:w-1/3 bg-gray-50 border-l border-gray-200 flex-col",children:e.jsx("div",{className:"p-3 md:p-6 lg:p-8 flex-1 overflow-y-auto",children:e.jsx(F,{currentStep:o,selectedGoal:d,selectedAccount:j,contributionAmount:p.amount,onTipClick:T})})})]})}),e.jsx(q,{currentStep:o,onPrevious:()=>f("contribution"),onSubmit:G,isSubmitting:W,showPrevious:!0})]})]})}),e.jsx(be,{isOpen:se,onClose:()=>V(!1),errorTitle:B?.title||"Access Denied",errorMessage:B?.message||"You don't have permission to perform this action.",suggestedActions:B?.suggestedActions,userRole:x.familyRole||void 0}),Y&&de.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 md:hidden flex items-end justify-center animate-fadeIn",style:{zIndex:1050},onClick:()=>$(!1),children:e.jsxs("div",{className:"bg-white rounded-t-2xl shadow-2xl w-full max-h-[80vh] overflow-hidden animate-slideUp flex flex-col",style:{animation:"slideUp 0.3s ease-out"},onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between z-10",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Goal Information"}),e.jsx("button",{onClick:()=>$(!1),className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 transition-colors",children:e.jsx("i",{className:"fas fa-times text-gray-600 text-sm"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 smooth-scroll custom-scrollbar",style:{maxHeight:"calc(80vh - 60px)"},children:e.jsx(F,{currentStep:o,eligibleGoals:k,selectedGoal:d,selectedAccount:j,contributionAmount:p.amount,onTipClick:T})})]})}),document.body),e.jsx(pe,{isOpen:X.showErrorModal,error:X.error,onClose:()=>A(l=>({...l,showErrorModal:!1})),onRetry:ae})]})};export{Te as C};
