var ls=Object.defineProperty;var os=(b,l,s)=>l in b?ls(b,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):b[l]=s;var Le=(b,l,s)=>os(b,typeof l!="symbol"?l+"":l,s);import{j as e}from"./ui-vendor-Cn1Vfl4w.js";import{r as D,g as Ut,L as _e,u as qt,j as cs,i as ds}from"./react-vendor-D4A9EtXC.js";import{s as V,l as pe,f as me,B as ms,m as nt,n as hs,o as ht,b as Qe,d as qe,u as ut,c as Ze,r as Dt}from"./index-BbApZ7g3.js";import{d as Ye,H as Me}from"./chart-vendor-B0c7K_uV.js";/* empty css                       */import Wt from"./JoinFamily-C6o0B23Z.js";import{i as lt}from"./invitationService-CDp2WaQk.js";import{C as us}from"./ContributionModal-CQBvoOt8.js";import"./PermissionErrorModal-Dc2W8uaB.js";import"./ContributionMobileFooter-vJRvixwu.js";import"./AccountSelector-Bv9lXSIJ.js";import"./accountService-CFCTGWw4.js";import"./currencyUtils-BZq_rNNs.js";const xs=(b,l)=>{const[s,n]=D.useState(null),[a,r]=D.useState(!1),[o,t]=D.useState(!1),m=D.useCallback(async(d=0,f=3,p)=>{if(b){r(!0);try{if(p){const{data:w,error:g}=await V.from("families").select("*").eq("id",p).single();if(g){console.error("Error fetching specific family:",g),l(`Error loading family: ${g.message}`);return}if(w){n(w),t(b===w.created_by);return}}const{data:N,error:x}=await V.from("family_members").select(`
          family_id,
          role,
          status,
          families (
            id,
            family_name,
            description,
            currency_pref,
            created_by,
            created_at,
            updated_at,
            is_public
          )
        `).eq("user_id",b).eq("status","active").single();if(x||!N){if(d<f-1){setTimeout(()=>{m(d+1,f)},1500);return}n(null);return}const u=N.families;if(u)n({id:u.id,family_name:u.family_name,description:u.description||"",currency_pref:u.currency_pref||"PHP",created_by:u.created_by,created_at:u.created_at,updated_at:u.updated_at,is_public:u.is_public||!1}),t(b===u.created_by);else{if(d<f-1){setTimeout(()=>{m(d+1,f)},1500);return}n(null)}}catch(N){console.error("Error in fetchFamilyData:",N);const x=N instanceof Error?N.message:"An unknown error occurred";if(x.includes("400")||x.includes("Bad Request")||x.includes("RPC")||x.includes("get_family_membership")||x.includes("check_user_family")){l("Database connection error. Please try refreshing the page."),n(null);return}if(d<f-1){setTimeout(()=>{m(d+1,f)},1500);return}l(`Error loading family data: ${x}`)}finally{r(!1)}}},[b,l]);return{familyData:s,isLoadingFamilyData:a,isCreator:o,fetchFamilyData:m,setFamilyData:n}},gs=b=>{const[l,s]=D.useState([]),[n,a]=D.useState(!1),r=D.useCallback(async o=>{if(o){a(!0);try{const t=await pe.getFamilyMembers(o);console.log("Fetched family members via familyService:",t),s(t)}catch(t){console.error("Error in fetchFamilyMembers:",t);const m=t instanceof Error?t.message:"An unknown error occurred";b(`Error loading family members: ${m}`)}finally{a(!1)}}},[b]);return{members:l,isLoadingMembers:n,fetchFamilyMembers:r,setMembers:s}},fs=(b=[])=>{if(!b||b.length===0)return null;const s=[...b].sort((r,o)=>o.percentage-r.percentage).slice(0,10),n=s.map(r=>r.goal_name),a=s.map(r=>r.percentage);return{chart:{type:"bar",backgroundColor:"transparent",style:{fontFamily:"Nunito, sans-serif"},height:350,animation:{duration:800,easing:"easeOutBounce"}},title:{text:null},xAxis:{categories:n,title:{text:null},gridLineWidth:0,labels:{style:{color:"#858796"}}},yAxis:{min:0,max:100,title:{text:"Completion (%)"},gridLineColor:"#eaecf4",gridLineDashStyle:"dash",labels:{format:"{value}%",style:{color:"#858796"}}},legend:{enabled:!1},tooltip:{formatter:function(){const r=this.point,o=n.indexOf(r.category),t=s[o];return`<b>${r.category}</b><br>Progress: <b>${r.y.toFixed(1)}%</b><br>Current: <b>${me(t.current_amount)}</b><br>Target: <b>${me(t.target_amount)}</b><br>Remaining: <b>${me(t.remaining)}</b>`},useHTML:!0,backgroundColor:"rgba(255, 255, 255, 0.9)",borderWidth:1,borderRadius:8,shadow:!0},plotOptions:{bar:{dataLabels:{enabled:!0,format:"{y}%"},colorByPoint:!0},series:{animation:{duration:1e3}}},credits:{enabled:!1},series:[{name:"Goal Progress",data:a.map((r,o)=>({y:r,color:r>=75?"#1cc88a":r>=50?"#4e73df":r>=25?"#f6c23e":"#e74a3b"}))}]}},ps=(b=[])=>{if(!b||b.length===0)return null;const l={not_started:0,in_progress:0,completed:0,cancelled:0};b.forEach(r=>{l[r.status]!==void 0&&l[r.status]++});const s={not_started:"Not Started",in_progress:"In Progress",completed:"Completed",cancelled:"Cancelled"},a=Object.keys(l).map(r=>({name:s[r],y:l[r],color:r==="completed"?"#1cc88a":r==="in_progress"?"#4e73df":r==="not_started"?"#f6c23e":"#e74a3b"})).filter(r=>r.y>0);return a.length===0?null:{chart:{type:"pie",backgroundColor:"transparent",style:{fontFamily:"Nunito, sans-serif"},height:350,animation:{duration:800,easing:"easeOutBounce"}},title:{text:null},tooltip:{pointFormat:"<b>{point.name}</b>: {point.percentage:.1f}%<br>Count: {point.y}",animation:!0,backgroundColor:"rgba(255, 255, 255, 0.9)",borderWidth:1,borderRadius:8,shadow:!0},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.y}",style:{fontWeight:"normal"},connectorWidth:0,distance:30},showInLegend:!1,size:"85%",animation:{duration:1e3}}},credits:{enabled:!1},series:[{name:"Goal Status",colorByPoint:!0,data:a,animation:{duration:800}}]}},bs=b=>{const[l,s]=D.useState([]),[n,a]=D.useState(!1),[r,o]=D.useState(null),[t,m]=D.useState(null),d=D.useMemo(()=>l.map(x=>({...x,current_amount:x.current_amount||0,target_amount:x.target_amount||0,status:x.status||"active",percentage:x.target_amount>0?Math.round((x.current_amount||0)/x.target_amount*100):0})),[l]),f=D.useMemo(()=>r,[r]),p=D.useMemo(()=>t,[t]),N=D.useCallback(async x=>{if(x){a(!0);try{const{data:u,error:w}=await V.from("goals").select("*").eq("family_id",x).order("created_at",{ascending:!1});if(w){console.error("Error fetching family goals:",w),b(`Error loading family goals: ${w.message}`);return}const g=u?.map(j=>({...j,current_amount:j.current_amount||0,target_amount:j.target_amount||0,status:j.status||"active"}))||[];s(g),o(fs(g)),m(ps(g))}catch(u){console.error("Error in fetchFamilyGoals:",u);const w=u instanceof Error?u.message:"An unknown error occurred";b(`Error loading family goals: ${w}`)}finally{a(!1)}}},[b]);return{familyGoals:d,loadingFamilyGoals:n,sharedGoalPerformanceChartData:f,sharedGoalBreakdownChartData:p,setSharedGoalPerformanceChartData:o,setSharedGoalBreakdownChartData:m,fetchFamilyGoals:N,setFamilyGoals:s}},ys=(b,l)=>{const[s,n]=D.useState([]),[a,r]=D.useState([]),[o,t]=D.useState(!1),m=D.useCallback(async N=>{if(N){t(!0);try{const{data:x,error:u}=await V.from("join_requests").select(`
          id,
          family_id,
          user_id,
          status,
          requested_at,
          users (
            id,
            email,
            full_name,
            avatar_url
          )
        `).eq("family_id",N).eq("status","pending").order("requested_at",{ascending:!1});if(u){console.error("Error fetching join requests:",u),b(`Error loading join requests: ${u.message}`);return}const w=x?.map(g=>({id:g.id,family_id:g.family_id,user_id:g.user_id,status:g.status,requested_at:g.requested_at,user:g.users?{id:g.users[0]?.id||"",email:g.users[0]?.email||"",full_name:g.users[0]?.full_name||"",avatar_url:g.users[0]?.avatar_url||""}:{id:"",email:"",full_name:"",avatar_url:""}}))||[];n(w)}catch(x){console.error("Error in fetchJoinRequests:",x);const u=x instanceof Error?x.message:"An unknown error occurred";b(`Error loading join requests: ${u}`)}finally{t(!1)}}},[b]),d=D.useCallback(async N=>{if(N)try{const{data:x,error:u}=await V.from("join_requests").select(`
          id,
          family_id,
          user_id,
          status,
          requested_at,
          families (
            id,
            family_name,
            description
          )
        `).eq("user_id",N).eq("status","pending").order("requested_at",{ascending:!1});if(u){console.error("Error fetching pending requests:",u);return}const w=x?.map(g=>({id:g.id,family_id:g.family_id,user_id:g.user_id,status:g.status,requested_at:g.requested_at,user:{id:g.user_id,email:"",full_name:"",avatar_url:""}}))||[];r(w)}catch(x){console.error("Error fetching pending requests:",x)}},[]),f=D.useCallback(async(N,x,u)=>{try{const{data:w,error:g}=await V.rpc(x==="approve"?"approve_join_request":"reject_join_request",{p_request_id:N});if(g){console.error(`Error ${x}ing join request:`,g),b(`Failed to ${x} join request: ${g.message}`);return}l(`Join request ${x}ed successfully`),await m(u)}catch(w){console.error(`Error ${x}ing join request:`,w);const g=w instanceof Error?w.message:"An unknown error occurred";b(`Failed to ${x} join request: ${g}`)}},[b,l,m]),p=D.useCallback(async N=>{try{const{error:x}=await V.from("join_requests").delete().eq("id",N);return x?(console.error("Error deleting join request:",x),b(`Failed to delete join request: ${x.message}`),!1):(l("Join request deleted successfully"),!0)}catch(x){console.error("Error deleting join request:",x);const u=x instanceof Error?x.message:"An unknown error occurred";return b(`Failed to delete join request: ${u}`),!1}},[b,l]);return{joinRequests:s,pendingJoinRequests:a,isLoadingJoinRequests:o,fetchJoinRequests:m,fetchPendingRequests:d,handleJoinRequest:f,deleteJoinRequest:p}};var Ht={exports:{}};(function(b){(function(l){b.exports?(l.default=l,b.exports=l):l(typeof Highcharts<"u"?Highcharts:void 0)})(function(l){var s=l?l._modules:{};function n(a,r,o,t){a.hasOwnProperty(r)||(a[r]=t.apply(null,o),typeof CustomEvent=="function"&&l.win.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:r,module:a[r]}})))}n(s,"Extensions/Breadcrumbs/BreadcrumbsDefaults.js",[],function(){return{lang:{mainBreadcrumb:"Main"},options:{buttonTheme:{fill:"none",height:18,padding:2,"stroke-width":0,zIndex:7,states:{select:{fill:"none"}},style:{color:"#334eff"}},buttonSpacing:5,floating:!1,format:void 0,relativeTo:"plotBox",rtl:!1,position:{align:"left",verticalAlign:"top",x:0,y:void 0},separator:{text:"/",style:{color:"#666666",fontSize:"0.8em"}},showFullPath:!0,style:{},useHTML:!1,zIndex:7}}}),n(s,"Extensions/Breadcrumbs/Breadcrumbs.js",[s["Extensions/Breadcrumbs/BreadcrumbsDefaults.js"],s["Core/Templating.js"],s["Core/Globals.js"],s["Core/Utilities.js"]],function(a,r,o,t){let{format:m}=r,{composed:d}=o,{addEvent:f,defined:p,extend:N,fireEvent:x,isString:u,merge:w,objectEach:g,pick:j,pushUnique:M}=t;function y(){if(this.breadcrumbs){let h=this.resetZoomButton&&this.resetZoomButton.getBBox(),c=this.breadcrumbs.options;h&&c.position.align==="right"&&c.relativeTo==="plotBox"&&this.breadcrumbs.alignBreadcrumbsGroup(-h.width-c.buttonSpacing)}}function S(){this.breadcrumbs&&(this.breadcrumbs.destroy(),this.breadcrumbs=void 0)}function B(){let h=this.breadcrumbs;if(h&&!h.options.floating&&h.level){let c=h.options,i=c.buttonTheme,v=(i.height||0)+2*(i.padding||0)+c.buttonSpacing,E=c.position.verticalAlign;E==="bottom"?(this.marginBottom=(this.marginBottom||0)+v,h.yOffset=v):E!=="middle"?(this.plotTop+=v,h.yOffset=-v):h.yOffset=void 0}}function T(){this.breadcrumbs&&this.breadcrumbs.redraw()}function Y(h){h.resetSelection===!0&&this.breadcrumbs&&this.breadcrumbs.alignBreadcrumbsGroup()}class C{static compose(c,i){M(d,"Breadcrumbs")&&(f(c,"destroy",S),f(c,"afterShowResetZoom",y),f(c,"getMargins",B),f(c,"redraw",T),f(c,"selection",Y),N(i.lang,a.lang))}constructor(c,i){this.elementList={},this.isDirty=!0,this.level=0,this.list=[];let v=w(c.options.drilldown&&c.options.drilldown.drillUpButton,C.defaultOptions,c.options.navigation&&c.options.navigation.breadcrumbs,i);this.chart=c,this.options=v||{}}updateProperties(c){this.setList(c),this.setLevel(),this.isDirty=!0}setList(c){this.list=c}setLevel(){this.level=this.list.length&&this.list.length-1}getLevel(){return this.level}getButtonText(c){let i=this.chart,v=this.options,E=i.options.lang,k=j(v.format,v.showFullPath?"{level.name}":"← {level.name}"),P=E&&j(E.drillUpText,E.mainBreadcrumb),R=v.formatter&&v.formatter(c)||m(k,{level:c.levelOptions},i)||"";return(u(R)&&!R.length||R==="← ")&&p(P)&&(R=v.showFullPath?P:"← "+P),R}redraw(){this.isDirty&&this.render(),this.group&&this.group.align(),this.isDirty=!1}render(){let c=this.chart,i=this.options;!this.group&&i&&(this.group=c.renderer.g("breadcrumbs-group").addClass("highcharts-no-tooltip highcharts-breadcrumbs").attr({zIndex:i.zIndex}).add()),i.showFullPath?this.renderFullPathButtons():this.renderSingleButton(),this.alignBreadcrumbsGroup()}renderFullPathButtons(){this.destroySingleButton(),this.resetElementListState(),this.updateListElements(),this.destroyListElements()}renderSingleButton(){let c=this.chart,i=this.list,v=this.options.buttonSpacing;this.destroyListElements();let E=this.group?this.group.getBBox().width:v,k=i[i.length-2];!c.drillUpButton&&this.level>0?c.drillUpButton=this.renderButton(k,E,v):c.drillUpButton&&(this.level>0?this.updateSingleButton():this.destroySingleButton())}alignBreadcrumbsGroup(c){if(this.group){let i=this.options,v=i.buttonTheme,E=i.position,k=i.relativeTo==="chart"||i.relativeTo==="spacingBox"?void 0:"plotBox",P=this.group.getBBox(),R=2*(v.padding||0)+i.buttonSpacing;E.width=P.width+R,E.height=P.height+R;let q=w(E);c&&(q.x+=c),this.options.rtl&&(q.x+=E.width),q.y=j(q.y,this.yOffset,0),this.group.align(q,!0,k)}}renderButton(c,i,v){let E=this,k=this.chart,P=E.options,R=w(P.buttonTheme),q=k.renderer.button(E.getButtonText(c),i,v,function(X){let J,Q=P.events&&P.events.click;Q&&(J=Q.call(E,X,c)),J!==!1&&(P.showFullPath?X.newLevel=c.level:X.newLevel=E.level-1,x(E,"up",X))},R).addClass("highcharts-breadcrumbs-button").add(E.group);return k.styledMode||q.attr(P.style),q}renderSeparator(c,i){let v=this.chart,E=this.options.separator,k=v.renderer.label(E.text,c,i,void 0,void 0,void 0,!1).addClass("highcharts-breadcrumbs-separator").add(this.group);return v.styledMode||k.css(E.style),k}update(c){w(!0,this.options,c),this.destroy(),this.isDirty=!0}updateSingleButton(){let c=this.chart,i=this.list[this.level-1];c.drillUpButton&&c.drillUpButton.attr({text:this.getButtonText(i)})}destroy(){this.destroySingleButton(),this.destroyListElements(!0),this.group&&this.group.destroy(),this.group=void 0}destroyListElements(c){let i=this.elementList;g(i,(v,E)=>{(c||!i[E].updated)&&((v=i[E]).button&&v.button.destroy(),v.separator&&v.separator.destroy(),delete v.button,delete v.separator,delete i[E])}),c&&(this.elementList={})}destroySingleButton(){this.chart.drillUpButton&&(this.chart.drillUpButton.destroy(),this.chart.drillUpButton=void 0)}resetElementListState(){g(this.elementList,c=>{c.updated=!1})}updateListElements(){let c=this.elementList,i=this.options.buttonSpacing,v=this.list,E=this.options.rtl,k=E?-1:1,P=function(Q,ne){return k*Q.getBBox().width+k*ne},R=function(Q,ne,F){Q.translate(ne-Q.getBBox().width,F)},q=this.group?P(this.group,i):i,X,J;for(let Q=0,ne=v.length;Q<ne;++Q){let F,K,le=Q===ne-1;c[(J=v[Q]).level]?(F=(X=c[J.level]).button,X.separator||le?X.separator&&le&&(X.separator.destroy(),delete X.separator):(q+=k*i,X.separator=this.renderSeparator(q,i),E&&R(X.separator,q,i),q+=P(X.separator,i)),c[J.level].updated=!0):(F=this.renderButton(J,q,i),E&&R(F,q,i),q+=P(F,i),le||(K=this.renderSeparator(q,i),E&&R(K,q,i),q+=P(K,i)),c[J.level]={button:F,separator:K,updated:!0}),F&&F.setState(le?2:0)}}}return C.defaultOptions=a.options,C}),n(s,"Series/ColorMapComposition.js",[s["Core/Series/SeriesRegistry.js"],s["Core/Renderer/SVG/SVGElement.js"],s["Core/Utilities.js"]],function(a,r,o){var t;let{column:{prototype:m}}=a.seriesTypes,{addEvent:d,defined:f}=o;return function(p){function N(x){let u=this.series,w=u.chart.renderer;this.moveToTopOnHover&&this.graphic&&(u.stateMarkerGraphic||(u.stateMarkerGraphic=new r(w,"use").css({pointerEvents:"none"}).add(this.graphic.parentGroup)),x?.state==="hover"?(this.graphic.attr({id:this.id}),u.stateMarkerGraphic.attr({href:`${w.url}#${this.id}`,visibility:"visible"})):u.stateMarkerGraphic.attr({href:""}))}p.pointMembers={dataLabelOnNull:!0,moveToTopOnHover:!0,isValid:function(){return this.value!==null&&this.value!==1/0&&this.value!==-1/0&&(this.value===void 0||!isNaN(this.value))}},p.seriesMembers={colorKey:"value",axisTypes:["xAxis","yAxis","colorAxis"],parallelArrays:["x","y","value"],pointArrayMap:["value"],trackerGroups:["group","markerGroup","dataLabelsGroup"],colorAttribs:function(x){let u={};return f(x.color)&&(!x.state||x.state==="normal")&&(u[this.colorProp||"fill"]=x.color),u},pointAttribs:m.pointAttribs},p.compose=function(x){return d(x.prototype.pointClass,"afterSetState",N),x}}(t||(t={})),t}),n(s,"Series/Treemap/TreemapAlgorithmGroup.js",[],function(){return class{constructor(a,r,o,t){this.height=a,this.width=r,this.plot=t,this.direction=o,this.startDirection=o,this.total=0,this.nW=0,this.lW=0,this.nH=0,this.lH=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(m,d){return Math.max(m/d,d/m)}}}addElement(a){this.lP.total=this.elArr[this.elArr.length-1],this.total=this.total+a,this.direction===0?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(a)}reset(){this.nW=0,this.lW=0,this.elArr=[],this.total=0}}}),n(s,"Series/Treemap/TreemapNode.js",[],function(){return class{constructor(){this.childrenTotal=0,this.visible=!1}init(a,r,o,t,m,d,f){return this.id=a,this.i=r,this.children=o,this.height=t,this.level=m,this.series=d,this.parent=f,this}}}),n(s,"Series/DrawPointUtilities.js",[],function(){return{draw:function(a,r){let{animatableAttribs:o,onComplete:t,css:m,renderer:d}=r,f=a.series&&a.series.chart.hasRendered?void 0:a.series&&a.series.options.animation,p=a.graphic;if(r.attribs={...r.attribs,class:a.getClassName()},a.shouldDraw())p||(p=r.shapeType==="text"?d.text():r.shapeType==="image"?d.image(r.imageUrl||"").attr(r.shapeArgs||{}):d[r.shapeType](r.shapeArgs||{}),a.graphic=p,p.add(r.group)),m&&p.css(m),p.attr(r.attribs).animate(o,!r.isNew&&f,t);else if(p){let N=()=>{a.graphic=p=p&&p.destroy(),typeof t=="function"&&t()};Object.keys(o).length?p.animate(o,void 0,()=>N()):N()}}}}),n(s,"Series/Treemap/TreemapPoint.js",[s["Series/DrawPointUtilities.js"],s["Core/Series/SeriesRegistry.js"],s["Core/Utilities.js"]],function(a,r,o){let{pie:{prototype:{pointClass:t}},scatter:{prototype:{pointClass:m}}}=r.seriesTypes,{extend:d,isNumber:f,pick:p}=o;class N extends m{constructor(){super(...arguments),this.shapeType="rect"}draw(u){a.draw(this,u)}getClassName(){let u=this.series,w=u.options,g=super.getClassName();return this.node.level<=u.nodeMap[u.rootNode].level&&this.node.children.length?g+=" highcharts-above-level":this.node.isLeaf||p(w.interactByLeaf,!w.allowTraversingTree)?this.node.isLeaf||(g+=" highcharts-internal-node"):g+=" highcharts-internal-node-interactive",g}isValid(){return!!(this.id||f(this.value))}setState(u){super.setState.apply(this,arguments),this.graphic&&this.graphic.attr({zIndex:u==="hover"?1:0})}shouldDraw(){return f(this.plotY)&&this.y!==null}}return d(N.prototype,{setVisible:t.prototype.setVisible}),N}),n(s,"Series/Treemap/TreemapSeriesDefaults.js",[s["Core/Series/SeriesRegistry.js"],s["Core/Utilities.js"]],function(a,r){let{isString:o}=r;return{allowTraversingTree:!1,animationLimit:250,borderRadius:0,showInLegend:!1,marker:void 0,colorByPoint:!1,dataLabels:{defer:!1,enabled:!0,formatter:function(){let t=this&&this.point?this.point:{};return o(t.name)?t.name:""},inside:!0,verticalAlign:"middle"},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.value}<br/>"},ignoreHiddenPoint:!0,layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,traverseUpButton:{position:{align:"right",x:-10,y:10}},borderColor:"#e6e6e6",borderWidth:1,colorKey:"colorValue",opacity:.15,states:{hover:{borderColor:"#999999",brightness:a.seriesTypes.heatmap?0:.1,halo:!1,opacity:.75,shadow:!1}},legendSymbol:"rectangle",traverseToLeaf:!1}}),n(s,"Series/Treemap/TreemapUtilities.js",[],function(){var a;return(a||(a={})).recursive=function r(o,t,m){let d=t.call(m||this,o);d!==!1&&r(d,t,m)},a}),n(s,"Series/TreeUtilities.js",[s["Core/Color/Color.js"],s["Core/Utilities.js"]],function(a,r){let{extend:o,isArray:t,isNumber:m,isObject:d,merge:f,pick:p,relativeLength:N}=r;return{getColor:function(x,u){let w,g,j,M,y,S,B=u.index,T=u.mapOptionsToLevel,Y=u.parentColor,C=u.parentColorIndex,h=u.series,c=u.colors,i=u.siblings,v=h.points,E=h.chart.options.chart;return x&&(w=v[x.i],g=T[x.level]||{},w&&g.colorByPoint&&(M=w.index%(c?c.length:E.colorCount),j=c&&c[M]),h.chart.styledMode||(y=p(w&&w.options.color,g&&g.color,j,Y&&(k=>{let P=g&&g.colorVariation;return P&&P.key==="brightness"&&B&&i?a.parse(k).brighten(P.to*(B/i)).get():k})(Y),h.color)),S=p(w&&w.options.colorIndex,g&&g.colorIndex,M,C,u.colorIndex)),{color:y,colorIndex:S}},getLevelOptions:function(x){let u,w,g,j,M,y,S={};if(d(x))for(j=m(x.from)?x.from:1,y=x.levels,w={},u=d(x.defaults)?x.defaults:{},t(y)&&(w=y.reduce((B,T)=>{let Y,C,h;return d(T)&&m(T.level)&&(C=p((h=f({},T)).levelIsConstant,u.levelIsConstant),delete h.levelIsConstant,delete h.level,d(B[Y=T.level+(C?0:j-1)])?f(!0,B[Y],h):B[Y]=h),B},{})),M=m(x.to)?x.to:1,g=0;g<=M;g++)S[g]=f({},u,d(w[g])?w[g]:{});return S},getNodeWidth:function(x,u){let{chart:w,options:g}=x,{nodeDistance:j=0,nodeWidth:M=0}=g,{plotSizeX:y=1}=w;if(M==="auto"){if(typeof j=="string"&&/%$/.test(j))return y/(u+parseFloat(j)/100*(u-1));let S=Number(j);return(y+S)/(u||1)-S}return N(M,y)},setTreeValues:function x(u,w){let g=w.before,j=w.idRoot,M=w.mapIdToNode[j],y=w.levelIsConstant!==!1,S=w.points[u.i],B=S&&S.options||{},T=[],Y=0;u.levelDynamic=u.level-(y?0:M.level),u.name=p(S&&S.name,""),u.visible=j===u.id||w.visible===!0,typeof g=="function"&&(u=g(u,w)),u.children.forEach((h,c)=>{let i=o({},w);o(i,{index:c,siblings:u.children.length,visible:u.visible}),h=x(h,i),T.push(h),h.visible&&(Y+=h.val)});let C=p(B.value,Y);return u.visible=C>=0&&(Y>0||u.visible),u.children=T,u.childrenTotal=Y,u.isLeaf=u.visible&&!Y,u.val=C,u},updateRootId:function(x){let u,w;return d(x)&&(w=d(x.options)?x.options:{},u=p(x.rootNode,w.rootId,""),d(x.userOptions)&&(x.userOptions.rootId=u),x.rootNode=u),u}}}),n(s,"Series/Treemap/TreemapSeries.js",[s["Extensions/Breadcrumbs/Breadcrumbs.js"],s["Core/Color/Color.js"],s["Series/ColorMapComposition.js"],s["Core/Globals.js"],s["Core/Series/SeriesRegistry.js"],s["Series/Treemap/TreemapAlgorithmGroup.js"],s["Series/Treemap/TreemapNode.js"],s["Series/Treemap/TreemapPoint.js"],s["Series/Treemap/TreemapSeriesDefaults.js"],s["Series/Treemap/TreemapUtilities.js"],s["Series/TreeUtilities.js"],s["Core/Utilities.js"]],function(a,r,o,t,m,d,f,p,N,x,u,w){let{parse:g}=r,{composed:j,noop:M}=t,{column:y,scatter:S}=m.seriesTypes,{getColor:B,getLevelOptions:T,updateRootId:Y}=u,{addEvent:C,correctFloat:h,crisp:c,defined:i,error:v,extend:E,fireEvent:k,isArray:P,isObject:R,isString:q,merge:X,pick:J,pushUnique:Q,stableSort:ne}=w,F=!1;function K(){let ve,_=this.xAxis,A=this.yAxis;_&&A&&(this.is("treemap")?(ve={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,minPadding:0,max:100,maxPadding:0,startOnTick:!1,title:void 0,tickPositions:[]},E(A.options,ve),E(_.options,ve),F=!0):F&&(A.setOptions(A.userOptions),_.setOptions(_.userOptions),F=!1))}class le extends S{static compose(_){Q(j,"TreemapSeries")&&C(_,"afterBindAxes",K)}algorithmCalcPoints(_,A,L,G){let z=L.plot,U=L.elArr.length-1,$,W,Z,O,ee=L.lW,he=L.lH,be,ue=0;for(let xe of(A?(ee=L.nW,he=L.nH):be=L.elArr[U],L.elArr))(A||ue<U)&&(L.direction===0?($=z.x,W=z.y,O=xe/(Z=ee)):($=z.x,W=z.y,Z=xe/(O=he)),G.push({x:$,y:W,width:Z,height:h(O)}),L.direction===0?z.y=z.y+O:z.x=z.x+Z),ue+=1;L.reset(),L.direction===0?L.width=L.width-ee:L.height=L.height-he,z.y=z.parent.y+(z.parent.height-L.height),z.x=z.parent.x+(z.parent.width-L.width),_&&(L.direction=1-L.direction),A||L.addElement(be)}algorithmFill(_,A,L){let G=[],z,U=A.direction,$=A.x,W=A.y,Z=A.width,O=A.height,ee,he,be,ue;for(let xe of L)z=A.width*A.height*(xe.val/A.val),ee=$,he=W,U===0?(Z-=be=z/(ue=O),$+=be):(O-=ue=z/(be=Z),W+=ue),G.push({x:ee,y:he,width:be,height:ue}),_&&(U=1-U);return G}algorithmLowAspectRatio(_,A,L){let G=[],z={x:A.x,y:A.y,parent:A},U=A.direction,$=L.length-1,W=new d(A.height,A.width,U,z),Z,O=0;for(let ee of L)Z=A.width*A.height*(ee.val/A.val),W.addElement(Z),W.lP.nR>W.lP.lR&&this.algorithmCalcPoints(_,!1,W,G,z),O===$&&this.algorithmCalcPoints(_,!0,W,G,z),++O;return G}alignDataLabel(_,A,L){let G=L.style;G&&!i(G.textOverflow)&&A.text&&A.getBBox().width>(A.text.textWidth||0)&&A.css({textOverflow:"ellipsis",width:G.width+="px"}),y.prototype.alignDataLabel.apply(this,arguments),_.dataLabel&&_.dataLabel.attr({zIndex:(_.node.zIndex||0)+1})}calculateChildrenAreas(_,A){let L=this.options,G=this.mapOptionsToLevel[_.level+1],z=J(this[G&&G.layoutAlgorithm]&&G.layoutAlgorithm,L.layoutAlgorithm),U=L.alternateStartingDirection,$=_.children.filter(O=>!O.ignore),W=[];G&&G.layoutStartingDirection&&(A.direction=G.layoutStartingDirection==="vertical"?0:1),W=this[z](A,$);let Z=-1;for(let O of $){let ee=W[++Z];O.values=X(ee,{val:O.childrenTotal,direction:U?1-A.direction:A.direction}),O.pointValues=X(ee,{x:ee.x/this.axisRatio,y:100-ee.y-ee.height,width:ee.width/this.axisRatio}),O.children.length&&this.calculateChildrenAreas(O,O.values)}}createList(_){let A=this.chart,L=A.breadcrumbs,G=[];if(L){let z=0;G.push({level:z,levelOptions:A.series[0]});let U=_.target.nodeMap[_.newRootId],$=[];for(;U.parent||U.parent==="";)$.push(U),U=_.target.nodeMap[U.parent];for(let W of $.reverse())G.push({level:++z,levelOptions:W});G.length<=1&&(G.length=0)}return G}drawDataLabels(){let _,A,L=this.mapOptionsToLevel;for(let G of this.points.filter(function(z){return z.node.visible}))A=L[G.node.level],_={style:{}},G.node.isLeaf||(_.enabled=!1),A&&A.dataLabels&&(_=X(_,A.dataLabels),this.hasDataLabels=()=>!0),G.shapeArgs&&(_.style.width=G.shapeArgs.width,G.dataLabel&&G.dataLabel.css({width:G.shapeArgs.width+"px"})),G.dlOptions=X(_,G.options.dataLabels);super.drawDataLabels()}drawPoints(_=this.points){let A=this.chart,L=A.renderer,G=A.styledMode,z=this.options,U=G?{}:z.shadow,$=z.borderRadius,W=A.pointCount<z.animationLimit,Z=z.allowTraversingTree;for(let O of _){let ee=O.node.levelDynamic,he={},be={},ue={},xe="level-group-"+O.node.level,we=!!O.graphic,Fe=W&&we,Ce=O.shapeArgs;O.shouldDraw()&&(O.isInside=!0,$&&(be.r=$),X(!0,Fe?he:be,we?Ce:{},G?{}:this.pointAttribs(O,O.selected?"select":void 0)),this.colorAttribs&&G&&E(ue,this.colorAttribs(O)),this[xe]||(this[xe]=L.g(xe).attr({zIndex:1e3-(ee||0)}).add(this.group),this[xe].survive=!0)),O.draw({animatableAttribs:he,attribs:be,css:ue,group:this[xe],imageUrl:O.imageUrl,renderer:L,shadow:U,shapeArgs:Ce,shapeType:O.shapeType}),Z&&O.graphic&&(O.drillId=z.interactByLeaf?this.drillToByLeaf(O):this.drillToByGroup(O))}}drillToByGroup(_){let A=!1;return _.node.isLeaf||_.node.level-this.nodeMap[this.rootNode].level!=1||(A=_.id),A}drillToByLeaf(_){let{traverseToLeaf:A}=_.series.options,L=!1,G;if(_.node.parent!==this.rootNode&&_.node.isLeaf)if(A)L=_.id;else for(G=_.node;!L;)G.parent!==void 0&&(G=this.nodeMap[G.parent]),G.parent===this.rootNode&&(L=G.id);return L}drillToNode(_,A){v(32,!1,void 0,{"treemap.drillToNode":"use treemap.setRootNode"}),this.setRootNode(_,A)}drillUp(){let _=this.nodeMap[this.rootNode];_&&q(_.parent)&&this.setRootNode(_.parent,!0,{trigger:"traverseUpButton"})}getExtremes(){let{dataMin:_,dataMax:A}=super.getExtremes(this.colorValueData);return this.valueMin=_,this.valueMax=A,super.getExtremes()}getListOfParents(_,A){let L=P(_)?_:[],G=P(A)?A:[],z=L.reduce(function(U,$,W){let Z=J($.parent,"");return U[Z]===void 0&&(U[Z]=[]),U[Z].push(W),U},{"":[]});for(let U of Object.keys(z)){let $=z[U];if(U!==""&&G.indexOf(U)===-1){for(let W of $)z[""].push(W);delete z[U]}}return z}getTree(){let _=this.data.map(function(L){return L.id}),A=this.getListOfParents(this.data,_);return this.nodeMap={},this.nodeList=[],this.buildTree("",-1,0,A)}buildTree(_,A,L,G,z){let U=[],$=this.points[A],W=0,Z;for(let ee of G[_]||[])W=Math.max((Z=this.buildTree(this.points[ee].id,ee,L+1,G,_)).height+1,W),U.push(Z);let O=new this.NodeClass().init(_,A,U,W,L,this,z);for(let ee of U)ee.parentNode=O;return this.nodeMap[O.id]=O,this.nodeList.push(O),$&&($.node=O,O.point=$),O}hasData(){return!!this.processedXData.length}init(_,A){let L=this,G=X(A.drillUpButton,A.breadcrumbs),z=C(L,"setOptions",U=>{let $=U.userOptions;i($.allowDrillToNode)&&!i($.allowTraversingTree)&&($.allowTraversingTree=$.allowDrillToNode,delete $.allowDrillToNode),i($.drillUpButton)&&!i($.traverseUpButton)&&($.traverseUpButton=$.drillUpButton,delete $.drillUpButton)});super.init(_,A),delete L.opacity,L.eventsToUnbind.push(z),L.options.allowTraversingTree&&(L.eventsToUnbind.push(C(L,"click",L.onClickDrillToNode)),L.eventsToUnbind.push(C(L,"setRootNode",function(U){let $=L.chart;$.breadcrumbs&&$.breadcrumbs.updateProperties(L.createList(U))})),L.eventsToUnbind.push(C(L,"update",function(U,$){let W=this.chart.breadcrumbs;W&&U.options.breadcrumbs&&W.update(U.options.breadcrumbs)})),L.eventsToUnbind.push(C(L,"destroy",function(U){let $=this.chart;$.breadcrumbs&&!U.keepEventsForUpdate&&($.breadcrumbs.destroy(),$.breadcrumbs=void 0)}))),_.breadcrumbs||(_.breadcrumbs=new a(_,G)),L.eventsToUnbind.push(C(_.breadcrumbs,"up",function(U){let $=this.level-U.newLevel;for(let W=0;W<$;W++)L.drillUp()}))}onClickDrillToNode(_){let A=_.point,L=A&&A.drillId;q(L)&&(A.setState(""),this.setRootNode(L,!0,{trigger:"click"}))}pointAttribs(_,A){let L,G=R(this.mapOptionsToLevel)?this.mapOptionsToLevel:{},z=_&&G[_.node.level]||{},U=this.options,$=A&&U.states&&U.states[A]||{},W=_&&_.getClassName()||"",Z={stroke:_&&_.borderColor||z.borderColor||$.borderColor||U.borderColor,"stroke-width":J(_&&_.borderWidth,z.borderWidth,$.borderWidth,U.borderWidth),dashstyle:_&&_.borderDashStyle||z.borderDashStyle||$.borderDashStyle||U.borderDashStyle,fill:_&&_.color||this.color};return W.indexOf("highcharts-above-level")!==-1?(Z.fill="none",Z["stroke-width"]=0):W.indexOf("highcharts-internal-node-interactive")!==-1?(L=J($.opacity,U.opacity),Z.fill=g(Z.fill).setOpacity(L).get(),Z.cursor="pointer"):W.indexOf("highcharts-internal-node")!==-1?Z.fill="none":A&&(Z.fill=g(Z.fill).brighten($.brightness).get()),Z}setColorRecursive(_,A,L,G,z){let U=this&&this.chart,$=U&&U.options&&U.options.colors;if(_){let W=B(_,{colors:$,index:G,mapOptionsToLevel:this.mapOptionsToLevel,parentColor:A,parentColorIndex:L,series:this,siblings:z}),Z=this.points[_.i];Z&&(Z.color=W.color,Z.colorIndex=W.colorIndex);let O=-1;for(let ee of _.children||[])this.setColorRecursive(ee,W.color,W.colorIndex,++O,_.children.length)}}setPointValues(){let _=this,{points:A,xAxis:L,yAxis:G}=_,z=_.chart.styledMode,U=$=>z?0:_.pointAttribs($)["stroke-width"]||0;for(let $ of A){let{pointValues:W,visible:Z}=$.node;if(W&&Z){let{height:O,width:ee,x:he,y:be}=W,ue=U($),xe=c(L.toPixels(he,!0),ue,!0),we=c(L.toPixels(he+ee,!0),ue,!0),Fe=c(G.toPixels(be,!0),ue,!0),Ce=c(G.toPixels(be+O,!0),ue,!0),Ee={x:Math.min(xe,we),y:Math.min(Fe,Ce),width:Math.abs(we-xe),height:Math.abs(Ce-Fe)};$.plotX=Ee.x+Ee.width/2,$.plotY=Ee.y+Ee.height/2,$.shapeArgs=Ee}else delete $.plotX,delete $.plotY}}setRootNode(_,A,L){k(this,"setRootNode",E({newRootId:_,previousRootId:this.rootNode,redraw:J(A,!0),series:this},L),function(G){let z=G.series;z.idPreviousRoot=G.previousRootId,z.rootNode=G.newRootId,z.isDirty=!0,G.redraw&&z.chart.redraw()})}setState(_){this.options.inactiveOtherPoints=!0,super.setState(_,!1),this.options.inactiveOtherPoints=!1}setTreeValues(_){let A=this.options,L=this.rootNode,G=this.nodeMap[L],z=typeof A.levelIsConstant!="boolean"||A.levelIsConstant,U=[],$=this.points[_.i],W=0;for(let O of _.children)O=this.setTreeValues(O),U.push(O),O.ignore||(W+=O.val);ne(U,(O,ee)=>(O.sortIndex||0)-(ee.sortIndex||0));let Z=J($&&$.options.value,W);return $&&($.value=Z),E(_,{children:U,childrenTotal:W,ignore:!(J($&&$.visible,!0)&&Z>0),isLeaf:_.visible&&!W,levelDynamic:_.level-(z?0:G.level),name:J($&&$.name,""),sortIndex:J($&&$.sortIndex,-Z),val:Z}),_}sliceAndDice(_,A){return this.algorithmFill(!0,_,A)}squarified(_,A){return this.algorithmLowAspectRatio(!0,_,A)}strip(_,A){return this.algorithmLowAspectRatio(!1,_,A)}stripes(_,A){return this.algorithmFill(!1,_,A)}translate(){let _=this,A=_.options,L=Y(_),G,z,U,$;super.translate();let W=_.tree=_.getTree();G=_.nodeMap[L],L===""||G||(_.setRootNode("",!1),L=_.rootNode,G=_.nodeMap[L]),_.mapOptionsToLevel=T({from:G.level+1,levels:A.levels,to:W.height,defaults:{levelIsConstant:_.options.levelIsConstant,colorByPoint:A.colorByPoint}}),x.recursive(_.nodeMap[_.rootNode],Z=>{let O=Z.parent,ee=!1;return Z.visible=!0,(O||O==="")&&(ee=_.nodeMap[O]),ee}),x.recursive(_.nodeMap[_.rootNode].children,Z=>{let O=!1;for(let ee of Z)ee.visible=!0,ee.children.length&&(O=(O||[]).concat(ee.children));return O}),_.setTreeValues(W),_.axisRatio=_.xAxis.len/_.yAxis.len,_.nodeMap[""].pointValues=z={x:0,y:0,width:100,height:100},_.nodeMap[""].values=U=X(z,{width:z.width*_.axisRatio,direction:A.layoutStartingDirection==="vertical"?0:1,val:W.val}),_.calculateChildrenAreas(W,U),_.colorAxis||A.colorByPoint||_.setColorRecursive(_.tree),A.allowTraversingTree&&($=G.pointValues,_.xAxis.setExtremes($.x,$.x+$.width,!1),_.yAxis.setExtremes($.y,$.y+$.height,!1),_.xAxis.setScale(),_.yAxis.setScale()),_.setPointValues()}}return le.defaultOptions=X(S.defaultOptions,N),E(le.prototype,{buildKDTree:M,colorAttribs:o.seriesMembers.colorAttribs,colorKey:"colorValue",directTouch:!0,getExtremesFromAll:!0,getSymbol:M,optionalAxis:"colorAxis",parallelArrays:["x","y","value","colorValue"],pointArrayMap:["value"],pointClass:p,NodeClass:f,trackerGroups:["group","dataLabelsGroup"],utils:x}),o.compose(le),m.registerSeriesType("treemap",le),le}),n(s,"masters/modules/treemap.src.js",[s["Core/Globals.js"],s["Extensions/Breadcrumbs/Breadcrumbs.js"],s["Series/Treemap/TreemapSeries.js"]],function(a,r,o){return a.Breadcrumbs=a.Breadcrumbs||r,a.Breadcrumbs.compose(a.Chart,a.defaultOptions),o.compose(a.Series),a})})})(Ht);var js=Ht.exports;const vs=Ut(js);var Vt={exports:{}};(function(b){(function(l){b.exports?(l.default=l,b.exports=l):l(typeof Highcharts<"u"?Highcharts:void 0)})(function(l){var s=l?l._modules:{};function n(a,r,o,t){a.hasOwnProperty(r)||(a[r]=t.apply(null,o),typeof CustomEvent=="function"&&l.win.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:r,module:a[r]}})))}n(s,"Core/Axis/Color/ColorAxisComposition.js",[s["Core/Color/Color.js"],s["Core/Utilities.js"]],function(a,r){var o;let{parse:t}=a,{addEvent:m,extend:d,merge:f,pick:p,splat:N}=r;return function(x){let u;function w(){let{userOptions:h}=this;this.colorAxis=[],h.colorAxis&&(h.colorAxis=N(h.colorAxis),h.colorAxis.map(c=>new u(this,c)))}function g(h){let c=this.chart.colorAxis||[],i=P=>{let R=h.allItems.indexOf(P);R!==-1&&(this.destroyItem(h.allItems[R]),h.allItems.splice(R,1))},v=[],E,k;for(c.forEach(function(P){(E=P.options)&&E.showInLegend&&(E.dataClasses&&E.visible?v=v.concat(P.getDataClassLegendSymbols()):E.visible&&v.push(P),P.series.forEach(function(R){(!R.options.showInLegend||E.dataClasses)&&(R.options.legendType==="point"?R.points.forEach(function(q){i(q)}):i(R))}))}),k=v.length;k--;)h.allItems.unshift(v[k])}function j(h){h.visible&&h.item.legendColor&&h.item.legendItem.symbol.attr({fill:h.item.legendColor})}function M(h){this.chart.colorAxis?.forEach(c=>{c.update({},h.redraw)})}function y(){(this.chart.colorAxis&&this.chart.colorAxis.length||this.colorAttribs)&&this.translateColors()}function S(){let h=this.axisTypes;h?h.indexOf("colorAxis")===-1&&h.push("colorAxis"):this.axisTypes=["colorAxis"]}function B(h){let c=this,i=h?"show":"hide";c.visible=c.options.visible=!!h,["graphic","dataLabel"].forEach(function(v){c[v]&&c[v][i]()}),this.series.buildKDTree()}function T(){let h=this,c=this.getPointsCollection(),i=this.options.nullColor,v=this.colorAxis,E=this.colorKey;c.forEach(k=>{let P=k.getNestedProperty(E),R=k.options.color||(k.isNull||k.value===null?i:v&&P!==void 0?v.toColor(P,k):k.color||h.color);R&&k.color!==R&&(k.color=R,h.options.legendType==="point"&&k.legendItem&&k.legendItem.label&&h.chart.legend.colorizeItem(k,k.visible))})}function Y(){this.elem.attr("fill",t(this.start).tweenTo(t(this.end),this.pos),void 0,!0)}function C(){this.elem.attr("stroke",t(this.start).tweenTo(t(this.end),this.pos),void 0,!0)}x.compose=function(h,c,i,v,E){let k=c.prototype,P=i.prototype,R=E.prototype;k.collectionsWithUpdate.includes("colorAxis")||(u=h,k.collectionsWithUpdate.push("colorAxis"),k.collectionsWithInit.colorAxis=[k.addColorAxis],m(c,"afterGetAxes",w),function(q){let X=q.prototype.createAxis;q.prototype.createAxis=function(J,Q){if(J!=="colorAxis")return X.apply(this,arguments);let ne=new u(this,f(Q.axis,{index:this[J].length,isX:!1}));return this.isDirtyLegend=!0,this.axes.forEach(F=>{F.series=[]}),this.series.forEach(F=>{F.bindAxes(),F.isDirtyData=!0}),p(Q.redraw,!0)&&this.redraw(Q.animation),ne}}(c),P.fillSetter=Y,P.strokeSetter=C,m(v,"afterGetAllItems",g),m(v,"afterColorizeItem",j),m(v,"afterUpdate",M),d(R,{optionalAxis:"colorAxis",translateColors:T}),d(R.pointClass.prototype,{setVisible:B}),m(E,"afterTranslate",y,{order:1}),m(E,"bindAxes",S))},x.pointSetVisible=B}(o||(o={})),o}),n(s,"Core/Axis/Color/ColorAxisDefaults.js",[],function(){return{lineWidth:0,minPadding:0,maxPadding:0,gridLineColor:"#ffffff",gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},width:.01,color:"#999999"},labels:{distance:8,overflow:"justify",rotation:0},minColor:"#e6e9ff",maxColor:"#0022ff",tickLength:5,showInLegend:!0}}),n(s,"Core/Axis/Color/ColorAxisLike.js",[s["Core/Color/Color.js"],s["Core/Utilities.js"]],function(a,r){var o,t;let{parse:m}=a,{merge:d}=r;return(t=o||(o={})).initDataClasses=function(f){let p=this.chart,N=this.legendItem=this.legendItem||{},x=this.options,u=f.dataClasses||[],w,g,j=p.options.chart.colorCount,M=0,y;this.dataClasses=g=[],N.labels=[];for(let S=0,B=u.length;S<B;++S)w=d(w=u[S]),g.push(w),(p.styledMode||!w.color)&&(x.dataClassColor==="category"?(p.styledMode||(j=(y=p.options.colors||[]).length,w.color=y[M]),w.colorIndex=M,++M===j&&(M=0)):w.color=m(x.minColor).tweenTo(m(x.maxColor),B<2?.5:S/(B-1)))},t.initStops=function(){let f=this.options,p=this.stops=f.stops||[[0,f.minColor||""],[1,f.maxColor||""]];for(let N=0,x=p.length;N<x;++N)p[N].color=m(p[N][1])},t.normalizedValue=function(f){let p=this.max||0,N=this.min||0;return this.logarithmic&&(f=this.logarithmic.log2lin(f)),1-(p-f)/(p-N||1)},t.toColor=function(f,p){let N,x,u,w,g,j,M=this.dataClasses,y=this.stops;if(M){for(j=M.length;j--;)if(x=(g=M[j]).from,u=g.to,(x===void 0||f>=x)&&(u===void 0||f<=u)){w=g.color,p&&(p.dataClass=j,p.colorIndex=g.colorIndex);break}}else{for(N=this.normalizedValue(f),j=y.length;j--&&!(N>y[j][0]););x=y[j]||y[j+1],N=1-((u=y[j+1]||x)[0]-N)/(u[0]-x[0]||1),w=x.color.tweenTo(u.color,N)}return w},o}),n(s,"Core/Axis/Color/ColorAxis.js",[s["Core/Axis/Axis.js"],s["Core/Axis/Color/ColorAxisComposition.js"],s["Core/Axis/Color/ColorAxisDefaults.js"],s["Core/Axis/Color/ColorAxisLike.js"],s["Core/Defaults.js"],s["Core/Legend/LegendSymbol.js"],s["Core/Series/SeriesRegistry.js"],s["Core/Utilities.js"]],function(a,r,o,t,m,d,f,p){let{defaultOptions:N}=m,{series:x}=f,{defined:u,extend:w,fireEvent:g,isArray:j,isNumber:M,merge:y,pick:S,relativeLength:B}=p;N.colorAxis=y(N.xAxis,o);class T extends a{static compose(C,h,c,i){r.compose(T,C,h,c,i)}constructor(C,h){super(C,h),this.coll="colorAxis",this.visible=!0,this.init(C,h)}init(C,h){let c=C.options.legend||{},i=h.layout?h.layout!=="vertical":c.layout!=="vertical";this.side=h.side||i?2:1,this.reversed=h.reversed||!i,this.opposite=!i,super.init(C,h,"colorAxis"),this.userOptions=h,j(C.userOptions.colorAxis)&&(C.userOptions.colorAxis[this.index]=h),h.dataClasses&&this.initDataClasses(h),this.initStops(),this.horiz=i,this.zoomEnabled=!1}hasData(){return!!(this.tickPositions||[]).length}setTickPositions(){if(!this.dataClasses)return super.setTickPositions()}setOptions(C){let h=y(N.colorAxis,C,{showEmpty:!1,title:null,visible:this.chart.options.legend.enabled&&C.visible!==!1});super.setOptions(h),this.options.crosshair=this.options.marker}setAxisSize(){let C=this.chart,h=this.legendItem?.symbol,{width:c,height:i}=this.getSize();h&&(this.left=+h.attr("x"),this.top=+h.attr("y"),this.width=c=+h.attr("width"),this.height=i=+h.attr("height"),this.right=C.chartWidth-this.left-c,this.bottom=C.chartHeight-this.top-i,this.pos=this.horiz?this.left:this.top),this.len=(this.horiz?c:i)||T.defaultLegendLength}getOffset(){let C=this.legendItem?.group,h=this.chart.axisOffset[this.side];if(C){this.axisParent=C,super.getOffset();let c=this.chart.legend;c.allItems.forEach(function(i){i instanceof T&&i.drawLegendSymbol(c,i)}),c.render(),this.chart.getMargins(!0),this.chart.series.some(i=>i.isDrilling)||(this.isDirty=!0),this.added||(this.added=!0,this.labelLeft=0,this.labelRight=this.width),this.chart.axisOffset[this.side]=h}}setLegendColor(){let C=this.horiz,h=this.reversed,c=h?1:0,i=h?0:1,v=C?[c,0,i,0]:[0,i,0,c];this.legendColor={linearGradient:{x1:v[0],y1:v[1],x2:v[2],y2:v[3]},stops:this.stops}}drawLegendSymbol(C,h){let c=h.legendItem||{},i=C.padding,v=C.options,E=this.options.labels,k=S(v.itemDistance,10),P=this.horiz,{width:R,height:q}=this.getSize(),X=S(v.labelPadding,P?16:30);this.setLegendColor(),c.symbol||(c.symbol=this.chart.renderer.symbol("roundedRect").attr({r:v.symbolRadius??3,zIndex:1}).add(c.group)),c.symbol.attr({x:0,y:(C.baseline||0)-11,width:R,height:q}),c.labelWidth=R+i+(P?k:S(E.x,E.distance)+(this.maxLabelLength||0)),c.labelHeight=q+i+(P?X:0)}setState(C){this.series.forEach(function(h){h.setState(C)})}setVisible(){}getSeriesExtremes(){let C=this.series,h,c,i,v,E,k,P=C.length,R,q;for(this.dataMin=1/0,this.dataMax=-1/0;P--;){if(c=(k=C[P]).colorKey=S(k.options.colorKey,k.colorKey,k.pointValKey,k.zoneAxis,"y"),v=k.pointArrayMap,E=k[c+"Min"]&&k[c+"Max"],k[c+"Data"])h=k[c+"Data"];else if(v){if(h=[],i=v.indexOf(c),R=k.yData,i>=0&&R)for(q=0;q<R.length;q++)h.push(S(R[q][i],R[q]))}else h=k.yData;if(E)k.minColorValue=k[c+"Min"],k.maxColorValue=k[c+"Max"];else{let X=x.prototype.getExtremes.call(k,h);k.minColorValue=X.dataMin,k.maxColorValue=X.dataMax}u(k.minColorValue)&&u(k.maxColorValue)&&(this.dataMin=Math.min(this.dataMin,k.minColorValue),this.dataMax=Math.max(this.dataMax,k.maxColorValue)),E||x.prototype.applyExtremes.call(k)}}drawCrosshair(C,h){let c,i=this.legendItem||{},v=h&&h.plotX,E=h&&h.plotY,k=this.pos,P=this.len;h&&((c=this.toPixels(h.getNestedProperty(h.series.colorKey)))<k?c=k-2:c>k+P&&(c=k+P+2),h.plotX=c,h.plotY=this.len-c,super.drawCrosshair(C,h),h.plotX=v,h.plotY=E,this.cross&&!this.cross.addedToColorAxis&&i.group&&(this.cross.addClass("highcharts-coloraxis-marker").add(i.group),this.cross.addedToColorAxis=!0,this.chart.styledMode||typeof this.crosshair!="object"||this.cross.attr({fill:this.crosshair.color})))}getPlotLinePath(C){let h=this.left,c=C.translatedValue,i=this.top;return M(c)?this.horiz?[["M",c-4,i-6],["L",c+4,i-6],["L",c,i],["Z"]]:[["M",h,c],["L",h-6,c+6],["L",h-6,c-6],["Z"]]:super.getPlotLinePath(C)}update(C,h){let c=this.chart.legend;this.series.forEach(i=>{i.isDirtyData=!0}),(C.dataClasses&&c.allItems||this.dataClasses)&&this.destroyItems(),super.update(C,h),this.legendItem&&this.legendItem.label&&(this.setLegendColor(),c.colorizeItem(this,!0))}destroyItems(){let C=this.chart,h=this.legendItem||{};if(h.label)C.legend.destroyItem(this);else if(h.labels)for(let c of h.labels)C.legend.destroyItem(c);C.isDirtyLegend=!0}destroy(){this.chart.isDirtyLegend=!0,this.destroyItems(),super.destroy(...[].slice.call(arguments))}remove(C){this.destroyItems(),super.remove(C)}getDataClassLegendSymbols(){let C,h=this,c=h.chart,i=h.legendItem&&h.legendItem.labels||[],v=c.options.legend,E=S(v.valueDecimals,-1),k=S(v.valueSuffix,""),P=R=>h.series.reduce((q,X)=>(q.push(...X.points.filter(J=>J.dataClass===R)),q),[]);return i.length||h.dataClasses.forEach((R,q)=>{let X=R.from,J=R.to,{numberFormatter:Q}=c,ne=!0;C="",X===void 0?C="< ":J===void 0&&(C="> "),X!==void 0&&(C+=Q(X,E)+k),X!==void 0&&J!==void 0&&(C+=" - "),J!==void 0&&(C+=Q(J,E)+k),i.push(w({chart:c,name:C,options:{},drawLegendSymbol:d.rectangle,visible:!0,isDataClass:!0,setState:F=>{for(let K of P(q))K.setState(F)},setVisible:function(){this.visible=ne=h.visible=!ne;let F=[];for(let K of P(q))K.setVisible(ne),K.hiddenInDataClass=!ne,F.indexOf(K.series)===-1&&F.push(K.series);c.legend.colorizeItem(this,ne),F.forEach(K=>{g(K,"afterDataClassLegendClick")})}},R))}),i}getSize(){let{chart:C,horiz:h}=this,{height:c,width:i}=this.options,{legend:v}=C.options;return{width:S(u(i)?B(i,C.chartWidth):void 0,v?.symbolWidth,h?T.defaultLegendLength:12),height:S(u(c)?B(c,C.chartHeight):void 0,v?.symbolHeight,h?12:T.defaultLegendLength)}}}return T.defaultLegendLength=200,T.keepProps=["legendItem"],w(T.prototype,t),Array.prototype.push.apply(a.keepProps,T.keepProps),T}),n(s,"masters/modules/coloraxis.src.js",[s["Core/Globals.js"],s["Core/Axis/Color/ColorAxis.js"]],function(a,r){return a.ColorAxis=a.ColorAxis||r,a.ColorAxis.compose(a.Chart,a.Fx,a.Legend,a.Series),a}),n(s,"Series/ColorMapComposition.js",[s["Core/Series/SeriesRegistry.js"],s["Core/Renderer/SVG/SVGElement.js"],s["Core/Utilities.js"]],function(a,r,o){var t;let{column:{prototype:m}}=a.seriesTypes,{addEvent:d,defined:f}=o;return function(p){function N(x){let u=this.series,w=u.chart.renderer;this.moveToTopOnHover&&this.graphic&&(u.stateMarkerGraphic||(u.stateMarkerGraphic=new r(w,"use").css({pointerEvents:"none"}).add(this.graphic.parentGroup)),x?.state==="hover"?(this.graphic.attr({id:this.id}),u.stateMarkerGraphic.attr({href:`${w.url}#${this.id}`,visibility:"visible"})):u.stateMarkerGraphic.attr({href:""}))}p.pointMembers={dataLabelOnNull:!0,moveToTopOnHover:!0,isValid:function(){return this.value!==null&&this.value!==1/0&&this.value!==-1/0&&(this.value===void 0||!isNaN(this.value))}},p.seriesMembers={colorKey:"value",axisTypes:["xAxis","yAxis","colorAxis"],parallelArrays:["x","y","value"],pointArrayMap:["value"],trackerGroups:["group","markerGroup","dataLabelsGroup"],colorAttribs:function(x){let u={};return f(x.color)&&(!x.state||x.state==="normal")&&(u[this.colorProp||"fill"]=x.color),u},pointAttribs:m.pointAttribs},p.compose=function(x){return d(x.prototype.pointClass,"afterSetState",N),x}}(t||(t={})),t}),n(s,"Series/Heatmap/HeatmapPoint.js",[s["Core/Series/SeriesRegistry.js"],s["Core/Utilities.js"]],function(a,r){let{scatter:{prototype:{pointClass:o}}}=a.seriesTypes,{clamp:t,defined:m,extend:d,pick:f}=r;class p extends o{applyOptions(x,u){return(this.isNull||this.value===null)&&delete this.color,super.applyOptions(x,u),this.formatPrefix=this.isNull||this.value===null?"null":"point",this}getCellAttributes(){let x=this.series,u=x.options,w=(u.colsize||1)/2,g=(u.rowsize||1)/2,j=x.xAxis,M=x.yAxis,y=this.options.marker||x.options.marker,S=x.pointPlacementToXValue(),B=f(this.pointPadding,u.pointPadding,0),T={x1:t(Math.round(j.len-j.translate(this.x-w,!1,!0,!1,!0,-S)),-j.len,2*j.len),x2:t(Math.round(j.len-j.translate(this.x+w,!1,!0,!1,!0,-S)),-j.len,2*j.len),y1:t(Math.round(M.translate(this.y-g,!1,!0,!1,!0)),-M.len,2*M.len),y2:t(Math.round(M.translate(this.y+g,!1,!0,!1,!0)),-M.len,2*M.len)};for(let Y of[["width","x"],["height","y"]]){let C=Y[0],h=Y[1],c=h+"1",i=h+"2",v=Math.abs(T[c]-T[i]),E=y&&y.lineWidth||0,k=Math.abs(T[c]+T[i])/2,P=y&&y[C];if(m(P)&&P<v){let R=P/2+E/2;T[c]=k-R,T[i]=k+R}B&&((h==="x"&&j.reversed||h==="y"&&!M.reversed)&&(c=i,i=h+"1"),T[c]+=B,T[i]-=B)}return T}haloPath(x){if(!x)return[];let{x:u=0,y:w=0,width:g=0,height:j=0}=this.shapeArgs||{};return[["M",u-x,w-x],["L",u-x,w+j+x],["L",u+g+x,w+j+x],["L",u+g+x,w-x],["Z"]]}isValid(){return this.value!==1/0&&this.value!==-1/0}}return d(p.prototype,{dataLabelOnNull:!0,moveToTopOnHover:!0,ttBelow:!1}),p}),n(s,"Series/Heatmap/HeatmapSeriesDefaults.js",[s["Core/Utilities.js"]],function(a){let{isNumber:r}=a;return{animation:!1,borderRadius:0,borderWidth:0,interpolation:!1,nullColor:"#f7f7f7",dataLabels:{formatter:function(){let{numberFormatter:o}=this.series.chart,{value:t}=this.point;return r(t)?o(t,-1):""},inside:!0,verticalAlign:"middle",crop:!1,overflow:"allow",padding:0},marker:{symbol:"rect",radius:0,lineColor:void 0,states:{hover:{lineWidthPlus:0},select:{}}},clip:!0,pointRange:null,tooltip:{pointFormat:"{point.x}, {point.y}: {point.value}<br/>"},states:{hover:{halo:!1,brightness:.2}},legendSymbol:"rectangle"}}),n(s,"Series/InterpolationUtilities.js",[s["Core/Globals.js"],s["Core/Utilities.js"]],function(a,r){let{doc:o}=a,{defined:t,pick:m}=r;return{colorFromPoint:function(d,f){let p=f.series.colorAxis;if(p){let N=p.toColor(d||0,f).split(")")[0].split("(")[1].split(",").map(x=>m(parseFloat(x),parseInt(x,10)));return N[3]=255*m(N[3],1),t(d)&&f.visible||(N[3]=0),N}return[0,0,0,0]},getContext:function(d){let{canvas:f,context:p}=d;return f&&p?(p.clearRect(0,0,f.width,f.height),p):(d.canvas=o.createElement("canvas"),d.context=d.canvas.getContext("2d",{willReadFrequently:!0})||void 0,d.context)}}}),n(s,"Series/Heatmap/HeatmapSeries.js",[s["Core/Color/Color.js"],s["Series/ColorMapComposition.js"],s["Series/Heatmap/HeatmapPoint.js"],s["Series/Heatmap/HeatmapSeriesDefaults.js"],s["Core/Series/SeriesRegistry.js"],s["Core/Renderer/SVG/SVGRenderer.js"],s["Core/Utilities.js"],s["Series/InterpolationUtilities.js"]],function(a,r,o,t,m,d,f,p){let{series:N,seriesTypes:{column:x,scatter:u}}=m,{prototype:{symbols:w}}=d,{addEvent:g,extend:j,fireEvent:M,isNumber:y,merge:S,pick:B}=f,{colorFromPoint:T,getContext:Y}=p;class C extends u{constructor(){super(...arguments),this.valueMax=NaN,this.valueMin=NaN,this.isDirtyCanvas=!0}drawPoints(){let c=this,i=c.options,v=i.interpolation,E=i.marker||{};if(v){let{image:k,chart:P,xAxis:R,yAxis:q}=c,{reversed:X=!1,len:J}=R,{reversed:Q=!1,len:ne}=q,F={width:J,height:ne};if(!k||c.isDirtyData||c.isDirtyCanvas){let K=Y(c),{canvas:le,options:{colsize:ve=1,rowsize:_=1},points:A,points:{length:L}}=c,G=P.colorAxis&&P.colorAxis[0];if(le&&K&&G){let{min:z,max:U}=R.getExtremes(),{min:$,max:W}=q.getExtremes(),Z=U-z,O=W-$,ee=Math.round(Z/ve/8*8),he=Math.round(O/_/8*8),[be,ue]=[[ee,ee/Z,X,"ceil"],[he,he/O,!Q,"floor"]].map(([Re,ge,We,$e])=>We?Oe=>Math[$e](Re-ge*Oe):Oe=>Math[$e](ge*Oe)),xe=le.width=ee+1,we=xe*(le.height=he+1),Fe=(L-1)/we,Ce=new Uint8ClampedArray(4*we),Ee=(Re,ge)=>4*Math.ceil(xe*ue(ge-$)+be(Re-z));c.buildKDTree();for(let Re=0;Re<we;Re++){let ge=A[Math.ceil(Fe*Re)],{x:We,y:$e}=ge;Ce.set(T(ge.value,ge),Ee(We,$e))}K.putImageData(new ImageData(Ce,xe),0,0),k?k.attr({...F,href:le.toDataURL("image/png",1)}):(c.directTouch=!1,c.image=P.renderer.image(le.toDataURL("image/png",1)).attr(F).add(c.group))}c.isDirtyCanvas=!1}else(k.width!==J||k.height!==ne)&&k.attr(F)}else(E.enabled||c._hasPointMarkers)&&(N.prototype.drawPoints.call(c),c.points.forEach(k=>{k.graphic&&(k.graphic[c.chart.styledMode?"css":"animate"](c.colorAttribs(k)),k.value===null&&k.graphic.addClass("highcharts-null-point"))}))}getExtremes(){let{dataMin:c,dataMax:i}=N.prototype.getExtremes.call(this,this.valueData);return y(c)&&(this.valueMin=c),y(i)&&(this.valueMax=i),N.prototype.getExtremes.call(this)}getValidPoints(c,i){return N.prototype.getValidPoints.call(this,c,i,!0)}hasData(){return!!this.xData}init(){super.init.apply(this,arguments);let c=this.options;c.pointRange=B(c.pointRange,c.colsize||1),this.yAxis.axisPointRange=c.rowsize||1,w.ellipse=w.circle,c.marker&&y(c.borderRadius)&&(c.marker.r=c.borderRadius)}markerAttribs(c,i){let v=c.shapeArgs||{};if(c.hasImage)return{x:c.plotX,y:c.plotY};if(i&&i!=="normal"){let E=c.options.marker||{},k=this.options.marker||{},P=k.states&&k.states[i]||{},R=E.states&&E.states[i]||{},q=(R.width||P.width||v.width||0)+(R.widthPlus||P.widthPlus||0),X=(R.height||P.height||v.height||0)+(R.heightPlus||P.heightPlus||0);return{x:(v.x||0)+((v.width||0)-q)/2,y:(v.y||0)+((v.height||0)-X)/2,width:q,height:X}}return v}pointAttribs(c,i){let v=N.prototype.pointAttribs.call(this,c,i),E=this.options||{},k=this.chart.options.plotOptions||{},P=k.series||{},R=k.heatmap||{},q=c&&c.options.borderColor||E.borderColor||R.borderColor||P.borderColor,X=c&&c.options.borderWidth||E.borderWidth||R.borderWidth||P.borderWidth||v["stroke-width"];if(v.stroke=c&&c.marker&&c.marker.lineColor||E.marker&&E.marker.lineColor||q||this.color,v["stroke-width"]=X,i&&i!=="normal"){let J=S(E.states&&E.states[i],E.marker&&E.marker.states&&E.marker.states[i],c&&c.options.states&&c.options.states[i]||{});v.fill=J.color||a.parse(v.fill).brighten(J.brightness||0).get(),v.stroke=J.lineColor||v.stroke}return v}translate(){let{borderRadius:c,marker:i}=this.options,v=i&&i.symbol||"rect",E=w[v]?v:"rect",k=["circle","square"].indexOf(E)!==-1;if(!this.processedXData){let{xData:P,yData:R}=this.getProcessedData();this.processedXData=P,this.processedYData=R}for(let P of(this.generatePoints(),this.points)){let R=P.getCellAttributes(),q=Math.min(R.x1,R.x2),X=Math.min(R.y1,R.y2),J=Math.max(Math.abs(R.x2-R.x1),0),Q=Math.max(Math.abs(R.y2-R.y1),0);if(P.hasImage=(P.marker&&P.marker.symbol||v).indexOf("url")===0,k){let ne=Math.abs(J-Q);q=Math.min(R.x1,R.x2)+(J<Q?0:ne/2),X=Math.min(R.y1,R.y2)+(J<Q?ne/2:0),J=Q=Math.min(J,Q)}P.hasImage&&(P.marker={width:J,height:Q}),P.plotX=P.clientX=(R.x1+R.x2)/2,P.plotY=(R.y1+R.y2)/2,P.shapeType="path",P.shapeArgs=S(!0,{x:q,y:X,width:J,height:Q},{d:w[E](q,X,J,Q,{r:y(c)?c:0})})}M(this,"afterTranslate")}}return C.defaultOptions=S(u.defaultOptions,t),g(C,"afterDataClassLegendClick",function(){this.isDirtyCanvas=!0,this.drawPoints()}),j(C.prototype,{axisTypes:r.seriesMembers.axisTypes,colorKey:r.seriesMembers.colorKey,directTouch:!0,getExtremesFromAll:!0,parallelArrays:r.seriesMembers.parallelArrays,pointArrayMap:["y","value"],pointClass:o,specialGroup:"group",trackerGroups:r.seriesMembers.trackerGroups,alignDataLabel:x.prototype.alignDataLabel,colorAttribs:r.seriesMembers.colorAttribs,getSymbol:N.prototype.getSymbol}),r.compose(C),m.registerSeriesType("heatmap",C),C}),n(s,"masters/modules/heatmap.src.js",[s["Core/Globals.js"]],function(a){return a})})})(Vt);var Ns=Vt.exports;const ws=Ut(Ns),Ie=class Ie{constructor(){Le(this,"subscriptions",new Map)}static getInstance(){return Ie.instance||(Ie.instance=new Ie),Ie.instance}async getFamilyExpenseByCategory(l,s){try{const n=await pe.getFamilyMembers(l);if(!n||n.length===0)throw new Error("No family members found");const a=n.map(m=>m.user_id),{data:r,error:o}=await V.rpc("get_family_expense_by_category",{p_family_id:l,p_user_ids:a,p_start_date:s.startDate,p_end_date:s.endDate});return o?(console.warn("RPC function failed, falling back to manual aggregation:",o),await this.getFamilyExpenseByCategoryFallback(l,a,s)):await this.enhanceCategoryDataWithContributions(r||[],a,n,s)}catch(n){throw console.error("Error in getFamilyExpenseByCategory:",n),n}}async getFamilyExpenseByCategoryFallback(l,s,n){try{const{data:a,error:r}=await V.from("transactions").select("amount").in("user_id",s).eq("type","expense").gte("date",n.startDate).lte("date",n.endDate);if(r)throw r;const o=a?.reduce((f,p)=>f+p.amount,0)||0,{data:t,error:m}=await V.from("expense_categories").select(`
          id,
          category_name,
          color,
          icon,
          monthly_budget,
          transactions!inner(
            amount,
            user_id,
            date
          )
        `).in("user_id",s).gte("transactions.date",n.startDate).lte("transactions.date",n.endDate).eq("transactions.type","expense");if(m)throw m;return this.processCategoryAggregation(t||[],o)}catch(a){return console.error("Error in fallback category aggregation:",a),[]}}processCategoryAggregation(l,s){const n=new Map;return l.forEach(a=>{const r=a.id,o=Array.isArray(a.transactions)?a.transactions:[];n.has(r)||n.set(r,{category_id:r,category_name:a.category_name,category_color:a.color,category_icon:a.icon,total_amount:0,transaction_count:0,percentage_of_total:0,monthly_budget:a.monthly_budget,variance:0,family_member_contributions:[]});const t=n.get(r);o.forEach(m=>{t.total_amount+=m.amount,t.transaction_count+=1}),t.percentage_of_total=s>0?t.total_amount/s*100:0,t.variance=t.monthly_budget?t.total_amount-t.monthly_budget:0}),Array.from(n.values()).filter(a=>a.total_amount>0).sort((a,r)=>r.total_amount-a.total_amount)}async enhanceCategoryDataWithContributions(l,s,n,a){try{for(const r of l){const{data:o,error:t}=await V.from("transactions").select("user_id, amount").in("user_id",s).eq("expense_category_id",r.category_id).eq("type","expense").gte("date",a.startDate).lte("date",a.endDate);if(!t&&o){const m=new Map;o.forEach(d=>{const f=m.get(d.user_id)||0;m.set(d.user_id,f+d.amount)}),r.family_member_contributions=Array.from(m.entries()).map(([d,f])=>{const p=n.find(N=>N.user_id===d);return{user_id:d,full_name:p?.full_name||"Unknown Member",amount:f,percentage:r.total_amount>0?f/r.total_amount*100:0}}).sort((d,f)=>f.amount-d.amount)}}return l}catch(r){return console.error("Error enhancing category data with contributions:",r),l}}async getFamilyFinancialSummary(l,s="current"){try{const n=await pe.getFamilyMembers(l),a=n.map(m=>m.user_id);if(a.length===0)throw new Error("No family members found");const r=this.calculateDateRange(s),{data:o,error:t}=await V.rpc("get_family_financial_summary",{p_family_id:l,p_user_ids:a,p_start_date:r.startDate,p_end_date:r.endDate});return!t&&o?{...o,member_count:n.length,healthMetrics:this.calculateHealthMetrics(o)}:await this.getFamilyFinancialSummaryFallback(l,a,r,n.length)}catch(n){throw console.error("Error in getFamilyFinancialSummary:",n),n}}async getFamilyFinancialSummaryFallback(l,s,n,a){try{const{data:r,error:o}=await V.from("transactions").select("amount, type, date").in("user_id",s).gte("date",n.startDate).lte("date",n.endDate).in("type",["income","expense"]);if(o)throw o;const t=r?.filter(j=>j.type==="income").reduce((j,M)=>j+M.amount,0)||0,m=r?.filter(j=>j.type==="expense").reduce((j,M)=>j+M.amount,0)||0,{data:d,error:f}=await V.from("budgets").select("amount, spent").in("user_id",s).eq("status","active"),p=d?.reduce((j,M)=>j+M.amount,0)||0,N=d?.reduce((j,M)=>j+(M.spent||0),0)||0,x=p>0?N/p*100:0,u=t>0?(t-m)/t*100:0,w=this.calculateMonthlyTrends(r||[]),g=this.calculateHealthMetrics({total_family_income:t,total_family_expenses:m,budget_utilization:x,savings_rate:u});return{total_family_income:t,total_family_expenses:m,budget_utilization:x,savings_rate:u,expense_trend:w,healthMetrics:g,member_count:a}}catch(r){throw console.error("Error in financial summary fallback:",r),r}}calculateHealthMetrics(l){let s=0,n=0,a=0,r=0;l.savings_rate>=20?s+=40:l.savings_rate>=10?s+=30:l.savings_rate>=5?s+=20:s+=10,a=Math.min(100,l.savings_rate*5),l.budget_utilization<=80?(s+=30,r+=40):l.budget_utilization<=100?(s+=20,r+=30):(s+=5,r+=10);const o=l.total_family_income>0?l.total_family_expenses/l.total_family_income*100:100;o<=50?(s+=30,n=100):o<=70?(s+=25,n=80):o<=80?(s+=15,n=60):(s+=5,n=30);let t="F",m="Critical";return s>=90?(t="A+",m="Excellent"):s>=80?(t="A",m="Very Good"):s>=70?(t="B",m="Good"):s>=60?(t="C",m="Fair"):s>=50&&(t="D",m="Needs Improvement"),{financial_health_score:s,expense_control_score:n,savings_discipline_score:a,budget_planning_score:r+(l.budget_utilization>0?60:0),overall_grade:t,overall_status:m}}calculateMonthlyTrends(l){const s=new Map;return l.forEach(n=>{const a=new Date(n.date).toISOString().substring(0,7);s.has(a)||s.set(a,{income:0,expenses:0});const r=s.get(a);n.type==="income"?r.income+=n.amount:n.type==="expense"&&(r.expenses+=n.amount)}),Array.from(s.entries()).map(([n,a])=>({month:n,income:a.income,expenses:a.expenses,savings:a.income-a.expenses})).sort((n,a)=>n.month.localeCompare(a.month)).slice(-6)}async getFamilyMemberActivity(l,s=10){try{const n=await pe.getFamilyMembers(l),a=n.map(f=>f.user_id);if(a.length===0)return[];const{data:r,error:o}=await V.from("transactions").select("user_id, amount, type, description, created_at").in("user_id",a).order("created_at",{ascending:!1}).limit(s);o&&console.warn("Error fetching recent transactions:",o);const{data:t,error:m}=await V.from("goal_contributions").select(`
          user_id, 
          amount, 
          contribution_date,
          goals (
            goal_name
          )
        `).in("user_id",a).order("contribution_date",{ascending:!1}).limit(s);m&&console.warn("Error fetching recent contributions:",m);const d=[];return r?.forEach(f=>{const p=n.find(N=>N.user_id===f.user_id);d.push({user_id:f.user_id,full_name:p?.full_name||"Unknown Member",avatar_url:p?.avatar_url,activity_type:"transaction",activity_description:`${f.type==="income"?"Received":"Spent"} ₱${f.amount.toLocaleString()} - ${f.description}`,amount:f.amount,timestamp:f.created_at})}),t?.forEach(f=>{const p=n.find(N=>N.user_id===f.user_id);d.push({user_id:f.user_id,full_name:p?.full_name||"Unknown Member",avatar_url:p?.avatar_url,activity_type:"goal_contribution",activity_description:`Contributed ₱${f.amount.toLocaleString()} to ${f.goals?.goal_name||"Unknown Goal"}`,amount:f.amount,timestamp:f.contribution_date})}),d.sort((f,p)=>new Date(p.timestamp).getTime()-new Date(f.timestamp).getTime()).slice(0,s)}catch(n){return console.error("Error in getFamilyMemberActivity:",n),[]}}subscribeFamilyDataChanges(l,s){const n=`family_data_${l}`;this.subscriptions.has(n)&&this.subscriptions.get(n).unsubscribe();const a=V.channel(`family-data-${l}`).on("postgres_changes",{event:"*",schema:"public",table:"transactions"},async()=>{try{const r=await this.getFamilyFinancialSummary(l);s({type:"financial_summary",data:r})}catch(r){console.error("Error refreshing family data:",r)}}).on("postgres_changes",{event:"*",schema:"public",table:"goal_contributions"},async()=>{try{const r=await this.getFamilyMemberActivity(l);s({type:"member_activity",data:r})}catch(r){console.error("Error refreshing family activity:",r)}}).subscribe();return this.subscriptions.set(n,a),()=>{a.unsubscribe(),this.subscriptions.delete(n)}}calculateDateRange(l){const s=new Date;let n,a;switch(l){case"current":n=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s.getFullYear(),s.getMonth()+1,0);break;case"last_month":n=new Date(s.getFullYear(),s.getMonth()-1,1),a=new Date(s.getFullYear(),s.getMonth(),0);break;case"last_quarter":const r=Math.floor(s.getMonth()/3),o=r===0?9:(r-1)*3,t=r===0?s.getFullYear()-1:s.getFullYear();n=new Date(t,o,1),a=new Date(t,o+3,0);break;default:n=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s.getFullYear(),s.getMonth()+1,0)}return{startDate:n.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]}}};Le(Ie,"instance");let ct=Ie;const At=ct.getInstance(),Ge=class Ge{constructor(){Le(this,"budgetService");this.budgetService=ms.getInstance()}static getInstance(){return Ge.instance||(Ge.instance=new Ge),Ge.instance}async getFamilyBudgetPerformance(l,s="monthly"){const n=Date.now();nt("FamilyBudgetService","getFamilyBudgetPerformance_start",{familyId:l,period:s});try{const a=await pe.getFamilyMembers(l);if(!a||a.length===0)throw new Error("No family members found");const r=a.map(d=>d.user_id),o=this.calculatePeriodDateRange(s),{data:t,error:m}=await V.rpc("get_family_budget_performance",{p_family_id:l,p_user_ids:r,p_start_date:o.startDate,p_end_date:o.endDate});if(!m&&t){const d=Date.now()-n;return nt("FamilyBudgetService","getFamilyBudgetPerformance_rpc_success",{familyId:l,duration:d,memberCount:a.length}),{...t,member_count:a.length}}return nt("FamilyBudgetService","getFamilyBudgetPerformance_fallback",{familyId:l,rpcError:m?.message}),await this.getFamilyBudgetPerformanceFallback(l,r,a,o)}catch(a){const r=Date.now()-n;throw hs("FamilyBudgetService","getFamilyBudgetPerformance",a instanceof Error?a:new Error(String(a)),{familyId:l,period:s,duration:r}),a}}async getFamilyBudgetPerformanceFallback(l,s,n,a){try{let r=0,o=0,t=0,m=0;const{data:d,error:f}=await V.from("transactions").select("amount, type, date, expense_category_id, user_id").in("user_id",s).gte("date",a.startDate).lte("date",a.endDate).in("type",["income","expense"]);f&&console.warn("Error fetching transactions:",f),d&&d.length>0&&(r=d.filter(M=>M.type==="income").reduce((M,y)=>M+(y.amount||0),0),o=d.filter(M=>M.type==="expense").reduce((M,y)=>M+(y.amount||0),0));const p=await this.getFamilyBudgets(s);p.length>0&&(t=p.reduce((M,y)=>M+(y.amount||0),0),m=p.reduce((M,y)=>M+(y.spent||0),0));const N=t>0?m/t*100:0,x=r>0?(r-o)/r*100:0,u=N>0?Math.min(100,(100-Math.abs(N-80))*1.25):0,w=this.calculateFamilyFinancialHealth({savingsRate:x,budgetUtilization:N,totalIncome:r,totalExpenses:o,budgetEfficiency:u}),g=await this.calculateCategoryPerformance(p,d||[],n),j=this.calculateExpenseTrends(d||[],p);return{total_family_income:r,total_family_expenses:o,budget_utilization:N,savings_rate:x,category_performance:g,family_financial_health:w,expense_trend:j,budget_efficiency:u,member_count:n.length}}catch(r){return console.error("Error in fallback budget performance calculation:",r),{total_family_income:0,total_family_expenses:0,budget_utilization:0,savings_rate:0,category_performance:[],family_financial_health:0,expense_trend:[],budget_efficiency:0,member_count:n.length}}}async getFamilyBudgetUtilization(l){try{const s=await pe.getFamilyMembers(l),n=s.map(t=>t.user_id);if(n.length===0)return[];const{data:a,error:r}=await V.from("budgets").select(`
          *,
          expense_categories (
            id,
            category_name,
            color,
            icon
          )
        `).in("user_id",n).eq("status","active");if(r)throw r;const o=new Map;return a?.forEach(t=>{const m=t.category_id,d=t.expense_categories?.category_name||"Uncategorized";o.has(m)||o.set(m,{category_id:m,category_name:d,total_budget:0,total_spent:0,utilization_percentage:0,member_utilization:[],is_over_budget:!1,variance:0});const f=o.get(m);f.total_budget+=t.amount,f.total_spent+=t.spent||0;const p=s.find(N=>N.user_id===t.user_id);f.member_utilization.push({user_id:t.user_id,full_name:p?.full_name||"Unknown Member",budget:t.amount,spent:t.spent||0,percentage:t.amount>0?(t.spent||0)/t.amount*100:0})}),Array.from(o.values()).map(t=>(t.utilization_percentage=t.total_budget>0?t.total_spent/t.total_budget*100:0,t.is_over_budget=t.total_spent>t.total_budget,t.variance=t.total_spent-t.total_budget,t)).sort((t,m)=>m.utilization_percentage-t.utilization_percentage)}catch(s){throw console.error("Error in getFamilyBudgetUtilization:",s),s}}async getFamilyBudgetTrends(l,s=6){try{const a=(await pe.getFamilyMembers(l)).map(o=>o.user_id);if(a.length===0)return[];const r=[];for(let o=s-1;o>=0;o--){const t=new Date;t.setMonth(t.getMonth()-o);const m=t.toISOString().substring(0,7),d=new Date(t.getFullYear(),t.getMonth(),1).toISOString().split("T")[0],f=new Date(t.getFullYear(),t.getMonth()+1,0).toISOString().split("T")[0],{data:p,error:N}=await V.from("budgets").select(`
            amount,
            spent,
            expense_categories (
              category_name
            )
          `).in("user_id",a).gte("start_date",d).lte("end_date",f);if(N){console.warn(`Error fetching budgets for ${m}:`,N);continue}const{data:x,error:u}=await V.from("transactions").select("amount, type").in("user_id",a).gte("date",d).lte("date",f).in("type",["income","expense"]);u&&console.warn(`Error fetching transactions for ${m}:`,u);const w=p?.reduce((S,B)=>S+B.amount,0)||0,g=p?.reduce((S,B)=>S+(B.spent||0),0)||0,j=x?.filter(S=>S.type==="income").reduce((S,B)=>S+B.amount,0)||0,M=x?.filter(S=>S.type==="expense").reduce((S,B)=>S+B.amount,0)||0,y=new Map;p?.forEach(S=>{const B=S.expense_categories?.[0]?.category_name||"Uncategorized";y.has(B)||y.set(B,{category_name:B,budget:0,spent:0,utilization:0});const T=y.get(B);T.budget+=S.amount,T.spent+=S.spent||0}),Array.from(y.values()).forEach(S=>{S.utilization=S.budget>0?S.spent/S.budget*100:0}),r.push({month:m,total_budget:w,total_spent:g,utilization_percentage:w>0?g/w*100:0,savings_achieved:j-M,categories:Array.from(y.values())})}return r}catch(n){throw console.error("Error in getFamilyBudgetTrends:",n),n}}async getFamilyBudgets(l){const s=[];for(const n of l)try{const a=await this.budgetService.getBudgets(n);a.source!=="error"&&s.push(...a.data)}catch(a){console.warn(`Error fetching budgets for user ${n}:`,a)}return s}async calculateCategoryPerformance(l,s,n){const a=new Map;return l.forEach(r=>{const o=r.category_name||"Uncategorized";a.has(o)||a.set(o,{category:o,category_color:r.category_color,category_icon:r.category_icon,budget:0,actual:0,utilization:0,variance:0,status:"on_track",member_contributions:[]});const t=a.get(o);t.budget+=r.amount,t.actual+=r.spent||0;const m=n.find(f=>f.user_id===r.user_id),d=t.member_contributions.find(f=>f.user_id===r.user_id);d?(d.budget_allocated+=r.amount,d.amount_spent+=r.spent||0):t.member_contributions.push({user_id:r.user_id,full_name:m?.full_name||"Unknown Member",budget_allocated:r.amount,amount_spent:r.spent||0,utilization_percentage:0})}),Array.from(a.values()).forEach(r=>{r.utilization=r.budget>0?r.actual/r.budget*100:0,r.variance=r.actual-r.budget,r.utilization>100?r.status="over":r.utilization>80?r.status="on_track":r.status="under",r.member_contributions.forEach(o=>{o.utilization_percentage=o.budget_allocated>0?o.amount_spent/o.budget_allocated*100:0}),r.member_contributions.sort((o,t)=>t.utilization_percentage-o.utilization_percentage)}),Array.from(a.values()).sort((r,o)=>o.utilization-r.utilization)}calculateFamilyFinancialHealth(l){let s=0;l.savingsRate>=20?s+=40:l.savingsRate>=10?s+=30:l.savingsRate>=5?s+=20:s+=10,s+=l.budgetEfficiency/100*30;const n=l.totalIncome>0?l.totalExpenses/l.totalIncome*100:100;return n<=50?s+=30:n<=70?s+=25:n<=80?s+=15:s+=5,Math.min(100,Math.round(s))}calculateExpenseTrends(l,s){const n=new Map;return l.filter(a=>a.type==="expense").forEach(a=>{const r=new Date(a.date).toISOString().substring(0,7);n.has(r)||n.set(r,{actual:0,planned:0}),n.get(r).actual+=a.amount}),s.forEach(a=>{const r=new Date(a.start_date).toISOString().substring(0,7);n.has(r)||n.set(r,{actual:0,planned:0}),n.get(r).planned+=a.amount}),Array.from(n.entries()).map(([a,r])=>{const o=r.actual-r.planned,t=r.planned>0?o/r.planned*100:0;return{month:a,planned:r.planned,actual:r.actual,variance:o,variance_percentage:t}}).sort((a,r)=>a.month.localeCompare(r.month)).slice(-6)}calculatePeriodDateRange(l){const s=new Date;let n,a=new Date(s);switch(l){case"monthly":n=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s.getFullYear(),s.getMonth()+1,0);break;case"quarterly":const r=Math.floor(s.getMonth()/3);n=new Date(s.getFullYear(),r*3,1),a=new Date(s.getFullYear(),(r+1)*3,0);break;case"yearly":n=new Date(s.getFullYear(),0,1),a=new Date(s.getFullYear(),11,31);break;default:n=new Date(s.getFullYear(),s.getMonth(),1),a=new Date(s.getFullYear(),s.getMonth()+1,0)}return{startDate:n.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]}}};Le(Ge,"instance");let dt=Ge;const _s=dt.getInstance(),Be=class Be{static getInstance(){return Be.instance||(Be.instance=new Be),Be.instance}async getFamilyGoalProgress(l){try{const s=await pe.getFamilyMembers(l);if(!s||s.length===0)throw new Error("No family members found");const n=s.map(t=>t.user_id),{data:a,error:r}=await V.from("goals").select("*").eq("family_id",l).eq("is_family_goal",!0).order("created_at",{ascending:!1});if(r)throw r;if(!a||a.length===0)return[];const o=[];for(const t of a){const m=t.target_amount>0?t.current_amount/t.target_amount*100:0,d=t.target_date?Math.ceil((new Date(t.target_date).getTime()-new Date().getTime())/(1e3*60*60*24)):null,{data:f,error:p}=await V.from("goal_contributions").select("user_id, amount, contribution_date").eq("goal_id",t.id).order("contribution_date",{ascending:!1});p&&console.warn(`Error fetching contributions for goal ${t.id}:`,p);const N=this.calculateContributionVelocity(f||[],t.created_at),x=this.mapContributionsToMembers(f||[],s,t.current_amount),u=s.find(w=>w.user_id===t.user_id);o.push({goal_id:t.id,goal_name:t.goal_name,target_amount:t.target_amount,current_amount:t.current_amount,progress_percentage:m,family_contributions:x,days_remaining:d,status:t.status||"in_progress",priority:t.priority||"medium",category:t.category,contribution_velocity:N,is_family_goal:!0,owner_name:u?.full_name||"Unknown Member",target_date:t.target_date,created_at:t.created_at})}return o.sort((t,m)=>{const d={in_progress:1,not_started:2,completed:3,cancelled:4},f=d[t.status]||5,p=d[m.status]||5;return f!==p?f-p:m.progress_percentage-t.progress_percentage})}catch(s){throw console.error("Error in getFamilyGoalProgress:",s),s}}async getFamilyGoalsByStatus(l){try{const n=(await pe.getFamilyMembers(l)).map(o=>o.user_id);if(n.length===0)return[];const{data:a,error:r}=await V.rpc("get_family_goals_by_status",{p_family_id:l,p_user_ids:n});return!r&&a?a.map(o=>({...o,commitment_insights:this.calculateCommitmentInsights(a)})):await this.getFamilyGoalsByStatusFallback(l,n)}catch(s){throw console.error("Error in getFamilyGoalsByStatus:",s),s}}async calculateGoalCommitment(l){try{if((await pe.getFamilyMembers(l)).map(g=>g.user_id).length===0)return this.getEmptyCommitmentData();const{data:a,error:r}=await V.from("goals").select("*").eq("family_id",l).eq("is_family_goal",!0);if(r)return console.warn("Error fetching family goals for commitment analysis:",r),this.getEmptyCommitmentData();if(!a||a.length===0)return this.getEmptyCommitmentData();const o=a.length,t=a.filter(g=>g.status==="in_progress"||g.status==="not_started").length,m=a.filter(g=>g.status==="completed").length,d=new Set(a.map(g=>g.category).filter(Boolean)).size,f=o>0?m/o*100:0;let p=0;p+=Math.min(25,t*8),p+=Math.min(25,d*8),p+=f/100*30,p+=Math.min(20,o*4);let N="";o===0?N="Set family goals to improve financial planning":o<=2?N="Good start - consider adding more goals for better diversification":N="Excellent goal planning and commitment";const{strengths:x,improvements:u,recommendations:w}=this.generateCommitmentInsights({totalGoals:o,activeGoals:t,completedGoals:m,goalCategories:d,completionRate:f,commitmentScore:p});return{overall_score:Math.round(p),commitment_level:N,active_goals:t,completed_goals:m,total_goals:o,goal_categories:d,average_completion_days:null,strengths:x,improvements:u,recommendations:w}}catch(s){return console.error("Error in calculateGoalCommitment:",s),this.getEmptyCommitmentData()}}async getFamilyGoalDiversity(l){try{if((await pe.getFamilyMembers(l)).map(p=>p.user_id).length===0)return{total_categories:0,category_distribution:[],diversification_score:0,recommended_categories:this.getRecommendedCategories([])};const{data:a,error:r}=await V.from("goals").select("category, target_amount, current_amount, status").eq("family_id",l).eq("is_family_goal",!0).not("category","is",null);if(r)throw r;if(!a||a.length===0)return{total_categories:0,category_distribution:[],diversification_score:0,recommended_categories:this.getRecommendedCategories([])};const o=new Map;a.forEach(p=>{const N=p.category||"Other";o.has(N)||o.set(N,{category:N,goal_count:0,total_target:0,total_current:0,average_progress:0});const x=o.get(N);x.goal_count+=1,x.total_target+=p.target_amount,x.total_current+=p.current_amount});const t=Array.from(o.values()).map(p=>({...p,average_progress:p.total_target>0?p.total_current/p.total_target*100:0})).sort((p,N)=>N.total_target-p.total_target),m=t.length,d=Math.min(100,m*20),f=t.map(p=>p.category);return{total_categories:m,category_distribution:t,diversification_score:d,recommended_categories:this.getRecommendedCategories(f)}}catch(s){throw console.error("Error in getFamilyGoalDiversity:",s),s}}calculateContributionVelocity(l,s){if(!l||l.length===0)return 0;const n=l.reduce((t,m)=>t+m.amount,0),a=new Date(s),o=Math.max(1,Math.ceil((new Date().getTime()-a.getTime())/(1e3*60*60*24)));return n/o}mapContributionsToMembers(l,s,n){const a=new Map;return l.forEach(r=>{const o=a.get(r.user_id)||{amount:0};o.amount+=r.amount,(!o.lastDate||new Date(r.contribution_date)>new Date(o.lastDate))&&(o.lastDate=r.contribution_date),a.set(r.user_id,o)}),Array.from(a.entries()).map(([r,o])=>{const t=s.find(m=>m.user_id===r);return{user_id:r,full_name:t?.full_name||"Unknown Member",avatar_url:t?.avatar_url,amount:o.amount,percentage:n>0?o.amount/n*100:0,last_contribution_date:o.lastDate}}).sort((r,o)=>o.amount-r.amount)}async enhanceGoalDataWithContributions(l,s){const n=[];for(const a of l){const{data:r,error:o}=await V.from("goal_contributions").select("user_id, amount, contribution_date").eq("goal_id",a.goal_id);o&&console.warn(`Error fetching contributions for goal ${a.goal_id}:`,o);const t=this.mapContributionsToMembers(r||[],s,a.current_amount);n.push({...a,family_contributions:t})}return n}getFamilyGoalsByStatusFallback(l,s){return Promise.resolve([])}calculateCommitmentInsights(l){const s=l.reduce((m,d)=>m+d.goal_count,0),n=l.filter(m=>m.status_category==="in_progress"||m.status_category==="not_started").reduce((m,d)=>m+d.goal_count,0),a=l.find(m=>m.status_category==="completed")?.goal_count||0,r=s>0?a/s*100:0;let o=0;o+=Math.min(25,n*8),o+=r/100*30,o+=Math.min(20,s*4);let t="";return s===0?t="Set family goals to improve financial planning":s<=2?t="Good start - consider adding more goals for better diversification":t="Excellent goal planning and commitment",{total_goals:s,active_goal_count:n,commitment_level:t,goal_commitment_score:Math.round(o),goal_diversity:0,completion_rate:r,average_days_to_completion:null,planning_discipline_score:Math.min(100,s*20)}}generateCommitmentInsights(l){const s=[],n=[],a=[];return l.activeGoals>0&&s.push(`${l.activeGoals} active goals showing commitment to financial planning`),l.completionRate>50&&s.push(`Strong goal completion rate of ${l.completionRate.toFixed(1)}%`),l.goalCategories>2&&s.push(`Good goal diversification across ${l.goalCategories} categories`),l.totalGoals===0&&(n.push("No financial goals currently set"),a.push("Start with 1-2 achievable short-term family goals")),l.goalCategories<=1&&(n.push("Limited goal diversity - consider goals in different areas"),a.push("Consider goals for: emergency fund, education, home improvement, vacation")),{strengths:s,improvements:n,recommendations:a}}getRecommendedCategories(l){return["Emergency Fund","Vacation","Home Improvement","Education","Retirement","Vehicle","Health & Wellness","Technology","Investment","Debt Payoff"].filter(n=>!l.includes(n)).slice(0,3)}getEmptyCommitmentData(){return{overall_score:0,commitment_level:"Set family goals to improve financial planning",active_goals:0,completed_goals:0,total_goals:0,goal_categories:0,average_completion_days:null,strengths:[],improvements:["No financial goals currently set"],recommendations:["Start with 1-2 achievable short-term family goals","Consider emergency fund and vacation savings goals"]}}};Le(Be,"instance");let mt=Be;const Et=mt.getInstance(),et=b=>{const{familyId:l,enableCategories:s=!0,enableBudgets:n=!0,enableGoals:a=!0,refreshInterval:r=3e4}=b,[o,t]=D.useState({financialSummary:null,categoryExpenses:[],budgetPerformance:null,goalProgress:[],goalCommitment:null,lastUpdated:new Date}),[m,d]=D.useState(!0),[f,p]=D.useState(null),[N,x]=D.useState(!1),u=D.useRef([]),w=D.useRef(null),g=D.useRef(new Date),j=D.useCallback(async()=>{if(l)try{p(null);const T=[];if(T.push(At.getFamilyFinancialSummary(l,"current")),s){const h={startDate:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0],endDate:new Date(new Date().getFullYear(),new Date().getMonth()+1,0).toISOString().split("T")[0]};T.push(At.getFamilyExpenseByCategory(l,h))}n&&T.push(_s.getFamilyBudgetPerformance(l,"monthly")),a&&T.push(Et.getFamilyGoalProgress(l),Et.calculateGoalCommitment(l));const Y=await Promise.allSettled(T),C={financialSummary:Y[0].status==="fulfilled"?Y[0].value:null,categoryExpenses:s&&Y[1].status==="fulfilled"?Y[1].value:[],budgetPerformance:n&&Y[s?2:1].status==="fulfilled"?Y[s?2:1].value:null,goalProgress:a&&Y[s&&n?3:s||n?2:1].status==="fulfilled"?Y[s&&n?3:s||n?2:1].value:[],goalCommitment:a&&Y[s&&n?4:s||n?3:2].status==="fulfilled"?Y[s&&n?4:s||n?3:2].value:null,lastUpdated:new Date};t(C),g.current=new Date,d(!1),console.log("Family data refreshed successfully:",{familyId:l,timestamp:C.lastUpdated,enabledFeatures:{enableCategories:s,enableBudgets:n,enableGoals:a}})}catch(T){console.error("Error refreshing family data:",T),p(T instanceof Error?T.message:"Failed to refresh data"),d(!1)}},[l,s,n,a]),M=D.useCallback(()=>{if(!l)return;u.current.forEach(C=>{C&&typeof C.unsubscribe=="function"&&C.unsubscribe()}),u.current=[],console.log("Setting up real-time subscriptions for family:",l);const T=V.channel(`family-transactions-${l}`).on("postgres_changes",{event:"*",schema:"public",table:"transactions"},C=>{console.log("Transaction change detected:",C.eventType),j()}).subscribe(C=>{console.log("Transaction subscription status:",C),C==="SUBSCRIBED"?x(!0):(C==="CLOSED"||C==="CHANNEL_ERROR")&&x(!1)});if(u.current.push(T),n){const C=V.channel(`family-budgets-${l}`).on("postgres_changes",{event:"*",schema:"public",table:"budgets"},h=>{console.log("Budget change detected:",h.eventType),j()}).subscribe();u.current.push(C)}if(a){const C=V.channel(`family-goals-${l}`).on("postgres_changes",{event:"*",schema:"public",table:"goals"},c=>{console.log("Goal change detected:",c.eventType),j()}).subscribe(),h=V.channel(`family-goal-contributions-${l}`).on("postgres_changes",{event:"*",schema:"public",table:"goal_contributions"},c=>{console.log("Goal contribution change detected:",c.eventType),j()}).subscribe();u.current.push(C,h)}const Y=V.channel(`family-members-${l}`).on("postgres_changes",{event:"*",schema:"public",table:"family_members",filter:`family_id=eq.${l}`},C=>{console.log("Family member change detected:",C.eventType),j()}).subscribe();u.current.push(Y)},[l,n,a,j]),y=D.useCallback(()=>{w.current&&clearInterval(w.current),w.current=setInterval(()=>{new Date().getTime()-g.current.getTime()>r&&!N&&(console.log("Fallback refresh triggered"),j())},r)},[r,j,N]),S=D.useCallback(async()=>{d(!0),await j()},[j]),B=D.useCallback(()=>({isConnected:N,subscriptionCount:u.current.length,lastRefresh:g.current,timeSinceLastRefresh:new Date().getTime()-g.current.getTime()}),[N]);return D.useEffect(()=>{if(!l){p("Family ID is required"),d(!1);return}return console.log("Initializing real-time family data for:",l),j(),M(),y(),()=>{console.log("Cleaning up real-time subscriptions"),u.current.forEach(T=>{T&&typeof T.unsubscribe=="function"&&T.unsubscribe()}),u.current=[],w.current&&(clearInterval(w.current),w.current=null)}},[l]),D.useEffect(()=>{y()},[y]),{data:o,loading:m,error:f,isConnected:N,manualRefresh:S,checkConnection:B}};class tt extends D.Component{constructor(s){super(s);Le(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});Le(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,n){console.error("Chart Error Boundary caught an error:",s,n),this.setState({error:s,errorInfo:n}),this.props.onError&&this.props.onError(s,n),this.logErrorToService(s,n)}logErrorToService(s,n){const a={message:s.message,stack:s.stack,componentStack:n.componentStack,timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent};console.error("Production error captured:",a)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{className:"alert alert-danger m-3",role:"alert",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-2x text-danger me-3"}),e.jsxs("div",{children:[e.jsx("h5",{className:"alert-heading mb-1",children:"Chart Failed to Load"}),e.jsx("p",{className:"mb-0",children:"Something went wrong while rendering this chart."})]})]}),this.state.error&&e.jsx("div",{className:"mb-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Error:"})," ",this.state.error.message]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:this.handleRetry,children:[e.jsx("i",{className:"fas fa-redo me-1"}),"Try Refresh"]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",onClick:this.handleReload,children:[e.jsx("i",{className:"fas fa-sync-alt me-1"}),"Reload Page"]})]}),!1]}):this.props.children}}vs(Me);ws(Me);const Rt=({familyId:b,chartRef:l,dateRange:s})=>{const{data:n,loading:a,error:r,isConnected:o,manualRefresh:t}=et({familyId:b,enableCategories:!0,enableBudgets:!1,enableGoals:!1}),m=n.categoryExpenses||[],d=n.financialSummary,f=(h,c)=>{const i=h.replace("#",""),v=parseInt(i.substr(0,2),16),E=parseInt(i.substr(2,2),16),k=parseInt(i.substr(4,2),16),P=Math.min(255,Math.round(v+(255-v)*c)),R=Math.min(255,Math.round(E+(255-E)*c)),q=Math.min(255,Math.round(k+(255-k)*c));return`#${P.toString(16).padStart(2,"0")}${R.toString(16).padStart(2,"0")}${q.toString(16).padStart(2,"0")}`};if(a)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden"})}),e.jsx("p",{className:"mt-2",children:"Loading family expense data..."}),o&&e.jsxs("small",{className:"text-success d-block mt-1",children:[e.jsx("i",{className:"fas fa-wifi me-1"}),"Real-time updates enabled"]})]});if(r)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x mb-3 text-warning"}),e.jsx("p",{className:"text-danger",children:r}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:t,children:[e.jsx("i",{className:"fas fa-sync-alt me-1"}),"Retry"]}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]}),e.jsxs("small",{className:"text-muted d-block mt-2",children:["Connection status: ",o?"Connected":"Disconnected"]})]});if(!m||m.length===0)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-sitemap fa-3x mb-3"}),e.jsx("p",{children:"No expense data available for the current period"}),e.jsxs("button",{className:"btn btn-sm btn-outline-primary mt-2",onClick:t,children:[e.jsx("i",{className:"fas fa-sync-alt me-1"}),"Refresh Data"]}),o&&e.jsxs("small",{className:"text-success d-block mt-2",children:[e.jsx("i",{className:"fas fa-wifi me-1"}),"Real-time monitoring active"]})]});const p=d?.total_family_expenses||m.reduce((h,c)=>h+c.total_amount,0),N=d?.total_family_income||0,x=d?.budget_utilization||0,u=d?.member_count||1,w=[],g=["#3498db","#27ae60","#f39c12","#e74c3c","#9b59b6","#95a5a6","#34495e","#e67e22","#2ecc71","#8e44ad"];m.forEach((h,c)=>{const i=h.category_color||g[c%g.length];w.push({id:h.category_id,name:h.category_name,color:i,value:h.total_amount,percentage:h.percentage_of_total,transactionCount:h.transaction_count,budget:h.monthly_budget,variance:h.variance,memberContributions:h.family_member_contributions}),h.family_member_contributions.length>1&&h.family_member_contributions.forEach(v=>{v.amount>0&&w.push({name:v.full_name,parent:h.category_id,value:v.amount,color:f(i,.3),percentage:v.percentage})})});const j={chart:{type:"treemap",backgroundColor:"#f8f9fa",borderRadius:10,height:550,style:{fontFamily:"Inter, system-ui, sans-serif"}},title:{text:"Family Budget Allocation Treemap",style:{fontSize:"18px",fontWeight:"600",color:"#2c3e50"}},subtitle:{text:`Monthly Spending Breakdown • ₱${p.toLocaleString()} Total Expenses • ${x.toFixed(1)}% Budget Used${o?" • Live":""}`,style:{fontSize:"12px",color:"#7f8c8d"}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#bdc3c7",borderRadius:8,shadow:!0,formatter:function(){const h=this.point,c=h.value;if(!h.parent){const v=h.percentage||c/p*100,E=N>0?c/N*100:0,k=h.budget,P=h.variance,R=h.transactionCount||0;return`
            <div style="padding: 12px; max-width: 300px;">
              <b style="color: #2c3e50; font-size: 14px;">${h.name}</b><br/>
              <div style="margin: 8px 0;">
                <span style="color: #3498db; font-size: 16px; font-weight: bold;">₱${c.toLocaleString()}</span>
                <span style="font-size: 12px; color: #7f8c8d;"> (${v.toFixed(1)}% of expenses)</span>
              </div>
              ${k?`<div style="font-size: 11px; color: #34495e;">Budget: ₱${k.toLocaleString()}</div>`:""}
              ${P!==void 0?`<div style="font-size: 11px; color: ${P>0?"#e74c3c":"#27ae60"};">Variance: ${P>0?"+":""}₱${P.toLocaleString()}</div>`:""}
              <div style="font-size: 10px; color: #95a5a6; margin-top: 6px;">
                ${R} transaction${R!==1?"s":""} • ${E.toFixed(1)}% of income
              </div>
            </div>
          `}else{const v=h.percentage||0;return`
            <div style="padding: 8px;">
              <b>${h.name}</b><br/>
              <span style="color: #3498db;">₱${c.toLocaleString()}</span>
              <span style="font-size: 11px; color: #7f8c8d;"> (${v.toFixed(1)}% of category)</span>
            </div>
          `}}},plotOptions:{treemap:{layoutAlgorithm:"squarified",dataLabels:{enabled:!0,style:{fontSize:"11px",fontWeight:"600",color:"#ffffff",textOutline:"1px rgba(0,0,0,0.5)"},formatter:function(){const h=this.point;if(!h.parent){const i=h.percentage||h.value/p*100;if(i>=3)return`${h.name}<br/>₱${(h.value/1e3).toFixed(0)}k<br/>(${i.toFixed(1)}%)`}else if((h.percentage||0)>=10)return`${h.name}<br/>₱${(h.value/1e3).toFixed(0)}k`;return""}},borderWidth:2,borderColor:"#ffffff",levelIsConstant:!1,levels:[{level:1,dataLabels:{enabled:!0,style:{fontSize:"13px",fontWeight:"bold"}},borderWidth:3,borderColor:"#ffffff"},{level:2,dataLabels:{enabled:!0,style:{fontSize:"10px",fontWeight:"normal"}},borderWidth:1,borderColor:"#ffffff"}]}},series:[{name:"Budget Allocation",data:w,allowDrillToNode:!0,cursor:"pointer",dataLabels:{enabled:!0}}],credits:{enabled:!1}},M=N>0?(N-p)/N*100:0,y=m.find(h=>h.category_name.toLowerCase().includes("housing")||h.category_name.toLowerCase().includes("rent")||h.category_name.toLowerCase().includes("utilities")),S=N>0&&y?y.total_amount/N*100:0,B=m.filter(h=>{const c=h.category_name.toLowerCase();return c.includes("housing")||c.includes("food")||c.includes("health")||c.includes("utilities")||c.includes("groceries")||c.includes("medical")}).reduce((h,c)=>h+c.total_amount,0),T=N>0?B/N*100:0,Y=m.filter(h=>{const c=h.category_name.toLowerCase();return c.includes("entertainment")||c.includes("shopping")||c.includes("dining")||c.includes("hobby")||c.includes("leisure")||c.includes("travel")}).reduce((h,c)=>h+c.total_amount,0),C=N>0?Y/N*100:0;return e.jsx(tt,{children:e.jsxs("div",{className:"position-relative",children:[e.jsx(Ye,{highcharts:Me,options:j,ref:l}),e.jsx("div",{className:"mt-3 p-3 bg-light rounded",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"text-dark mb-3",children:[e.jsx("i",{className:"fas fa-chart-pie text-primary me-2"}),"Budget Efficiency Analysis"]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block",children:"Housing Ratio"}),e.jsxs("strong",{className:`h6 ${S<=30?"text-success":S<=35?"text-warning":"text-danger"}`,children:[S.toFixed(1),"%"]}),e.jsx("small",{className:"d-block text-muted",children:"Recommended: ≤30%"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block",children:"Necessities"}),e.jsxs("strong",{className:`h6 ${T<=60?"text-success":T<=70?"text-warning":"text-danger"}`,children:[T.toFixed(1),"%"]}),e.jsx("small",{className:"d-block text-muted",children:"Recommended: ≤60%"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block",children:"Discretionary"}),e.jsxs("strong",{className:`h6 ${C<=20?"text-success":C<=30?"text-warning":"text-danger"}`,children:[C.toFixed(1),"%"]}),e.jsx("small",{className:"d-block text-muted",children:"Recommended: ≤20%"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block",children:"Savings Available"}),e.jsxs("strong",{className:`h6 ${M>=20?"text-success":M>=10?"text-warning":"text-danger"}`,children:[M.toFixed(1),"%"]}),e.jsx("small",{className:"d-block text-muted",children:"Target: ≥20%"})]})})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"text-dark mb-3",children:[e.jsx("i",{className:"fas fa-lightbulb text-warning me-2"}),"Family Spending Insights"]}),e.jsxs("ul",{className:"list-unstyled small mb-0",children:[S>35&&e.jsxs("li",{className:"text-danger mb-2",children:[e.jsx("i",{className:"fas fa-home me-2"}),e.jsx("strong",{children:"Housing costs exceed 35% of income"})," - Consider optimization strategies"]}),C>25&&e.jsxs("li",{className:"text-warning mb-2",children:[e.jsx("i",{className:"fas fa-shopping-cart me-2"}),e.jsx("strong",{children:"High discretionary spending"})," - Review entertainment and lifestyle costs"]}),M<10&&e.jsxs("li",{className:"text-danger mb-2",children:[e.jsx("i",{className:"fas fa-piggy-bank me-2"}),e.jsx("strong",{children:"Low savings rate"})," - Focus on reducing largest expense categories"]}),M>=20&&e.jsxs("li",{className:"text-success mb-2",children:[e.jsx("i",{className:"fas fa-star me-2"}),e.jsx("strong",{children:"Excellent financial discipline"})," - Consider increasing investment allocation"]}),m.length>0&&e.jsxs("li",{className:"text-info mb-2",children:[e.jsx("i",{className:"fas fa-users me-2"}),e.jsxs("strong",{children:[u," family member",u!==1?"s":""]})," contributing to ",m.length," expense categories"]}),e.jsxs("li",{className:"text-primary mb-2",children:[e.jsx("i",{className:"fas fa-chart-line me-2"}),e.jsxs("strong",{children:["Budget utilization at ",x.toFixed(1),"%"]})," -",x<80?" Room for strategic spending":x>95?" Near budget limit - monitor closely":" Well-controlled spending"]})]})]})]})})]})})};ht(Me);const Tt=({familyId:b,chartRef:l,period:s="monthly"})=>{const{data:n,loading:a,error:r,isConnected:o,manualRefresh:t}=et({familyId:b,enableCategories:!1,enableBudgets:!0,enableGoals:!1}),m=n.budgetPerformance;if(a)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden"})}),e.jsx("p",{className:"mt-2",children:"Loading budget performance data..."}),o&&e.jsxs("small",{className:"text-success d-block mt-1",children:[e.jsx("i",{className:"fas fa-wifi me-1"}),"Real-time updates enabled"]})]});if(r)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x mb-3 text-warning"}),e.jsx("p",{className:"text-danger",children:r}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:t,children:[e.jsx("i",{className:"fas fa-sync-alt me-1"}),"Retry"]}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]}),e.jsxs("small",{className:"text-muted d-block mt-2",children:["Connection status: ",o?"Connected":"Disconnected"]})]});if(!m)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-tachometer-alt fa-3x mb-3"}),e.jsx("p",{children:"No performance data available"})]});const{total_family_income:d=0,total_family_expenses:f=0,budget_utilization:p=0,savings_rate:N=0,family_financial_health:x=0,budget_efficiency:u=0,member_count:w=0}=m||{},g=d>0?f/d*100:0,j=typeof N=="number"&&!isNaN(N)?N:0,M=typeof p=="number"&&!isNaN(p)?p:0,y=typeof x=="number"&&!isNaN(x)?x:0,S=typeof u=="number"&&!isNaN(u)?u:0,B=d-f;if(!(d>0||f>0||M>0))return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-chart-line fa-3x mb-3"}),e.jsx("h5",{className:"text-muted mb-3",children:"No Budget Data Available"}),e.jsx("p",{className:"mb-3",children:"No budget or transaction data found for your family during the current period."}),e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-md-8",children:e.jsx("div",{className:"card border-0 bg-light",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("h6",{className:"text-primary mb-2",children:[e.jsx("i",{className:"fas fa-lightbulb me-2"}),"Get Started with Family Budgeting"]}),e.jsxs("ul",{className:"list-unstyled small mb-0 text-start",children:[e.jsxs("li",{className:"mb-1",children:[e.jsx("i",{className:"fas fa-plus-circle text-success me-2"}),"Create family budgets for different expense categories"]}),e.jsxs("li",{className:"mb-1",children:[e.jsx("i",{className:"fas fa-receipt text-info me-2"}),"Add family transactions and income records"]}),e.jsxs("li",{children:[e.jsx("i",{className:"fas fa-chart-bar text-warning me-2"}),"Track spending patterns and budget performance"]})]})]})})})}),e.jsxs("button",{className:"btn btn-primary mt-3 me-2",onClick:t,children:[e.jsx("i",{className:"fas fa-sync-alt me-1"}),"Refresh Data"]}),o&&e.jsxs("small",{className:"text-success d-block mt-3",children:[e.jsx("i",{className:"fas fa-wifi me-1"}),"Real-time monitoring active - data will update automatically"]})]});const Y=v=>isNaN(v)||v===0?{grade:"N/A",color:"#95a5a6",description:"No Data"}:v>=90?{grade:"A+",color:"#1cc88a",description:"Healthy"}:v>=75?{grade:"A",color:"#36b9cc",description:"On Track"}:v>=50?{grade:"B",color:"#f6c23e",description:"Getting Started"}:{grade:"C",color:"#e74a3b",description:"Just Beginning"},C=Y(y),h=Y(Math.min(100,j*5)),c=Y(S),i={chart:{type:"solidgauge",height:"400px",backgroundColor:"transparent",margin:[0,0,0,0]},title:{text:"Family Financial Performance Dashboard",style:{fontSize:"18px",fontWeight:"bold",color:"#5a5c69"},y:40},pane:{center:["50%","70%"],size:"80%",startAngle:-90,endAngle:90,background:{backgroundColor:"#f8f9fc",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},tooltip:{enabled:!0,backgroundColor:"rgba(255, 255, 255, 0.95)",borderWidth:1,borderRadius:8,shadow:!0,useHTML:!0,formatter:function(){return`
          <div style="padding: 10px;">
            <strong>Family Financial Performance Analysis</strong><br/>
            <strong>Overall Score:</strong> ${Math.round(y)}/100<br/>
            <strong>Status:</strong> ${C.description}<br/><br/>
            <strong>Component Breakdown:</strong><br/>
            • Savings Rate: ${j.toFixed(1)}%<br/>
            • Budget Efficiency: ${S.toFixed(0)}%<br/>
            • Budget Utilization: ${M.toFixed(1)}%<br/>
          </div>
        `}},yAxis:{min:0,max:100,title:{text:"",style:{fontSize:"16px",fontWeight:"bold",color:C.color,textShadow:"1px 1px 2px rgba(0,0,0,0.3)"},y:60},lineWidth:0,tickWidth:0,minorTickInterval:null,tickAmount:2,labels:{y:16,style:{fontSize:"12px"}}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0,style:{fontSize:"20px",fontWeight:"bold",color:"white"},format:'<div style="text-align:center"><div style="background: linear-gradient(135deg, '+C.color+" 0%, "+C.color+'dd 100%);color:white;padding:12px 16px;border-radius:20px;font-weight:600;box-shadow:0 8px 25px rgba(0,0,0,0.15), 0 3px 10px rgba(0,0,0,0.1);display:inline-block;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);transform:perspective(1px) translateZ(0);"><div style="font-size:24px;line-height:0.9;font-weight:700;margin-bottom:2px;text-shadow:0 1px 2px rgba(0,0,0,0.2)">{y}</div><div style="font-size:10px;line-height:1;opacity:0.9;font-weight:500;letter-spacing:0.5px;text-transform:uppercase">out of 100</div></div></div>'},animation:{duration:1500}}},series:[{name:"Financial Health",data:[{y:Math.round(y),color:C.color}],tooltip:{valueSuffix:" points"}}],credits:{enabled:!1}};return e.jsx(tt,{children:e.jsxs("div",{className:"position-relative",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx(Ye,{highcharts:Me,options:i,ref:l}),e.jsxs("div",{className:"text-center mt-2",children:[e.jsx("div",{className:"text-xs font-weight-bold text-gray-500 text-uppercase mb-1",children:"FINANCIAL HEALTH STATUS"}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3 mb-4",children:e.jsxs("div",{style:{backgroundColor:"#1cc88a",borderRadius:"8px",height:"100%",padding:"15px",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{className:"text-white font-weight-bold mb-1",style:{fontSize:"0.9rem"},children:"Healthy"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"90-100%"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"progress"})]})}),e.jsx("div",{className:"col-md-3 mb-4",children:e.jsxs("div",{style:{backgroundColor:"#36b9cc",borderRadius:"8px",height:"100%",padding:"15px",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{className:"text-white font-weight-bold mb-1",style:{fontSize:"0.9rem"},children:"On Track"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"75-89%"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"progress"})]})}),e.jsx("div",{className:"col-md-3 mb-4",children:e.jsxs("div",{style:{backgroundColor:"#f6c23e",borderRadius:"8px",height:"100%",padding:"15px",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{className:"text-white font-weight-bold mb-1",style:{fontSize:"0.9rem"},children:"Getting"}),e.jsx("div",{className:"text-white font-weight-bold mb-1",style:{fontSize:"0.9rem"},children:"Started"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"50-74%"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"progress"})]})}),e.jsx("div",{className:"col-md-3 mb-4",children:e.jsxs("div",{style:{backgroundColor:"#e74a3b",borderRadius:"8px",height:"100%",padding:"15px",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsx("div",{className:"text-white font-weight-bold mb-1",style:{fontSize:"0.9rem"},children:"Just"}),e.jsx("div",{className:"text-white font-weight-bold mb-1",style:{fontSize:"0.9rem"},children:"Beginning"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"0-49%"}),e.jsx("div",{className:"text-white",style:{opacity:.7,fontSize:"0.75rem"},children:"progress"})]})})]})]})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row h-100",children:[e.jsx("div",{className:"col-12 mb-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"card-title mb-1 text-muted",children:"Savings Rate"}),e.jsxs("h4",{className:"mb-0",style:{color:h.color},children:[j.toFixed(1),"%",e.jsx("span",{className:"ms-2 badge",style:{backgroundColor:h.color+"20",color:h.color},children:h.grade})]}),e.jsx("small",{className:"text-muted",children:h.description})]}),e.jsx("div",{className:"text-end",children:e.jsx("i",{className:"fas fa-piggy-bank fa-2x",style:{color:h.color}})})]}),e.jsx("div",{className:"progress mt-2",style:{height:"4px"},children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,j*5)}%`,backgroundColor:h.color}})})]})})}),e.jsx("div",{className:"col-12 mb-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"card-title mb-1 text-muted",children:"Budget Efficiency"}),e.jsxs("h4",{className:"mb-0",style:{color:c.color},children:[S.toFixed(0),"%",e.jsx("span",{className:"ms-2 badge",style:{backgroundColor:c.color+"20",color:c.color},children:c.grade})]}),e.jsx("small",{className:"text-muted",children:c.description})]}),e.jsx("div",{className:"text-end",children:e.jsx("i",{className:"fas fa-chart-line fa-2x",style:{color:c.color}})})]}),e.jsx("div",{className:"progress mt-2",style:{height:"4px"},children:e.jsx("div",{className:"progress-bar",style:{width:`${S}%`,backgroundColor:c.color}})})]})})}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"card-title mb-1 text-muted",children:"Budget Utilization"}),e.jsxs("h4",{className:"mb-0 text-primary",children:[M.toFixed(1),"%",e.jsx("span",{className:"ms-2 badge bg-primary bg-opacity-10 text-primary",children:M<=80?"Controlled":M<=95?"On Track":"Critical"})]}),e.jsx("small",{className:"text-muted",children:M<=80?"Room for strategic spending":M>95?"Near budget limit - monitor closely":"Well-controlled spending"})]}),e.jsx("div",{className:"text-end",children:e.jsx("i",{className:"fas fa-bullseye fa-2x text-primary"})})]}),e.jsx("div",{className:"progress mt-2",style:{height:"4px"},children:e.jsx("div",{className:"progress-bar bg-primary",style:{width:`${Math.min(100,M)}%`}})})]})})})]})})]}),e.jsx("div",{className:"mt-4 p-3 bg-light rounded",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h6",{className:"text-dark mb-3",children:[e.jsx("i",{className:"fas fa-analytics text-primary me-2"}),"Performance Analysis & Recommendations"]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"text-success mb-2",children:"Strengths"}),e.jsxs("ul",{className:"list-unstyled small mb-0",children:[N>=15&&e.jsxs("li",{className:"text-success mb-1",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Excellent savings discipline (",N.toFixed(1),"%)"]}),p>=70&&p<=90&&e.jsxs("li",{className:"text-success mb-1",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Optimal budget utilization (",p.toFixed(1),"%)"]}),d>0&&e.jsxs("li",{className:"text-success mb-1",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Active income tracking with ₱",d.toLocaleString()," monthly"]}),(d-f)/d<=.7&&e.jsxs("li",{className:"text-success mb-1",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Conservative spending habits"]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"text-warning mb-2",children:"Improvement Areas"}),e.jsxs("ul",{className:"list-unstyled small mb-0",children:[N<10&&e.jsxs("li",{className:"text-danger mb-1",children:[e.jsx("i",{className:"fas fa-exclamation-triangle me-2"}),"Increase savings rate to 10%+ (currently ",N.toFixed(1),"%)"]}),p>95&&e.jsxs("li",{className:"text-warning mb-1",children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),"Budget nearly exhausted - monitor spending closely"]}),u<70&&e.jsxs("li",{className:"text-warning mb-1",children:[e.jsx("i",{className:"fas fa-chart-line me-2"}),"Budget efficiency could be improved - review allocations"]}),f/d>.8&&e.jsxs("li",{className:"text-warning mb-1",children:[e.jsx("i",{className:"fas fa-chart-line me-2"}),"High expense ratio - review spending categories"]})]})]})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("h6",{className:"text-dark mb-3",children:[e.jsx("i",{className:"fas fa-trophy text-warning me-2"}),"Performance Metrics"]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"small text-dark",children:"Financial Health:"}),e.jsxs("span",{className:"badge text-white",style:{backgroundColor:C.color},children:[C.grade," (",y.toFixed(0),"/100)"]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"small text-dark",children:"Expense Control:"}),e.jsx("span",{className:`badge text-white ${g<=70?"bg-success":g<=80?"bg-warning":"bg-danger"}`,children:isNaN(g)?"N/A":`${g.toFixed(1)}% of income`})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"small text-dark",children:"Budget Usage:"}),e.jsx("span",{className:`badge text-white ${M<=80?"bg-success":M<=95?"bg-warning":"bg-danger"}`,children:isNaN(M)?"N/A":`${M.toFixed(1)}% utilized`})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"small text-dark",children:"Monthly Surplus:"}),e.jsx("span",{className:`badge text-white ${B>0?"bg-success":"bg-danger"}`,children:isNaN(B)?"N/A":`₱${Math.abs(B).toLocaleString()}`})]})]})]})})]})})},Ue=({title:b,value:l,subtitle:s,icon:n,color:a,badge:r,progressValue:o,progressColor:t,className:m=""})=>e.jsx("div",{className:`card border-0 shadow-sm h-100 ${m}`,children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"card-title mb-1 text-muted",style:{fontSize:"14px",fontWeight:"600",color:"#5a5c69"},children:b}),e.jsxs("h4",{className:"mb-0",style:{color:a,fontSize:"24px",fontWeight:"bold"},children:[l,r&&e.jsx("span",{className:"ms-2 badge",style:{backgroundColor:r.color+"20",color:r.color,fontSize:"10px",fontWeight:"600"},children:r.text})]}),s&&e.jsx("small",{className:"text-muted",style:{fontSize:"12px"},children:s})]}),e.jsx("div",{className:"text-end",children:e.jsx("i",{className:`${n} fa-2x`,style:{color:a}})})]}),o!==void 0&&e.jsx("div",{className:"progress mt-2",style:{height:"4px"},children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,Math.max(0,o))}%`,backgroundColor:t||a}})})]})});ht(Me);const ie={progress:{excellent:"#1cc88a",good:"#4e73df",fair:"#f6c23e",poor:"#e74a3b"},status:{completed:"#1cc88a",in_progress:"#4e73df",not_started:"#f6c23e"},semantic:{success:"#1cc88a",warning:"#f6c23e",info:"#4e73df"},background:{light:"#f8f9fc",transparent:"transparent"}},Xe=b=>b>=90?ie.progress.excellent:b>=75?ie.progress.good:b>=50?ie.progress.fair:ie.progress.poor,Pt=b=>b>=90?{grade:"A+",color:ie.progress.excellent,description:"Excellent"}:b>=80?{grade:"A",color:ie.progress.good,description:"Good"}:b>=70?{grade:"B+",color:ie.progress.good,description:"Good"}:b>=60?{grade:"B",color:ie.progress.fair,description:"Fair"}:b>=50?{grade:"C",color:ie.progress.fair,description:"Fair"}:{grade:"D",color:ie.progress.poor,description:"Needs Improvement"},Cs={chart:{backgroundColor:ie.background.transparent,borderRadius:10,height:400,style:{fontFamily:"Inter, system-ui, sans-serif"}}};({...Cs.chart});const ks=b=>{const{goalCommitmentScore:l=0,financialHealthScore:s=0,expenseControlScore:n=0,savingsDisciplineScore:a=0,budgetPlanningScore:r=0}=b,o=Math.round(l*.3+s*.25+n*.2+a*.15+r*.1);return Ss(o)},Ss=b=>b>=90?{score:b,status:"Excellent",color:"#1cc88a",description:"Your family financial health is excellent"}:b>=75?{score:b,status:"Good",color:"#4e73df",description:"Your family financial health is good"}:b>=50?{score:b,status:"Fair",color:"#f6c23e",description:"Your family financial health needs attention"}:{score:b,status:"Needs Improvement",color:"#e74a3b",description:"Your family financial health needs significant improvement"},Ms=b=>{if(!b||b.length===0)return{totalGoals:0,activeGoals:0,completedGoals:0,progressPercentage:0,allocationRate:0};const l=b.length,s=b.filter(m=>m.status==="in_progress"||m.status==="not_started").length,n=b.filter(m=>m.status==="completed").length,a=b.reduce((m,d)=>m+(d.target_amount||0),0),r=b.reduce((m,d)=>m+(d.current_amount||0),0),o=a>0?r/a*100:0,t=b.reduce((m,d)=>d.family_contributions&&Array.isArray(d.family_contributions)?m+d.family_contributions.reduce((f,p)=>f+(p.amount||0),0):m,0);return{totalGoals:l,activeGoals:s,completedGoals:n,progressPercentage:Math.round(o*10)/10,allocationRate:t}},Fs=b=>{const{totalGoals:l,activeGoals:s,progressPercentage:n}=b;let a=0;return l>=5?a+=30:l>=3?a+=20:l>=1&&(a+=10),s>=3?a+=30:s>=2?a+=20:s>=1&&(a+=10),n>=75?a+=40:n>=50?a+=30:n>=25?a+=20:n>0&&(a+=10),a>=80?{level:"Excellent",score:a,color:"#1cc88a"}:a>=60?{level:"Good",score:a,color:"#4e73df"}:a>=40?{level:"Fair",score:a,color:"#f6c23e"}:{level:"Needs Improvement",score:a,color:"#e74a3b"}},Lt=({familyId:b,chartRef:l})=>{const{data:s,loading:n,error:a,isConnected:r}=et({familyId:b,enableCategories:!1,enableBudgets:!1,enableGoals:!0}),o=s.goalProgress||[],t=s.financialSummary;if(n)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden"})}),e.jsx("p",{className:"mt-2",children:"Loading goal progress data..."})]});if(a)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x mb-3 text-warning"}),e.jsx("p",{className:"text-danger",children:a}),e.jsx("button",{className:"btn btn-sm btn-outline-primary mt-2",onClick:()=>window.location.reload(),children:"Retry"})]});if(!o||o.length===0)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-chart-waterfall fa-3x mb-3"}),e.jsx("p",{children:"No family goals found"}),e.jsx("small",{className:"text-muted",children:"Create your first family goal to see progress analysis"})]});const m=t?.total_family_income||0;t?.total_family_expenses,t?.member_count,Ms(o);const d=o.filter(y=>y.status==="in_progress"||y.status==="not_started"),f=o.filter(y=>y.status==="completed"),p=o.reduce((y,S)=>y+S.target_amount,0),N=o.reduce((y,S)=>y+S.current_amount,0),x=o.reduce((y,S)=>y+S.family_contributions.reduce((B,T)=>B+T.amount,0),0),u=p>0?N/p*100:0,w=m>0?x/m*100:0,g=Pt(u),j=Pt(w*5),M={chart:{type:"bar",backgroundColor:ie.background.transparent,borderRadius:10,height:400,style:{fontFamily:"Inter, system-ui, sans-serif"}},title:{text:"Goal Progress Overview",style:{fontSize:"18px",fontWeight:"600",color:"#5a5c69"}},subtitle:{text:`${d.length} Active • ${f.length} Completed${r?" • Live":""}`,style:{fontSize:"12px",color:"#858796"}},xAxis:{categories:o.slice(0,5).map(y=>y.goal_name.length>15?y.goal_name.substring(0,15)+"...":y.goal_name),title:{text:null},labels:{style:{fontSize:"11px",color:"#5a5c69"}}},yAxis:{title:{text:"Progress %",style:{fontSize:"12px",color:"#5a5c69"}},max:100,labels:{formatter:function(){return this.value+"%"},style:{fontSize:"11px",color:"#5a5c69"}},gridLineWidth:1,gridLineColor:"#e3e6f0"},legend:{enabled:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e3e6f0",borderRadius:8,shadow:!0,formatter:function(){const y=this.point,S=o.find(B=>B.goal_name.startsWith(y.category.replace("...","")));return S?`
          <div style="padding: 8px;">
            <b>${S.goal_name}</b><br/>
            <span style="color: ${Xe(S.progress_percentage)};">Progress: ${S.progress_percentage.toFixed(1)}%</span><br/>
            <span style="font-size: 10px; color: #858796;">₱${S.current_amount.toLocaleString()} / ₱${S.target_amount.toLocaleString()}</span><br/>
            <span style="font-size: 10px; color: #858796;">Priority: ${S.priority}</span>
          </div>
        `:""}},plotOptions:{bar:{dataLabels:{enabled:!0,formatter:function(){return this.y.toFixed(1)+"%"},style:{fontSize:"10px",fontWeight:"600",color:"#5a5c69"}},borderWidth:0,pointPadding:.3,groupPadding:.1}},series:[{name:"Progress",data:o.slice(0,5).map(y=>({y:y.progress_percentage,color:Xe(y.progress_percentage)}))}],credits:{enabled:!1}};return e.jsx(tt,{children:e.jsxs("div",{className:"position-relative family-dashboard-charts chart-loading",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6 col-md-12 mb-3 mb-lg-0",children:e.jsx("div",{style:{backgroundColor:ie.background.light,borderRadius:"10px",padding:"15px",height:"400px"},className:"responsive-chart-container",children:e.jsx(Ye,{highcharts:Me,options:{...M,responsive:{rules:[{condition:{maxWidth:768},chartOptions:{chart:{height:300},title:{style:{fontSize:"16px"}},plotOptions:{bar:{dataLabels:{style:{fontSize:"9px"}}}}}}]}},ref:l})})}),e.jsx("div",{className:"col-lg-6 col-md-12",children:e.jsxs("div",{className:"row h-100",children:[e.jsx("div",{className:"col-12 mb-3",children:e.jsx(Ue,{title:"Overall Progress",value:`${u.toFixed(1)}%`,subtitle:g.description,icon:"fas fa-bullseye",color:g.color,badge:{text:g.grade,color:g.color},progressValue:u,progressColor:g.color,className:"responsive-kpi-card"})}),e.jsx("div",{className:"col-12 mb-3",children:e.jsx(Ue,{title:"Active Goals",value:`${d.length} / ${o.length}`,subtitle:d.length>0?"Goals in progress":"No active goals",icon:"fas fa-flag-checkered",color:d.length>0?ie.semantic.info:ie.semantic.warning,badge:{text:d.length>2?"High Activity":d.length>0?"Moderate":"Low Activity",color:d.length>2?ie.semantic.success:d.length>0?ie.semantic.info:ie.semantic.warning},progressValue:o.length>0?d.length/o.length*100:0,className:"responsive-kpi-card"})}),e.jsx("div",{className:"col-12",children:e.jsx(Ue,{title:"Goal Allocation Rate",value:`${w.toFixed(1)}%`,subtitle:j.description,icon:"fas fa-chart-line",color:j.color,badge:{text:j.grade,color:j.color},progressValue:Math.min(100,w*5),progressColor:j.color,className:"responsive-kpi-card"})})]})})]}),d.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-light rounded",children:[e.jsxs("h6",{className:"text-dark mb-3",children:[e.jsx("i",{className:"fas fa-bullseye text-primary me-2"}),"Active Goal Progress"]}),e.jsx("div",{className:"row",children:d.slice(0,4).map((y,S)=>e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx("div",{className:"card border-0 bg-white",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx("h6",{className:"card-title mb-1 text-truncate",title:y.goal_name,children:y.goal_name}),e.jsx("span",{className:`badge text-white ${y.priority==="high"?"bg-danger":y.priority==="medium"?"bg-warning":"bg-secondary"}`,children:y.priority})]}),e.jsx("div",{className:"progress mb-2",style:{height:"8px"},children:e.jsx("div",{className:"progress-bar",style:{width:`${Math.min(100,y.progress_percentage)}%`,backgroundColor:Xe(y.progress_percentage)}})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("small",{className:"text-muted",children:["₱",y.current_amount.toLocaleString()," / ₱",y.target_amount.toLocaleString()]}),e.jsxs("small",{className:"fw-bold",style:{color:Xe(y.progress_percentage)},children:[y.progress_percentage.toFixed(1),"%"]})]}),y.days_remaining!==null&&y.days_remaining>0&&e.jsxs("small",{className:"text-muted d-block mt-1",children:[e.jsx("i",{className:"fas fa-calendar me-1"}),y.days_remaining," days remaining"]})]})})},y.goal_id))})]}),r&&e.jsxs("small",{className:"text-success d-block mt-2 text-center",children:[e.jsx("i",{className:"fas fa-wifi me-1"}),"Real-time updates active"]})]})})};ht(Me);const $t=({familyId:b,chartRef:l})=>{const{data:s,loading:n,error:a,isConnected:r,manualRefresh:o}=et({familyId:b,enableCategories:!1,enableBudgets:!1,enableGoals:!0}),t=s.goalCommitment,m=s.financialSummary?.healthMetrics,[d,f]=D.useState([]);if(D.useEffect(()=>{async function j(){if(!(!b||!t))try{const M=[{status_category:"in_progress",goal_count:t.active_goals,total_target_value:0,total_current_value:0,average_progress:0,status_color:"#007bff",commitment_insights:{total_goals:t.total_goals,active_goal_count:t.active_goals,commitment_level:t.commitment_level,goal_commitment_score:t.overall_score,goal_diversity:t.goal_categories,completion_rate:t.total_goals>0?t.completed_goals/t.total_goals*100:0,average_days_to_completion:t.average_completion_days,planning_discipline_score:Math.min(100,t.total_goals*20)}},{status_category:"completed",goal_count:t.completed_goals,total_target_value:0,total_current_value:0,average_progress:100,status_color:"#28a745",commitment_insights:{total_goals:t.total_goals,active_goal_count:t.active_goals,commitment_level:t.commitment_level,goal_commitment_score:t.overall_score,goal_diversity:t.goal_categories,completion_rate:t.total_goals>0?t.completed_goals/t.total_goals*100:0,average_days_to_completion:t.average_completion_days,planning_discipline_score:Math.min(100,t.total_goals*20)}}];f(M)}catch(M){console.error("Error creating goal status data:",M)}}j()},[b,t]),n)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden"})}),e.jsx("p",{className:"mt-2",children:"Loading goal breakdown data..."})]});if(a)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x mb-3 text-warning"}),e.jsx("p",{className:"text-danger",children:a}),e.jsx("button",{className:"btn btn-sm btn-outline-primary mt-2",onClick:()=>window.location.reload(),children:"Retry"})]});if(!t||t.total_goals===0)return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-bullseye fa-3x mb-3"}),e.jsx("h5",{className:"text-muted mb-3",children:"No Family Goals Found"}),e.jsx("p",{className:"mb-3",children:"Your family hasn't set any financial goals yet. Start planning your financial future!"}),e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-md-8",children:e.jsx("div",{className:"card border-0 bg-light",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("h6",{className:"text-primary mb-2",children:[e.jsx("i",{className:"fas fa-lightbulb me-2"}),"Get Started with Family Goals"]}),e.jsxs("ul",{className:"list-unstyled small mb-0 text-start",children:[e.jsxs("li",{className:"mb-1",children:[e.jsx("i",{className:"fas fa-home text-success me-2"}),"Create an emergency fund goal for financial security"]}),e.jsxs("li",{className:"mb-1",children:[e.jsx("i",{className:"fas fa-plane text-info me-2"}),"Plan for family vacations and experiences"]}),e.jsxs("li",{className:"mb-1",children:[e.jsx("i",{className:"fas fa-graduation-cap text-warning me-2"}),"Save for children's education and future"]}),e.jsxs("li",{children:[e.jsx("i",{className:"fas fa-car text-primary me-2"}),"Set goals for major purchases like vehicles or home improvements"]})]})]})})})}),e.jsxs("button",{className:"btn btn-primary mt-3 me-2",onClick:o,children:[e.jsx("i",{className:"fas fa-sync-alt me-1"}),"Refresh Data"]}),r&&e.jsxs("small",{className:"text-success d-block mt-3",children:[e.jsx("i",{className:"fas fa-wifi me-1"}),"Real-time monitoring active - goal updates will appear automatically"]})]});const p=ks({goalCommitmentScore:t?.overall_score||0,financialHealthScore:m?.financial_health_score||0,expenseControlScore:m?.expense_control_score||0,savingsDisciplineScore:m?.savings_discipline_score||0,budgetPlanningScore:m?.budget_planning_score||0}),N=Fs({totalGoals:t.total_goals,activeGoals:t.active_goals,completedGoals:t.completed_goals,progressPercentage:t.total_goals>0?t.completed_goals/t.total_goals*100:0}),x=t?.average_completion_days||0,u=x>0&&x<=90?Math.max(0,100-(x-30)):x===0?50:Math.max(0,100-x/2);if(!((t?.overall_score||0)>0||(m?.financial_health_score||0)>0||(m?.expense_control_score||0)>0||(m?.savings_discipline_score||0)>0||(m?.budget_planning_score||0)>0||t.total_goals>0))return e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-chart-pie fa-3x mb-3"}),e.jsx("h5",{className:"text-muted mb-3",children:"No Goal Data Available"}),e.jsx("p",{className:"mb-3",children:"Start setting family goals and tracking expenses to see your financial health score."}),e.jsxs("button",{className:"btn btn-primary mt-3",onClick:o,children:[e.jsx("i",{className:"fas fa-sync-alt me-1"}),"Refresh Data"]})]});const g={chart:{type:"pie",backgroundColor:ie.background.transparent,height:400,style:{fontFamily:"Inter, system-ui, sans-serif"}},title:{text:"Goals by Status",style:{fontSize:"18px",fontWeight:"600",color:"#5a5c69"}},subtitle:{text:`${t.total_goals} Total Goals${r?" • Live":""}`,style:{fontSize:"12px",color:"#858796"}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",borderWidth:1,borderRadius:8,shadow:!0,formatter:function(){const j=this.point;return`
          <div style="padding: 10px;">
            <strong>${j.name}</strong><br/>
            <span style="color: ${j.color};">Count: ${j.y}</span><br/>
            <span style="font-size: 10px; color: #858796;">Percentage: ${j.percentage.toFixed(1)}%</span>
          </div>
        `}},plotOptions:{pie:{innerSize:"40%",dataLabels:{enabled:!0,format:"{point.name}<br>{point.percentage:.1f}%",style:{fontSize:"11px",fontWeight:"600",color:"#5a5c69"}},showInLegend:!1}},series:[{name:"Goals",data:[{name:"Completed",y:t.completed_goals,color:ie.status.completed},{name:"In Progress",y:t.active_goals,color:ie.status.in_progress},{name:"Not Started",y:Math.max(0,t.total_goals-t.completed_goals-t.active_goals),color:ie.status.not_started}].filter(j=>j.y>0)}],credits:{enabled:!1}};return e.jsx(tt,{children:e.jsxs("div",{className:"position-relative family-dashboard-charts chart-loading",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6 col-md-12 mb-3 mb-lg-0",children:e.jsx("div",{style:{backgroundColor:ie.background.light,borderRadius:"10px",padding:"15px",height:"400px"},className:"responsive-chart-container",children:e.jsx(Ye,{highcharts:Me,options:{...g,responsive:{rules:[{condition:{maxWidth:768},chartOptions:{chart:{height:300},title:{style:{fontSize:"16px"}},plotOptions:{pie:{dataLabels:{style:{fontSize:"10px"}}}}}}]}},ref:l})})}),e.jsx("div",{className:"col-lg-6 col-md-12",children:e.jsxs("div",{className:"row h-100",children:[e.jsx("div",{className:"col-12 mb-3",children:e.jsx(Ue,{title:"Financial Health Score",value:`${p.score}/100`,subtitle:p.description,icon:"fas fa-heartbeat",color:p.color,badge:{text:p.status,color:p.color},progressValue:p.score,progressColor:p.color,className:"responsive-kpi-card"})}),e.jsx("div",{className:"col-12 mb-3",children:e.jsx(Ue,{title:"Goal Commitment Level",value:N.level,subtitle:`Score: ${N.score}/100`,icon:"fas fa-medal",color:N.color,badge:{text:`${N.score}/100`,color:N.color},progressValue:N.score,progressColor:N.color,className:"responsive-kpi-card"})}),e.jsx("div",{className:"col-12",children:e.jsx(Ue,{title:"Completion Efficiency",value:`${Math.round(u)}%`,subtitle:x>0?`Avg: ${x} days`:"No data yet",icon:"fas fa-stopwatch",color:u>=75?ie.progress.excellent:u>=50?ie.progress.good:ie.progress.fair,badge:{text:u>=75?"Fast":u>=50?"Moderate":"Slow",color:u>=75?ie.progress.excellent:u>=50?ie.progress.good:ie.progress.fair},progressValue:u,progressColor:u>=75?ie.progress.excellent:u>=50?ie.progress.good:ie.progress.fair,className:"responsive-kpi-card"})})]})})]}),t&&e.jsxs("div",{className:"mt-4 p-3 bg-light rounded",children:[e.jsxs("h6",{className:"text-dark mb-3",children:[e.jsx("i",{className:"fas fa-bullseye text-primary me-2"}),"Goal Commitment Analysis"]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:t&&t.total_goals>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"small text-muted",children:"Commitment Level:"}),e.jsx("span",{className:"badge",style:{backgroundColor:N.color+"20",color:N.color},children:t.commitment_level})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"small text-muted",children:"Active Goals:"}),e.jsx("strong",{className:"text-primary",children:t.active_goals})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"small text-muted",children:"Completed Goals:"}),e.jsx("strong",{className:"text-success",children:t.completed_goals})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"small text-muted",children:"Goal Categories:"}),e.jsx("strong",{className:"text-info",children:t.goal_categories})]})]})}),e.jsx("div",{className:"col-md-6",children:t&&t.strengths&&t.strengths.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{className:"text-success mb-2",children:[e.jsx("i",{className:"fas fa-check-circle me-1"}),"Strengths"]}),e.jsx("ul",{className:"list-unstyled small",children:t.strengths.slice(0,3).map((j,M)=>e.jsxs("li",{className:"text-success mb-1",children:[e.jsx("i",{className:"fas fa-star me-1"}),j]},M))})]})})]}),t&&t.recommendations&&t.recommendations.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-top",children:[e.jsxs("h6",{className:"text-info mb-2",children:[e.jsx("i",{className:"fas fa-lightbulb me-1"}),"Recommendations"]}),e.jsx("ul",{className:"list-unstyled small",children:t.recommendations.slice(0,3).map((j,M)=>e.jsxs("li",{className:"text-info mb-1",children:[e.jsx("i",{className:"fas fa-arrow-right me-1"}),j]},M))})]})]}),r&&e.jsxs("small",{className:"text-success d-block mt-2 text-center",children:[e.jsx("i",{className:"fas fa-wifi me-1"}),"Real-time updates active"]})]})})},ot=({data:b,chartRef:l})=>b?e.jsx(Ye,{highcharts:Me,options:b,ref:l}):e.jsxs("div",{className:"text-center text-muted p-4",children:[e.jsx("i",{className:"fas fa-chart-line fa-3x mb-3"}),e.jsx("p",{children:"No contribution data available"})]}),Ds=({chartData:b,familyId:l,expenseChartRef:s,budgetChartRef:n,goalChartRef:a,goalBreakdownChartRef:r,toggleTip:o,refreshKey:t})=>{const[m,d]=D.useState("expenses");return e.jsxs("div",{className:"animate__animated animate__fadeIn",children:[e.jsxs("div",{className:"block md:hidden",children:[e.jsxs("div",{className:"flex bg-slate-50 rounded-xl mb-3 p-1",children:[e.jsxs("button",{onClick:()=>d("expenses"),className:`flex-1 py-2 text-[10px] font-semibold rounded-lg transition-all ${m==="expenses"?"bg-white text-indigo-600 shadow-sm":"text-gray-500"}`,children:[e.jsx("i",{className:"fas fa-chart-pie mr-1 text-[9px]"}),"Expenses"]}),e.jsxs("button",{onClick:()=>d("budget"),className:`flex-1 py-2 text-[10px] font-semibold rounded-lg transition-all ${m==="budget"?"bg-white text-indigo-600 shadow-sm":"text-gray-500"}`,children:[e.jsx("i",{className:"fas fa-chart-bar mr-1 text-[9px]"}),"Budget"]}),e.jsxs("button",{onClick:()=>d("goals"),className:`flex-1 py-2 text-[10px] font-semibold rounded-lg transition-all ${m==="goals"?"bg-white text-indigo-600 shadow-sm":"text-gray-500"}`,children:[e.jsx("i",{className:"fas fa-flag mr-1 text-[9px]"}),"Progress"]}),e.jsxs("button",{onClick:()=>d("breakdown"),className:`flex-1 py-2 text-[10px] font-semibold rounded-lg transition-all ${m==="breakdown"?"bg-white text-indigo-600 shadow-sm":"text-gray-500"}`,children:[e.jsx("i",{className:"fas fa-tasks mr-1 text-[9px]"}),"Status"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:`fas fa-${m==="expenses"?"chart-pie":m==="budget"?"chart-bar":m==="goals"?"flag-checkered":"tasks"} text-indigo-500 text-[10px]`}),m==="expenses"?"Family Expense Categories":m==="budget"?"Budget vs Actual":m==="goals"?"Goals Progress":"Goals by Status"]}),e.jsx("button",{onClick:f=>o(m==="expenses"?"expense-categories":m==="budget"?"budget-performance":m==="goals"?"goal-progress":"goal-breakdown",f),className:"w-5 h-5 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-info text-gray-400 text-[8px]"})})]}),e.jsxs("div",{className:"p-3",children:[m==="expenses"&&e.jsx("div",{className:"animate__animated animate__fadeIn",children:e.jsx(Rt,{familyId:l,chartRef:s},`category-mobile-${t}`)}),m==="budget"&&e.jsx("div",{className:"animate__animated animate__fadeIn",children:e.jsx(Tt,{familyId:l,chartRef:n},`budget-mobile-${t}`)}),m==="goals"&&e.jsx("div",{className:"animate__animated animate__fadeIn",children:e.jsx(Lt,{familyId:l,chartRef:a},`goal-performance-mobile-${t}`)}),m==="breakdown"&&e.jsx("div",{className:"animate__animated animate__fadeIn",children:e.jsx($t,{familyId:l,chartRef:r},`goal-breakdown-mobile-${t}`)})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-indigo-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-flag-checkered text-indigo-500 text-[10px]"})}),e.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"Total Goals"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-800",children:b.familyGoalsCount})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-percentage text-emerald-500 text-[10px]"})}),e.jsx("span",{className:"text-[10px] text-gray-500 font-medium",children:"Utilization"})]}),e.jsxs("p",{className:"text-lg font-bold text-gray-800",children:[b.budgetUtilization.toFixed(1),"%"]})]})]})]}),e.jsxs("div",{className:"d-none d-md-block",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow h-100",children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:e.jsxs("h6",{className:"m-0 font-weight-bold text-primary",children:["Family Expense Categories",e.jsx("i",{className:"fas fa-info-circle ml-2 text-gray-400",style:{cursor:"pointer"},onClick:f=>o("expense-categories",f)})]})}),e.jsx("div",{className:"card-body",children:e.jsx(Rt,{familyId:l,chartRef:s},`category-${t}`)})]})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow h-100",children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:e.jsxs("h6",{className:"m-0 font-weight-bold text-primary",children:["Budget vs Actual Spending",e.jsx("i",{className:"fas fa-info-circle ml-2 text-gray-400",style:{cursor:"pointer"},onClick:f=>o("budget-performance",f)})]})}),e.jsx("div",{className:"card-body",children:e.jsx(Tt,{familyId:l,chartRef:n},`budget-${t}`)})]})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow h-100",children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:e.jsxs("h6",{className:"m-0 font-weight-bold text-primary",children:["Family Goals Progress",e.jsx("i",{className:"fas fa-info-circle ml-2 text-gray-400",style:{cursor:"pointer"},onClick:f=>o("goal-progress",f)})]})}),e.jsx("div",{className:"card-body",children:e.jsx(Lt,{familyId:l,chartRef:a},`goal-performance-${t}`)})]})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow h-100",children:[e.jsx("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:e.jsxs("h6",{className:"m-0 font-weight-bold text-primary",children:["Goals by Status",e.jsx("i",{className:"fas fa-info-circle ml-2 text-gray-400",style:{cursor:"pointer"},onClick:f=>o("goal-breakdown",f)})]})}),e.jsx("div",{className:"card-body",children:e.jsx($t,{familyId:l,chartRef:r},`goal-breakdown-${t}`)})]})})})]})]})},It=D.memo(Ds),As=({familyId:b})=>{const{showSuccessToast:l,showErrorToast:s}=Qe(),[n,a]=D.useState([]),[r,o]=D.useState(!1),[t,m]=D.useState(null),[d,f]=D.useState(0),[p,N]=D.useState(0),[x,u]=D.useState(!1),w=D.useCallback(async()=>{if(!b||x||r)return;const j=Date.now();if(!(j-p<5e3&&p!==0)){N(j),o(!0);try{const{data:M,error:y}=await V.from("family_join_requests").select("*").eq("family_id",b).eq("status","pending").order("created_at",{ascending:!1});if(y){const S=d+1;f(S),console.error("Error fetching join requests:",y),S<3&&s("Failed to load join requests"),S>=5&&(u(!0),console.log("Disabled join requests fetching due to too many errors")),a([]);return}if(M&&M.length>0){const S=M.map(B=>B.user_id).filter(Boolean);if(S.length>0){const{data:B,error:T}=await V.from("profiles").select("id, email, full_name, avatar_url").in("id",S);T&&console.error("Error fetching user profiles:",T);const Y=M.map(C=>{const h=B?.find(c=>c.id===C.user_id);return{...C,profiles:h}});a(Y||[])}else a(M)}else a([]);f(0)}catch(M){const y=d+1;f(y),console.error("Error in fetchPendingRequests:",M),y<3&&s("An error occurred while loading join requests"),y>=5&&(u(!0),console.log("Disabled join requests fetching due to too many errors")),a([])}finally{o(!1)}}},[b,s,r,d,p,x]),g=async(j,M)=>{if(b){m(j);try{const y=n.find(S=>S.id===j);if(!y)throw new Error("Request not found");if(M==="approve"){const{data:S,error:B}=await V.from("family_members").select("id, status").eq("family_id",b).eq("user_id",y.user_id).single();if(B&&B.code!=="PGRST116")throw new Error(`Error checking existing membership: ${B.message}`);if(S){if(S.status!=="active"){const{error:Y}=await V.from("family_members").update({status:"active"}).eq("id",S.id);if(Y)throw new Error(`Error updating member status: ${Y.message}`)}}else{const{error:Y}=await V.from("family_members").insert({family_id:b,user_id:y.user_id,role:"member",status:"active",created_at:new Date().toISOString()});if(Y)throw new Error(`Error adding family member: ${Y.message}`)}const{error:T}=await V.from("family_join_requests").update({status:"approved"}).eq("id",j);if(T)throw new Error(`Error updating request status: ${T.message}`);l("Join request approved successfully! User added as a member.")}else{const{error:S}=await V.from("family_join_requests").update({status:"rejected"}).eq("id",j);if(S)throw new Error(`Error updating request status: ${S.message}`);l("Join request rejected")}w()}catch(y){console.error(`Error ${M}ing request:`,y);const S=y instanceof Error?y.message:"Unknown error";s(`Failed to ${M} request: ${S}`)}finally{m(null)}}};return D.useEffect(()=>{const j=setTimeout(()=>{w()},1500);return()=>clearTimeout(j)},[]),r?e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3 d-flex justify-content-between align-items-center",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Pending Join Requests"})}),e.jsxs("div",{className:"card-body text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading pending requests..."})]})]}):n.length===0?e.jsxs("div",{className:"card shadow mb-4",children:[e.jsxs("div",{className:"card-header py-3 d-flex justify-content-between align-items-center",children:[e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Pending Join Requests"}),e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:w,disabled:x,title:x?"Refresh disabled due to errors":"Refresh",children:e.jsx("i",{className:"fas fa-sync-alt"})})]}),e.jsxs("div",{className:"card-body text-center py-4",children:[e.jsx("i",{className:"fas fa-check-circle fa-2x text-success mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No pending join requests at this time."})]})]}):e.jsxs("div",{className:"card shadow mb-4",children:[e.jsxs("div",{className:"card-header py-3 d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-primary",children:["Pending Join Requests ",e.jsx("span",{className:"badge badge-warning ml-2",children:n.length}),e.jsx("small",{className:"ml-2 text-muted font-weight-normal",children:"(All approved users join as members)"})]}),e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:w,title:"Refresh",children:e.jsx("i",{className:"fas fa-sync-alt"})})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Requested On"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.map(j=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{className:"img-profile rounded-circle mr-3",src:j.profiles?.avatar_url||"../images/placeholder.png",width:"40",height:"40",alt:"User"}),e.jsx("div",{className:"font-weight-bold",children:j.profiles?.full_name||j.profiles?.email||"User"})]})}),e.jsx("td",{children:j.profiles?.email||"Unknown"}),e.jsx("td",{children:qe(j.created_at)}),e.jsxs("td",{children:[e.jsxs("button",{className:"btn btn-success btn-sm mr-2",onClick:()=>g(j.id,"approve"),disabled:t===j.id,title:"Approve request and add user as a member",children:[t===j.id?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsx("i",{className:"fas fa-check mr-1"}),"Approve as Member"]}),e.jsxs("button",{className:"btn btn-danger btn-sm",onClick:()=>g(j.id,"reject"),disabled:t===j.id,children:[e.jsx("i",{className:"fas fa-times mr-1"})," Reject"]})]})]},j.id))})]})})})]})},Gt=({isCreator:b,familyData:l,members:s,getMemberRoleBadge:n,familyId:a,onMembersUpdate:r})=>{const{user:o}=ut(),{showSuccessToast:t,showErrorToast:m}=Qe(),[d,f]=D.useState({showRoleModal:!1,showTransferModal:!1,showDeleteModal:!1,showLeaveModal:!1,showAssignFeaturesModal:!1,canManageRoles:!1,isOwner:!1,deleteConfirmed:!1});D.useEffect(()=>{p()},[a,o]);const p=async()=>{if(!(!o||!a))try{const i=await pe.canManageRoles(a,o.id);f(v=>({...v,canManageRoles:i.canManage,isOwner:i.isOwner,userRole:i.role}))}catch(i){console.error("Error loading permissions:",i)}},N=async()=>{if(!(!o||!d.targetMember||!d.newRole||!a))try{await pe.updateMemberRole(a,d.targetMember.user_id,d.newRole,o.id),t(`Successfully updated ${d.targetMember.full_name||d.targetMember.email} to ${d.newRole}`),T(),r&&r()}catch(i){console.error("Error updating role:",i);const v=i instanceof Error?i.message:"Failed to update role";m(v)}},x=async()=>{if(!(!o||!d.targetMember||!a))try{await pe.transferOwnership(a,d.targetMember.user_id,o.id),t(`Successfully transferred ownership to ${d.targetMember.full_name||d.targetMember.email}`),T(),r&&r()}catch(i){console.error("Error transferring ownership:",i);const v=i instanceof Error?i.message:"Failed to transfer ownership";m(v)}},u=async()=>{if(!(!o||!d.targetMember||!a))try{await pe.removeFamilyMember(a,d.targetMember.user_id,o.id),t(`Successfully removed ${d.targetMember.full_name||d.targetMember.email} from the family`),T(),r&&r()}catch(i){console.error("Error removing member:",i);const v=i instanceof Error?i.message:"Failed to remove member";m(v)}},w=async()=>{if(!(!o||!a))try{await pe.leaveFamily(a,o.id),t("Successfully left the family"),T(),r&&r()}catch(i){console.error("Error leaving family:",i);const v=i instanceof Error?i.message:"Failed to leave family";m(v)}},g=async()=>{if(!(!o||!d.targetMember||!a))try{const i={can_create_goals:d.targetMember.can_create_goals||!1,can_view_budgets:d.targetMember.can_view_budgets||!0,can_contribute_goals:d.targetMember.can_contribute_goals||!0};await pe.updateMemberFeatures(a,d.targetMember.user_id,i,o.id),t(`Successfully updated features for ${d.targetMember.full_name||d.targetMember.email}`),T(),r&&r()}catch(i){console.error("Error updating features:",i);const v=i instanceof Error?i.message:"Failed to update features";m(v)}},j=i=>{f(v=>({...v,showRoleModal:!0,targetMember:i,newRole:i.role}))},M=i=>{f(v=>({...v,showTransferModal:!0,targetMember:i}))},y=i=>{f(v=>({...v,showDeleteModal:!0,targetMember:i}))},S=()=>{f(i=>({...i,showLeaveModal:!0}))},B=i=>{f(v=>({...v,showAssignFeaturesModal:!0,targetMember:i}))},T=()=>{f(i=>({...i,showRoleModal:!1,showTransferModal:!1,showDeleteModal:!1,showLeaveModal:!1,showAssignFeaturesModal:!1,targetMember:void 0,newRole:void 0,deleteConfirmed:!1}))},Y=i=>{switch(i){case"admin":return"badge-primary";case"member":return"badge-success";case"viewer":return"badge-secondary";default:return"badge-light"}},C=i=>{switch(i){case"admin":return"bg-indigo-100 text-indigo-600";case"member":return"bg-emerald-100 text-emerald-600";case"viewer":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-500"}},h=i=>!(!d.canManageRoles||!o||i.user_id===o.id||l&&i.user_id===l.created_by&&!d.isOwner),c=({member:i})=>{const v=i.user_id===o?.id,E=l&&i.user_id===l.created_by,k=h(i);return e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-gray-100 shadow-sm mb-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("img",{className:"w-10 h-10 rounded-full object-cover",src:i.avatar_url||i.user?.avatar_url||"../images/placeholder.png",alt:i.full_name||i.user?.full_name||i.email||"User"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 truncate",children:i.full_name||i.user?.full_name||i.email||i.user?.email||"Unknown User"}),v&&e.jsx("span",{className:"text-[9px] text-gray-400",children:"(You)"}),E&&e.jsx("i",{className:"fas fa-crown text-amber-500 text-[10px]",title:"Family Owner"})]}),e.jsx("p",{className:"text-[10px] text-gray-500 truncate mb-1.5",children:i.email||i.user?.email||"No email"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-semibold ${C(i.role)}`,children:E?"Owner":i.role.charAt(0).toUpperCase()+i.role.slice(1)}),e.jsxs("span",{className:"text-[9px] text-gray-400",children:["Joined ",i.created_at?qe(i.created_at):"N/A"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 mt-2 border-t border-gray-100",children:[k&&e.jsx("button",{onClick:()=>j(i),className:"w-7 h-7 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center hover:bg-indigo-100 transition-colors",title:"Manage Role",children:e.jsx("i",{className:"fas fa-user-cog text-[10px]"})}),d.isOwner&&!v&&(i.role==="admin"||i.role==="member")&&e.jsx("button",{onClick:()=>M(i),className:"w-7 h-7 rounded-full bg-amber-50 text-amber-500 flex items-center justify-center hover:bg-amber-100 transition-colors",title:"Transfer Ownership",children:e.jsx("i",{className:"fas fa-crown text-[10px]"})}),d.isOwner&&!v&&e.jsx("button",{onClick:()=>B(i),className:"w-7 h-7 rounded-full bg-cyan-50 text-cyan-500 flex items-center justify-center hover:bg-cyan-100 transition-colors",title:"Assign Features",children:e.jsx("i",{className:"fas fa-cogs text-[10px]"})}),k&&e.jsx("button",{onClick:()=>y(i),className:"w-7 h-7 rounded-full bg-rose-50 text-rose-500 flex items-center justify-center hover:bg-rose-100 transition-colors",title:"Remove Member",children:e.jsx("i",{className:"fas fa-user-times text-[10px]"})}),v&&!d.isOwner&&e.jsx("button",{onClick:S,className:"w-7 h-7 rounded-full bg-gray-50 text-gray-500 flex items-center justify-center hover:bg-gray-100 transition-colors",title:"Leave Family",children:e.jsx("i",{className:"fas fa-sign-out-alt text-[10px]"})})]})]})};return e.jsxs("div",{className:"animate__animated animate__fadeIn",children:[b&&l&&e.jsx(As,{familyId:l.id}),e.jsxs("div",{className:"block md:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 mt-3",children:[e.jsxs("h5",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-users text-indigo-500 text-xs"}),"Family Members",e.jsx("span",{className:"bg-indigo-100 text-indigo-600 px-1.5 py-0.5 rounded-full text-[9px]",children:s.length})]}),e.jsxs(_e,{to:`/family/${a}/invite`,className:"flex items-center gap-1.5 px-3 py-1.5 bg-indigo-500 text-white text-[11px] font-medium rounded-lg hover:bg-indigo-600 transition-colors",children:[e.jsx("i",{className:"fas fa-user-plus text-[10px]"}),"Invite"]})]}),s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(i=>e.jsx(c,{member:i},i.id))}):e.jsxs("div",{className:"text-center py-8 bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-users text-gray-400 text-lg"})}),e.jsx("h5",{className:"text-sm text-gray-500 font-medium mb-1",children:"No family members yet"}),e.jsx("p",{className:"text-[11px] text-gray-400 mb-3",children:"Invite your family members to join"}),e.jsxs(_e,{to:`/family/${a}/invite`,className:"inline-flex items-center gap-1.5 px-4 py-2 bg-indigo-500 text-white text-sm font-medium rounded-lg hover:bg-indigo-600 transition-colors",children:[e.jsx("i",{className:"fas fa-user-plus text-xs"}),"Invite Family Member"]})]})]}),e.jsxs("div",{className:"d-none d-md-block",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4 mt-4",children:[e.jsx("h5",{className:"text-primary font-weight-bold",children:"Family Members"}),e.jsxs(_e,{to:`/family/${a}/invite`,className:"btn btn-sm btn-primary",children:[e.jsx("i",{className:"fas fa-user-plus mr-2"})," Invite Member"]})]}),s.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",width:"100%",cellSpacing:"0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Join Date"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(i=>{const v=i.user_id===o?.id,E=l&&i.user_id===l.created_by,k=h(i);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{className:"img-profile rounded-circle mr-3",src:i.avatar_url||i.user?.avatar_url||"../images/placeholder.png",alt:i.full_name||i.user?.full_name||i.email||"User",width:"40",height:"40"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-weight-bold",children:[i.full_name||i.user?.full_name||i.email||i.user?.email||"Unknown User",v&&e.jsx("span",{className:"text-muted ml-1",children:"(You)"}),E&&e.jsx("i",{className:"fas fa-crown text-warning ml-2",title:"Family Owner"})]}),e.jsx("div",{className:"small text-gray-600",children:i.email||i.user?.email||"No email"})]})]})}),e.jsx("td",{children:n(i.role,l?i.user_id===l.created_by:!1)}),e.jsx("td",{children:i.created_at?qe(i.created_at):"N/A"}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[k&&e.jsx("button",{onClick:()=>j(i),className:"btn btn-outline-primary",title:"Manage Role",children:e.jsx("i",{className:"fas fa-user-cog"})}),d.isOwner&&!v&&(i.role==="admin"||i.role==="member")&&e.jsx("button",{onClick:()=>M(i),className:"btn btn-outline-warning",title:"Transfer Ownership",children:e.jsx("i",{className:"fas fa-crown"})}),d.isOwner&&!v&&e.jsx("button",{onClick:()=>B(i),className:"btn btn-outline-info",title:"Assign Features",children:e.jsx("i",{className:"fas fa-cogs"})}),k&&e.jsx("button",{onClick:()=>y(i),className:"btn btn-outline-danger",title:"Remove Member",children:e.jsx("i",{className:"fas fa-user-times"})}),v&&!d.isOwner&&e.jsx("button",{onClick:S,className:"btn btn-outline-secondary",title:"Leave Family",children:e.jsx("i",{className:"fas fa-sign-out-alt"})}),!d.canManageRoles&&!v&&e.jsx("span",{className:"badge badge-secondary",title:"You don't have permission to manage roles",children:e.jsx("i",{className:"fas fa-lock"})})]})})]},i.id)})})]})}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"fas fa-users fa-3x text-gray-300"})}),e.jsx("h5",{className:"text-gray-500 font-weight-light",children:"No family members yet"}),e.jsx("p",{className:"text-gray-500 mb-0 small",children:"Invite your family members to join and collaborate on your finances."}),e.jsxs(_e,{to:`/family/${a}/invite`,className:"btn btn-sm btn-primary mt-3",children:[e.jsx("i",{className:"fas fa-user-plus fa-sm mr-1"})," Invite Family Member"]})]})]}),d.showRoleModal&&d.targetMember&&e.jsx("div",{className:"modal",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Manage Role"}),e.jsx("button",{type:"button",className:"close",onClick:T,children:e.jsx("span",{children:"×"})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{children:["Change role for ",e.jsx("strong",{children:d.targetMember.full_name||d.targetMember.email}),":"]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Role:"}),e.jsxs("select",{className:"form-control",value:d.newRole||"",onChange:i=>f(v=>({...v,newRole:i.target.value})),children:[e.jsx("option",{value:"admin",children:"Admin - Full management privileges"}),e.jsx("option",{value:"member",children:"Member - Standard privileges"}),e.jsx("option",{value:"viewer",children:"Viewer - Read-only access"})]})]}),e.jsxs("div",{className:"alert alert-info small",children:[e.jsx("strong",{children:"Role Descriptions:"}),e.jsxs("ul",{className:"mb-0 mt-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Admin:"})," Can invite members, manage roles, and access all family data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Member:"})," Can contribute to goals and view most family information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Viewer:"})," Limited read-only access to family information"]})]}),!d.isOwner&&e.jsx("div",{className:"mt-2 p-2 bg-warning text-dark rounded",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Admin Restrictions:"})," You cannot manage the family owner or transfer ownership. Only the owner can change ownership or demote themselves."]})})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:T,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:N,disabled:!d.newRole||d.newRole===d.targetMember.role,children:"Update Role"})]})]})})}),d.showTransferModal&&d.targetMember&&e.jsx("div",{className:"modal",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title text-warning",children:[e.jsx("i",{className:"fas fa-crown mr-2"}),"Transfer Ownership"]}),e.jsx("button",{type:"button",className:"close",onClick:T,children:e.jsx("span",{children:"×"})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),e.jsx("strong",{children:"Warning:"})," This action cannot be undone!"]}),e.jsx("p",{children:"You are about to transfer ownership of this family to:"}),e.jsx("div",{className:"card bg-light mb-3",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:d.targetMember.avatar_url||"/images/placeholder.png",className:"rounded-circle mr-3",width:"50",height:"50",alt:d.targetMember.full_name||"Member"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-bold h5 mb-1",children:d.targetMember.full_name||"Unknown User"}),e.jsx("div",{className:"text-muted",children:d.targetMember.email}),e.jsxs("span",{className:`badge ${Y(d.targetMember.role)} mt-1`,children:["Current: ",d.targetMember.role.charAt(0).toUpperCase()+d.targetMember.role.slice(1)]})]})]})})}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("h6",{children:"What happens after transfer:"}),e.jsxs("ul",{className:"mb-0",children:[e.jsx("li",{children:"The selected member becomes the new family owner"}),e.jsx("li",{children:"They will automatically be promoted to Admin role"}),e.jsx("li",{children:"You will remain in the family as an Admin"}),e.jsx("li",{children:"The new owner will have full control over the family"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:T,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-warning",onClick:x,children:[e.jsx("i",{className:"fas fa-crown mr-2"}),"Transfer Ownership"]})]})]})})}),d.showDeleteModal&&d.targetMember&&e.jsx("div",{className:"modal",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title text-danger",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),"Remove Family Member"]}),e.jsx("button",{type:"button",className:"close",onClick:T,children:e.jsx("span",{children:"×"})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),e.jsx("strong",{children:"Warning:"})," This action cannot be undone!"]}),e.jsx("p",{children:"You are about to remove the following member from your family:"}),e.jsx("div",{className:"card bg-light mb-3",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:d.targetMember.avatar_url||"/images/placeholder.png",className:"rounded-circle mr-3",width:"50",height:"50",alt:d.targetMember.full_name||"Member"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-bold h5 mb-1",children:d.targetMember.full_name||"Unknown User"}),e.jsx("div",{className:"text-muted",children:d.targetMember.email}),e.jsxs("span",{className:`badge ${Y(d.targetMember.role)} mt-1`,children:["Role: ",d.targetMember.role.charAt(0).toUpperCase()+d.targetMember.role.slice(1)]})]})]})})}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("h6",{children:"What happens when you remove this member:"}),e.jsxs("ul",{className:"mb-0",children:[e.jsx("li",{children:"They will lose access to all family data and features"}),e.jsx("li",{children:"Their transactions and goals will remain in the system"}),e.jsx("li",{children:"They can be re-invited later if needed"}),e.jsx("li",{children:"Any shared budgets or goals they contributed to will be affected"})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"confirmRemoval",checked:d.deleteConfirmed,onChange:i=>f(v=>({...v,deleteConfirmed:i.target.checked}))}),e.jsx("label",{className:"form-check-label",htmlFor:"confirmRemoval",children:"I understand that removing this member will revoke their access to all family features"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:T,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-danger",onClick:u,disabled:!d.deleteConfirmed,children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Remove Member"]})]})]})})}),d.showLeaveModal&&e.jsx("div",{className:"modal",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title text-warning",children:[e.jsx("i",{className:"fas fa-sign-out-alt mr-2"}),"Leave Family"]}),e.jsx("button",{type:"button",className:"close",onClick:T,children:e.jsx("span",{children:"×"})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),e.jsx("strong",{children:"Warning:"})," You are about to leave this family!"]}),e.jsxs("p",{children:["Are you sure you want to leave ",e.jsx("strong",{children:l?.family_name}),"?"]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("h6",{children:"What happens when you leave:"}),e.jsxs("ul",{className:"mb-0",children:[e.jsx("li",{children:"You will lose access to all family data and features"}),e.jsx("li",{children:"Your transactions and goals will remain in the system"}),e.jsx("li",{children:"You can be re-invited by family admins later"}),e.jsx("li",{children:"Any shared budgets or goals you contributed to will be affected"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:T,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-warning",onClick:w,children:[e.jsx("i",{className:"fas fa-sign-out-alt mr-2"}),"Leave Family"]})]})]})})}),d.showAssignFeaturesModal&&d.targetMember&&e.jsx("div",{className:"modal",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title text-info",children:[e.jsx("i",{className:"fas fa-cogs mr-2"}),"Assign Features"]}),e.jsx("button",{type:"button",className:"close",onClick:T,children:e.jsx("span",{children:"×"})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{children:["Manage features for ",e.jsx("strong",{children:d.targetMember.full_name||d.targetMember.email}),":"]}),e.jsx("div",{className:"card bg-light mb-3",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("img",{src:d.targetMember.avatar_url||"/images/placeholder.png",className:"rounded-circle mr-3",width:"40",height:"40",alt:d.targetMember.full_name||"Member"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-bold",children:d.targetMember.full_name||"Unknown User"}),e.jsx("div",{className:"text-muted small",children:d.targetMember.email})]})]})})}),e.jsxs("div",{className:"form-group",children:[e.jsx("h6",{className:"mb-3",children:"Feature Permissions:"}),e.jsxs("div",{className:"form-check mb-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"canCreateGoals",defaultChecked:d.targetMember.can_create_goals}),e.jsxs("label",{className:"form-check-label",htmlFor:"canCreateGoals",children:[e.jsx("strong",{children:"Can Create Goals"}),e.jsx("small",{className:"d-block text-muted",children:"Allow this member to create new family goals"})]})]}),e.jsxs("div",{className:"form-check mb-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"canViewBudgets",defaultChecked:d.targetMember.can_view_budgets}),e.jsxs("label",{className:"form-check-label",htmlFor:"canViewBudgets",children:[e.jsx("strong",{children:"Can View Budgets"}),e.jsx("small",{className:"d-block text-muted",children:"Allow this member to view family budgets and financial data"})]})]}),e.jsxs("div",{className:"form-check mb-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"canContributeGoals",defaultChecked:d.targetMember.can_contribute_goals}),e.jsxs("label",{className:"form-check-label",htmlFor:"canContributeGoals",children:[e.jsx("strong",{children:"Can Contribute to Goals"}),e.jsx("small",{className:"d-block text-muted",children:"Allow this member to contribute money to family goals"})]})]})]}),e.jsxs("div",{className:"alert alert-info small",children:[e.jsx("strong",{children:"Note:"})," These permissions are in addition to the member's role-based permissions. Role permissions (admin, member, viewer) define the base level of access."]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:T,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-info",onClick:g,children:[e.jsx("i",{className:"fas fa-save mr-2"}),"Update Features"]})]})]})})})]})},Bt=({recentActivity:b})=>{const l=n=>{switch(n){case"join":return"bg-emerald-500";case"goal":return"bg-amber-500";case"transaction":return"bg-indigo-500";default:return"bg-gray-500"}},s=n=>{switch(n){case"join":return"bg-emerald-100 text-emerald-600";case"goal":return"bg-amber-100 text-amber-600";case"transaction":return"bg-indigo-100 text-indigo-600";default:return"bg-gray-100 text-gray-600"}};return e.jsxs("div",{className:"animate__animated animate__fadeIn",children:[e.jsx("div",{className:"block md:hidden",children:b.length>0?e.jsx("div",{className:"space-y-2",children:b.map(n=>e.jsx("div",{className:"bg-white rounded-xl p-3 border border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0 ${s(n.type)}`,children:e.jsx("i",{className:`fas ${n.icon} text-xs`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm text-gray-800",children:[e.jsx("span",{className:"font-semibold",children:n.user})," ",e.jsx("span",{className:"text-gray-600",children:n.description})]}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-0.5",children:[e.jsx("i",{className:"fas fa-clock mr-1 text-[8px]"}),qe(n.date)]})]})]})},n.id))}):e.jsxs("div",{className:"text-center py-8 bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-history text-gray-400 text-lg"})}),e.jsx("h5",{className:"text-sm text-gray-500 font-medium mb-1",children:"No recent activity"}),e.jsx("p",{className:"text-[11px] text-gray-400 mb-4 px-4",children:"Family activity will appear here as you and your family members take financial actions."}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 px-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center mx-auto mb-1.5",children:e.jsx("i",{className:"fas fa-user-plus text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 text-center",children:"Add members"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mx-auto mb-1.5",children:e.jsx("i",{className:"fas fa-money-bill-alt text-indigo-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 text-center",children:"Record transactions"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-2.5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-amber-100 flex items-center justify-center mx-auto mb-1.5",children:e.jsx("i",{className:"fas fa-flag-checkered text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 text-center",children:"Create goals"})]})]})]})}),e.jsx("div",{className:"d-none d-md-block",children:b.length>0?e.jsx("ul",{className:"list-group list-group-flush",children:b.map(n=>e.jsxs("li",{className:"list-group-item d-flex align-items-center",children:[e.jsx("div",{className:`mr-3 text-white rounded-circle d-flex align-items-center justify-content-center ${l(n.type)}`,style:{width:"40px",height:"40px"},children:e.jsx("i",{className:`fas ${n.icon}`})}),e.jsxs("div",{children:[e.jsx("strong",{children:n.user})," ",n.description,e.jsx("div",{className:"small text-gray-500",children:qe(n.date)})]})]},n.id))}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"fas fa-history fa-3x text-gray-300"})}),e.jsx("h5",{className:"text-gray-500 font-weight-light",children:"No recent activity"}),e.jsx("p",{className:"text-gray-500 mb-3 small",children:"Family activity feed will be shown here as you and your family members take financial actions."}),e.jsxs("div",{className:"row justify-content-center",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card bg-light mb-3 shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-3",children:[e.jsx("i",{className:"fas fa-user-plus text-primary mb-2"}),e.jsx("p",{className:"mb-0 small",children:"Add family members"})]})})}),e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card bg-light mb-3 shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-3",children:[e.jsx("i",{className:"fas fa-money-bill-alt text-success mb-2"}),e.jsx("p",{className:"mb-0 small",children:"Record transactions"})]})})}),e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card bg-light mb-3 shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-3",children:[e.jsx("i",{className:"fas fa-flag-checkered text-warning mb-2"}),e.jsx("p",{className:"mb-0 small",children:"Create shared goals"})]})})})]})]})})]})},Es=b=>{const l=new Date(b),n=Math.floor((new Date().getTime()-l.getTime())/1e3);if(n<60)return"just now";const a=Math.floor(n/60);if(a<60)return`${a} minute${a===1?"":"s"} ago`;const r=Math.floor(a/60);if(r<24)return`${r} hour${r===1?"":"s"} ago`;const o=Math.floor(r/24);if(o===1)return"yesterday";if(o<7)return`${o} days ago`;const t=Math.floor(o/7);if(t<4)return`${t} week${t===1?"":"s"} ago`;const m=Math.floor(o/30);return`${m} month${m===1?"":"s"} ago`},Rs=b=>{const l=b.split(" ");return l.length>=2?(l[0][0]+l[l.length-1][0]).toUpperCase():b[0].toUpperCase()},Ts=b=>b>=5e3?"text-success":b>=1e3?"text-info":"text-muted",Ot=({contributions:b})=>{const l=b.slice(0,10);return l.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"fas fa-clock fa-2x text-gray-300 mb-2"}),e.jsx("p",{className:"text-muted small mb-0",children:"No contribution history yet"})]}):e.jsx("div",{className:"timeline-container",style:{maxHeight:"400px",overflowY:"auto"},children:l.map((s,n)=>{const a=s.profiles?.full_name||"Unknown",r=Rs(a),o=Es(s.contribution_date||s.created_at),t=Ts(s.amount);return e.jsx("div",{className:"timeline-item animate__animated animate__fadeInUp mb-3",style:{animationDelay:`${n*.05}s`},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mr-3",style:{width:"40px",height:"40px",fontSize:"14px",fontWeight:"bold",flexShrink:0},children:r}),e.jsxs("div",{className:"flex-grow-1 border-left pl-3 pb-3",style:{borderColor:"#e3e6f0"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-weight-bold text-gray-800",children:a}),e.jsx("div",{className:"small text-muted",children:o})]}),e.jsx("div",{className:`font-weight-bold ${t}`,children:me(s.amount)})]}),s.notes&&e.jsxs("div",{className:"small text-gray-600 mt-1",children:[e.jsx("i",{className:"fas fa-comment-dots mr-1"}),s.notes]})]})]})},s.id)})})},Ps=({goal:b,getRemainingDays:l,openContributeModal:s,fetchGoalContributions:n,loadingContributions:a,selectedGoalForContributions:r})=>{const o=b.percentage||0,t=l(b.target_date||b.deadline),m=b.status==="completed"||o>=100,f=m?"emerald":o>=75?"blue":o>=50?"indigo":o>=25?"amber":"rose";return e.jsxs("div",{className:"bg-white rounded-xl p-3 border border-gray-100 shadow-sm mb-2",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 truncate",children:b.goal_name}),e.jsx("p",{className:"text-[10px] text-gray-500",children:b.owner_name||"Family Member"})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-semibold ${b.status==="completed"?"bg-emerald-100 text-emerald-600":b.status==="in_progress"?"bg-blue-100 text-blue-600":b.status==="not_started"?"bg-gray-100 text-gray-600":"bg-rose-100 text-rose-600"}`,children:b.status==="not_started"?"Not Started":b.status==="in_progress"?"In Progress":b.status==="completed"?"Completed":"Cancelled"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Progress"}),e.jsx("span",{className:`font-semibold text-${f}-600`,children:Ze(o)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 bg-${f}-500`,style:{width:`${Math.min(o,100)}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] text-gray-400 uppercase",children:"Target"}),e.jsx("p",{className:"text-xs font-semibold text-gray-800",children:me(b.target_amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] text-gray-400 uppercase",children:"Saved"}),e.jsx("p",{className:"text-xs font-semibold text-emerald-600",children:me(b.current_amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] text-gray-400 uppercase",children:"Days Left"}),e.jsx("p",{className:`text-xs font-semibold ${t<=30?"text-rose-600":"text-gray-800"}`,children:t>0?t:"Overdue"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-gray-100",children:[e.jsxs("button",{onClick:()=>s(b),disabled:m,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-[10px] font-medium transition-colors ${m?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:[e.jsx("i",{className:"fas fa-plus text-[8px]"}),"Contribute"]}),e.jsx("button",{onClick:()=>n(b.id),disabled:a&&r===b.id,className:"w-7 h-7 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center hover:bg-indigo-100 transition-colors",children:a&&r===b.id?e.jsx("i",{className:"fas fa-spinner fa-spin text-[10px]"}):e.jsx("i",{className:"fas fa-chart-bar text-[10px]"})}),e.jsx(_e,{to:`/goals/${b.id}`,className:"w-7 h-7 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center hover:bg-blue-100 transition-colors",children:e.jsx("i",{className:"fas fa-eye text-[10px]"})})]})]})},zt=({familyGoals:b,isCreator:l,loadingFamilyGoals:s,selectedGoalForContributions:n,loadingContributions:a,goalContributions:r,contributionChartData:o,contributionPieChartData:t,contributionBarChartRef:m,contributionPieChartRef:d,openContributeModal:f,fetchGoalContributions:p,toggleTip:N,getRemainingDays:x,onRefresh:u})=>{const[w,g]=D.useState("all"),[j,M]=D.useState("all"),[y,S]=D.useState("all"),[B,T]=D.useState(""),[Y,C]=D.useState(!1),[h,c]=D.useState(1),[i,v]=D.useState(10),E=D.useMemo(()=>b.map(K=>({id:K.user_id,name:K.owner_name||"Unknown"})).filter((K,le,ve)=>le===ve.findIndex(_=>_.id===K.id)),[b]),k=D.useMemo(()=>{let F=[...b];if(w!=="all"&&(F=F.filter(K=>K.status===w)),j!=="all"&&(F=F.filter(K=>K.priority===j)),y!=="all"&&(F=F.filter(K=>K.user_id===y)),B.trim()){const K=B.toLowerCase();F=F.filter(le=>le.goal_name.toLowerCase().includes(K))}return F},[b,w,j,y,B]),P=k.length,R=Math.max(1,Math.ceil(P/i)),q=(h-1)*i,X=Math.min(q+i,P),J=k.slice(q,X);D.useEffect(()=>{c(1)},[w,j,y,B]);const Q=()=>{g("all"),M("all"),S("all"),T(""),c(1)},ne=w!=="all"||j!=="all"||y!=="all"||B!=="";return s?e.jsxs("div",{className:"animate__animated animate__fadeIn",children:[e.jsx("div",{className:"block md:hidden py-8",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading family goals..."})]})}),e.jsxs("div",{className:"d-none d-md-block text-center p-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading family goals..."})]})]}):e.jsxs("div",{className:"animate__animated animate__fadeIn",children:[e.jsxs("div",{className:"block md:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-flag-checkered text-indigo-500 text-xs"}),"Family Goals",e.jsx("span",{className:"bg-indigo-100 text-indigo-600 px-1.5 py-0.5 rounded-full text-[9px]",children:k.length})]}),e.jsx("p",{className:"text-[10px] text-gray-500 mt-0.5",children:"Track and contribute to shared goals"})]}),u&&e.jsx("button",{onClick:u,disabled:s,className:"w-8 h-8 rounded-full bg-indigo-500 text-white flex items-center justify-center shadow-md",children:e.jsx("i",{className:`fas fa-sync text-xs ${s?"fa-spin":""}`})})]}),b.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 mb-3 overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 scrollbar-hide",children:[e.jsxs("button",{onClick:()=>C(!Y),className:`flex-shrink-0 flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[11px] font-medium transition-all ${ne?"bg-indigo-500 text-white shadow-md":"bg-white text-gray-600 border border-gray-200"}`,children:[e.jsx("i",{className:"fas fa-sliders-h text-[10px]"}),"Filters",ne&&e.jsx("span",{className:"w-4 h-4 rounded-full bg-white/30 flex items-center justify-center text-[9px]",children:(w!=="all"?1:0)+(j!=="all"?1:0)+(y!=="all"?1:0)+(B!==""?1:0)})]}),["all","in_progress","completed"].map(F=>e.jsx("button",{onClick:()=>g(F),className:`flex-shrink-0 px-3 py-1.5 rounded-full text-[11px] font-medium transition-all ${w===F?F==="completed"?"bg-emerald-500 text-white shadow-sm":F==="in_progress"?"bg-blue-500 text-white shadow-sm":"bg-indigo-500 text-white shadow-sm":"bg-white text-gray-600 border border-gray-200"}`,children:F==="all"?"All":F==="in_progress"?"Active":"Done"},F)),ne&&e.jsx("button",{onClick:Q,className:"flex-shrink-0 w-7 h-7 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-times text-[10px]"})})]})}),Y&&e.jsxs("div",{className:"p-3 bg-white animate__animated animate__fadeIn",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase mb-1 block",children:"Status"}),e.jsxs("select",{className:"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-[11px] text-gray-700",value:w,onChange:F=>g(F.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"not_started",children:"Not Started"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase mb-1 block",children:"Priority"}),e.jsxs("select",{className:"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-[11px] text-gray-700",value:j,onChange:F=>M(F.target.value),children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase mb-1 block",children:"Owner"}),e.jsxs("select",{className:"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-[11px] text-gray-700",value:y,onChange:F=>S(F.target.value),children:[e.jsx("option",{value:"all",children:"All Members"}),E.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-500 uppercase mb-1 block",children:"Search"}),e.jsx("input",{type:"text",className:"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-[11px] text-gray-700",placeholder:"Search goals...",value:B,onChange:F=>T(F.target.value)})]})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-100 flex items-center justify-between",children:[e.jsxs("button",{onClick:Q,className:"text-[10px] text-gray-500 font-medium",children:[e.jsx("i",{className:"fas fa-undo mr-1 text-[8px]"}),"Reset"]}),e.jsx("button",{onClick:()=>C(!1),className:"text-[10px] text-indigo-600 font-medium",children:"Done"})]})]})]}),e.jsx("div",{className:"space-y-2",children:J.length>0?J.map(F=>e.jsx(Ps,{goal:F,getRemainingDays:x,openContributeModal:f,fetchGoalContributions:p,loadingContributions:a,selectedGoalForContributions:n},F.id)):e.jsxs("div",{className:"text-center py-8 bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-filter text-gray-400 text-lg"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"No goals match your filters"})]})}),R>1&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[10px] text-gray-500",children:[q+1,"-",X," of ",P]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>c(h-1),disabled:h===1,className:"w-7 h-7 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center disabled:opacity-50",children:e.jsx("i",{className:"fas fa-chevron-left text-[10px]"})}),e.jsxs("span",{className:"text-[11px] text-gray-700 px-2",children:[h," / ",R]}),e.jsx("button",{onClick:()=>c(h+1),disabled:h===R,className:"w-7 h-7 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center disabled:opacity-50",children:e.jsx("i",{className:"fas fa-chevron-right text-[10px]"})})]})]})})]}):e.jsxs("div",{className:"text-center py-8 bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-flag-checkered text-gray-400 text-lg"})}),e.jsx("h5",{className:"text-sm text-gray-500 font-medium mb-1",children:"No family goals yet"}),e.jsx("p",{className:"text-[11px] text-gray-400 mb-3",children:"Create goals and share them with your family"}),l&&e.jsxs(_e,{to:"/goals/create?share=family",className:"inline-flex items-center gap-1.5 px-4 py-2 bg-indigo-500 text-white text-sm font-medium rounded-lg",children:[e.jsx("i",{className:"fas fa-plus text-xs"}),"Create Goal"]})]})]}),e.jsxs("div",{className:"d-none d-md-block",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-primary font-weight-bold mb-1",children:"Family Goals Overview"}),e.jsx("p",{className:"text-muted mb-0",children:"Track and contribute to shared financial goals"})]}),u&&e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:u,disabled:s,children:[e.jsx("i",{className:`fas ${s?"fa-spinner fa-spin":"fa-sync"} mr-1`}),"Refresh"]})]})}),b.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card shadow mb-3",children:[e.jsxs("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:[e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Filter Goals"}),e.jsxs("button",{className:"btn btn-sm btn-outline-secondary",onClick:Q,children:[e.jsx("i",{className:"fas fa-undo fa-sm mr-1"}),"Reset"]})]}),e.jsx("div",{className:"card-body border-bottom bg-light py-3",children:e.jsxs("div",{className:"row align-items-end",children:[e.jsxs("div",{className:"col-lg-2 col-md-3 col-6 mb-2",children:[e.jsx("label",{className:"text-xs font-weight-bold text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:w,onChange:F=>g(F.target.value),className:"form-control form-control-sm",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"not_started",children:"Not Started"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"col-lg-2 col-md-3 col-6 mb-2",children:[e.jsx("label",{className:"text-xs font-weight-bold text-gray-700 mb-1",children:"Priority"}),e.jsxs("select",{value:j,onChange:F=>M(F.target.value),className:"form-control form-control-sm",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{className:"col-lg-2 col-md-3 col-6 mb-2",children:[e.jsx("label",{className:"text-xs font-weight-bold text-gray-700 mb-1",children:"Owner"}),e.jsxs("select",{value:y,onChange:F=>S(F.target.value),className:"form-control form-control-sm",children:[e.jsx("option",{value:"all",children:"All Members"}),E.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]})]}),e.jsxs("div",{className:"col-lg-6 col-md-3 col-12 mb-2",children:[e.jsx("label",{className:"text-xs font-weight-bold text-gray-700 mb-1",children:"Search"}),e.jsx("input",{type:"text",value:B,onChange:F=>T(F.target.value),placeholder:"Search goal name or notes...",className:"form-control form-control-sm"})]})]})})]}),e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3",children:e.jsxs("h6",{className:"m-0 font-weight-bold text-primary",children:["Family Goals (",k.length,")"]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Goal"}),e.jsx("th",{children:"Owner"}),e.jsx("th",{children:"Progress"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Target Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:J.length>0?J.map(F=>{const K=F.percentage||0,le=F.status==="completed"||K>=100,ve=F.status==="completed"?"badge-success":F.status==="in_progress"?"badge-primary":F.status==="not_started"?"badge-secondary":"badge-danger",_=F.priority==="high"?"badge-danger":F.priority==="medium"?"badge-warning":"badge-info";return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-weight-bold",children:F.goal_name}),e.jsxs("span",{className:"badge badge-info",children:[e.jsx("i",{className:"fas fa-users mr-1"}),"Family Goal"]})]}),e.jsx("td",{children:F.owner_name||"Family Member"}),e.jsxs("td",{style:{width:"180px"},children:[e.jsx("div",{className:"progress",style:{height:"12px"},children:e.jsx("div",{className:`progress-bar ${K>=75?"bg-success":K>=50?"bg-info":K>=25?"bg-warning":"bg-danger"}`,style:{width:`${K}%`}})}),e.jsx("div",{className:"small text-muted mt-1",children:Ze(K)})]}),e.jsxs("td",{children:[e.jsx("div",{className:"font-weight-bold",children:me(F.current_amount)}),e.jsxs("div",{className:"small text-muted",children:["of ",me(F.target_amount)]})]}),e.jsxs("td",{children:[e.jsx("div",{children:qe(F.target_date||F.deadline)}),e.jsxs("div",{className:"small text-muted",children:[x(F.target_date||F.deadline)," days left"]})]}),e.jsxs("td",{children:[e.jsx("span",{className:`badge ${ve}`,children:F.status==="not_started"?"Not Started":F.status==="in_progress"?"In Progress":F.status==="completed"?"Completed":"Cancelled"}),e.jsx("div",{className:"small mt-1",children:e.jsxs("span",{className:`badge ${_}`,children:[(F.priority||"medium").charAt(0).toUpperCase()+(F.priority||"medium").slice(1)," Priority"]})})]}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn btn-info btn-sm",onClick:()=>f(F),disabled:le,children:[e.jsx("i",{className:"fas fa-plus mr-1"}),"Contribute"]}),e.jsx("button",{className:"btn btn-info btn-sm",onClick:()=>p(F.id),disabled:a&&n===F.id,children:a&&n===F.id?e.jsx("span",{className:"spinner-border spinner-border-sm"}):e.jsx("i",{className:"fas fa-chart-bar"})}),e.jsx(_e,{to:`/goals/${F.id}`,className:"btn btn-primary btn-sm",children:e.jsx("i",{className:"fas fa-eye"})})]})})]},F.id)}):e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-4",children:[e.jsx("i",{className:"fas fa-filter fa-2x text-gray-300 mb-3 d-block"}),e.jsx("p",{className:"text-gray-500",children:"No goals found matching your filters."})]})})})]})})}),R>1&&e.jsx("div",{className:"card-footer bg-white",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsx("div",{className:"col-md-4 text-center text-md-start mb-2 mb-md-0",children:e.jsxs("span",{className:"text-muted",children:["Showing ",q+1," to ",X," of ",P]})}),e.jsx("div",{className:"col-md-4 text-center mb-2 mb-md-0",children:e.jsxs("select",{className:"form-select d-inline-block w-auto",value:i,onChange:F=>v(Number(F.target.value)),children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})}),e.jsx("div",{className:"col-md-4 text-center text-md-end",children:e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0 justify-content-center justify-content-md-end",children:[e.jsx("li",{className:`page-item ${h===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>c(h-1),children:e.jsx("i",{className:"fas fa-chevron-left"})})}),Array.from({length:Math.min(R,5)},(F,K)=>{let le=R<=5||h<=3?K+1:h>=R-2?R-4+K:h-2+K;return e.jsx("li",{className:`page-item ${h===le?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>c(le),children:le})},le)}),e.jsx("li",{className:`page-item ${h===R?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>c(h+1),children:e.jsx("i",{className:"fas fa-chevron-right"})})})]})})})]})})]}),n&&e.jsxs("div",{className:"card shadow mb-4 mt-4 animate__animated animate__fadeIn",children:[e.jsxs("div",{className:"card-header py-3 d-flex flex-row align-items-center justify-content-between",children:[e.jsxs("h6",{className:"m-0 font-weight-bold text-primary",children:["Family Goal Contributions",e.jsx("i",{className:"fas fa-info-circle ml-2 text-gray-400",style:{cursor:"pointer"},onClick:F=>N("goal-contributions",F)})]}),e.jsx("strong",{children:b.find(F=>F.id===n)?.goal_name||"Shared Goal"})]}),e.jsx("div",{className:"card-body",children:a?e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xl-6 mb-4",children:e.jsx("div",{className:"card h-100",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"skeleton",style:{width:"100%",height:"250px",borderRadius:"8px"}})})})}),e.jsx("div",{className:"col-xl-6 mb-4",children:e.jsx("div",{className:"card h-100",children:e.jsx("div",{className:"card-body d-flex justify-content-center",children:e.jsx("div",{className:"skeleton skeleton-circle",style:{width:"200px",height:"200px"}})})})})]}):r.length>0?e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xl-6 mb-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Contribution by Member"})}),e.jsx("div",{className:"card-body",children:e.jsx(ot,{data:o,chartRef:m})})]})}),e.jsx("div",{className:"col-xl-6 mb-4",children:e.jsxs("div",{className:"card h-100",children:[e.jsx("div",{className:"card-header py-3",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Contribution Breakdown"})}),e.jsx("div",{className:"card-body",children:e.jsx(ot,{data:t,chartRef:d})})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsx("div",{className:"card-header py-3 bg-white border-bottom",children:e.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Recent Contributions"})}),e.jsx("div",{className:"card-body",children:e.jsx(Ot,{contributions:r})})]})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"fas fa-users fa-3x text-gray-300"})}),e.jsx("h5",{className:"text-gray-500 font-weight-light",children:"No Contributions Yet"}),e.jsx("p",{className:"text-gray-500 mb-0 small",children:"Be the first to contribute to this goal!"}),e.jsxs("button",{className:"btn btn-primary mt-3",onClick:()=>{const F=b.find(K=>K.id===n);F&&f(F)},children:[e.jsx("i",{className:"fas fa-plus-circle mr-2"}),"Make First Contribution"]})]})})]})]}):e.jsxs("div",{className:"text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"fas fa-flag-checkered fa-3x text-gray-300"})}),e.jsx("h5",{className:"text-gray-500 font-weight-light",children:"No family goals found"}),e.jsx("p",{className:"text-gray-500 mb-0 small",children:"Create a goal and share it with family members to track progress together."}),l&&e.jsxs(_e,{to:"/goals/create?share=family",className:"btn btn-sm btn-primary mt-3",children:[e.jsx("i",{className:"fas fa-plus fa-sm mr-1"}),"Create Family Goal"]}),!l&&e.jsxs("div",{className:"alert alert-info mt-3 text-left",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"}),"As a family member, you can contribute to existing family goals, but only the family creator can add new family goals."]})]})]}),n&&e.jsx("div",{className:"block md:hidden mt-3",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2.5 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("h6",{className:"text-[11px] font-bold text-gray-800 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-chart-bar text-indigo-500 text-[10px]"}),"Contributions"]}),e.jsx("span",{className:"text-[10px] text-gray-500 truncate max-w-[150px]",children:b.find(F=>F.id===n)?.goal_name})]}),e.jsx("div",{className:"p-3",children:a?e.jsxs("div",{className:"text-center py-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Loading contributions..."})]}):r.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ot,{data:o,chartRef:m}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("h6",{className:"text-[11px] font-bold text-gray-800 mb-2",children:"Recent Contributions"}),e.jsx(Ot,{contributions:r.slice(0,5)})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-2",children:e.jsx("i",{className:"fas fa-users text-gray-400 text-sm"})}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"No contributions yet"}),e.jsxs("button",{className:"px-3 py-1.5 bg-indigo-500 text-white text-[11px] font-medium rounded-lg",onClick:()=>{const F=b.find(K=>K.id===n);F&&f(F)},children:[e.jsx("i",{className:"fas fa-plus mr-1 text-[9px]"}),"Be First"]})]})})]})})]})},Yt=({onAcceptSuccess:b})=>{const{user:l}=ut(),{showSuccessToast:s,showErrorToast:n}=Qe(),[a,r]=D.useState([]),[o,t]=D.useState(!0),[m,d]=D.useState(null),f=async()=>{if(l)try{t(!0);const g=await lt.getPendingInvitations(l.id);r(g)}catch(g){console.error("Error fetching invitations:",g),n("Failed to load invitations")}finally{t(!1)}},p=async g=>{if(l)try{d(g),await lt.acceptInvitation(g,l.id),s("Invitation accepted! Welcome to the family!"),b()}catch(j){console.error("Error accepting invitation:",j);const M=j instanceof Error?j.message:"Failed to accept invitation";n(M)}finally{d(null)}},N=async g=>{if(l)try{d(g),await lt.declineInvitation(g,l.id),s("Invitation declined"),await f()}catch(j){console.error("Error declining invitation:",j);const M=j instanceof Error?j.message:"Failed to decline invitation";n(M)}finally{d(null)}},x=g=>{switch(g){case"admin":return e.jsx("span",{className:"badge badge-danger",children:"Admin"});case"member":return e.jsx("span",{className:"badge badge-primary",children:"Member"});case"viewer":return e.jsx("span",{className:"badge badge-secondary",children:"Viewer"});default:return e.jsx("span",{className:"badge badge-light",children:g})}},u=g=>new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=g=>new Date(g)<new Date;return D.useEffect(()=>{f()},[l]),o?e.jsxs("div",{children:[e.jsx("div",{className:"block md:hidden py-8 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading invitations..."})]})}),e.jsxs("div",{className:"text-center py-5 hidden md:block",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading your invitations..."})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"block md:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-800",children:"Invitations"}),e.jsxs("p",{className:"text-[10px] text-gray-500",children:[a.length," pending invitation",a.length!==1?"s":""]})]}),e.jsx("button",{className:"w-8 h-8 rounded-full bg-indigo-100 hover:bg-indigo-200 text-indigo-600 flex items-center justify-center transition-all active:scale-95",onClick:f,disabled:o,children:e.jsx("i",{className:`fas ${o?"fa-spinner fa-spin":"fa-sync"} text-xs`})})]}),a.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-envelope-open text-gray-400 text-xl"})}),e.jsx("h5",{className:"text-sm font-semibold text-gray-600 mb-1",children:"No Invitations"}),e.jsx("p",{className:"text-xs text-gray-400",children:"You don't have any pending invitations."})]}):e.jsx("div",{className:"space-y-3",children:a.map(g=>e.jsxs("div",{className:`bg-white rounded-xl p-4 shadow-sm border ${w(g.expires_at)?"border-amber-200":"border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-home text-indigo-500 text-sm"})}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-sm font-bold text-gray-800",children:g.family_name||"Unknown Family"}),e.jsxs("p",{className:"text-[10px] text-gray-500",children:["From: ",g.inviter_name]})]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-semibold ${g.role==="admin"?"bg-rose-100 text-rose-600":g.role==="member"?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-600"}`,children:g.role.charAt(0).toUpperCase()+g.role.slice(1)})]}),g.message&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-2 mb-3",children:e.jsxs("p",{className:"text-[10px] text-gray-600 italic",children:['"',g.message,'"']})}),e.jsxs("div",{className:"flex items-center justify-between text-[9px] text-gray-400 mb-3",children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-calendar mr-1"}),u(g.created_at)]}),e.jsxs("span",{className:w(g.expires_at)?"text-amber-500":"",children:[e.jsx("i",{className:"fas fa-clock mr-1"}),w(g.expires_at)?"Expired":"Expires",": ",u(g.expires_at)]})]}),w(g.expires_at)?e.jsx("div",{className:"bg-amber-50 rounded-lg p-2 text-center",children:e.jsxs("p",{className:"text-[10px] text-amber-600",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),"Invitation expired. Contact admin for a new one."]})}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 py-2 bg-emerald-500 text-white text-xs font-medium rounded-lg hover:bg-emerald-600 transition-colors disabled:opacity-50",onClick:()=>p(g.id),disabled:m===g.id,children:m===g.id?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-1"}),"Accepting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check mr-1"}),"Accept"]})}),e.jsx("button",{className:"flex-1 py-2 bg-gray-100 text-gray-600 text-xs font-medium rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",onClick:()=>N(g.id),disabled:m===g.id,children:m===g.id?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-1"}),"Declining..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Decline"]})})]})]},g.id))})]}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-800 mb-2",children:"Family Invitations"}),e.jsxs("p",{className:"text-gray-600 mb-0",children:["You have ",a.length," pending invitation",a.length!==1?"s":""]})]}),e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:f,disabled:o,children:[e.jsx("i",{className:`fas ${o?"fa-spinner fa-spin":"fa-sync"} mr-1`}),"Refresh"]})]}),a.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center mb-3",style:{width:"80px",height:"80px",backgroundColor:"rgba(108, 117, 125, 0.1)"},children:e.jsx("i",{className:"fas fa-envelope-open fa-2x text-gray-400"})}),e.jsx("h5",{className:"text-gray-500 font-weight-light mb-2",children:"No Pending Invitations"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You don't have any family invitations at the moment. Ask a family member to invite you or look for public families to join."})]}):e.jsx("div",{className:"row",children:a.map(g=>e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:`card h-100 shadow-sm ${w(g.expires_at)?"border-warning":"border-primary"}`,children:[e.jsx("div",{className:"card-header bg-light border-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"card-title mb-0 text-primary",children:[e.jsx("i",{className:"fas fa-home mr-2"}),g.family_name||"Unknown Family"]}),x(g.role)]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("small",{className:"text-muted d-block mb-1",children:[e.jsx("i",{className:"fas fa-user mr-1"}),"Invited by: ",e.jsx("strong",{children:g.inviter_name})]}),g.inviter_email&&e.jsxs("small",{className:"text-muted d-block",children:[e.jsx("i",{className:"fas fa-envelope mr-1"}),g.inviter_email]})]}),g.message&&e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted d-block mb-1",children:"Message:"}),e.jsxs("p",{className:"small text-gray-700 mb-0 p-2 bg-light rounded",children:['"',g.message,'"']})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("small",{className:"text-muted d-block",children:[e.jsx("i",{className:"fas fa-calendar mr-1"}),"Invited: ",u(g.created_at)]}),e.jsxs("small",{className:`d-block ${w(g.expires_at)?"text-warning":"text-muted"}`,children:[e.jsx("i",{className:"fas fa-clock mr-1"}),w(g.expires_at)?"Expired":"Expires",": ",u(g.expires_at)]})]}),w(g.expires_at)&&e.jsxs("div",{className:"alert alert-warning py-2 mb-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-1"}),e.jsx("small",{children:"This invitation has expired. Contact the family admin for a new invitation."})]})]}),e.jsx("div",{className:"card-footer bg-white border-0",children:w(g.expires_at)?e.jsxs("button",{className:"btn btn-secondary btn-sm w-100",disabled:!0,children:[e.jsx("i",{className:"fas fa-ban mr-1"}),"Invitation Expired"]}):e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-success btn-sm flex-fill",onClick:()=>p(g.id),disabled:m===g.id,children:m===g.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1",role:"status","aria-hidden":"true"}),"Accepting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check mr-1"}),"Accept"]})}),e.jsx("button",{className:"btn btn-outline-secondary btn-sm flex-fill",onClick:()=>N(g.id),disabled:m===g.id,children:m===g.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-1",role:"status","aria-hidden":"true"}),"Declining..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-times mr-1"}),"Decline"]})})]})})]})},g.id))})]})]})},Ls=({onJoinSuccess:b})=>{const l=qt(),[s,n]=D.useState("create"),a=o=>{n(o)},r=()=>{l("/family/create")};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"block md:hidden animate__animated animate__fadeIn",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("i",{className:"fas fa-users text-indigo-500 text-2xl"})}),e.jsx("h1",{className:"text-lg font-bold text-gray-800 mb-1",children:"Family Finance"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Start collaborating together"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-xl p-1 mb-4",children:[e.jsxs("button",{type:"button",className:`flex-1 py-2 px-3 text-xs font-medium rounded-lg transition-all ${s==="create"?"bg-white text-indigo-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,onClick:()=>a("create"),children:[e.jsx("i",{className:"fas fa-plus-circle mr-1"}),"Create"]}),e.jsxs("button",{type:"button",className:`flex-1 py-2 px-3 text-xs font-medium rounded-lg transition-all ${s==="join"?"bg-white text-indigo-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,onClick:()=>a("join"),children:[e.jsx("i",{className:"fas fa-sign-in-alt mr-1"}),"Join"]}),e.jsxs("button",{type:"button",className:`flex-1 py-2 px-3 text-xs font-medium rounded-lg transition-all ${s==="invitations"?"bg-white text-indigo-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,onClick:()=>a("invitations"),children:[e.jsx("i",{className:"fas fa-envelope mr-1"}),"Invites"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4",children:[s==="create"&&e.jsx($s,{onCreateFamily:r}),s==="join"&&e.jsx(Wt,{onJoinSuccess:b}),s==="invitations"&&e.jsx(Yt,{onAcceptSuccess:b})]})]}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"d-flex justify-content-center mb-3",children:e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(78, 115, 223, 0.1)"},children:e.jsx("i",{className:"fas fa-users fa-2x text-primary"})})}),e.jsx("h1",{className:"h2 text-gray-800 mb-2",children:"Family Financial Management"}),e.jsx("p",{className:"text-gray-600 mb-0",children:"Start collaborating on your family finances"})]}),e.jsxs("div",{className:"card shadow mb-4",children:[e.jsx("div",{className:"card-header py-3",children:e.jsxs("ul",{className:"nav nav-tabs card-header-tabs",children:[e.jsx("li",{className:"nav-item",children:e.jsxs("button",{type:"button",className:`nav-link btn btn-link ${s==="create"?"active":""}`,onClick:()=>a("create"),children:[e.jsx("i",{className:"fas fa-plus-circle mr-1"})," Create Family"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{type:"button",className:`nav-link btn btn-link ${s==="join"?"active":""}`,onClick:()=>a("join"),children:[e.jsx("i",{className:"fas fa-sign-in-alt mr-1"})," Join Family"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{type:"button",className:`nav-link btn btn-link ${s==="invitations"?"active":""}`,onClick:()=>a("invitations"),children:[e.jsx("i",{className:"fas fa-envelope mr-1"})," Invitations"]})})]})}),e.jsxs("div",{className:"card-body",children:[s==="create"&&e.jsx(Is,{onCreateFamily:r}),s==="join"&&e.jsx(Gs,{onJoinSuccess:b}),s==="invitations"&&e.jsx(Bs,{onAcceptSuccess:b})]})]})]})]})},$s=({onCreateFamily:b})=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-800 mb-2",children:"Create Your Family"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Start managing finances together with your household."}),e.jsxs("button",{type:"button",className:"w-full py-3 bg-indigo-500 text-white text-sm font-medium rounded-xl hover:bg-indigo-600 transition-colors flex items-center justify-center gap-2",onClick:b,children:[e.jsx("i",{className:"fas fa-home"}),"Create Family Group"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-100 flex items-center justify-center mx-auto mb-2",children:e.jsx("i",{className:"fas fa-chart-line text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] font-semibold text-gray-700",children:"Shared"}),e.jsx("p",{className:"text-[8px] text-gray-400",children:"Overview"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center mx-auto mb-2",children:e.jsx("i",{className:"fas fa-bullseye text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] font-semibold text-gray-700",children:"Team"}),e.jsx("p",{className:"text-[8px] text-gray-400",children:"Goals"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-rose-100 flex items-center justify-center mx-auto mb-2",children:e.jsx("i",{className:"fas fa-shield-alt text-rose-500 text-xs"})}),e.jsx("p",{className:"text-[9px] font-semibold text-gray-700",children:"Privacy"}),e.jsx("p",{className:"text-[8px] text-gray-400",children:"Control"})]})]})]}),Is=({onCreateFamily:b})=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("h3",{className:"text-gray-800 mb-3",children:"Create Your Family Budget"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Start managing your family's finances together. Collaborate on budgets, track shared expenses, and achieve your financial goals as a team."}),e.jsxs("button",{type:"button",className:"btn btn-primary btn-lg shadow-sm",onClick:b,style:{minWidth:"200px",padding:"12px 30px"},children:[e.jsx("i",{className:"fas fa-home mr-2"}),"Create Family Group"]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4 mb-4",children:e.jsx("div",{className:"card border-0 h-100",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center mb-3",style:{width:"60px",height:"60px",backgroundColor:"rgba(28, 200, 138, 0.1)"},children:e.jsx("i",{className:"fas fa-chart-line fa-2x text-success"})}),e.jsx("h5",{className:"card-title",children:"Shared Financial Overview"}),e.jsx("p",{className:"card-text text-gray-600 small",children:"View combined family income, expenses, and savings in real-time dashboards."})]})})}),e.jsx("div",{className:"col-md-4 mb-4",children:e.jsx("div",{className:"card border-0 h-100",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center mb-3",style:{width:"60px",height:"60px",backgroundColor:"rgba(246, 194, 62, 0.1)"},children:e.jsx("i",{className:"fas fa-bullseye fa-2x text-warning"})}),e.jsx("h5",{className:"card-title",children:"Collaborative Goals"}),e.jsx("p",{className:"card-text text-gray-600 small",children:"Set and track family financial goals together. Everyone can contribute and see progress."})]})})}),e.jsx("div",{className:"col-md-4 mb-4",children:e.jsx("div",{className:"card border-0 h-100",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("div",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center mb-3",style:{width:"60px",height:"60px",backgroundColor:"rgba(231, 74, 59, 0.1)"},children:e.jsx("i",{className:"fas fa-shield-alt fa-2x text-danger"})}),e.jsx("h5",{className:"card-title",children:"Privacy & Control"}),e.jsx("p",{className:"card-text text-gray-600 small",children:"You control who can see what. Set permissions and maintain financial privacy."})]})})})]})]}),Gs=({onJoinSuccess:b})=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("h3",{className:"text-gray-800 mb-2",children:"Join an Existing Family"}),e.jsx("p",{className:"text-gray-600",children:"Find and request to join a family group that's already been created."})]}),e.jsx(Wt,{onJoinSuccess:b})]}),Bs=({onAcceptSuccess:b})=>e.jsx("div",{children:e.jsx(Yt,{onAcceptSuccess:b})}),ta=()=>{const b=qt(),{user:l}=ut(),{showSuccessToast:s,showErrorToast:n}=Qe(),[a,r]=cs(),{familyId:o}=ds(),{familyData:t,setFamilyData:m,isLoadingFamilyData:d}=xs(l?.id,n),{members:f,fetchFamilyMembers:p,setMembers:N}=gs(n),{familyGoals:x,loadingFamilyGoals:u,setSharedGoalPerformanceChartData:w,setSharedGoalBreakdownChartData:g,fetchFamilyGoals:j,setFamilyGoals:M}=bs(n);ys(n,s);const[y,S]=D.useState(null),[B,T]=D.useState([]),[Y,C]=D.useState([]),[h]=D.useState(null),c=a.get("tab")||"overview",[i,v]=D.useState(c),[E,k]=D.useState(null),[P,R]=D.useState(null),[q,X]=D.useState(!1),[J,Q]=D.useState(!1),[ne,F]=D.useState(""),K=I=>{r(H=>{const ae=new URLSearchParams(H);return ae.set("tab",I),ae}),v(I)},[le,ve]=D.useState([]),[_,A]=D.useState(null),[L,G]=D.useState(null),[z,U]=D.useState(null),[$,W]=D.useState(!1),[Z,O]=D.useState(!1),[ee,he]=D.useState(void 0),[be,ue]=D.useState(0),[xe,we]=D.useState(0),[Fe,Ce]=D.useState(0),[Ee]=D.useState(!1),[Re]=D.useState(null),[ge,We]=D.useState(!1),$e=D.useRef(null),Oe=D.useRef(null),xt=D.useRef(null),gt=D.useRef(null),ft=D.useRef(null),pt=D.useRef(null),[Jt,Kt]=D.useState([]),[Te,bt]=D.useState(!1),[st,at]=D.useState(!1),[yt,Xt]=D.useState(0),Zt=2e3,rt=D.useRef(j);rt.current=j;const jt=D.useCallback(async I=>{const H=Date.now();if(H-yt<Zt){console.log("Subscription refresh throttled - too frequent");return}Xt(H),await j(I)},[j,yt]),vt=D.useMemo(()=>{const I=Number(be.toFixed(2)),H=Number(xe.toFixed(2)),ae=Number(Fe.toFixed(2)),te=x.length;return{totalExpenses:I,totalIncome:H,budgetUtilization:ae,familyGoalsCount:te}},[be,xe,Fe,x.length]),[Nt,Qt]=D.useState(0),De=D.useCallback((I,H)=>{if(H?.stopPropagation(),E===I)k(null),R(null);else{k(I);const ae=H?.target?.getBoundingClientRect();ae&&R({top:ae.bottom+5,left:ae.left})}},[E]),wt=(I,H=!1)=>{const te=`badge ${{admin:"badge-danger",member:"badge-primary",viewer:"badge-info"}[I]||"badge-secondary"}`,se=H?"Owner":I.charAt(0).toUpperCase()+I.slice(1);return e.jsx("span",{className:te,children:se})},_t=I=>{const H=new Date(I),ae=new Date,te=H.getTime()-ae.getTime();return Math.ceil(te/(1e3*60*60*24))},Ct=async I=>{console.log("fetchGoalContributions called for:",I);try{W(!0),U(I);const{data:H,error:ae}=await V.from("goal_contributions").select("*").eq("goal_id",I).order("contribution_date",{ascending:!1});if(ae){console.error("Error fetching contributions:",ae),n("Failed to load contribution data"),ve([]),A(null),G(null);return}let te=H||[];if(H&&H.length>0){const se=[...new Set(H.map(ce=>ce.user_id))],{data:re,error:de}=await V.from("profiles").select("id, full_name, avatar_url").in("id",se);!de&&re&&(te=H.map(ce=>({...ce,profiles:re.find(fe=>fe.id===ce.user_id)})))}if(ve(te),te&&te.length>0){const se=te.reduce((de,ce)=>{const fe=ce.user_id;return de[fe]||(de[fe]={userId:fe,userName:ce.profiles?.full_name||"Unknown",userAvatar:ce.profiles?.avatar_url,totalAmount:0,contributionCount:0,contributions:[]}),de[fe].totalAmount+=ce.amount,de[fe].contributionCount+=1,de[fe].contributions.push(ce),de},{}),re=Object.values(se);A({chart:{type:"column"},title:{text:""},xAxis:{categories:re.map(de=>de.userName),crosshair:!0},yAxis:{min:0,title:{text:"Amount (₱)"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>₱{point.y:.2f}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Total Contributions",data:re.map(de=>de.totalAmount),color:"#4e73df"}],credits:{enabled:!1}}),G({chart:{type:"pie"},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>₱{point.y:.2f}</b> ({point.percentage:.1f}%)"},accessibility:{point:{valueSuffix:"%"}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %"}}},series:[{name:"Contribution",colorByPoint:!0,data:re.map(de=>({name:de.userName,y:de.totalAmount}))}],credits:{enabled:!1}})}else A(null),G(null)}catch(H){console.error("Error in fetchGoalContributions:",H),n("An error occurred while loading contributions"),ve([]),A(null),G(null)}finally{W(!1)}},it={"family-visibility":{title:"Family Visibility",description:"Public families can be discovered by other users. Private families require an invite."},"family-income":{title:"Family Savings Target",description:"Total target amount for all active family goals. This represents your family's collective savings objectives."},"family-expenses":{title:"Family Goals Progress",description:"Total amount currently saved toward all family goals. This shows your family's progress toward your shared objectives."},"family-balance":{title:"Remaining to Save",description:"Amount still needed to reach all family goals. This is the difference between your targets and current progress."},"family-savings-rate":{title:"Goals Progress Rate",description:"Percentage of family goals completed, calculated as (Current Progress / Total Targets) × 100."}},es=`family-changes-${l?.id}`,ts=`family-members-${l?.id}`,kt=`family-goals-${t?.id}`,ss=`family-transactions-${t?.id}`,as=`family-activity-${t?.id}`,St=`user-membership-${l?.id}`,He=D.useCallback(async I=>{try{if(!I)return;const{data:H,error:ae}=await V.from("goals").select("*").eq("family_id",I).eq("status","in_progress");if(!ae&&H){const te=H.reduce((fe,ye)=>fe+(ye.target_amount||0),0),se=H.reduce((fe,ye)=>fe+(ye.current_amount||0),0),re=te-se,de=te>0?se/te*100:0;we(te),ue(se);const ce=te>0?se/te*100:0;Ce(ce),S({income:te,expenses:se,balance:re,savingsRate:de})}else we(0),ue(0),Ce(0),S({income:0,expenses:0,balance:0,savingsRate:0})}catch(H){console.error("Error updating family goals metrics:",H)}},[t]),Ae=D.useCallback(async(I,H)=>{if(!(!I||!H.length))try{const ae=[],{data:te,error:se}=await V.from("family_members").select(`
          id,
          user_id,
          created_at
        `).eq("family_id",I).eq("status","active").order("created_at",{ascending:!1}).limit(3);if(!se&&te&&te.length>0){const Se=te.map(oe=>oe.user_id),{data:je,error:Ne}=await V.from("profiles").select("id, email, full_name").in("id",Se);!Ne&&je&&te.forEach(oe=>{const ke=je.find(Ve=>Ve.id===oe.user_id);ke&&ae.push({id:`join-${oe.id}`,type:"join",user:ke.full_name||ke.email||"Family Member",description:"joined the family.",date:oe.created_at,icon:"fa-user-plus"})})}const{data:re,error:de}=await V.from("goals").select(`
          id,
          user_id,
          goal_name,
          created_at
        `).in("user_id",H).order("created_at",{ascending:!1}).limit(3);if(!de&&re&&re.length>0){const Se=re.map(oe=>oe.user_id),{data:je,error:Ne}=await V.from("profiles").select("id, email, full_name").in("id",Se);!Ne&&je&&re.forEach(oe=>{const ke=je.find(Ve=>Ve.id===oe.user_id);ke&&ae.push({id:`goal-${oe.id}`,type:"goal",user:ke.full_name||ke.email||"Family Member",description:`created a new goal '${oe.goal_name}'.`,date:oe.created_at,icon:"fa-flag-checkered"})})}const{data:ce,error:fe}=await V.from("transactions").select(`
          id,
          user_id,
          amount,
          description,
          date,
          created_at,
          type
        `).in("user_id",H).order("created_at",{ascending:!1}).limit(4);if(!fe&&ce&&ce.length>0){const Se=ce.map(oe=>oe.user_id),{data:je,error:Ne}=await V.from("profiles").select("id, email, full_name").in("id",Se);!Ne&&je&&ce.forEach(oe=>{const ke=je.find(Ve=>Ve.id===oe.user_id);ke&&ae.push({id:`tx-${oe.id}`,type:"transaction",user:ke.full_name||ke.email||"Family Member",description:`${oe.type==="expense"?"spent":"received"} ${me(oe.amount)} ${oe.description?`for ${oe.description}`:""}.`,date:oe.created_at,icon:oe.type==="expense"?"fa-credit-card":"fa-money-bill-alt"})})}const ye=ae.sort((Se,je)=>new Date(je.date).getTime()-new Date(Se.date).getTime()).slice(0,10);T(ye)}catch(ae){console.error("Error updating activity feed:",ae)}},[]),Je=D.useCallback(async()=>{if(!(!t?.id||Te)){bt(!0);try{switch(i){case"overview":await j(t.id),await He(t.id),Qt(I=>I+1);break;case"members":await p(t.id);break;case"activity":if(f.length>0){const I=f.map(H=>H.user_id);await Ae(t.id,I)}break;case"goals":await j(t.id);break;default:break}s("Data refreshed successfully")}catch(I){console.error("Error refreshing data:",I),n("Failed to refresh data")}finally{bt(!1)}}},[t?.id,Te,i,j,He,p,f,Ae,s,n]),Pe=D.useCallback(async(I=0,H=3,ae)=>{if(l&&!d)try{if(I>=H){n("Could not load family data. Please refresh the page.");return}let te;try{te=await pe.getUserFamily(l.id)}catch(re){if(console.error("Error getting user family:",re),re instanceof Error&&(re.message.includes("400")||re.message.includes("Bad Request")||re.message.includes("RPC")||re.message.includes("get_family_membership"))){n("Error connecting to family data. Please try refreshing the page."),m(null);return}throw re}if(!te){if(I<H-1){setTimeout(()=>{Pe(I+1,H)},1500);return}m(null);return}m(te),We(l.id===te.created_by);const se=await pe.getFamilyMembers(te.id);if(N(se),se.length>0)try{await Promise.all([He(te.id),rt.current(te.id),Ae(te.id,se.map(re=>re.user_id))])}catch(re){console.error("Error fetching related data:",re)}else N([]),C([]),M([]),T([]),S({income:0,expenses:0,balance:0,savingsRate:0}),w(null),g(null)}catch(te){console.error("Error in fetchFamilyData:",te);const se=te instanceof Error?te.message:"An unknown error occurred";if(se.includes("400")||se.includes("Bad Request")||se.includes("RPC")||se.includes("get_family_membership")){n("Database connection error. Please try refreshing the page."),m(null);return}if(I<H-1){setTimeout(()=>{Pe(I+1,H)},1500);return}n(`Error loading family data: ${se}`)}},[l,d,m,M,N,g,w,n,Ae,He]);D.useEffect(()=>{if(!l){n("Please sign in to view your family dashboard");return}if(st){console.log("Family data fetch already in progress, skipping...");return}const I=o||a.get("familyId"),ae=new URLSearchParams(window.location.search).get("created")==="true";at(!0);const te=setTimeout(async()=>{try{ae?await Pe(0,5):I?await Pe(0,3,I):await Pe(0,3)}finally{at(!1)}},1e3);return()=>{clearTimeout(te),at(!1)}},[l,n,o,a,Pe]),D.useEffect(()=>{if(t?.id&&l&&!st&&!Te){console.log("Fetching family goals on mount or family data change");const I=t.id,H=setTimeout(()=>{t?.id===I&&!st&&!Te&&rt.current(t.id).catch(ae=>{console.error("Error fetching goals in useEffect:",ae)})},3e3);return()=>clearTimeout(H)}},[t?.id,l]),D.useEffect(()=>{if(!l)return;console.log("Setting up user membership subscription");const I=V.channel(St).on("postgres_changes",{event:"*",schema:"public",table:"family_members",filter:`user_id=eq.${l.id}`},async H=>{console.log("User membership changed:",H);try{H.eventType==="INSERT"||H.eventType==="UPDATE"&&H.new&&H.new.status==="active"||(H.eventType==="DELETE"||H.eventType==="UPDATE"&&H.new&&H.new.status!=="active")&&(m(null),N([]),C([]),M([]),T([]),S(null),w(null),g(null))}catch(ae){console.error("Error handling membership change:",ae)}}).subscribe();return()=>{I.unsubscribe()}},[l,St]),D.useEffect(()=>{if(!l||!t)return;const I=[],H=setTimeout(()=>{console.log(`Setting up real-time subscriptions for family ${t.id}`);try{const ae=V.channel(es).on("postgres_changes",{event:"*",schema:"public",table:"families",filter:`id=eq.${t.id}`},se=>{console.log("Family update received:",se),se.eventType==="UPDATE"&&se.new&&m(se.new)}).subscribe();I.push(ae);const te=V.channel(ts).on("postgres_changes",{event:"*",schema:"public",table:"family_members",filter:`family_id=eq.${t.id}`},async se=>{console.log("Family member update received:",se);const{data:re,error:de}=await V.from("family_members").select(`
                id,
                family_id,
                user_id,
                role,
                status,
                created_at,
                updated_at
              `).eq("family_id",t.id).eq("status","active");if(!de&&re){let ce=[];if(re&&re.length>0){const fe=re.map(je=>je.user_id),{data:ye,error:Se}=await V.from("profiles").select(`
                    id,
                    email,
                    full_name,
                    avatar_url,
                    created_at,
                    updated_at
                  `).in("id",fe);Se&&console.error("Error fetching user profiles:",Se),ce=re.map(je=>{const Ne=ye?.find(oe=>oe.id===je.user_id);return{...je,user:Ne?{id:Ne.id,email:Ne.email,created_at:Ne.created_at,updated_at:Ne.updated_at,full_name:Ne.full_name,avatar_url:Ne.avatar_url}:void 0,joined_at:je.created_at||""}})}if(N(ce),ce.length>0){const fe=ce.map(ye=>ye.user_id);await Ae(t.id,fe)}}}).subscribe();if(I.push(te),f.length>0){const se=f.map(re=>re.user_id);if(se.length>0){const re=V.channel(kt).on("postgres_changes",{event:"*",schema:"public",table:"goals",filter:`family_id=eq.${t.id}`},async ye=>{console.log("Family goal update received:",ye),await jt(t.id),await Ae(t.id,se)}).subscribe(),de=V.channel(`${kt}-sharing`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"goals"},async ye=>{ye.new&&ye.new.family_id===t.id&&(console.log("Goal shared with family:",ye),await jt(t.id),await Ae(t.id,se))}).subscribe();I.push(de),I.push(re);const ce=V.channel(ss).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=in.(${se.join(",")})`},async ye=>{console.log("Transaction update received:",ye),await He(t.id),await Ae(t.id,se)}).subscribe();I.push(ce);const fe=V.channel(as).on("postgres_changes",{event:"*",schema:"public",table:"family_members",filter:`family_id=eq.${t.id}`},async ye=>{await Ae(t.id,se)}).subscribe();I.push(fe)}}Kt(I)}catch(ae){console.error("Error setting up subscriptions:",ae)}},2e3);return()=>{clearTimeout(H),Jt.forEach(ae=>V.removeChannel(ae))}},[l,t,f]);const Mt=I=>{he(I),O(!0)},Ke=()=>{X(!0)},ze=()=>{X(!1),Q(!1),F("")},rs=async()=>{if(!(!t||!l)){Q(!0);try{if(l.id===t.created_by){n("As the family creator, you must delete the family instead of leaving it."),Q(!1),ze();return}const{error:I}=await V.from("family_members").delete().eq("family_id",t.id).eq("user_id",l.id);if(I)throw new Error(`Error leaving family: ${I.message}`);try{await Dt()}catch(H){console.warn("Failed to refresh materialized view (non-critical):",H)}s("You've successfully left the family group"),setTimeout(()=>{b("/family/create")},300)}catch(I){console.error("Error leaving family:",I);const H=I instanceof Error?I.message:"An unknown error occurred";n(`Failed to leave family: ${H}`),Q(!1),ze()}}},is=async()=>{if(!(!t||!l)){Q(!0);try{if(l.id!==t.created_by){n("Only the family owner can permanently delete the family."),Q(!1),ze();return}if(ne!==t.family_name){n("Family name confirmation does not match. Please type the exact family name."),Q(!1);return}await pe.deleteFamily(t.id,l.id);try{await Dt()}catch(I){console.warn("Failed to refresh materialized view (non-critical):",I)}s(`Family "${t.family_name}" has been permanently deleted`),setTimeout(()=>{b("/family/create")},300)}catch(I){console.error("Error deleting family:",I);const H=I instanceof Error?I.message:"An unknown error occurred";n(`Failed to delete family: ${H}`),Q(!1),ze()}}},Ft=()=>{t&&b(`/family/${t.id}/edit`)},ns=D.useCallback(async()=>{l&&setTimeout(()=>{Pe(0,3)},1e3)},[l,Pe]);return e.jsx("div",{className:"container-fluid",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block md:hidden py-12 animate__animated animate__fadeIn",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"mt-3 text-xs text-gray-500 font-medium",children:"Loading family data..."})]})}),e.jsxs("div",{className:"hidden md:block text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}),e.jsx("h5",{className:"text-gray-600",children:"Loading family information..."})]})]}):e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[q&&e.jsx("div",{className:"modal",style:{display:"block",backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:ge?"Confirm Deletion":"Confirm Leave Family"}),e.jsx("button",{type:"button",className:"close",onClick:ze,disabled:J,children:e.jsx("span",{"aria-hidden":"true",children:"×"})})]}),e.jsxs("div",{className:"modal-body text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"rounded-circle mx-auto d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",backgroundColor:"rgba(220, 53, 69, 0.2)"},children:e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"})})}),ge?e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"text-danger mb-3",children:"⚠️ Permanent Family Deletion ⚠️"}),e.jsxs("p",{className:"mb-3",children:["You are about to ",e.jsx("strong",{children:"permanently delete"})," your family group ",e.jsxs("strong",{children:['"',t?.family_name,'"']}),"."]}),e.jsxs("div",{className:"alert alert-danger text-left mb-4",children:[e.jsxs("h6",{className:"text-danger mb-2",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),"This action cannot be undone!"]}),e.jsxs("ul",{className:"mb-0",children:[e.jsx("li",{children:"All family member associations will be permanently removed"}),e.jsx("li",{children:"All shared family goals and progress will be deleted"}),e.jsx("li",{children:"All family activity history will be lost"}),e.jsx("li",{children:"All pending invitations will be cancelled"})]})]}),e.jsx("p",{className:"mb-3",children:"To confirm deletion, please type the exact name of your family:"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"font-weight-bold mb-2",children:['Type "',t?.family_name,'" to confirm:']}),e.jsx("input",{type:"text",className:"form-control text-center",value:ne,onChange:I=>F(I.target.value),placeholder:t?.family_name,disabled:J,style:{fontSize:"16px",padding:"12px"}})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:['Are you sure you want to leave the family group "',t?.family_name,'"?']}),e.jsx("p",{className:"text-muted small",children:"You will no longer have access to family financial data or shared goals. Your personal data will remain intact."})]})]}),e.jsxs("div",{className:"modal-footer d-flex justify-content-center",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:ze,disabled:J,children:"Cancel"}),ge?e.jsx("button",{type:"button",className:"btn btn-danger",onClick:is,disabled:J||ne!==t?.family_name,children:J?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-trash mr-2"}),"Permanently Delete Family"]})}):e.jsx("button",{type:"button",className:"btn btn-warning",onClick:rs,disabled:J,children:J?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"}),"Leaving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-sign-out-alt mr-2"}),"Leave Family"]})})]})]})})}),e.jsx(us,{isOpen:Z,goals:x.map(I=>({...I,target_date:I.target_date||I.deadline})),preSelectedGoal:ee?{...ee,target_date:ee.target_date||ee.deadline}:void 0,onClose:()=>{O(!1),he(void 0)},onContributionSuccess:async()=>{t?.id&&await j(t.id),O(!1),he(void 0)}}),e.jsx("div",{className:"block md:hidden mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-base font-bold text-gray-800 truncate",children:t?.family_name||"Family"}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[ge&&e.jsx("span",{className:"px-1.5 py-0.5 bg-indigo-100 text-indigo-600 text-[9px] font-semibold rounded-full",children:"Creator"}),t&&e.jsxs("span",{className:`px-1.5 py-0.5 text-[9px] font-semibold rounded-full ${t.is_public?"bg-emerald-100 text-emerald-600":"bg-gray-100 text-gray-600"}`,children:[e.jsx("i",{className:`fas ${t.is_public?"fa-globe":"fa-lock"} mr-0.5 text-[8px]`}),t.is_public?"Public":"Private"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Je,disabled:Te,className:"w-9 h-9 rounded-full bg-emerald-500 hover:bg-emerald-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95 disabled:opacity-50","aria-label":"Refresh",children:e.jsx("i",{className:`fas fa-sync text-xs ${Te?"fa-spin":""}`})}),e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"w-9 h-9 rounded-full bg-indigo-500 hover:bg-indigo-600 text-white flex items-center justify-center shadow-md transition-all active:scale-95",type:"button",id:"mobileActionsDropdown","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false","aria-label":"More actions",children:e.jsx("i",{className:"fas fa-ellipsis-v text-xs"})}),e.jsxs("div",{className:"dropdown-menu dropdown-menu-right shadow","aria-labelledby":"mobileActionsDropdown",children:[t&&e.jsxs(e.Fragment,{children:[e.jsxs(_e,{to:`/family/${t.id}/invite`,className:"dropdown-item text-sm",children:[e.jsx("i",{className:"fas fa-user-plus fa-sm fa-fw mr-2 text-success"}),"Invite Member"]}),ge?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"dropdown-item text-sm",onClick:Ft,children:[e.jsx("i",{className:"fas fa-edit fa-sm fa-fw mr-2 text-primary"}),"Edit Family"]}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item text-sm text-danger",onClick:Ke,children:[e.jsx("i",{className:"fas fa-trash fa-sm fa-fw mr-2"}),"Delete Family"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item text-sm text-warning",onClick:Ke,children:[e.jsx("i",{className:"fas fa-sign-out-alt fa-sm fa-fw mr-2"}),"Leave Family"]})]})]}),!t&&e.jsxs(_e,{to:"/family/create",className:"dropdown-item text-sm",children:[e.jsx("i",{className:"fas fa-home fa-sm fa-fw mr-2 text-success"}),"Create Family"]})]})]})]})]})}),e.jsxs("div",{className:"d-none d-md-flex align-items-center justify-content-between mb-4",children:[e.jsxs("h1",{className:"h3 mb-0 text-gray-800 animate__animated animate__fadeIn",children:[t?.family_name||"Family Dashboard",ge&&e.jsx("span",{className:"badge badge-primary ml-2",children:"Creator"}),t&&e.jsxs("span",{className:`badge ml-2 ${t.is_public?"badge-success":"badge-secondary"}`,style:{cursor:"pointer"},onClick:I=>De("family-visibility",I),children:[e.jsx("i",{className:`fas ${t.is_public?"fa-globe":"fa-lock"} mr-1`}),t.is_public?"Public":"Private"]})]}),e.jsx("div",{className:"animate__animated animate__fadeIn",children:t?e.jsxs(e.Fragment,{children:[ge?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Ke,className:"btn btn-danger shadow-sm mr-2",style:{minWidth:"145px",padding:"10px 20px",fontSize:"16px"},children:[e.jsx("i",{className:"fas fa-trash mr-2"})," Delete Family"]}),e.jsxs("button",{onClick:Ft,className:"btn btn-primary mr-2 shadow-sm",style:{minWidth:"145px",padding:"10px 20px",fontSize:"16px"},children:[e.jsx("i",{className:"fas fa-edit mr-2"})," Edit Family"]})]}):e.jsxs("button",{onClick:Ke,className:"btn btn-warning shadow-sm mr-2",style:{minWidth:"145px",padding:"10px 20px",fontSize:"16px"},children:[e.jsx("i",{className:"fas fa-sign-out-alt mr-2"})," Leave Family"]}),e.jsxs(_e,{to:`/family/${t.id}/invite`,className:"btn btn-success shadow-sm",style:{minWidth:"145px",padding:"10px 20px",fontSize:"16px"},children:[e.jsx("i",{className:"fas fa-user-plus mr-2"})," Invite Member"]})]}):e.jsxs(_e,{to:"/family/create",className:"btn btn-success shadow-sm mr-2",style:{minWidth:"145px",padding:"10px 20px",fontSize:"16px"},children:[e.jsx("i",{className:"fas fa-home mr-2"}),"Create Family"]})})]}),e.jsxs("div",{className:"block md:hidden mb-4",children:[e.jsxs("div",{className:`bg-gradient-to-br ${(y?.savingsRate||0)>=75?"from-emerald-500 via-teal-500 to-cyan-500":(y?.savingsRate||0)>=50?"from-blue-500 via-indigo-500 to-purple-500":"from-amber-500 via-orange-500 to-rose-500"} rounded-2xl p-4 mb-3 shadow-lg`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-white/80 text-xs font-medium",children:"Goals Progress"}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:`fas fa-${(y?.savingsRate||0)>=75?"trophy":(y?.savingsRate||0)>=50?"chart-line":"flag"} text-white text-sm`})})]}),e.jsx("div",{className:"text-white text-2xl font-bold mb-1",children:y?Ze(y.savingsRate):"0%"}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:`text-xs font-medium ${(y?.savingsRate||0)>=75?"text-green-200":(y?.savingsRate||0)>=50?"text-blue-200":"text-amber-200"}`,children:[e.jsx("i",{className:`fas fa-${(y?.savingsRate||0)>=75?"check-circle":(y?.savingsRate||0)>=50?"arrow-up":"info-circle"} text-[10px] mr-1`}),(y?.savingsRate||0)>=75?"Excellent Progress":(y?.savingsRate||0)>=50?"Good Progress":"Getting Started"]})}),e.jsx("div",{className:"mt-3 w-full bg-white/20 rounded-full h-1.5",children:e.jsx("div",{className:"bg-white h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.min(y?.savingsRate||0,100)}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-bullseye text-blue-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Target"}),e.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",children:y?me(y.income):me(0)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-piggy-bank text-emerald-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Saved"}),e.jsx("p",{className:"text-sm font-bold text-gray-800 truncate",children:y?me(y.expenses):me(0)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-3 shadow-sm border border-gray-100",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center mb-2",children:e.jsx("i",{className:"fas fa-hourglass-half text-amber-500 text-xs"})}),e.jsx("p",{className:"text-[9px] text-gray-500 font-medium uppercase tracking-wide",children:"Left"}),e.jsx("p",{className:`text-sm font-bold truncate ${(y?.balance||0)<0?"text-rose-600":"text-gray-800"}`,children:y?me(y.balance):me(0)})]})]})]}),e.jsx("div",{className:"d-none d-md-block",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xl-3 col-md-6 mb-4",children:e.jsx("div",{className:"card border-left-primary shadow h-100 py-2",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-primary text-uppercase mb-1",children:["Family Savings Target",e.jsx("i",{className:"fas fa-info-circle ml-1 text-gray-400",style:{cursor:"pointer"},onClick:I=>De("family-income",I)})]}),e.jsx("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:y?me(y.income):me(0)}),!y||y.income===0?e.jsxs("div",{className:"small text-gray-500 mt-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"})," No family goals set yet"]}):null]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-calendar fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6 mb-4",children:e.jsx("div",{className:"card border-left-danger shadow h-100 py-2",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-danger text-uppercase mb-1",children:["Family Goals Progress",e.jsx("i",{className:"fas fa-info-circle ml-1 text-gray-400",style:{cursor:"pointer"},onClick:I=>De("family-expenses",I)})]}),e.jsx("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:y?me(y.expenses):me(0)}),!y||y.expenses===0?e.jsxs("div",{className:"small text-gray-500 mt-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"})," No progress recorded yet"]}):null]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fa-solid fa-people-roof fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6 mb-4",children:e.jsx("div",{className:"card border-left-info shadow h-100 py-2",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-info text-uppercase mb-1",children:["Remaining to Save",e.jsx("i",{className:"fas fa-info-circle ml-1 text-gray-400",style:{cursor:"pointer"},onClick:I=>De("family-balance",I)})]}),e.jsx("div",{className:"h5 mb-0 font-weight-bold text-gray-800",children:y?me(y.balance):me(0)}),y?null:e.jsxs("div",{className:"small text-gray-500 mt-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"})," Create family goals to track progress"]})]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-clipboard-list fa-2x text-gray-300"})})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6 mb-4",children:e.jsx("div",{className:"card border-left-success shadow h-100 py-2",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsxs("div",{className:"col mr-2",children:[e.jsxs("div",{className:"text-xs font-weight-bold text-success text-uppercase mb-1",children:["Goals Progress Rate",e.jsx("i",{className:"fas fa-info-circle ml-1 text-gray-400",style:{cursor:"pointer"},onClick:I=>De("family-savings-rate",I)})]}),e.jsxs("div",{className:"row no-gutters align-items-center",children:[e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"h5 mb-0 mr-3 font-weight-bold text-gray-800",children:y?Ze(y.savingsRate):"0%"})}),e.jsx("div",{className:"col",children:e.jsx("div",{className:"progress progress-sm mr-2",children:e.jsx("div",{className:"progress-bar bg-success",role:"progressbar",style:{width:`${y?y.savingsRate:0}%`}})})})]}),!y||y.savingsRate===0?e.jsxs("div",{className:"small text-gray-500 mt-2",children:[e.jsx("i",{className:"fas fa-info-circle mr-1"})," Set family goals to track progress"]}):null]}),e.jsx("div",{className:"col-auto",children:e.jsx("i",{className:"fas fa-percentage fa-2x text-gray-300"})})]})})})})]})}),E&&P&&it[E]&&e.jsxs("div",{className:"tip-box light",style:{position:"absolute",top:`${P.top}px`,left:`${P.left}px`,transform:"translateX(-50%)",zIndex:1e3,background:"white",padding:"12px 15px",borderRadius:"8px",boxShadow:"0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15)",maxWidth:"300px",border:"1px solid rgba(0, 0, 0, 0.05)"},children:[e.jsx("div",{className:"font-weight-bold mb-2",children:it[E].title}),e.jsx("p",{className:"mb-0",children:it[E].description})]}),e.jsx("div",{className:"block md:hidden mb-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex bg-slate-50 overflow-x-auto scrollbar-hide",children:[e.jsxs("button",{onClick:()=>K("overview"),className:`flex-shrink-0 flex-1 min-w-[80px] py-3 text-[11px] font-semibold transition-all relative ${i==="overview"?"text-indigo-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-chart-pie mr-1 text-[10px]"}),"Overview",i==="overview"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]}),e.jsxs("button",{onClick:()=>K("goals"),className:`flex-shrink-0 flex-1 min-w-[80px] py-3 text-[11px] font-semibold transition-all relative ${i==="goals"?"text-indigo-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-flag-checkered mr-1 text-[10px]"}),"Goals",i==="goals"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]}),e.jsxs("button",{onClick:()=>K("members"),className:`flex-shrink-0 flex-1 min-w-[80px] py-3 text-[11px] font-semibold transition-all relative ${i==="members"?"text-indigo-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-users mr-1 text-[10px]"}),"Members",e.jsx("span",{className:"ml-1 bg-gray-200 text-gray-600 px-1 py-0.5 rounded-full text-[9px]",children:f.length}),i==="members"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]}),e.jsxs("button",{onClick:()=>K("activity"),className:`flex-shrink-0 flex-1 min-w-[80px] py-3 text-[11px] font-semibold transition-all relative ${i==="activity"?"text-indigo-600 bg-white":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-history mr-1 text-[10px]"}),"Activity",i==="activity"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600"})]})]}),e.jsxs("div",{className:"p-3",children:[i==="overview"&&e.jsx(It,{chartData:vt,familyId:t?.id,expenseChartRef:xt,budgetChartRef:gt,goalChartRef:ft,goalBreakdownChartRef:pt,toggleTip:De,refreshKey:Nt}),i==="members"&&e.jsx(Gt,{isCreator:ge,familyData:t,members:f,getMemberRoleBadge:wt,familyId:t?.id,onMembersUpdate:()=>{t?.id&&p(t.id)}}),i==="activity"&&e.jsx(Bt,{recentActivity:B}),i==="goals"&&e.jsx(zt,{familyGoals:x,isCreator:ge,loadingFamilyGoals:u,selectedGoalForContributions:z,loadingContributions:$,goalContributions:le,contributionChartData:_,contributionPieChartData:L||[],contributionBarChartRef:$e,contributionPieChartRef:Oe,openContributeModal:Mt,fetchGoalContributions:Ct,toggleTip:De,getRemainingDays:_t,onRefresh:Je})]})]})}),e.jsx("div",{className:"d-none d-md-block",children:e.jsxs("div",{className:"card shadow mb-4",children:[e.jsxs("div",{className:"card-header py-3 d-flex justify-content-between align-items-center",children:[e.jsxs("ul",{className:"nav nav-tabs card-header-tabs mb-0",children:[e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link btn btn-link ${i==="overview"?"active":""}`,onClick:()=>K("overview"),children:[e.jsx("i",{className:"fas fa-chart-pie mr-1"})," Overview"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link btn btn-link ${i==="goals"?"active":""}`,onClick:()=>K("goals"),children:[e.jsx("i",{className:"fas fa-flag-checkered mr-1"})," Family Goals"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link btn btn-link ${i==="members"?"active":""}`,onClick:()=>K("members"),children:[e.jsx("i",{className:"fas fa-users mr-1"})," Members (",f.length,")"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link btn btn-link ${i==="activity"?"active":""}`,onClick:()=>K("activity"),children:[e.jsx("i",{className:"fas fa-history mr-1"})," Recent Activity"]})})]}),e.jsx("button",{onClick:Je,disabled:Te,className:"btn btn-primary shadow-sm mr-2 d-inline-flex align-items-center",style:{minWidth:"100px"},children:Te?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm mr-2",role:"status","aria-hidden":"true"}),"Refreshing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-sync-alt mr-2"}),"Refresh"]})})]}),e.jsxs("div",{className:"card-body",children:[i==="overview"&&e.jsx(It,{chartData:vt,familyId:t?.id,expenseChartRef:xt,budgetChartRef:gt,goalChartRef:ft,goalBreakdownChartRef:pt,toggleTip:De,refreshKey:Nt}),i==="members"&&e.jsx(Gt,{isCreator:ge,familyData:t,members:f,getMemberRoleBadge:wt,familyId:t?.id,onMembersUpdate:()=>{t?.id&&p(t.id)}}),i==="activity"&&e.jsx(Bt,{recentActivity:B}),i==="goals"&&e.jsx(zt,{familyGoals:x,isCreator:ge,loadingFamilyGoals:u,selectedGoalForContributions:z,loadingContributions:$,goalContributions:le,contributionChartData:_,contributionPieChartData:L||[],contributionBarChartRef:$e,contributionPieChartRef:Oe,openContributeModal:Mt,fetchGoalContributions:Ct,toggleTip:De,getRemainingDays:_t,onRefresh:Je})]})]})})]}):e.jsx(Ls,{onJoinSuccess:ns})})})};export{ta as default};
